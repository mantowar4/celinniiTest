/*
 Textbox.io JavaScript Library
 Copyright (c) 2013-2017 Ephox Corp. All rights reserved.
 This software is provided "AS IS," without a warranty of any kind.

 Version: 2.4.2.101
 Client Build: 2.4.2.144
*/
(function () {
    function Vx() {
        return {major: "2", minor: "4", full: "2.4.2.101"}
    }

    function gT() {
        var a = g.none(), b = function (b) {
            a = g.some(b.api)
        };
        return {
            add: function (c) {
                var d = u(b, c);
                a.isNone() && b(c);
                c.api.events.focus.addListener(d)
            }, get: function () {
                return a
            }, remove: function (b) {
                a.is(b.api) && (a = g.none())
            }
        }
    }

    function hT(a, b, c) {
        var d = g.from(a.ui.editorName).map(I.error);
        c = c.map(I.value);
        d = d.or(c).getOrThunk(function () {
            return I.value(iT())
        });
        c = Wx.toolbar(a.platform.toolbar, b);
        b = Wx.mentions(a.mentions, b);
        return oa(a, {
            ui: {editorName: d},
            platform: {toolbar: c}, mentions: b
        })
    }

    function jT() {
        var a = [];
        return {
            get: function (b) {
                return qa(a, function (a) {
                    return a.is(b)
                })
            }, findAll: function (b) {
                var c = Fa.all(b);
                return ka(a, function (a) {
                    return Xa(c, a.is)
                })
            }, add: function (b) {
                a.push(b)
            }, remove: function (b) {
                Gc(a, b).each(function (b) {
                    a.splice(b, 1)
                })
            }
        }
    }

    function Xx(a, b, c, d, e) {
        return a(c, d) ? g.some(c) : vb(e) && e(c) ? g.none() : b(c, d, e)
    }

    function Tb(a, b) {
        z(b, function (b, d) {
            if (d > a.length - 1) {
                if (b.required()) throw Error('missing parameter "' + b.name() + '"');
            } else b.validate(a[d])
        })
    }

    function kT(a) {
        var b = Ql.create(), c = eb(a, function (a) {
            var c = lT.create();
            b.bind(a, c.eventTrigger);
            return c
        });
        a = eb(c, function (a) {
            return a.eventRegistry
        });
        c = eb(c, function (a) {
            return a.eventTrigger
        });
        return {
            registry: a, trigger: c, destroy: function () {
                b.unbindAll()
            }
        }
    }

    function mT() {
        var a = {};
        return {
            getOrSetIndexed: function (b, c) {
                if (void 0 !== a[b]) return a[b];
                c = c();
                return a[b] = c
            }, waitForLoad: function () {
                var b = Ze(a);
                return Rl(b, Ga.nu)
            }
        }
    }

    function Yx() {
        var a = mT(), b = function () {
            return a.waitForLoad()
        };
        return {
            preload: function () {
                b().get(ca)
            },
            addStylesheet: function (b, d) {
                return a.getOrSetIndexed(b, function () {
                    return nT.download(b, d)
                })
            }, addScript: function (b, d) {
                return a.getOrSetIndexed(b, function () {
                    return oT.download(b).map(d)
                })
            }, waitForLoad: b
        }
    }

    function pT(a) {
        var b = function (b, c, f) {
            Tb(arguments, [ba.func("filter"), ba.string("selector"), ba.func("callback")]);
            var d = b(c, Zx(f));
            a.filter().customFilters().addFilter(d)
        }, c = function (b, c, f) {
            Tb(arguments, [ba.func("filter"), ba.func("predicate"), ba.func("callback")]);
            var d = b(qT(c), Zx(f));
            a.filter().customFilters().addFilter(d)
        };
        return {
            selector: {addInput: u(b, ij.inputSelector), addOutput: u(b, ij.outputSelector)},
            predicate: {addInput: u(c, ij.inputPredicate), addOutput: u(c, ij.outputPredicate)}
        }
    }

    function zq(a, b, c, d) {
        return {
            term: function () {
                return new RegExp(a, d.getOr("g"))
            }, prefix: b, suffix: c
        }
    }

    function rT(a, b, c) {
        var d = Cb.sanitise(a), e = Cb.sanitise(b);
        return {
            patterns: function () {
                return [new RegExp(d + "(.*?)" + e, "gi")]
            }, useCursor: Jb, generate: function (a, b) {
                return c.generate(a, b.key(), b.value())
            }, derive: function (a) {
                var b = a[1];
                return c.get(b).map(function (c) {
                    return {
                        startIndex: h(a.index),
                        finishIndex: h(a.index + a[0].length), key: h(b), value: h(c)
                    }
                })
            }
        }
    }

    function $x(a, b, c) {
        return rT(a, b, {
            get: function (a) {
                a = c(a);
                return g.some(a)
            }, generate: function (a, b, c) {
                a = qe.fromHtml(c, a.dom());
                return Zd.species({elements: h(a), cursor: g.none, dictation: g.none, notify: g.none})
            }
        })
    }

    function ay(a, b) {
        var c = function (a) {
            try {
                return d(a)
            } catch (l) {
                return g.none()
            }
        }, d = function (b) {
            return a(b) ? g.from(b.dom().nodeValue) : g.none()
        }, e = aa.detect().browser, f = e.isIE() && 10 === e.version.major ? c : d;
        return {
            get: function (c) {
                if (!a(c)) throw Error("Can only get " +
                    b + " value of a " + b + " node");
                return f(c).getOr("")
            }, getOption: f, set: function (c, d) {
                if (!a(c)) throw Error("Can only set raw " + b + " value of a " + b + " node");
                c.dom().nodeValue = d
            }
        }
    }

    function nb() {
        return {
            up: h({selector: L.ancestor, closest: L.closest, predicate: Ja.ancestor, all: A.parents}),
            down: h({selector: Y.descendants, predicate: ed.descendants}),
            styles: h({get: v.get, getRaw: v.getRaw, set: v.set, remove: v.remove}),
            attrs: h({
                get: m.get, set: m.set, remove: m.remove, copyTo: function (a, b) {
                    a = m.clone(a);
                    m.setAll(b, a)
                }
            }),
            insert: h({
                before: y.before,
                after: y.after,
                afterAll: P.after,
                append: y.append,
                appendAll: P.append,
                prepend: y.prepend,
                wrap: y.wrap
            }),
            remove: h({unwrap: F.unwrap, remove: F.remove}),
            create: h({
                nu: r.fromTag, clone: function (a) {
                    return r.fromDom(a.dom().cloneNode(!1))
                }, text: r.fromText
            }),
            query: h({
                comparePosition: function (a, b) {
                    return a.dom().compareDocumentPosition(b.dom())
                }, prevSibling: A.prevSibling, nextSibling: A.nextSibling
            }),
            property: h({
                children: A.children,
                name: D.name,
                parent: A.parent,
                isText: D.isText,
                isComment: D.isComment,
                isElement: D.isElement,
                getText: Ya.get,
                setText: Ya.set,
                isBoundary: function (a) {
                    return D.isElement(a) ? "body" === D.name(a) ? !0 : U(sT, D.name(a)) : !1
                },
                isEmptyTag: function (a) {
                    return D.isElement(a) ? U(["br", "img", "hr", "input"], D.name(a)) : !1
                }
            }),
            eq: N.eq,
            is: N.is
        }
    }

    function tT(a, b, c) {
        var d = kT({
                loaded: a.events.loaded,
                focus: a.events.focus,
                change: a.events.change,
                dirty: a.events.dirty,
                internal: a.events.internal
            }), e = function (a, b) {
                var c = A.owner(a);
                a = A.defaultView(a);
                c = Za.get(c);
                b = b();
                a.dom().scrollTo(c.left(), c.top());
                return b
            }, f = u(Aq.getText, a),
            k = Sl.makeReadOnly({
                content: {
                    documentElement: u(Fd.documentElement, a),
                    insertHtmlAtCursor: u(Fd.insertHtmlAtCursor, a),
                    uploadImages: u(Fd.uploadImages, a),
                    get: u(Fd.get, a),
                    set: u(Fd.set, a),
                    isDirty: u(Fd.isDirty, a),
                    setDirty: u(Fd.setDirty, a),
                    selection: {findTagAtCursor: u(Aq.findTagAtCursor, a), getText: f, getHtml: u(Aq.getHtml, a)},
                    getSelectedText: f
                },
                mode: {set: u(by.set, a), get: u(by.get, a)},
                filters: pT(a),
                macros: {addSimpleMacro: u(cy.addSimpleMacro, a), removeMacro: u(cy.removeMacro, a)},
                message: u(uT.message, a),
                events: d.registry,
                element: function () {
                    return a.element().dom()
                },
                focus: a.focus,
                restore: gc(function () {
                    return e(a.element(), function () {
                        vT.blur();
                        var b = Fd.get(a);
                        d.destroy();
                        a.destroy();
                        return c.restore(b)
                    })
                })
            });
        z(b, function (a) {
            Bq.hookup(k, a)
        });
        return k
    }

    function wT() {
        var a = gT(), b = jT(), c = function (a) {
            return a.api
        }, d = function (c, d) {
            var e = hT(d.options(), function () {
                return f.getOrDie("Internal Error")
            }, g.from(m.get(c, "id"))), f = xT.one(c, d.constructors(), e).map(function (d) {
                var f = tT(d.polish, e && e.plugins ? e.plugins : [], {
                    restore: function (c) {
                        b.remove(k);
                        a.remove(k);
                        return d.restore(c).dom()
                    }
                }), k = {
                    is: function (a) {
                        return N.eq(c, a)
                    }, api: f
                };
                b.add(k);
                a.add(k);
                return f
            });
            return f
        };
        return {
            getOrCreate: function (a, f) {
                return b.get(a).map(c).orThunk(function () {
                    return d(a, f)
                })
            }, get: function (a) {
                a = b.findAll(a);
                return E(a, c)
            }, getActiveEditor: a.get
        }
    }

    function Cq(a, b, c) {
        var d = c || !1, e = function () {
            b();
            d = !0
        }, f = function () {
            a();
            d = !1
        };
        return {
            on: e, off: f, toggle: function () {
                (d ? f : e)()
            }, isOn: function () {
                return d
            }
        }
    }

    function p(a) {
        var b = O.apply(null, a), c = [];
        return {
            bind: function (a) {
                if (void 0 ===
                    a) throw"Event bind error: undefined handler";
                c.push(a)
            }, unbind: function (a) {
                c = ka(c, function (b) {
                    return b !== a
                })
            }, trigger: function () {
                var a = b.apply(null, arguments);
                z(c, function (b) {
                    b(a)
                })
            }
        }
    }

    function dy(a, b) {
        var c = function (c) {
            var d = b(c);
            return 0 >= d || null === d ? (c = v.get(c, a), parseFloat(c) || 0) : d
        }, d = function (a, b) {
            return hb(b, function (b, c) {
                c = v.get(a, c);
                c = void 0 === c ? 0 : parseInt(c, 10);
                return isNaN(c) ? b : b + c
            }, 0)
        };
        return {
            set: function (b, c) {
                if (!$e(c) && !c.match(/^[0-9]+$/)) throw a + ".set accepts only positive integer values. Value was " +
                c;
                b = b.dom();
                af.isSupported(b) && (b.style[a] = c + "px")
            }, get: c, getOuter: c, aggregate: d, max: function (a, b, c) {
                a = d(a, c);
                return b > a ? b - a : 0
            }
        }
    }

    function Gd(a) {
        return yT(a, function () {
            return {bind: t, unbind: t}
        })
    }

    function ey(a) {
        a = na(a.dirty);
        var b = a.get, c = a.set, d = H.create({dirty: p([]), clean: p([])}), e = Hd.tap(function (a) {
            var f = b();
            a !== f && (c(a), !0 === a ? d.trigger.dirty() : (e.control.block(), d.trigger.clean(), e.control.unblock()))
        });
        return {
            events: d.registry, isDirty: b, setDirty: e.instance, state: function () {
                return {dirty: b()}
            }
        }
    }

    function fy(a, b, c) {
        var d = [], e = u(b, "input"), f = u(b, "output"), k = u(c, "input"), l = u(c, "output");
        b = function (a) {
            ij.cata(a, e, f, k, l);
            d.push(a)
        };
        z(a.customs, b);
        return {
            state: function () {
                return {customs: d.slice(0)}
            }, addFilter: b
        }
    }

    function Dq(a) {
        var b = {};
        Ma(a, function (a, d) {
            b[d] = a
        });
        return {
            get: function () {
                return Ze(b)
            }, add: function (a) {
                var c = Ha("macro");
                b[c] = a;
                return c
            }, remove: function (a) {
                delete b[a]
            }, state: function () {
                return ua({}, b)
            }
        }
    }

    function zT() {
        var a = t;
        return Eq({
            setAutocorrect: t,
            setSpelling: t,
            events: Gd(["analytics"]),
            init: function (b) {
                b.body().each(function (b) {
                    m.set(b, "spellcheck", "false");
                    a = function () {
                        m.remove(b, "spellcheck")
                    }
                })
            },
            ui: g.none,
            check: t,
            scanView: t,
            situation: Jg.noSituation,
            hasDropdown: h(!1),
            hasAutocorrect: h(!1),
            handle: t,
            assign: t,
            lock: xb,
            destroy: function () {
                a()
            },
            state: h({}),
            lookup: h(g.none()),
            name: h("spelling-disabled")
        })
    }

    function Q(a, b) {
        var c = p(a), d = 0, e = function (b) {
            var d = E(a, function (a) {
                return b[a]()
            });
            c.trigger.apply(null, d)
        };
        return {
            bind: function (a) {
                c.bind(a);
                d++;
                1 === d && b.bind(e)
            }, unbind: function (a) {
                c.unbind(a);
                d--;
                0 === d && b.unbind(e)
            }, trigger: yb("Cannot trigger a source event.")
        }
    }

    function gy(a, b, c) {
        var d = Ta.state(c), e = g.none(), f = g.none(), k = H.create({
            loaded: p([]),
            focus: p([]),
            dirty: Q([], d.laundry.events.dirty),
            change: p([]),
            internal: p(["command", "data"]),
            paint: p(["dimensions"])
        }), l = T.div();
        ma.add(l, [B.resolve("source-container"), "ephox-textbox-font", B.resolve("layer-editor")]);
        c = function () {
            return l
        };
        var q = function () {
                return f.getOrDie("CodeMirror not added to DOM")
            }, C = function (a) {
                return V() ? hy.beautify(a) : a
            },
            w = function (a) {
                var b = q().doc;
                a = C(a);
                b.setValue(a);
                b.clearHistory()
            }, J = function (a) {
                var b = r.fromDom(a.getWrapperElement()), c = -1;
                a.on("changes", function () {
                    var d = a.doc.lineCount();
                    d != c && (c = d, d = a.getScrollInfo(), d = iy({
                        width: Ia.get(b),
                        docWidth: d.width,
                        height: d.height,
                        docHeight: d.height
                    }), k.trigger.paint(d))
                })
            }, G = function () {
                q().focus()
            }, V = function () {
                return !0 === a.content.prettyprint
            };
        return kj.internal({
            activateInline: Id.activateInline,
            blur: yb("blur is not supported in the API."),
            communication: Ta.communication,
            connect: function (c) {
                if (a.content && !0 === a.content.autoresize) {
                    var d = c.dom().clientHeight;
                    sa.set(l, d)
                }
                y.append(c, l);
                b.updateUi(l);
                lj.detect(l);
                var e = Tl.use.codemirror()(l.dom(), {
                    mode: "text/html",
                    extraKeys: {"Ctrl-Space": "autocomplete"},
                    lineWrapping: !0
                });
                Kf(function () {
                    e.refresh();
                    e.focus()
                }, 100);
                e.on("focus", function () {
                    k.trigger.focus()
                });
                f = g.some(e);
                k.trigger.loaded();
                J(e);
                return !0
            },
            content: h({
                body: h(g.none()),
                doc: yb("content.doc is not supported in code view"),
                execCommand: yb("content.execCommand is not supported in code view"),
                getSelectedText: function () {
                    var a = q().getSelection();
                    return void 0 !== a && null !== a && 0 < a.length ? g.some(a) : g.none()
                },
                focus: G,
                isInline: h(!1)
            }),
            deactivateInline: Id.deactivateInline,
            destroy: function () {
                F.remove(l);
                F.empty(l);
                f = g.none()
            },
            element: c,
            events: k.registry,
            filter: d.filter,
            focus: G,
            fromTransfer: function (a) {
                var b = function (a) {
                    w(a);
                    e = g.some(a);
                    f.each(function (a) {
                        a.on("changes", function (a, b) {
                            d.laundry.setDirty(!0);
                            k.trigger.change()
                        })
                    })
                };
                Lf.cata(a, b, b)
            },
            fullscreen: Ta.fullscreen,
            getContent: function () {
                return q().doc.getValue()
            },
            getMode: hc.code,
            insertHtmlAtCursor: function (a) {
                q().replaceSelection(a)
            },
            isDirty: d.laundry.isDirty,
            isPrettyPrinting: V,
            keyboard: Id.keyboard,
            macros: d.macros,
            operations: Id.operations,
            setContent: function (a) {
                w(a);
                d.laundry.setDirty(!1)
            },
            setDirty: d.laundry.setDirty,
            smartview: Id.smartview,
            state: function () {
                return d.getState({content: {}})
            },
            toTransfer: function () {
                var a = q().doc.getValue();
                return e.filter(function (b) {
                    return C(b) === a
                }).fold(function () {
                    return Lf.changed(a)
                }, Lf.unchanged)
            },
            ui: Id.ui,
            undo: h(Ta.undo()),
            uploader: h(Ta.uploader()),
            viewport: c
        })
    }

    function BT(a) {
        var b = T.span();
        n.add(b, va.resolve("toolbar-group"));
        var c = E(a, function (a) {
            return a.component()
        });
        P.append(b, c);
        return jy.group({
            component: function () {
                return b
            }, isVisible: function () {
                return Xa(c, mj.isShowing)
            }, refreshUi: function () {
                z(a, function (a) {
                    a.refreshUi()
                })
            }, destroy: function () {
                z(a, function (a) {
                    a.destroy()
                })
            }
        })
    }

    function Gq(a, b, c) {
        n.add(a, lb.resolve("button"));
        var d = CT.disable(a);
        b = b.getOr(a);
        var e = null, f = n.toggler(a, lb.resolve("button-disabled")),
            k = function () {
                f.isOn() || q.trigger.click()
            }, l = K.bind(b, "click", k), q = H.create({click: p([])});
        return {
            element: function () {
                return a
            }, name: function () {
                return c
            }, destroy: function () {
                l.unbind();
                d.unbind();
                F.remove(a)
            }, content: function (b) {
                null !== e && F.remove(e.element());
                y.append(a, b.element());
                e = b
            }, enable: f.off, disable: f.on, disabled: f.isOn, click: k, events: q.registry
        }
    }

    function Oc(a) {
        var b = r.fromTag("span");
        n.add(b, lb.resolve("independent-button"));
        return Gq(b, g.none(), a)
    }

    function bf(a) {
        var b = T.span();
        m.set(b, "aria-hidden",
            !0);
        ma.add(b, [lb.resolve("icon-content")].concat(a));
        return {
            element: function () {
                return b
            }, destroy: function () {
                F.remove(b)
            }
        }
    }

    function Hq(a) {
        var b = T.span();
        n.add(b, lb.resolve("statebutton"));
        var c = Gq(T.span(), g.some(b), a);
        n.add(c.element(), lb.resolve("dependent-button"));
        y.append(b, c.element());
        a = n.toggler(b, lb.resolve("statebutton-selected"));
        var d = n.toggler(b, lb.resolve("statebutton-disabled"));
        return {
            element: function () {
                return b
            }, destroy: function () {
                c.destroy();
                F.remove(b)
            }, name: c.name, content: c.content,
            enable: function () {
                d.off();
                c.enable()
            }, disable: function () {
                d.on();
                c.disable()
            }, disabled: function () {
                return d.isOn() && c.disabled()
            }, click: c.click, events: c.events, select: a.on, deselect: a.off, selected: a.isOn
        }
    }

    function $d(a) {
        var b = Hq(a), c = H.create({click: p([])}), d = function () {
            b.selected() ? b.deselect() : b.select();
            c.trigger.click()
        };
        b.events.click.bind(d);
        return {
            element: b.element, name: b.name, content: b.content, destroy: function () {
                b.events.click.unbind(d);
                b.destroy()
            }, enable: b.enable, disable: b.disable, disabled: b.disabled,
            click: b.click, events: c.registry, select: b.select, deselect: b.deselect, selected: b.selected
        }
    }

    function DT(a) {
        var b = T.span();
        n.add(b, lb.resolve("dropbutton"));
        var c = T.span();
        n.add(c, lb.resolve("dropbutton-button"));
        var d = T.span();
        n.add(d, lb.resolve("dropbutton-arrow"));
        P.append(b, [c, d]);
        var e = Oc(), f = $d();
        f.content(bf(["ephox-pastry-arrow-icon"]));
        y.append(c, e.element());
        y.append(d, f.element());
        var k = H.create({click: p([]), open: p([]), close: p([])}), l = function () {
            k.trigger.click()
        }, q = function () {
            (f.selected() ?
                k.trigger.open : k.trigger.close)()
        };
        e.events.click.bind(l);
        f.events.click.bind(q);
        return {
            element: function () {
                return b
            }, name: function () {
                return a
            }, content: e.content, events: k.registry, open: function () {
                f.select();
                k.trigger.open()
            }, close: function () {
                f.deselect();
                k.trigger.close()
            }, destroy: function () {
                e.events.click.unbind(l);
                f.events.click.unbind(q);
                e.destroy();
                f.destroy();
                F.remove(b)
            }, isOpen: function () {
                return f.selected()
            }
        }
    }

    function ET(a) {
        var b = T.span();
        n.add(b, lb.resolve("dropbutton"));
        var c = T.span();
        n.add(c,
            lb.resolve("dropbutton-button"));
        var d = T.span();
        n.add(d, lb.resolve("dropbutton-arrow"));
        P.append(b, [c, d]);
        var e = $d(), f = $d();
        f.content(bf(["ephox-pastry-arrow-icon"]));
        y.append(c, e.element());
        y.append(d, f.element());
        var k = H.create({click: p([]), open: p([]), close: p([])}), l = function () {
            k.trigger.click()
        }, q = function () {
            (f.selected() ? k.trigger.open : k.trigger.close)()
        };
        e.events.click.bind(l);
        f.events.click.bind(q);
        return {
            element: h(b),
            name: h(a),
            content: e.content,
            events: k.registry,
            open: function () {
                f.select();
                k.trigger.open()
            },
            close: function () {
                f.deselect();
                k.trigger.close()
            },
            destroy: function () {
                e.events.click.unbind(l);
                f.events.click.unbind(q);
                e.destroy();
                f.destroy();
                F.remove(b)
            },
            isOpen: function () {
                return f.selected()
            },
            click: e.click,
            enable: e.enable,
            disable: e.disable,
            disabled: e.disabled,
            select: e.select,
            deselect: e.deselect,
            selected: e.selected
        }
    }

    function Rc(a) {
        var b = T.span();
        n.add(b, lb.resolve("text-content"));
        y.append(b, r.fromText(a));
        return {
            element: function () {
                return b
            }, destroy: function () {
                F.remove(b)
            }
        }
    }

    function Ul(a) {
        var b =
            re.resolve(a);
        return {
            set: function (a) {
                n.add(a, b)
            }, up: function (a) {
                return n.has(a, b) ? g.some(a) : L.ancestor(a, "." + b)
            }, all: function (a) {
                return Y.descendants(a, "." + b)
            }, first: function (a) {
                return L.descendant(a, "." + b)
            }, is: function (a) {
                return n.has(a, b)
            }
        }
    }

    function ky(a, b) {
        b = void 0 !== b ? b : "info";
        var c = T.div();
        ma.add(c, [B.resolve("banner"), B.resolve("banner-" + b)]);
        b = T.div();
        n.add(b, B.resolve("banner-message"));
        y.append(b, r.fromText(a));
        var d = T.div();
        n.add(d, B.resolve("banner-buttons"));
        a = r.fromTag("span");
        n.add(a,
            B.resolve("banner-close"));
        y.append(d, a);
        S.button(a, x.translate("banner.close"));
        P.append(c, [b, d]);
        var e = K.bind(a, "click", function () {
            f.trigger.close()
        }), f = H.create({close: p([])});
        return {
            element: function () {
                return c
            }, action: function (a) {
                y.prepend(d, a.element())
            }, destroy: function () {
                e.unbind();
                F.remove(c)
            }, events: f.registry
        }
    }

    function nj(a, b) {
        b = void 0 !== b ? b : "error";
        var c = a.description();
        a = a.link();
        var d = ky(c, b), e = g.none(), f = function (a, b) {
            return K.bind(a, "click", function (a) {
                a.kill();
                window.open(b.url())
            })
        };
        b = function (a) {
            var b = r.fromTag("a");
            m.set(b, "href", a.url());
            m.set(b, "target", "_blank");
            var c = r.fromText(a.text());
            e = g.some(f(b, a));
            y.append(b, c);
            d.action({element: h(b)})
        };
        null !== a && a.url() && a.text() && b(a);
        return {
            element: d.element, action: d.action, destroy: function () {
                d.destroy();
                e.each(function (a) {
                    a.unbind()
                })
            }, events: d.events
        }
    }

    function FT(a, b) {
        var c = H.create({populate: p(["items"])}), d = function (b) {
            var c = a(b.textkey);
            c = zb.item(GT, b.name + "-menu-trigger", c);
            n.add(c, va.resolve("menu-more"));
            b = oj.generate("ephox-chameleon-" +
                b.name);
            P.prepend(c, b);
            S.menuItem(c, g.none(), g.some(!0));
            return c
        }(b), e = function (a) {
            a = r.fromText(a);
            f(a)
        }, f = function (a) {
            L.child(d, ".ephox-gopher-item-text").each(function (b) {
                F.empty(b);
                y.append(b, a);
                n.remove(b, ly)
            })
        }, k = Eh.control(d);
        return {
            element: h(d), populate: function (a) {
                c.trigger.populate(a)
            }, select: function (c) {
                L.child(d, ib.tokenSelector()).each(F.remove);
                var f = ib.describe(d, b.describe(c));
                y.append(d, f);
                c = a(c.textkey());
                e(c)
            }, selectElement: f, disable: k.disable, enable: k.enable, clear: function () {
                e(a(b.textkey));
                L.child(d, ".ephox-gopher-item-text").each(function (a) {
                    n.add(a, ly)
                })
            }, destroy: function () {
                F.remove(d)
            }, events: c.registry
        }
    }

    function HT(a, b) {
        var c = b ? a.slice(0) : [], d = b, e = b ? E(Ze(R), function (a) {
            return a()
        }) : [];
        return {
            swallowShortcuts: function (a) {
                c = a.slice(0)
            }, yieldShortcuts: function (a) {
                c = Iq(c, a)
            }, swallowChars: function () {
                d = !0
            }, yieldChars: function () {
                d = !1
            }, swallowKeys: function (a) {
                e = a.slice(0)
            }, yieldKeys: function (a) {
                e = Iq(e, a)
            }, process: function (a, b) {
                a.fold(function (a) {
                    U(c, a) && b()
                }, function (a) {
                    U(e, a) && b()
                }, function () {
                    d &&
                    b()
                })
            }
        }
    }

    function IT(a, b) {
        var c = !1, d = HT(a, b);
        return {
            on: function () {
                c = !0
            },
            off: function () {
                c = !1
            },
            isOn: function () {
                return c
            },
            handle: function (a) {
                return function (b) {
                    c && a(b.raw())
                }
            },
            stop: function (b) {
                var c = JT.identify(b, a);
                d.process(c, u(my.stop, b))
            },
            swallowShortcuts: d.swallowShortcuts,
            yieldShortcuts: d.yieldShortcuts,
            swallowChars: d.swallowChars,
            yieldChars: d.yieldChars,
            swallowKeys: d.swallowKeys,
            yieldKeys: d.yieldKeys
        }
    }

    function pj(a) {
        var b = ua({shortcuts: [], swallow: !1}, a), c = H.create({
                character: p(["character"]),
                space: p(["shift",
                    "stopper"]),
                left: p(["shift", "stopper"]),
                right: p(["shift", "stopper"]),
                backspace: p(["shift", "stopper"]),
                tab: p(["shift", "stopper"]),
                enter: p(["shift", "stopper"]),
                capslock: p(["shift", "stopper"]),
                escape: p(["shift", "stopper"]),
                pageup: p(["shift", "stopper"]),
                pagedown: p(["shift", "stopper"]),
                end: p(["shift", "stopper"]),
                home: p(["shift", "stopper"]),
                down: p(["shift", "stopper"]),
                up: p(["shift", "stopper"]),
                insert: p(["shift", "stopper"]),
                del: p(["shift", "stopper"]),
                command: p(["command"])
            }), d = IT(b.shortcuts, b.swallow),
            e = function (a) {
                return qa(b.shortcuts, function (b) {
                    return ny.isCommand(a, b)
                })
            }, f = function (a, b, d) {
                l(a);
                c.trigger[b].apply(void 0, d)
            }, k = function (a) {
                return function () {
                    d.isOn() && my.stop(a)
                }
            };
        a = d.handle(function (a) {
            e(a).fold(function () {
                var b = Kg.getSpecial(a.keyCode);
                Kg.noModifiers(a) && null !== b && (b = b.toLowerCase(), f(a, b, [a.shiftKey, k(a)]))
            }, function (b) {
                f(a, "command", [b])
            })
        });
        var l = function (a) {
            d.isOn() && d.stop(a)
        }, q = d.handle(function (a) {
            if (Kg.noModifiers(a)) Kg.isCharCode(a) || null === Kg.getSpecial(a.keyCode) ?
                e(a).isSome() ? l(a) : a.which && f(a, "character", [String.fromCharCode(a.which)]) : l(a); else return !1
        });
        return {
            off: d.off,
            on: d.on,
            events: c.registry,
            swallowShortcuts: d.swallowShortcuts,
            yieldShortcuts: d.yieldShortcuts,
            swallowChars: d.swallowChars,
            yieldChars: d.yieldChars,
            swallowKeys: d.swallowKeys,
            yieldKeys: d.yieldKeys,
            keypress: q,
            keydown: a
        }
    }

    function KT(a) {
        var b = H.create({mouseover: p(["item"]), click: p(["item"])}), c = [],
            d = pj({shortcuts: a.shortcuts, swallow: a.swallow});
        a = a.tabs ? [R.TAB()] : [];
        d.swallowKeys([R.UP(), R.DOWN(),
            R.ENTER(), R.SPACE(), R.ESCAPE()].concat(a));
        var e = function () {
            z(c, function (a) {
                a.mouseover().unbind();
                a.click().unbind();
                a.keydown().unbind()
            });
            c = [];
            d.off()
        };
        return {
            destroy: function () {
                e()
            }, attach: function (a) {
                e();
                c = E(a, function (a) {
                    var c = K.bind(a, "mouseover", function (a) {
                        Ic.up(a.target()).each(b.trigger.mouseover)
                    }), e = K.bind(a, "click", function (a) {
                        Ic.up(a.target()).each(b.trigger.click)
                    });
                    a = K.bind(a, "keydown", function (a) {
                        d.keydown(a)
                    });
                    return {mouseover: h(c), click: h(e), keydown: h(a)}
                });
                d.on()
            }, detach: e, simulateKey: function (a) {
                d.keydown(a)
            },
            events: b.registry, keys: d.events
        }
    }

    function LT(a, b) {
        var c = H.create({
            select: p(["item"]),
            active: p(["item"]),
            show: p(["menu"]),
            hide: p(["menu"]),
            collapse: p(["menu"]),
            expand: p(["menu", "trigger"]),
            escaped: p([])
        }), d = KT({shortcuts: [], swallow: [], tabs: b.tabs}), e = {}, f = function (b) {
            Jd.activate(a, b)
        }, k = function () {
            var b = Jd.inactive(a);
            z(b, function (a) {
                Mf.submenu().is(a) && c.trigger.hide(a)
            })
        }, l = function (b) {
            Ic.isEnabled(b) && Jd.submenu(a, e, b).each(function (a) {
                c.trigger.expand(a, b)
            })
        }, q = function (a) {
            Jd.up(a).each(function (b) {
                f(b);
                Kd.selectAll(b, [a]);
                c.trigger.active(a)
            })
        }, C = function (b) {
            Jd.active(a).bind(function (a) {
                Kd.selected(a).orThunk(function () {
                    return Jq.first(a)
                }).each(function (c) {
                    b(a, c)
                })
            })
        }, w = function (a) {
            C(function (b, c) {
                Ic.isEnabled(c) && a(b, c)
            })
        }, g = function (b) {
            C(function (d, f) {
                b(d, f).each(function (b) {
                    N.eq(f, b) || (Jd.submenu(a, e, f).each(c.trigger.collapse), c.trigger.active(b))
                })
            })
        }, G = u(g, Jq.prev), V = u(g, Jq.next), X = function () {
            Mf.main().first(a).each(function (a) {
                f(a);
                Kd.selected(a).each(c.trigger.active)
            })
        }, Hc = function (b) {
            Z.active().fold(b.stopper(),
                function (a) {
                    !1 === U(["input"], D.name(a)) && b.stopper()()
                });
            w(function (b, d) {
                Jd.submenu(a, e, d).fold(function () {
                    Mf.submenu().is(b) && (c.trigger.collapse(b), X())
                }, function (a) {
                    c.trigger.expand(a, d);
                    Kd.none(a);
                    Kd.first(a).each(c.trigger.active);
                    f(a)
                })
            })
        };
        g = function (a) {
            Z.active().fold(a.stopper(), function (b) {
                !1 === U(["input"], D.name(b)) && a.stopper()()
            });
            w(function (a, b) {
                Mf.submenu().is(a) && (c.trigger.collapse(a), X())
            })
        };
        var m = function (a) {
                w(function (b, d) {
                    b = Ic.get(d);
                    e.hasOwnProperty(b) && void 0 !== e[b] ? Hc(a) : c.trigger.select(d)
                })
            },
            n = function (a) {
                a.shift() ? G(a) : V(a)
            };
        d.keys.up.bind(G);
        d.keys.down.bind(V);
        b.tabs && d.keys.tab.bind(n);
        d.keys.enter.bind(m);
        d.keys.space.bind(m);
        d.keys.escape.bind(function (a) {
            a.stopper()();
            C(function (a, b) {
                Mf.submenu().is(a) ? (c.trigger.collapse(a), X()) : c.trigger.escaped()
            })
        });
        "ltr" === ae.getDirection(a) ? (d.keys.left.bind(g), d.keys.right.bind(Hc)) : (d.keys.right.bind(g), d.keys.left.bind(Hc));
        d.events.mouseover.bind(function (b) {
            b = b.item();
            Kd.is(b) && Jd.submenu(a, e, b).forall(sc.isVisible) || (q(b), k(), l(b))
        });
        d.events.click.bind(function (a) {
            a = a.item();
            var b = Ic.get(a);
            e.hasOwnProperty(b) && void 0 !== e[b] || !Ic.isEnabled(a) || c.trigger.select(a)
        });
        return {
            destroy: function () {
                d.destroy()
            }, populate: function (a) {
                e = ua({}, a)
            }, on: function (a) {
                a = void 0 !== a ? a : [r.fromDom(document)];
                d.attach(a)
            }, off: function () {
                d.detach()
            }, selectFirst: function () {
                Jd.active(a).each(function (a) {
                    Kd.none(a);
                    Kd.first(a).each(c.trigger.active)
                })
            }, select: function (a) {
                q(a);
                k()
            }, setActiveMenu: f, simulateKey: d.simulateKey, state: function () {
                return Jd.active(a).bind(function (a) {
                    return Kd.selected(a).map(function (b) {
                        return {
                            menu: h(a),
                            item: h(b)
                        }
                    })
                })
            }, events: c.registry
        }
    }

    function Kq(a, b, c) {
        var d = T.div();
        n.add(d, va.resolve("menu-" + b() + "-sandbox"));
        m.set(d, "tabindex", -1);
        y.append(a(), d);
        var e = g.none(), f = LT(d, {tabs: !0}), k = na({}), l = function () {
            f.off();
            w();
            C.trigger.close()
        }, q = function (a) {
            var b = Nf(k.get(), O("submenu", "item")), c = m.get(a, "data-ephox-gopher-menu-value");
            return qa(b, function (a) {
                return a.submenu() === c
            }).bind(function (b) {
                return L.descendant(d, "[data-ephox-gopher-item-value=" + b.item() + "]").map(function (b) {
                    return {menu: h(a), item: h(b)}
                })
            })
        };
        a = function (a) {
            var b = q(a.menu()).map(function (a) {
                return a.item()
            });
            C.trigger.collapse(a.menu(), b)
        };
        var C = H.create({
            open: p([]),
            close: p([]),
            itemAction: p(["value", "item"]),
            itemHover: Q(["item"], f.events.active),
            reveal: Q(["menu", "trigger"], f.events.expand),
            collapse: p(["menu", "item"]),
            escaped: Q([], f.events.escaped)
        });
        f.events.hide.bind(a);
        f.events.collapse.bind(a);
        f.events.escaped.bind(function () {
            f.state().fold(l, function (a) {
                q(a.menu()).fold(function () {
                    l()
                }, function (a) {
                    C.trigger.collapse(a.menu(), g.some(a.item()));
                    f.select(a.item())
                })
            })
        });
        f.events.select.bind(function (a) {
            a = a.item();
            var b = m.get(a, "data-ephox-gopher-item-value");
            C.trigger.itemAction(b, a)
        });
        f.events.active.bind(function (a) {
            c.focusActive() && Z.focusInside(a.item())
        });
        var w = function () {
            Ma(k.get(), function (a, b) {
                L.descendant(d, '[data-ephox-gopher-menu-value="' + a + '"]').each(function (a) {
                    var c = L.descendant(d, '[data-ephox-gopher-item-value="' + b + '"]');
                    C.trigger.collapse(a, c)
                })
            })
        };
        return {
            update: function (a) {
                k.set(a);
                f.populate(a)
            }, setActiveMenu: function (a) {
                e =
                    g.from(a);
                f.setActiveMenu(a);
                f.selectFirst()
            }, getActiveMenu: function () {
                return e
            }, structure: k, destroy: function () {
                l();
                f.destroy()
            }, open: function (a, b) {
                Z.focus(b);
                f.on(a);
                C.trigger.open()
            }, close: l, events: C.registry, sandbox: h(d), select: f.select, simulateKey: f.simulateKey
        }
    }

    function Fh(a, b) {
        return {southeast: h(Ra(-a, b)), southwest: h(Ra(a, b)), northeast: h(Ra(-a, -b)), northwest: h(Ra(a, -b))}
    }

    function Vl() {
        return {
            northwest: function () {
                return Ra(-2, 1)
            }, northeast: function () {
                return Ra(0, 1)
            }, southwest: function () {
                return Ra(-2,
                    -2)
            }, southeast: function () {
                return Ra(0, -2)
            }
        }
    }

    function oy(a, b, c) {
        c = c || [r.fromDom(document)];
        var d = [], e = function (c) {
            var d = b();
            c = c.target();
            N.member(c, d) || MT.anyAncestor(c, d) || a(c)
        };
        return {
            on: function () {
                z(c, function (a) {
                    d.push(K.bind(a, "mousedown", e).unbind)
                })
            }, off: function () {
                z(d, xb)
            }, mousedown: e
        }
    }

    function NT(a) {
        var b = ua({layerClass: null, zindex: null}, a), c = T.div();
        n.add(c, lb.resolve("panel"));
        v.setAll(c, {position: "fixed", display: "none", top: "0px"});
        b.zindex && v.set(c, "z-index", b.zindex);
        b.layerClass && n.add(c,
            b.layerClass);
        a = void 0 !== a.container ? a.container : L.first("body").getOrDie();
        y.append(a, c);
        a = sc.displayToggler(c, "block");
        return {
            element: function () {
                return c
            }, destroy: function () {
                F.remove(c)
            }, content: function (a) {
                F.empty(c);
                y.append(c, a)
            }, show: a.on, hide: a.off, toggle: a.toggle
        }
    }

    function qj(a, b, c, d, e) {
        var f = [], k = function () {
            var a = E(f, function (a) {
                return a.popup().panel()
            }).concat(d);
            z(f, function (b) {
                b.popup().setComponents(a)
            })
        }, l = function (a) {
            var b = Wl.get(f, a, Xl(a)).fold(function () {
                return C(a)
            }, function (a) {
                return a.popup()
            });
            k();
            f = Wl.put(f, a, b, py, Xl(a));
            return b
        }, q = function (a) {
            Wl.get(f, a, Xl(a)).each(function (a) {
                a.popup().close()
            });
            v.set(a, "display", "none")
        }, C = function (b) {
            var c = OT.create(a, e);
            c.setContent(b);
            f = Wl.put(f, b, c, py, Xl(b));
            k();
            return c
        };
        return {
            initMenu: C, registerMenus: function (a) {
                f = PT.triage(f);
                return E(a, l)
            }, hideAll: function () {
                z(f, function (a) {
                    q(a.menu())
                })
            }, hideMenu: q, expandMenu: function (d, e) {
                var f = l(d), k = Db.descendant(d, "." + Yl.styles()) ? cf.expandable() : cf.anchored();
                e = Lg.submenu(a, b, h(e), c.uiDirection(), k);
                v.set(d, "display", "block");
                f.open();
                e.recalculate(f);
                return {popup: f, anchorage: e}
            }
        }
    }

    function qy(a, b) {
        var c = T.span();
        ma.add(c, [lb.resolve("righticon-content"), b]);
        y.append(c, a);
        return {
            element: function () {
                return c
            }, destroy: function () {
                F.remove(c)
            }
        }
    }

    function QT(a, b) {
        var c = Rc(a), d = qy(c.element(), b);
        return {
            element: d.element, destroy: function () {
                c.destroy();
                d.destroy()
            }
        }
    }

    function RT(a, b, c, d, e, f, k, l, q, C) {
        var w = $d(c);
        k = Lq.control(w);
        ma.add(w.element(), [va.resolve("dropdown-button"), va.resolve(c + "-dropdown-button")]);
        m.set(w.element(), "title", l(d));
        S.toolbarButton(w.element(), l(d), !0, q);
        var g = Kq(a.uiContainer, h("dropdown-" + c), rj.menu({focusActive: !0})), G = r.fromDom(document),
            V = zb.mainmenu(G, c + "-menu", []), X = qj(g.sandbox, a.bounds, b, [w.element()], C).initMenu(V);
        c = Vl();
        var Hc = Lg.main(a.uiContainer, a.bounds, w.element, c, b.uiDirection(), cf.anchored());
        S.menu(V, l(e));
        var Fq = Ha("menu-control");
        m.set(V, "id", Fq);
        S.controls(w.element(), Fq);
        var jj = T.span();
        n.add(jj, va.resolve("dropdown-viewport"));
        w.content({element: h(jj)});
        var Dh = function (a, b) {
            b = b.map(oj.generate).getOr([]);
            P.prepend(a, b)
        };
        b = function () {
            v(l(d))
        };
        var v = function (a) {
            F.empty(jj);
            y.append(jj, QT(a, "ephox-pastry-arrow-righticon").element())
        }, x = function () {
            w.deselect();
            q && ra.pressed(w);
            ra.collapsed(w.element());
            S.disown(w.element());
            X.close();
            g.close()
        }, A = function () {
            w.select();
            q && ra.pressed(w);
            ra.expanded(w.element());
            S.owns(w.element(), Fq);
            X.open();
            var b = [a.uiContainer()];
            g.open(b, w.element())
        }, ry = H.create({
            select: Q(["value", "item"], g.events.itemAction),
            itemHover: Q(["item"],
                g.events.itemHover),
            escaped: Q([], g.events.escaped),
            open: p(["menu", "popup", "anchor"]),
            close: Q([], g.events.close)
        });
        w.events.click.bind(function () {
            (w.selected() ? A : x)()
        });
        X.events.close.bind(x);
        g.events.open.bind(function () {
            ry.trigger.open(V, X, Hc);
            g.update({});
            ST() || g.setActiveMenu(V)
        });
        g.events.escaped.bind(x);
        b();
        return {
            element: h(w.element()),
            menu: X.element,
            list: h(V),
            click: w.click,
            populate: function (a) {
                F.empty(V);
                z(a, function (a) {
                    a.label().each(function (a) {
                        a = Zl.generateSeparator(G, a, l);
                        y.append(V, a)
                    });
                    z(a.items(), function (a) {
                        var b = Zl.generateItem(G, a, f, l);
                        S.menuItemCheckbox(b);
                        Dh(b, a.icon());
                        y.append(V, b)
                    })
                })
            },
            enable: k.enable,
            disable: k.disable,
            close: x,
            uiStale: X.uiStale,
            recalculate: function () {
                Hc.recalculate(X)
            },
            clear: b,
            select: function (a) {
                v(l(a.textkey()));
                Dh(jj, a.icon())
            },
            selectElement: function (a) {
                a = qy(a, "ephox-pastry-arrow-righticon");
                w.content({element: a.element, destroy: t})
            },
            tick: u(Gh.tick, V),
            untick: u(Gh.untick, V),
            activate: u(Gh.activate, w.element()),
            deactivate: u(Gh.deactivate, w.element()),
            destroy: function () {
                g.destroy();
                w.destroy()
            },
            events: ry.registry
        }
    }

    function TT(a) {
        var b = sy.menu(a);
        return {
            widget: b.widget, menu: b.menu, general: b.general, "inline-widget": function (a) {
                return b["inline-widget"]({
                    instance: function () {
                        return a.instance(Mq.menu())
                    }
                })
            }, "split-widget": b["split-widget"], dropdown: b.dropdown, palette: b.palette
        }
    }

    function UT(a, b, c, d, e, f, k) {
        var l = sy.toolbar(f, c, k, Mg.editorContainer()), q = function (q) {
            return u(q, l, a, b, c, d, e, f, k)
        };
        return {
            widget: q(Nq.widget), "inline-widget": q(Nq.inlineWidget), "split-widget": q(Nq.splitWidget),
            cards: l.cards, general: q(VT.init), dropdown: q(WT.init), menu: q(XT.init), palette: l.palette
        }
    }

    function YT(a) {
        var b = Hq("overflower");
        n.add(b.element(), va.resolve("more-button"));
        b.content(Rc(a("toolbar.more")));
        var c = Of.onButton(b);
        m.set(b.element(), "tabindex", "-1");
        a = a("aria.label.more");
        m.set(b.element(), "title", a);
        var d = Ng.aria(b, a, !0, !0), e = Oq.toolbar([{component: b.element, destroy: b.destroy, refreshUi: t}]);
        return {
            group: e.component, select: function () {
                b.select();
                d.press()
            }, deselect: function () {
                d.release();
                b.deselect()
            }, focus: function () {
                Z.focus(b.element())
            }, destroy: function () {
                c.unbind();
                d.destroy();
                e.destroy()
            }, events: b.events
        }
    }

    function ty(a) {
        var b = [];
        return {
            add: function (c, d) {
                d = d ? a.indexOf(b, d).getOrDie() : b.length;
                b.splice(d, 0, c);
                return uy(c, d)
            }, remove: function (c) {
                var d = a.resolve(b, c).getOrDie();
                return Gc(b, d).bind(function (a) {
                    b.splice(a, 1);
                    return uy(d, a)
                })
            }, get: function () {
                return b.slice(0)
            }, itemAt: function (c) {
                return a.resolve(b, c)
            }
        }
    }

    function vy(a) {
        var b = function (a, b) {
            return $e(b) ? c(a, b) : xa(b) ? d(a,
                b) : ic(b) ? e(a, b) : I.error("Unsupported specifier type: " + b)
        }, c = function (a, b) {
            return 0 === a.length ? I.error("Items is empty") : 0 > b || b >= a.length ? I.error("Item index: " + b + " is out of range (0-" + (a.length - 1) + ")") : I.value(a[b])
        }, d = function (b, c) {
            return qa(b, function (b) {
                return a(b) === c
            }).fold(function () {
                return I.error("No item with value: [" + c + "]")
            }, function (a) {
                return I.value(a)
            })
        }, e = function (a, b) {
            return Gc(a, b).fold(function () {
                return I.error("Specified object is not a registered item: " + b)
            }, function (a) {
                return I.value(b)
            })
        };
        return {
            resolve: b, indexOf: function (a, c) {
                return b(a, c).bind(function (b) {
                    return Gc(a, b).fold(function () {
                        return I.error("Item not found: " + c)
                    }, function (a) {
                        return I.value(a)
                    })
                })
            }, index: c, value: d, item: e
        }
    }

    function ZT(a, b) {
        b = H.create({grow: p([]), shrink: p([]), exit: p([])});
        var c = ty(vy(ca)), d = r.fromTag("div");
        v.set(d, "overflow-x", "auto");
        n.add(d, va.resolve("toolstrip"));
        S.toolbarGroup(d);
        var e = r.fromTag("div");
        ma.add(e, [va.resolve("toolbar"), va.resolve("toolbar-primary")]);
        var f = r.fromTag("div");
        ma.add(f, [va.resolve("toolbar"),
            va.resolve("toolbar-more")]);
        y.append(d, e);
        y.append(d, f);
        var k = function () {
            var a = c.get();
            return ia(a, function (a) {
                return a.isVisible() ? [a.component()] : []
            })
        }, l = function () {
            var b = k();
            b = a.build(b);
            F.empty(e);
            F.empty(f);
            P.append(e, b);
            v.reflow(e)
        };
        return {
            element: function () {
                return d
            },
            main: h(e),
            mores: h(f),
            destroy: function () {
                var a = c.get();
                z(a, function (a) {
                    a.destroy()
                })
            },
            focused: fd,
            enter: t,
            restore: t,
            refocus: t,
            refresh: u(Hh.preserve, l, d),
            repaint: u(Hh.preserve, l, d),
            add: function (a) {
                c.add(a)
            },
            events: b.registry
        }
    }

    function wy(a) {
        Pq(a);
        var b = !1, c = K.bind(a, "transitionend", function (c) {
            "height" === c.raw().propertyName && (ma.remove(a, [xy, yy]), b && v.remove(a, "height"))
        });
        return {
            visible: function () {
                return b
            }, hide: function () {
                b = !1;
                Qq(a, sa.get(a));
                n.add(a, yy);
                Pq(a)
            }, show: function () {
                zy(a);
                var c = sa.get(a);
                Pq(a);
                n.add(a, xy);
                zy(a);
                Qq(a, c);
                b = !0
            }, destroy: function () {
                c.unbind()
            }
        }
    }

    function $T(a, b) {
        var c = H.create({grow: p([]), shrink: p([]), exit: p([])}), d = ty(vy(ca)), e = r.fromTag("div");
        S.toolbarGroup(e);
        n.add(e, va.resolve("toolstrip"));
        var f = r.fromTag("div");
        ma.add(f, [va.resolve("toolbar"), va.resolve("toolbar-primary")]);
        var k = r.fromTag("div");
        ma.add(k, [va.resolve("toolbar"), va.resolve("toolbar-more")]);
        y.append(e, f);
        y.append(e, k);
        var l = wy(k);
        b.events.click.bind(function () {
            l.visible() ? (l.hide(), b.deselect(), c.trigger.shrink()) : (l.show(), b.select(), c.trigger.grow())
        });
        var q = function () {
            var a = d.get();
            return ia(a, function (a) {
                return a.isVisible() ? [a.component()] : []
            })
        }, C = function () {
            a.update();
            var c = q();
            c = a.build(c);
            v.set(f, "visibility", "hidden");
            a.clearWidth();
            F.empty(f);
            P.append(f, c);
            var d = a.width(f);
            y.append(f, b.group());
            c = aU.partition(d, c, Ia.getOuter, b.group());
            d = c.extra();
            var e = c.within();
            F.empty(f);
            F.empty(k);
            P.append(f, e);
            P.append(k, d);
            a.updateWidth(b, c);
            v.remove(f, "visibility")
        }, w = function () {
            Hh.preserve(C, e)
        };
        return {
            element: function () {
                return e
            }, main: h(f), mores: h(k), destroy: function () {
                var a = d.get();
                z(a, function (a) {
                    a.destroy()
                });
                b.destroy();
                l.destroy()
            }, focused: fd, enter: t, restore: t, refocus: t, refresh: w, repaint: function () {
                a.shouldRefresh() && w()
            }, add: function (a) {
                d.add(a)
            },
            events: c.registry
        }
    }

    function Pf(a, b, c) {
        var d = K.bind(a, "keydown", c.getOr(function (a) {
            qa(b, function (b) {
                return b.matches(a)
            }).each(function (b) {
                b.run(a).each(function (b) {
                    a.kill()
                })
            })
        })), e = H.create({enter: p([]), exit: p([])});
        return gd({
            isFocused: u(fb.isFocused, a), element: h(a), clear: t, enter: function () {
                fb.set(a);
                e.trigger.enter()
            }, refresh: t, isEnabled: Jb, exit: function () {
                e.trigger.exit()
            }, events: e.registry, destroy: function () {
                d.unbind()
            }
        })
    }

    function Rq(a, b) {
        var c = Pf(a, [ea.rule(ea.inSet(R.SPACE().concat(R.ENTER())),
            function () {
                b.execute()(a);
                return g.some(!0)
            })], b.process());
        return gd({
            element: c.element,
            destroy: c.destroy,
            clear: c.clear,
            isFocused: c.isFocused,
            isEnabled: Jb,
            refresh: t,
            enter: c.enter,
            exit: c.exit
        })
    }

    function sj(a, b) {
        var c = u(b, -1, 0), d = u(b, 1, 0), e = ae.onDirection(c, d);
        d = ae.onDirection(d, c);
        c = u(b, 0, -1);
        b = u(b, 0, 1);
        var f = function (b) {
            return b(a)()
        };
        e = u(f, e);
        d = u(f, d);
        return {west: e, east: d, north: c, south: b}
    }

    function bU(a, b) {
        var c = YT(b), d = aa.detect().deviceType.isTouch() ? ZT(a, c) : $T(a, c);
        S.toolbar(d.main(), b("aria.label.toolbar"));
        S.group(d.mores());
        var e = H.create({
            drawer: Q(["delta", "total"], d.events.drawer),
            grow: Q([], d.events.grow),
            shrink: p([]),
            transitionend: p(["property"]),
            exit: p([])
        }), f = K.bind(d.element(), "transitionend", function (a) {
            e.trigger.transitionend(a.raw().propertyName)
        }), k = g.none();
        a = Ba.sectors({first: g.none, trigger: Of.trigger});
        var l = ha.sectors(d.element(), cU, a);
        l.events.exit.bind(function () {
            k = g.none();
            e.trigger.exit()
        });
        l.events.active.bind(function (a) {
            k = g.some(a.element())
        });
        var q = function () {
                return l.isFocused()
            },
            C = function () {
                k.each(Z.focus)
            };
        d.events.shrink.bind(function () {
            Z.search(d.mores()).isSome() && c.focus();
            e.trigger.shrink()
        });
        return {
            element: d.element, refresh: d.refresh, repaint: d.repaint, add: d.add, enter: function () {
                l.enter()
            }, destroy: function () {
                l.exit();
                k = g.none();
                f.unbind();
                d.destroy();
                l.destroy()
            }, focused: q, restore: C, refocus: function () {
                q() && C()
            }, events: e.registry
        }
    }

    function dU() {
        var a = T.div();
        n.add(a, B.resolve("bannerarium"));
        n.add(a, B.resolve("layer-above-editor"));
        var b = g.some([]), c = Ql.create(), d =
            function (a) {
                b = b.bind(function (b) {
                    b = ka(b, function (b) {
                        return b !== a
                    });
                    return g.some(b)
                });
                e(a)
            }, e = function (a) {
            a.destroy();
            c.unbind(a.events.close);
            F.remove(a.element())
        }, f = H.create({close: p(["banner"])});
        return {
            element: function () {
                return a
            }, display: function (e) {
                b.fold(function () {
                    e.destroy()
                }, function (b) {
                    b.push(e);
                    c.bind(e.events.close, function () {
                        d(e);
                        f.trigger.close(e)
                    });
                    y.append(a, e.element())
                })
            }, hide: d, destroy: function () {
                F.remove(a);
                b = b.bind(function (a) {
                    z(a, e);
                    return g.none()
                })
            }, events: f.registry
        }
    }

    function Ay() {
        var a =
            dU();
        a.events.close.bind(function () {
            b.trigger.resize()
        });
        var b = H.create({resize: p([])});
        return {
            element: a.element, display: function (c) {
                a.display(c);
                b.trigger.resize()
            }, hide: function (c) {
                a.hide(c);
                b.trigger.resize()
            }, destroy: a.destroy, events: b.registry
        }
    }

    function By(a, b, c) {
        var d = -1;
        return {
            shouldRefresh: function () {
                return Ia.getOuter(b) !== d
            },
            updateWidth: u(function (a, b, c) {
                d = Ia.getOuter(a)
            }, b),
            updateHeight: t,
            clearWidth: t,
            build: ca,
            update: t,
            width: Ia.getOuter,
            init: function (a, b, c, d, q, C) {
                a.refresh()
            },
            state: h({toolbar: {drag: g.none()}}),
            integrate: function (a, b, c, d, q) {
                var e = T.div();
                ma.add(e, [B.resolve("sticky-container"), B.resolve("layer-above-editor")]);
                P.append(e, [b.element(), c.element(), q]);
                P.append(a, [e, d])
            },
            destroy: t,
            events: Gd(["changed", "dock", "undock"])
        }
    }

    function eU(a) {
        a = ua({layerClass: Cy.resolve("blocker")}, a);
        var b = r.fromTag("div");
        m.set(b, "role", "presentation");
        v.setAll(b, {position: "fixed", left: "0px", top: "0px", width: "100%", height: "100%"});
        n.add(b, Cy.resolve("blocker"));
        n.add(b, a.layerClass);
        return {
            element: function () {
                return b
            },
            destroy: function () {
                F.remove(b)
            }
        }
    }

    function fU() {
        var a = g.none(), b = function (b, c) {
            var d = a.map(function (a) {
                return b.compare(a, c)
            });
            a = g.some(c);
            return d
        }, c = H.create({move: p(["info"])});
        return {
            onEvent: function (a, e) {
                e.extract(a).each(function (a) {
                    b(e, a).each(function (a) {
                        c.trigger.move(a)
                    })
                })
            }, reset: function () {
                a = g.none()
            }, events: c.registry
        }
    }

    function gU(a) {
        return {
            onEvent: function (a, c) {
            }, reset: t
        }
    }

    function hU() {
        var a = gU(), b = fU(), c = a;
        return {
            on: function () {
                c.reset();
                c = b
            }, off: function () {
                c.reset();
                c = a
            }, isOn: function () {
                return c ===
                    b
            }, onEvent: function (a, b) {
                c.onEvent(a, b)
            }, events: b.events
        }
    }

    function iU(a, b) {
        var c = H.create({relocate: p(["x", "y", "deltaX", "deltaY"]), dragend: p([])}), d = jU.both(a),
            e = tj.transform(d), f = K.bind(a, "mousedown", function (a) {
                0 !== a.raw().button || Db.closest(a.target(), b) || (e.on(), e.go(r.fromDom(document.body)))
            });
        e.events.stop.bind(function () {
            c.trigger.dragend();
            e.off()
        });
        d.events.relocate.bind(function (a) {
            c.trigger.relocate(a.x(), a.y(), a.deltaX(), a.deltaY())
        });
        return {
            blocker: e.element, destroy: function () {
                f.unbind();
                e.destroy()
            }, events: c.registry
        }
    }

    function kU() {
        var a = H.create({dock: p([]), undock: p([])}), b = function (a, b, e, f, k, l) {
            if ("true" === m.get(e, "data-ephox-snap")) {
                var c = bb.absolute(k), d = c.top() + l.top;
                if (Dy.isAllInside(b, d, d + f())) return c = a.locationToAbsolute(e, c.left(), d), g.some({
                    position: "absolute",
                    left: l.left + c.left() + "px",
                    top: c.top() + "px"
                });
                a = l.top + c.top() - f() <= b.y() ? b.fy() : b.fy() + b.h() - f();
                k = bb.viewport(k).left() - c.left();
                l = l.left + c.left() + k;
                return g.some({position: "fixed", left: l + "px", top: a + "px"})
            }
            return g.none()
        };
        return {
            update: function (c, d, e, f, k, l) {
                b(c, d, e, f, k, l).each(function (b) {
                    var c = v.get(e, "position");
                    v.setAll(e, b);
                    "absolute" === b.position && c !== b.position ? a.trigger.dock() : "fixed" === b.position && c !== b.position && a.trigger.undock()
                })
            }, getState: function (a) {
                return "true" === m.get(a, "data-ephox-snap")
            }, events: a.registry
        }
    }

    function lU(a) {
        var b = function (a, b, c) {
            a = A.owner(a);
            a = Za.get(a);
            b -= a.left();
            c -= a.top();
            return Ra(b, c)
        }, c = function (a, b, c) {
            a = A.owner(a);
            a = Za.get(a);
            b += a.left();
            c += a.top();
            return Ra(b, c)
        };
        return {
            locationToFixed: b,
            fixedToLocation: c, absoluteToFixed: function (b, c, f) {
                var d = a();
                b = A.owner(b);
                b = Za.get(b);
                c -= b.left();
                return Ra(c, d.top() - f)
            }, locationToAbsolute: function (b, c, f) {
                b = a();
                return Ra(c, f).translate(-b.left(), -b.top())
            }, absoluteToLocation: function (b, c, f) {
                b = a();
                return Ra(c, f).translate(b.left(), b.top())
            }, fromFixed: function (a, b, f) {
                var d = Ra(b, f);
                a = c(a, b, f);
                return Ey(d, a)
            }, fromLocation: function (a, c, f) {
                a = b(a, c, f);
                c = Ra(c, f);
                return Ey(a, c)
            }, boundToFixed: function (a, b, c, k, l, q, C) {
                b = c < a.x() ? a.fx() : c > a.x() + a.w() ? a.fx() +
                    a.w() : l;
                a = k < a.y() ? a.fy() : k + C > a.y() + a.h() ? a.fy() + a.h() - C : q;
                return Ra(b, a)
            }
        }
    }

    function Fy(a, b) {
        var c = a.isInline() ? a.element() : b;
        return mU(function () {
            var a = Za.get();
            return {x: a.left, y: a.top, w: h(window.innerWidth), h: h(window.innerHeight), fx: h(0), fy: h(0)}
        }, function () {
            return a.isInline() ? Ra(0, 0) : bb.absolute(c)
        }, function () {
            var a = L.descendant(b, ".ephox-chameleon-toolbar").getOr(b);
            return sa.getOuter(a)
        }, c)
    }

    function nU(a, b, c) {
        var d = T.div();
        v.set(d, "position", "relative");
        n.add(d, B.resolve("dragging-container"));
        var e = T.div();
        n.add(e, B.resolve("draggable-container"));
        var f = a.isInline() ? b : e;
        c = Fy(a, f);
        var k = Gy.transitions,
            l = Hy.except([".ephox-pastry-button", "." + B.resolve("banner-buttons") + " *", ".ephox-polish-ui-container", ".ephox-polish-socket", ".ephox-polish-widget-container"]),
            q = Iy.register(c, f, l, k), C = H.create({
                changed: Q([], q.events.dragend),
                dock: Q([], q.events.dock),
                undock: Q([], q.events.undock),
                appear: p(["container", "wrapper"]),
                disappear: p(["container", "wrapper"])
            });
        qd.initFade(e);
        q.events.appear.bind(function () {
            C.trigger.appear(f,
                e)
        });
        q.events.disappear.bind(function () {
            C.trigger.disappear(f, e)
        });
        n.add(e, B.resolve("layer-above-editor"));
        ma.add(q.blocker(), [B.resolve("above-outside"), B.resolve("dragging")]);
        var w = T.span();
        S.hidden(w, !0);
        ma.add(w, [B.resolve("toolbar-drag-handle"), B.resolve("general-drag-handle"), "ephox-textbox-font", B.resolve("icon")]);
        c = aa.detect();
        c.browser.isIE() && 10 === c.browser.version.major && n.add(w, B.resolve("ie10"));
        return {
            shouldRefresh: h(!0), updateWidth: u(qd.updateWidth, f), updateHeight: t, clearWidth: u(qd.clearWidth,
                f), build: function (a) {
                return [w].concat(a)
            }, width: u(qd.width, f), init: function (b, c, d, k, l, C) {
                var w = v.preserve(f, function () {
                    v.set(f, "visibility", "hidden");
                    v.remove(f, "display");
                    b.refresh();
                    return sa.get(b.element())
                });
                C.toolbar.drag.fold(function () {
                    var b = qd.offsetFrom(a, f, w, l);
                    q.init(b.left, b.top, g.from(l.toolbar.offset).getOr({top: -1 * w, left: 0}))
                }, q.setState);
                P.append(e, [b.element(), c.element()])
            }, update: function () {
                q.update()
            }, state: function () {
                return {toolbar: {drag: q.state()}}
            }, integrate: function (c, f, k,
                                    l, q) {
                y.append(e, f.element());
                a.isInline() ? (P.append(d, [e, q, l]), y.append(b, d)) : P.append(b, [e, q, l])
            }, destroy: function () {
                q.destroy()
            }, events: C.registry
        }
    }

    function oU(a, b, c) {
        var d = T.div();
        v.set(d, "position", "relative");
        n.add(d, B.resolve("floating-container"));
        !0 === c.toolbar.sticky && n.add(d, B.resolve("floating-container-sticky"));
        !0 === c.autoresize && n.add(d, B.resolve("floating-container-autoresize"));
        c = T.div();
        n.add(c, B.resolve("draggable-container"));
        var e = a.isInline() ? b : c;
        c = Fy(a, a.isInline() ? e : d);
        var f =
            Iy.register(c, e, Hy.none, Gy.transitions), k = H.create({
            changed: Q([], f.events.dragend),
            dock: Q([], f.events.dock),
            undock: Q([], f.events.undock),
            appear: p(["container", "wrapper"]),
            disappear: p(["container", "wrapper"])
        });
        qd.initFade(e);
        f.events.appear.bind(function () {
            k.trigger.appear(e, e)
        });
        f.events.disappear.bind(function () {
            k.trigger.disappear(e, e)
        });
        n.add(e, B.resolve("layer-toolbar"));
        var l = function () {
            f.update()
        }, q = function () {
            if (v.getRaw(e, "position").is("fixed")) {
                var b = bb.absolute(a.element());
                v.getRaw(e,
                    "left").is(b.left() + "px") || v.set(e, "left", b.left() + "px")
            }
            b = Ia.get(a.element());
            (v.getRaw(e, "width").isNone() || b !== Ia.get(e)) && v.set(e, "width", b + "px");
            return b
        }, C = function () {
            var b = sa.get(e) + "px";
            v.getRaw(a.element(), "margin-top").is(b) || v.set(a.element(), "margin-top", b)
        };
        return {
            shouldRefresh: function () {
                return !0
            }, updateWidth: function (b, c) {
                a.isInline() ? qd.updateWidth(e, b, c) : (q(), C(), l())
            }, updateHeight: function () {
                a.isInline() || C()
            }, clearWidth: function () {
                a.isInline() && qd.clearWidth(e)
            }, build: ca, width: function (b) {
                return a.isInline() ?
                    qd.width(e, b) : Ia.get(a.element())
            }, init: function (b, c, d, k, l, h) {
                h = v.preserve(e, function () {
                    v.set(e, "visibility", "hidden");
                    v.remove(e, "display");
                    b.refresh();
                    return sa.get(b.element())
                });
                d = qd.offsetFrom(a, e, h, l);
                a.isInline() || (q(), C());
                l = l.toolbar.sticky ? {top: 0, left: 0} : g.from(l.toolbar.offset).getOr({top: -1 * h, left: 0});
                f.init(d.left, d.top, l);
                P.append(e, [b.element(), c.element(), k])
            }, update: l, state: h({toolbar: {drag: g.none()}}), integrate: function (c, f, k, l, q) {
                y.append(e, f.element());
                a.isInline() ? P.append(d,
                    [q, l]) : P.append(d, [e, l]);
                y.append(b, d)
            }, destroy: function () {
                f.destroy()
            }, events: k.registry
        }
    }

    function pU(a, b, c, d, e, f) {
        var k = aa.detect(), l = r.fromTag("div"), q = c.uiContainer(), C = T.div();
        Jy(d, l);
        n.add(l, B.resolve("editor-main"));
        !0 === e.autoresize && n.add(l, be.autoresize());
        a.isInline() || k.deviceType.isTouch() ? y.append(l, q) : (Jy(d, C), n.add(C, B.resolve("external-ui")), d = ja.body(), y.append(d, C), y.append(C, q));
        var w = qU.setup(a, l, e, f), g = df.toolbar(w, x.translate);
        !1 === e.toolbar.visible && n.add(l, "ephox-polish-no-toolbar");
        b.events.toolbar.bind(g.enter);
        g.events.exit.bind(a.focus);
        var G = Ay(), V = T.div();
        n.add(V, B.resolve("socket"));
        var X = T.div();
        n.add(X, B.resolve("widget-container"));
        w.integrate(l, g, G, V, X);
        Ky.build(l, e.sideBar, e.bottomBar);
        var Hc = a.isInline() ? function () {
            v.set(G.element(), "min-width", Ia.getOuter(a.element()) + "px")
        } : t;
        a.events.paint.bind(function (a) {
            g.repaint();
            c.refresh();
            Hc()
        });
        w.events.changed.bind(function () {
            g.refresh()
        });
        a.isInline() || !0 !== e.toolbar.sticky || (w.events.dock.bind(function () {
            v.set(q, "position",
                "absolute");
            c.refresh()
        }), w.events.undock.bind(function () {
            v.set(q, "position", "fixed");
            c.refresh()
        }));
        if (a.isInline() || !0 === e.toolbar.sticky) w.events.appear.bind(function (b) {
            var c = a.isInline() ? [b.container()] : [b.container(), q];
            qd.fadeIn(c, b.wrapper())
        }), w.events.disappear.bind(function (b) {
            var c = a.isInline() ? [b.container()] : [b.container(), q];
            qd.fadeOut(c, b.wrapper())
        });
        g.events.transitionend.bind(w.updateHeight);
        return {
            element: h(l), socket: function (a) {
                a.connect(V)
            }, viewport: h(V), uiContainerParent: h(C),
            connect: function (a) {
                y.append(a, l);
                lj.detect(l);
                return !0
            }, destroy: function () {
                g.destroy();
                w.destroy();
                G.destroy();
                F.remove(l);
                F.remove(C)
            }, toolbar: g, position: function () {
                Hc();
                w.init(g, G, V, X, e, f)
            }, refresh: function () {
                w.update();
                g.refresh()
            }, banners: G.element, displayBanner: G.display, hideBanner: G.hide, state: w.state, dialogContainer: h(X)
        }
    }

    function rU(a) {
        var b = g.none(), c = function (b) {
            return function () {
                for (var c = [], d = 0; d < arguments.length; d++) c[d] = arguments[d];
                d = a.get()[b];
                if (null === d || void 0 === d) throw"can't find instance method: " +
                b;
                return d.apply(null, c)
            }
        }, d = function () {
            var a = b.getOrDie("Cannot reconnect the editor before it has been connected the first time.");
            c("connect")(a) && e.trigger.connected()
        }, e = H.create({connected: p([])});
        return kj.external({
            activateInline: c("activateInline"),
            deactivateInline: c("deactivateInline"),
            content: c("content"),
            keyboard: c("keyboard"),
            smartview: c("smartview"),
            macros: c("macros"),
            ui: c("ui"),
            filter: c("filter"),
            undo: c("undo"),
            operations: c("operations"),
            getMode: c("getMode"),
            element: c("element"),
            connect: function (a) {
                b =
                    g.some(a);
                d()
            },
            reconnect: function () {
                var c = b.getOrDie("Cannot reconnect the editor before it has been connected the first time."),
                    e = v.getRaw(c, "height");
                a.get().events.loaded.bind(function () {
                    e.fold(function () {
                        v.remove(c, "height")
                    }, function (a) {
                        v.set(c, "height", a)
                    })
                });
                var l = v.get(c, "height");
                v.set(c, "height", l);
                d()
            },
            focus: c("focus"),
            getContent: c("getContent"),
            setContent: c("setContent"),
            insertHtmlAtCursor: c("insertHtmlAtCursor"),
            state: c("state"),
            communication: c("communication"),
            uploader: c("uploader"),
            isDirty: c("isDirty"),
            setDirty: c("setDirty"),
            isPrettyPrinting: c("isPrettyPrinting"),
            events: e.registry
        })
    }

    function Ly(a) {
        var b = Pb(I.error, a);
        return {
            invalidError: b, different: function (a, d, e, f, k) {
                return 0 === d.length ? b(f) : d === e ? b(k) : I.value(a)
            }
        }
    }

    function sU(a) {
        var b = Ly(a);
        return {
            changeAlt: function (a, d, e, f) {
                var c = m.get(a, "src");
                return b.different(a, d, c, e, f).map(function (a) {
                    m.set(a, "alt", d);
                    return a
                })
            }
        }
    }

    function Sc(a, b, c, d) {
        var e = N.eq(a, c) && b === d;
        return {
            startContainer: h(a), startOffset: h(b), endContainer: h(c),
            endOffset: h(d), collapsed: h(e)
        }
    }

    function My(a) {
        var b = function (b) {
            return a(b).isRtl() ? $l.rtl : $l.ltr
        };
        return {
            delta: function (a, d) {
                return b(d).delta(a, d)
            }, edge: function (a) {
                return b(a).edge(a)
            }, positions: function (a, d) {
                return b(d).positions(a, d)
            }
        }
    }

    function tU(a) {
        var b = Ly(a);
        return {
            changeCaption: function (a, d, e, f) {
                var c = m.get(a, "summary");
                return b.different(a, d, c, e, f).map(function (a) {
                    Qf.setCaption(a, d);
                    return a
                })
            }, changeSummary: function (a, d, e, f) {
                var c = L.descendant(a, "caption").map(Ea.get).getOr("");
                return b.different(a,
                    d, c, e, f).map(function (a) {
                    Qf.setSummary(a, d);
                    return a
                })
            }, setHeaders: function (a, d, e, f) {
                return (!0 === e && !0 === f ? Qf.addBothHeaders : !0 === e ? Qf.addRowHeader : !0 === f ? Qf.addColumnHeader : h(b.invalidError("a11y.t4b.repair.errors.none")))(a, d)
            }, setScope: function (a, b) {
                m.set(a, "scope", b);
                return I.value(a)
            }
        }
    }

    function uU(a) {
        var b = Aa("id description prompts element severity url repair".split(" "), []), c = Aa(["ui", "repair"], []),
            d = sU(a), e = tU(a), f = {
                I1: g.some(c({
                    ui: [jc.field("image-alt", "a11y.i1.repair.info", h(""))], repair: function (a,
                                                                                                 b, c) {
                        return d.changeAlt(b.element(), c["image-alt"](), "a11y.i1.repair.errors.empty", "a11y.i1.repair.errors.duplicate")
                    }
                })),
                I2: g.some(c({
                    ui: [jc.field("image-alt", "a11y.i2.repair.info", function (a) {
                        return m.get(a.element(), "alt")
                    })], repair: function (a, b, c) {
                        return d.changeAlt(b.element(), c["image-alt"](), "a11y.i2.repair.errors.empty", "a11y.i2.repair.errors.duplicate")
                    }
                })),
                T1: g.some(c({
                    ui: [jc.field("table-caption", "a11y.t1.repair.info", h(""))], repair: function (a, b, c) {
                        return e.changeCaption(b.element(), c["table-caption"](),
                            "a11y.t1.repair.errors.empty", "a11y.t1.repair.errors.duplicate")
                    }
                })),
                T2: g.some(c({
                    ui: [jc.field("table-summary", "a11y.t2.repair.info", h(""))], repair: function (a, b, c) {
                        return e.changeSummary(b.element(), c["table-summary"](), "a11y.t2.repair.errors.empty", "a11y.t2.repair.errors.duplicate")
                    }
                })),
                T3: g.some(c({
                    ui: [jc.field("table-caption", "a11y.t3.repair.info", function (a) {
                        return m.get(a.element(), "summary")
                    })], repair: function (a, b, c) {
                        return e.changeCaption(b.element(), c["table-caption"](), "a11y.t3.repair.errors.empty",
                            "a11y.t3.repair.errors.duplicate")
                    }
                })),
                T4A: g.none(),
                T4B: g.some(c({
                    ui: [jc.toggles("table-headers", "a11y.t4b.repair.info", [jc.toggle("row-header", "ephox-polish-row-header", "a11y.t4b.repair.row"), jc.toggle("col-header", "ephox-polish-column-header", "a11y.t4b.repair.column")])],
                    repair: function (a, b, c) {
                        var d = c["row-header"]();
                        c = c["col-header"]();
                        return e.setHeaders(a, b.element(), d, c)
                    }
                })),
                T4C: g.some(c({
                    ui: [jc.select("scope-type", "a11y.t4c.repair.info", [jc.pair("row", "a11y.t4c.repair.scope.row"), jc.pair("col",
                        "a11y.t4c.repair.scope.col"), jc.pair("rowgroup", "a11y.t4c.repair.scope.rowgroup"), jc.pair("colgroup", "a11y.t4c.repair.scope.colgroup")])],
                    repair: function (a, b, c) {
                        return e.setScope(b.element(), c["scope-type"]())
                    }
                })),
                D1: g.some(c({
                    ui: [jc.select("heading-type", "a11y.d1.repair.info", [jc.pair("h1", "a11y.d1.repair.block.h1"), jc.pair("h2", "a11y.d1.repair.block.h2"), jc.pair("h3", "a11y.d1.repair.block.h3"), jc.pair("h4", "a11y.d1.repair.block.h4"), jc.pair("h5", "a11y.d1.repair.block.h5"), jc.pair("h6", "a11y.d1.repair.block.h6")])],
                    repair: function (a, b, c) {
                        return Ny.convertToHeading(b.element(), c["heading-type"]())
                    }
                })),
                D2: g.none(),
                D3: g.some(c({
                    ui: [], repair: function (a, b, c) {
                        return Ny.joinLinks(a.content().isRoot, b.element())
                    }
                })),
                D4: g.none(),
                D5: g.none(),
                O1: g.none(),
                O2: g.none()
            };
        return {
            convert: function (a, c) {
                var d = function (b) {
                    var c = b.repair();
                    return function (b, d) {
                        return a.undo().transaction(function () {
                            return c(a, b, d)
                        })
                    }
                };
                return E(c, function (a) {
                    var c = a.rule(), e = c.id().toUpperCase(), k = void 0 !== f[e] ? f[e] : g.none(), l = c.desckey();
                    return b({
                        id: e,
                        description: l,
                        prompts: k.map(function (a) {
                            return a.ui()
                        }),
                        element: r.fromDom(a.element()),
                        url: c.url(),
                        severity: c.severity(),
                        repair: k.map(d).getOr(function () {
                            return I.error("no repair")
                        })
                    })
                })
            }
        }
    }

    function vU(a) {
        return {
            audit: function (b) {
                return wU.audit(b, a.rules())
            }
        }
    }

    function xU() {
        var a = na([]), b = na(0), c = O("index", "total", "detail"), d = function (d) {
            var e = a.get();
            if (0 === e.length) return g.none();
            var k = b.get();
            var l = e.length - 1;
            d = k + d;
            l = d > l ? 0 : 0 > d ? l : d;
            b.set(l);
            return g.some(c(l, e.length, e[l]))
        };
        return {
            load: function (d) {
                if (0 ===
                    d.length) return g.none();
                b.set(0);
                a.set(d);
                return g.some(c(b.get(), d.length, d[0]))
            }, backwards: function () {
                return d(-1)
            }, current: function () {
                var d = a.get();
                return 0 === d.length ? g.none() : g.some(c(b.get(), d.length, d[b.get()]))
            }, resolve: function () {
                var d = a.get();
                if (0 === d.length) return g.none();
                d = d.slice(0, b.get()).concat(d.slice(b.get() + 1));
                var f = Math.min(d.length - 1, b.get());
                b.set(f);
                a.set(d);
                return 0 === d.length ? g.none() : g.some(c(b.get(), d.length, d[b.get()]))
            }, forwards: function () {
                return d(1)
            }
        }
    }

    function yU(a,
                b) {
        var c = T.div();
        n.add(c, $a.resolve(b, "assistance"));
        var d = $a.resolve(b, "assistance-invalid"), e = g.none(), f = r.fromTag("p");
        n.add(f, $a.resolve(b, "repair-error"));
        m.set(f, "aria-live", "polite");
        var k = function () {
            n.remove(c, d);
            F.remove(f)
        }, l = H.create({execute: p([])}), q = ha.dynamic(c, Ba.dynamic({})), C = [q];
        return {
            element: h(c), keylayouts: h(C), markInvalid: function (a) {
                n.add(c, d);
                ib.shout(c, a);
                Ea.set(f, a);
                y.append(c, f)
            }, markValid: k, getChange: function () {
                return e.map(function (a) {
                    return a.get()
                })
            }, destroy: function () {
                e.each(function (a) {
                    a.destroy()
                })
            },
            update: function (d) {
                k();
                d = d.detail();
                var f = d.prompts();
                e.each(function (a) {
                    a.destroy()
                });
                d = zU.generate(a, f, d, b);
                e = g.some(d);
                F.empty(c);
                P.prepend(c, d.elements());
                d.events.execute.bind(function () {
                    l.trigger.execute()
                });
                q.set(d.keylayouts())
            }, events: l.registry
        }
    }

    function AU(a, b) {
        var c = T.div();
        n.add(c, $a.resolve(b, "commands"));
        var d = T.div();
        n.add(d, $a.resolve(b, "commands-buttons"));
        var e = ef.defaultActionButton(a, [$a.resolve(b, "repair")], Tc.repairLabel(), Tc.repairText(), b),
            f = ef.normalButton(a, [$a.resolve(b,
                "ignore")], Tc.ignoreLabel(), Tc.ignoreText(), b),
            k = ef.defaultActionButton(a, [$a.resolve(b, "ok")], Tc.okLabel(), Tc.okText(), b), l = function () {
                P.append(d, [f.element(), e.element()])
            };
        l();
        a = Ba.button({
            execute: function (a) {
                a.dom().click()
            }
        });
        a = [ha.button(f.element(), a), ha.button(e.element(), a), ha.button(k.element(), a)];
        y.append(c, d);
        var q = H.create({repair: Q([], e.events.click), ignore: Q([], f.events.click), done: Q([], k.events.click)});
        return {
            element: h(c), destroy: function () {
                e.destroy();
                f.destroy();
                k.destroy()
            }, keylayouts: h(a),
            focus: function () {
                var a = e.disabled() ? e.element() : f.element();
                Z.focus(a)
            }, update: function (a) {
                F.remove(k.element());
                a = a.detail();
                sc.isVisible(f.element()) || l();
                a.prompts().fold(function () {
                    e.disable();
                    ra.disable(e.element())
                }, function (a) {
                    e.enable();
                    ra.enable(e.element());
                    ib.speak(ja.body(), $a.translate(b, Tc.repairAvailable()))
                })
            }, zero: function (a) {
                F.empty(d);
                y.append(d, k.element());
                Z.focus(k.element())
            }, events: q.registry
        }
    }

    function BU(a, b) {
        var c = T.div();
        n.add(c, $a.resolve(b, "information"));
        m.set(c, "data-severity",
            "info");
        a = T.div();
        n.add(a, $a.resolve(b, "icon"));
        var d = T.div();
        n.add(d, $a.resolve(b, "description"));
        y.append(d, r.fromText(""));
        var e = r.fromTag("a");
        n.add(e, $a.resolve(b, "help-icon"));
        m.set(e, "href", "javascript:void(0)");
        P.append(c, [a, d, e]);
        var f = K.bind(e, "click", function () {
            var a = m.get(e, "data-url");
            window.open(a, "", "height=700,width=820,resizable=yes,scrollbars=yes")
        });
        a = [ha.single(e, [], g.none())];
        return {
            element: h(c), destroy: function () {
                f.unbind()
            }, keylayouts: h(a), update: function (a) {
                a = a.detail();
                var f =
                    a.severity();
                m.set(c, "data-severity", f);
                ib.speak(ja.body(), $a.translate(b, Tc.severity(f)));
                f = $a.translate(b, a.description());
                Ea.set(d, f);
                ib.speak(ja.body(), f);
                m.set(e, "title", $a.translate(b, Tc.issueHelp()));
                m.set(e, "data-url", a.url());
                y.after(d, e)
            }, zero: function () {
                m.set(c, "data-severity", "success");
                var a = $a.translate(b, Tc.noIssue());
                Ea.set(d, a);
                ib.speak(ja.body(), a);
                F.remove(e)
            }
        }
    }

    function CU(a, b) {
        a = T.div();
        var c = T.span();
        n.add(c, $a.resolve(b, "spin"));
        n.add(a, $a.resolve(b, "loading"));
        y.append(a, c);
        return {element: h(a), destroy: t}
    }

    function DU(a, b) {
        var c = am("titlebar", g.none(), b), d = am("title", g.none(), b), e = am("title-text", g.some(Tc.title()), b),
            f = am("issue", g.some(Tc.running()), b);
        P.append(d, [e, f]);
        var k = T.div();
        n.add(k, $a.resolve(b, "navigation"));
        e = ef.icon(a, $a.resolve(b, "previous"), Tc.previous(), b);
        a = ef.icon(a, $a.resolve(b, "next"), Tc.next(), b);
        var l = [e, a];
        a = H.create({previous: Q([], e.events.click), next: Q([], a.events.click)});
        P.append(k, E(l, function (a) {
            return a.element()
        }));
        y.append(c, d);
        var q =
            Ba.button({
                execute: function (a) {
                    a.dom().click()
                }
            });
        e = E(l, function (a) {
            return ha.button(a.element(), q)
        });
        var C = function (a) {
            a.disable();
            ra.disable(a.element())
        }, w = function (a) {
            a.enable();
            ra.enable(a.element())
        }, J = function () {
            z(l, C)
        }, G = function () {
            z(l, w)
        }, V = function () {
            Hh.preserve(function () {
                y.after(d, k)
            }, k)
        };
        return {
            element: h(c), update: function (a) {
                var c = a.index() + 1;
                a = a.total();
                c = $a.translate(b, Tc.issueCounter(), c, a);
                Ea.set(f, c);
                ib.speak(ja.body(), c);
                (1 === a ? J : G)();
                V()
            }, zero: function () {
                Ea.set(f, "&nbsp;");
                V();
                J()
            }, keylayouts: h(e), destroy: function () {
                z(l, function (a) {
                    a.destroy()
                })
            }, events: a.registry
        }
    }

    function EU(a, b) {
        var c = T.div();
        n.add(c, $a.resolve(b, "widget"));
        var d = $a.resolve(b, "loading");
        n.add(c, d);
        var e = DU(a, b), f = BU(a, b), k = yU(a, b), l = AU(a, b), q = CU(a, b);
        P.append(c, [e.element(), q.element()]);
        var C = H.create({showcase: p(["detail"]), ignored: p(["detail"]), solved: p(["detail"]), done: p([])}),
            w = function (a) {
                z([e, f, k, l], function (b) {
                    b.update(a)
                });
                C.trigger.showcase(a.detail());
                Hh.preserve(function () {
                    y.after(e.element(),
                        f.element());
                    y.after(f.element(), k.element());
                    y.after(k.element(), l.element())
                }, c)
            }, g = function (a) {
                a.fold(function () {
                    y.after(e.element(), f.element());
                    y.after(f.element(), l.element());
                    F.remove(k.element());
                    e.zero();
                    f.zero();
                    l.zero()
                }, w)
            }, G = na(xU());
        e.events.previous.bind(function () {
            G.get().backwards().each(w)
        });
        e.events.next.bind(function () {
            G.get().forwards().each(w)
        });
        a = function () {
            var a = k.getChange().getOr({});
            G.get().current().each(function (b) {
                var c = b.detail();
                c.repair()(c, a).fold(function (a) {
                        k.markInvalid(a)
                    },
                    function (a) {
                        k.markValid();
                        a = G.get().resolve();
                        C.trigger.solved(c);
                        g(a);
                        l.focus()
                    })
            })
        };
        k.events.execute.bind(a);
        l.events.repair.bind(a);
        l.events.ignore.bind(function () {
            G.get().current().each(function (a) {
                var b = G.get().resolve();
                C.trigger.ignored(a.detail());
                g(b)
            })
        });
        l.events.done.bind(function () {
            C.trigger.done()
        });
        a = Qb([e.keylayouts(), f.keylayouts(), k.keylayouts(), l.keylayouts()]);
        return {
            element: h(c), destroy: function () {
                z([e, f, k, l], function (a) {
                    a.destroy()
                })
            }, load: function (a) {
                F.remove(q.element());
                n.remove(c,
                    d);
                a = G.get().load(a);
                g(a)
            }, open: function () {
                y.append(c, q.element());
                n.add(c, d)
            }, skip: function () {
                var a = G.get().resolve();
                g(a)
            }, keylayouts: h(a), events: C.registry
        }
    }

    function FU(a) {
        var b = Sq.ignoreAttr(), c = {prefix: h("accessibility-check"), translate: Oy.translate, tnames: h("a11y")},
            d = EU(GU, c);
        c = HU.all();
        c = IU({rules: c});
        var e = vU(c), f = uU(Oy.translate), k = Sq.manager(a.content()), l = function (c) {
            c = e.audit(c.dom());
            c = f.convert(a, c);
            return ka(c, function (a) {
                var c = a.element();
                c = ff.read(c, b);
                return !U(c, a.id())
            })
        };
        d.events.showcase.bind(function (b) {
            a.content().body().each(function (c) {
                c =
                    b.detail().element();
                ja.inBody(c) ? (k.moveTo(c, b.detail().severity()), Og.elementIntoView(a.content(), c)) : d.skip()
            })
        });
        d.events.ignored.bind(function (a) {
            a = a.detail();
            k.ignore(a.element(), a.id(), a.severity())
        });
        d.events.solved.bind(function (a) {
            a = a.detail();
            k.solve(a.element(), a.id(), a.severity())
        });
        c = H.create({done: Q([], d.events.done)});
        return {
            element: d.element,
            anchorName: h("a11y-widget-anchor"),
            textkey: h("action.a11ycheck"),
            dialogTextkey: h("a11y.widget.title"),
            destroy: function () {
                d.destroy()
            },
            keylayouts: d.keylayouts,
            openWidget: function () {
                a.content().hideInlineSelection();
                d.open();
                a.content().body().each(function (a) {
                    a = l(a);
                    k.start(a);
                    d.load(a)
                })
            },
            closeWidget: function () {
                k.stop()
            },
            events: c.registry
        }
    }

    function JU(a, b) {
        var c = H.create({open: p([]), close: p([])}), d = r.fromTag("div");
        n.add(d, va.resolve("layer-menus"));
        n.add(d, va.resolve("toolstrip"));
        y.append(a(), d);
        a = function () {
            v.getRaw(d, "opacity").isNone() && (e.cancel(), v.remove(d, "display"), c.trigger.close())
        };
        var e = uj(a, 1E3), f = K.bind(d, "transitionend", a);
        return {
            element: function () {
                return d
            },
            destroy: function () {
                f.unbind();
                F.remove(d)
            }, open: function () {
                v.set(d, "display", "block");
                v.reflow(d);
                c.trigger.open();
                v.set(d, "opacity", "1")
            }, close: function () {
                v.remove(d, "opacity");
                e.throttle()
            }, setContent: function (a) {
                y.append(d, a)
            }, events: c.registry
        }
    }

    function Py(a, b, c, d) {
        var e = a.content(), f = a.ui().tabstrip.element(), k = [b.element()],
            l = "." + B.resolve(c) + ", ." + va.resolve("more-button"), q = function () {
                var a = Y.descendants(f, l);
                return k.concat(a)
            }, C = hd.api(), w = H.create({abort: p([]), open: p([]), close: p([])}),
            g = function () {
                e.events.mousedown.unbind(h);
                C.clear();
                V.off()
            }, h = function () {
                C.isSet() && (b.closeWidget(), C.run(function (a) {
                    a.close()
                }))
            }, V = oy(h, q);
        b.events.done.bind(function () {
            h()
        });
        var X = ha.multiple(b.element(), b.keylayouts());
        X.events.exit.bind(function () {
            w.trigger.abort()
        });
        return {
            destroy: function () {
                g();
                X.destroy();
                b.destroy();
                V.off()
            }, events: w.registry, open: function () {
                V.on();
                b.openWidget();
                var c = JU(a.ui().dialogContainer, q);
                c.setContent(b.element());
                n.add(c.element(), d);
                var f = c.element();
                ma.add(f,
                    [B.resolve(b.anchorName()), B.resolve("side-widget-anchor")]);
                S.dialog(f, x.translate(b.dialogTextkey()));
                c.open();
                c.events.close.bind(function () {
                    e.focus();
                    w.trigger.close();
                    g()
                });
                C.set(c);
                X.enter();
                w.trigger.open();
                e.events.mousedown.bind(h)
            }, close: h, isOpen: C.isSet
        }
    }

    function KU(a) {
        var b = a.filter();
        Sq.configure(b);
        var c = hd.api(), d = function () {
            var b = FU(a);
            b = Py(a, b, "a11y-check", LU);
            b.events.abort.bind(b.close);
            b.events.close.bind(f);
            c.set(b);
            b.open()
        }, e = function () {
            c.run(function (a) {
                a.close()
            })
        }, f = function () {
            c.clear()
        };
        return {
            ui: wb.ui({
                "a11ycheck.general": {
                    toggle: !1,
                    hasPopup: !1,
                    value: "a11y-check",
                    textkey: x.key("action.a11ycheck"),
                    action: function () {
                        (c.isSet() ? e : d)()
                    },
                    updateGeneral: function (a) {
                        n.add(a.element(), B.resolve("a11y-check"))
                    },
                    icon: !0,
                    tooltip: qb.get
                }
            }), destroy: f
        }
    }

    function Tq(a) {
        return {
            change: function (b, c) {
                return (a.directionAt(b).isRtl() ? Qy.rtl : Qy.ltr).change(b, c)
            }
        }
    }

    function MU(a) {
        var b = a.property(), c = function (a, c) {
            return b.parent(a).map(b.name).map(function (a) {
                return !U(c, a)
            }).getOr(!1)
        };
        return {
            validateText: function (a) {
                return b.isText(a) &&
                    c(a, NU)
            }
        }
    }

    function OU(a, b) {
        return {
            is: function (c) {
                return v.get(c, a) === b
            }, remove: function (b) {
                v.remove(b, a)
            }, set: function (c) {
                v.set(c, a, b)
            }
        }
    }

    function PU(a) {
        var b = a.content(), c = a.keyboard(), d = a.shortcuts(), e = a.context(),
            f = H.create({analytics: p(["message", "properties"])}), k = u(ce.indent, a), l = u(ce.outdent, a),
            q = u(ce.blockquote, a);
        d.events.indent.bind(k);
        d.events.outdent.bind(l);
        d.events.blockquote.bind(q);
        var C = function (a) {
            var c = a.stopper();
            bm.context(b).bind(function (b) {
                bm.cata(b, t, function (b) {
                    (a.shift() ?
                        l : k)();
                    c()
                })
            })
        }, w = c.editor();
        w.on();
        w.events.tab.bind(C);
        e.events.preLinebreak.bind(function (b) {
            Uq.atQuoteBreak(a.content()).each(function (c) {
                ce.breakQuote(a, c.quote(), c.element());
                b.handler().handle()
            })
        });
        var J = O("value", "icon", "textkey");
        c = J("justifyleft", g.some(va.resolve("justifyleft")), x.key("alignment.left"));
        d = J("justifycenter", g.some(va.resolve("justifycenter")), x.key("alignment.center"));
        e = J("justifyright", g.some(va.resolve("justifyright")), x.key("alignment.right"));
        var G = J("justifyfull",
            g.some(va.resolve("justifyfull")), x.key("alignment.justify")),
            V = J("justifyleft", g.some(va.resolve("justifyleft")), x.key("alignment.left")),
            X = J("justifycenter", g.some(va.resolve("justifycenter")), x.key("alignment.center"));
        J = J("justifyright", g.some(va.resolve("justifyright")), x.key("alignment.right"));
        var m = [c, d, e, G], n = [V, X, J], r = function () {
                return vc.detect(b.getSelection()).fold(function () {
                    return m
                }, function (a) {
                    return n
                })
            }, Dh = {justifyleft: u(ce.imageLeft), justifycenter: u(ce.imageCentre), justifyright: u(ce.imageRight)},
            v = {
                justifyleft: ce.justifyLeft,
                justifycenter: ce.justifyCentre,
                justifyright: ce.justifyRight,
                justifyfull: ce.justifyFull
            }, z = function (a) {
                return a.toLowerCase()
            }, y = g.none();
        return {
            ui: wb.ui({
                "indent.general": {
                    value: "indent",
                    textkey: x.key("action.indent"),
                    action: k,
                    updateGeneral: ca,
                    tooltip: qb.get,
                    toggle: !1
                },
                "outdent.general": {
                    value: "outdent",
                    textkey: x.key("action.outdent"),
                    action: l,
                    updateGeneral: ca,
                    tooltip: qb.get,
                    toggle: !1
                },
                "blockquote.general": {
                    value: "blockquote", textkey: x.key("action.blockquote"), action: q,
                    updateGeneral: function (a) {
                        Uq.read(b).quoted().fold(a.deselect, t, a.select)
                    }, tooltip: qb.get, toggle: !0
                },
                "alignment.dropdown": {
                    name: "alignment",
                    textkey: x.key("alignment.toolbar"),
                    menuTextkey: x.key("alignment.menu"),
                    action: function (c) {
                        var d = vc.detect(b.getSelection()).fold(h(v), h(Dh));
                        (void 0 !== d[c] ? d[c] : t)(a)
                    },
                    updateDropdown: function (a) {
                        var c = r(), d = Uq.read(b).alignment().fold(function () {
                            return 0 < c.length ? Da.on(c[0].value()) : Da.off()
                        }, Da.unchanged, Da.on);
                        a.populate([{label: g.none, items: h(c)}]);
                        cm.updateMenu(a,
                            d.map(z), Da.on(), c, y)
                    },
                    values: m,
                    render: y,
                    tooltip: qb.get,
                    toggle: !1,
                    describe: function (a) {
                        return x.translate("alignment.describe", x.get(a.textkey()))
                    }
                }
            }), events: f.registry, destroy: function () {
                w.off();
                w.events.tab.unbind(C);
                w.destroy()
            }
        }
    }

    function QU(a, b) {
        var c = function (a, b, c) {
            var d = r.fromText(b);
            a(c, d);
            return g.some({
                element: h(d), cleanup: function () {
                    F.remove(d)
                }, splits: h([])
            })
        }, d = function (a) {
            return {
                none: g.none, start: u(c, y.before, a), end: u(c, y.after, a), middle: function (b, d, e) {
                    return c(y.after, a, d)
                }
            }
        }, e = function (a) {
            var b =
                function (a) {
                    return function (b, c) {
                        y.appendAt(b, c, a)
                    }
                };
            return {
                prepend: u(c, y.prepend, a),
                before: u(c, y.before, a),
                after: u(c, y.after, a),
                insertAt: function (d, e) {
                    return c(b(e), a, d)
                },
                append: u(c, y.append, a)
            }
        };
        return {
            before: {
                text: d(a),
                element: {hasPrevious: e(a).insertAt, first: e(a).prepend, empty: e(a).before, otherwise: e(a).append}
            },
            after: {
                text: d(b),
                element: {hasNext: e(b).insertAt, rightEdge: e(b).append, empty: e(b).after, otherwise: e(b).append}
            },
            general: {insertBefore: e(a).before, insertAfter: e(b).after}
        }
    }

    function Ry(a,
                b, c, d) {
        c = [b].concat(c);
        var e = u(Vq.nuTag, b), f = u(Pg.relatedTags, c), k = Jc.tagList(c), l = Pg.queriesTag(b),
            q = {nu: e, matches: f, purifiers: h(k)}, C = function (a) {
                var b = r.fromText(mb());
                dm.atStartOf(a.startContainer(), a.startOffset(), b);
                return Ub.hare(b, 0, b, 1)
            }, w = function (a, b, c) {
                return D.isText(b) && c === Ya.get(b).length ? wc.after(b, a).fold(function () {
                    return W.point(b, c)
                }, function (a) {
                    return W.point(a, 0)
                }) : W.point(b, c)
            }, J = function (a, b, c) {
                return D.isText(b) && 0 === c ? wc.before(b, a).fold(function () {
                        return W.point(b, c)
                    },
                    function (a) {
                        return W.point(a, wa.getEnd(a))
                    }) : W.point(b, c)
            }, G = function (a, b) {
                return b.map(function (b) {
                    var c = w(a, b.start(), b.soffset());
                    b = J(a, b.finish(), b.foffset());
                    return Ub.fussy(c.element(), c.offset(), b.element(), b.offset())
                })
            };
        c = {nu: e, purifiers: h(k), isStyled: h(!0)};
        var V = ["font-size"], X = function (a) {
            return a.getSelection().map(function (a) {
                var c = cb(d);
                c = Iq(c, V);
                return ob(c, function (c) {
                    return Pg.queryStyleOn(c, d[c], [b], a)
                })
            }).getOr(!1)
        };
        return {
            run: function (a, c) {
                var d = c.doc();
                return Wq.detect(c, l.queryOn).fold(function () {
                        return g.none()
                    },
                    function (b) {
                        b = C(b);
                        de.doRemoveUpto(a, k, b, f);
                        return g.some(Ub.fromHare(b))
                    }, function (a) {
                        a = C(a);
                        var c = r.fromTag(b, d.dom());
                        n.add(c, Rb.styleSpan());
                        y.wrap(a.startContainer(), c);
                        return g.some(Ub.fussy(a.startContainer(), 1, a.startContainer(), 1))
                    }, function (b) {
                        b = de.doRemoveUpto(a, k, b, f);
                        return G(a, b)
                    }, function (b) {
                        return Xq.run(c.doc(), a, b, q)
                    })
            }, query: function (a) {
                return l.query(a) || X(a)
            }, deferred: h(c), name: h(a)
        }
    }

    function Sy(a, b) {
        return {
            element: h(b), wrap: function (c) {
                a.insert().append(b, c)
            }
        }
    }

    function em(a,
                b, c, d, e, f) {
        var k = u(Vq.nu, d, e, b), l = u(Pg.relatedStyle, d, e, c), q = Jc.cssAndTag(c, d, e),
            C = Pg.queriesStyle(d, e, c), w = h(!0), J = function (b, c) {
                gf.generic(b, t, w, function (b) {
                    n.add(b, Rb.styleSpan());
                    v.set(b, d, c);
                    m.set(b, Rb.overrideSpan(), a);
                    v.reflow(b)
                });
                return g.none()
            };
        b = {
            nu: k, purifiers: h(q), isStyled: function (a) {
                return "span" === D.name(a) && vj.rawState(a, d, e)
            }, matches: l
        };
        return {
            run: function (a, b) {
                return Wq.detect(b, C.queryOn).fold(function () {
                    return g.none()
                }, function (a) {
                    return J(b, f)
                }, function (a) {
                    return J(b, e)
                }, function (b) {
                    return de.doRemoveUpto(a,
                        q, b, l)
                }, function (c) {
                    return Xq.run(b.doc(), a, c, {nu: k, matches: l, purifiers: h(q)})
                })
            }, query: function (b) {
                var c = "[" + Rb.overrideSpan() + '="' + a + '"]';
                return b.getSelection().bind(function (a) {
                    return L.closest(a.startContainer(), c).bind(function (b) {
                        return L.closest(a.endContainer(), c).bind(function (a) {
                            return N.eq(b, a) ? v.getRaw(b, d).map(function (a) {
                                return a === e
                            }) : g.none()
                        })
                    })
                }).getOrThunk(function () {
                    return C.query(b)
                })
            }, deferred: h(b), name: h(a)
        }
    }

    function RU(a) {
        var b = a.content(), c = a.shortcuts(), d = a.undo(), e = H.create({
                analytics: p(["message",
                    "properties"])
            }), f = function (a, c) {
                var d = SU.read(b);
                (void 0 !== d[a] ? d[a]() : Da.unchanged()).fold(c.deselect, t, c.select)
            }, k = function (c) {
                var e = function (a) {
                    return c(b.isRoot, a)
                };
                return function () {
                    Zb.cata(a.selections().get(), t, fm.multiple(b, d, e), fm.single(b, d, e));
                    b.uiChanged()
                }
            }, l = k(rd.bold), q = k(rd.italic), C = k(rd.underline), w = k(rd.strikethrough), g = k(rd.subscript),
            h = k(rd.superscript);
        k = k(rd.removeformat);
        c.events.bold.bind(l);
        c.events.italic.bind(q);
        c.events.underline.bind(C);
        return {
            ui: wb.ui({
                "bold.general": {
                    toggle: !0,
                    value: "bold",
                    textkey: x.key("action.bold"),
                    action: l,
                    updateGeneral: u(f, "bold"),
                    icon: !0,
                    tooltip: qb.get
                },
                "italic.general": {
                    toggle: !0,
                    value: "italic",
                    textkey: x.key("action.italic"),
                    action: q,
                    updateGeneral: u(f, "italic"),
                    icon: !0,
                    tooltip: qb.get
                },
                "underline.general": {
                    toggle: !0,
                    value: "underline",
                    textkey: x.key("action.underline"),
                    action: C,
                    updateGeneral: u(f, "underline"),
                    icon: !0,
                    tooltip: qb.get
                },
                "strikethrough.general": {
                    toggle: !0,
                    value: "strikethrough",
                    textkey: x.key("action.strikethrough"),
                    action: w,
                    updateGeneral: u(f,
                        "strikethrough"),
                    icon: !0,
                    tooltip: qb.get
                },
                "removeformat.general": {
                    toggle: !1,
                    value: "removeformat",
                    textkey: x.key("action.removeformat"),
                    action: k,
                    updateGeneral: ca,
                    icon: !0,
                    tooltip: qb.get
                },
                "subscript.general": {
                    toggle: !0,
                    value: "subscript",
                    textkey: x.key("action.subscript"),
                    action: g,
                    updateGeneral: u(f, "subscript"),
                    icon: !0,
                    tooltip: qb.get
                },
                "superscript.general": {
                    toggle: !0,
                    value: "superscript",
                    textkey: x.key("action.superscript"),
                    action: h,
                    updateGeneral: u(f, "superscript"),
                    icon: !0,
                    tooltip: qb.get
                }
            }), events: e.registry,
            destroy: t
        }
    }

    function Ty(a) {
        var b = function (b, d, e, f) {
            var c = e.join(",");
            b = a.up().closest(b, c, f);
            d = a.up().closest(d, c, f);
            return b.isSome() && d.isSome() ? (f = b.getOrDie("Just checked it was some."), d = d.getOrDie("Just checked it was some."), a.eq(f, d) ? qa(e, u(a.is, f)) : g.none()) : g.none()
        };
        return {
            query: function (a, d, e) {
                d = d.concat(TU.tags());
                return b(a.startContainer(), a.endContainer(), d, e)
            }, queryAll: b
        }
    }

    function Uy(a, b) {
        var c = O("base", "value", "textkey", "icon", "styles", "tag"), d = a.styles;
        a = b.map(u(UU, a.showDocumentStyles)).getOr([]);
        d = d.concat(a);
        d = E(d, function (a) {
            return {name: a.rule, text: g.from(a.text).map(x.raw), style: void 0 === a.style ? {} : a.style}
        });
        var e = {};
        z(d, function (a) {
            VU.decipher(a).each(function (b) {
                e[a.name] = b
            })
        });
        d = Jb;
        a = fd;
        b = function (a, b, c, d) {
            return function (e) {
                return Rf.cata(e, a, b, c, d)
            }
        };
        var f = Ze(e), k = ka(f, b(a, a, a, d)), l = ka(f, b(a, a, d, a)), q = ka(f, b(a, d, a, a)),
            C = ka(f, b(d, a, a, a));
        d = function () {
            var a = k.concat(q).concat(l).concat(C);
            return E(a, function (a) {
                return Rf.cata(a, function (a, b, c) {
                    return "." + a
                }, function (a, b, c, d) {
                    return a +
                        "." + b
                }, function (a, b, c) {
                    return a
                }, function (a, b, c, d) {
                    return a + "." + b
                })
            })
        }();
        var w = function (a) {
            return void 0 !== e[a] ? g.some(e[a]) : g.none()
        }, J = function (a) {
            return Rf.cata(a, function (a, b, d) {
                return c("span", "." + a, b, g.none(), d, "span")
            }, function (a, b, d, e) {
                return c(a, a + "." + b, d, g.none(), e, "span")
            }, function (a, b, d) {
                return c(a, a, b, g.none(), d, a)
            }, function (a, b, d, e) {
                return c(a, a + "." + b, d, g.none(), e, a)
            })
        };
        a = function () {
            var a = Ze(e);
            return E(a, J)
        }();
        return {
            candidateByName: function (a) {
                return w(a).map(J)
            }, toCandidate: J, ruleByName: w,
            divisions: function () {
                return {classblocks: h(k), blocks: h(l), objects: h(q), inlines: h(C)}
            }, backup: function (a) {
                return c(a, a, x.key("block." + a), g.none(), {}, "span")
            }, selectors: h(d), everything: h(a)
        }
    }

    function WU(a, b, c) {
        var d = c(void 0 === b || "default" === b ? g.none() : g.some(b)), e = r.fromTag("div");
        n.add(e, B.resolve("list-style-option"));
        c = void 0 === b || "default" === b ? XU(e, "ul" === a ? "list.unordered.default" : "list.ordered.default") : YU(a, b);
        y.append(e, c);
        a = x.translate(("ul" === a ? "list.unordered." : "list.ordered.") + b);
        m.set(e,
            "title", a);
        S.label(e, a);
        S.menuItemCheckbox(e);
        var f = ib.describe(e, x.translate("aria.widget.navigation"));
        y.append(e, f);
        var k = H.create({action: p(["type", "element"])}), l = function () {
            ra.checked(e, !0);
            n.add(e, B.resolve("list-style-selected"))
        }, q = function () {
            ra.checked(e, !1);
            n.remove(e, B.resolve("list-style-selected"))
        }, C = K.bind(e, "click", function (a) {
            k.trigger.action(d, g.some(e))
        });
        return {
            element: h(e), instance: d, style: b, update: function (a) {
                (d.query(a) && d.queryStyle(a) ? Da.on(!0) : Da.off()).fold(q, t, l)
            }, select: l,
            deselect: q, events: k.registry, destroy: function () {
                C.unbind();
                F.remove(e);
                F.remove(f)
            }
        }
    }

    function ZU(a, b, c) {
        var d = H.create({action: p(["type"])}), e = T.div();
        n.add(e, B.resolve("list-style-palette"));
        var f = E(a, function (a) {
            return WU("bullist" === b ? "ul" : "ol", a, c)
        });
        z(f, function (a) {
            a.events.action.bind(function (a) {
                a.element().each(l);
                d.trigger.action(a.type())
            });
            y.append(e, a.element())
        });
        var k = function () {
            var a = Math.floor(f.length / 4) + (0 < f.length % 4 ? 1 : 0);
            return ha.grid(e, {cell: h("." + B.resolve("list-style-option"))},
                a, 4, Ba.grid({
                    trigger: function (a) {
                        a.dom().click();
                        return g.some(a)
                    }
                }))
        }(), l = function (a) {
            L.sibling(a, "[" + gm + '="default"]').filter(function (b) {
                return b !== a
            }).each(function (b) {
                m.remove(b, gm);
                m.set(a, gm, "default")
            })
        };
        return {
            enter: k.enter, element: h(e), update: function (a) {
                z(f, function (b) {
                    b.update(a)
                })
            }, events: d.registry, destroy: function (a) {
                k.isFocused() && k.exit();
                k.destroy();
                z(f, function (a) {
                    a.destroy()
                });
                F.remove(e)
            }, findDefault: function () {
                return qa(f, function (a) {
                    return m.has(a.element(), gm)
                }).map(function (a) {
                    return a.instance
                })
            }
        }
    }

    function Vy(a) {
        var b = a.region(), c = a.content(), d = a.undo(), e = a.keyboard(), f = a.listConstructor(), k = a.type(),
            l = a.styles(), q = a.textkey(), C = a.menuTextkey(), g = f("default"), J = aa.detect(), G = e.all();
        G.swallowKeys([R.ESCAPE()]);
        var V = H.create({abort: p([]), done: p([]), close: p([]), analytics: p(["message"])});
        G.events.escape.bind(function (a) {
            V.trigger.abort()
        });
        var X = function (e, f) {
            var k = Ih.list(function (a, c, d, k, l) {
                return e.apply(a, c, d, k, l, Tq(b), f)
            }, b, c, d, a.selections());
            V.trigger.done();
            c.focus();
            return k
        }, m = function () {
            L.descendant(n.element(),
                '[data-ephox-polish-list-style="default"]').each(function (a) {
                Z.focus(a)
            })
        }, n = ZU(l, k, f);
        n.events.action.bind(function (a) {
            X(a.type(), !1)
        });
        return {
            action: function () {
                var a = n.findDefault().getOr(g);
                X(a, !0)
            },
            element: n.element,
            shortcut: !1,
            textkey: h(q),
            menuTextkey: h(C),
            label: h(!1),
            name: h(k),
            tooltip: qb.get,
            toggle: !0,
            value: k,
            updateWidget: function (a) {
                c.getSelection().each(function (b) {
                    var c = g.query(b) ? Da.on(!0) : Da.off();
                    c.fold(a.deselect, t, a.select);
                    c.fold(a.release, t, a.press);
                    n.update(b)
                })
            },
            open: function () {
                J.deviceType.isTouch() ||
                m();
                G.on()
            },
            close: function () {
                G.off();
                V.trigger.close()
            },
            icon: !0,
            events: V.registry,
            enter: n.enter,
            destroy: function () {
                G.off();
                G.destroy();
                n.destroy()
            }
        }
    }

    function $U(a, b, c) {
        var d = function (b) {
            if ("p" === D.name(b)) return Wy.replace(a, b, "li");
            var c = r.fromTag("li");
            y.before(b, c);
            y.append(c, b);
            return c
        }, e = function (a) {
            var d = r.fromTag(b);
            c.each(function (a) {
                v.set(d, "list-style-type", a)
            });
            y.before(a[0], d);
            P.append(d, a);
            g.from(m.get(a[0], "dir")).each(function (a) {
                m.set(d, "dir", a)
            });
            return d
        }, f = function (a) {
            var d = Pc.mutate(a,
                b);
            c.fold(function () {
                v.remove(d, "list-style-type")
            }, function (a) {
                v.set(d, "list-style-type", a)
            });
            return d
        }, k = function (a) {
            var b = h(!0), c = h(!1);
            return a.fold(b, c, c)
        }, l = function (a, b) {
            return function (c) {
                return wj.cata(c, function (c) {
                    var d = Y.descendants(c, "li");
                    return 0 < d.length ? (c = d[0], d = d[d.length - 1], c = kc.first(c).getOr(c), d = kc.last(d).getOr(d), Yq.outdent(a, c, 0, d, wa.getEnd(d), b).map(function (a) {
                        return a.all()
                    })) : g.none()
                }, g.none, g.none).getOr([])
            }
        }, q = function (a) {
            return wj.cata(a, function (a) {
                    return [a]
                }, function (a) {
                    return [f(a)]
                },
                function (a) {
                    a = E(a, d);
                    e(a);
                    return a
                })
        };
        return {
            apply: function (a, d, e) {
                e = aV.categorise(e, b, c);
                a = ob(e, k) ? l(a, d) : q;
                return ia(e, a)
            }
        }
    }

    function bV(a, b) {
        var c = H.create({analytics: p(["message"])}), d = Uy(b, g.none()), e = a.region(), f = a.content(),
            k = a.undo();
        f.events.stylesheetLoad.bind(function (a) {
            d = Uy(b, g.some(a.sheets()));
            f.uiChanged()
        });
        var l = g.some(Xy.format), q = f.isRoot, C = function (a) {
                cV.deviceType.isiOS() && z(hm(ee(E(a, function (a) {
                    return L.ancestor(a, "ul,ol", q)
                })), function (a) {
                    return a.dom()
                }), function (a) {
                    var b =
                        v.get(a[0], "list-style-type");
                    v.set(a[0], "list-style-type", "none");
                    setTimeout(function () {
                        v.set(a[0], "list-style-type", b)
                    }, 0)
                })
            }, w = function () {
                return Zb.cata(a.selections().get(), h([]), function (a) {
                    return 0 < a.length ? Yy.groups(d, a[0]) : []
                }, function (a, b) {
                    return Yy.groups(d, a.startContainer(), q)
                })
            }, J = function (a) {
                var b = se.hasSelection(f), c = dV.read(f, d), e = w();
                a.populate(e);
                cm.updateMenu(a, c.tag(), b.content(), d.everything(), g.none())
            }, G = function (b) {
                d.ruleByName(b).each(function (b) {
                    Rf.cata(b, function (b, c, d) {
                        Ih.inline(e,
                            f, k, a.selections(), b)
                    }, function (b, c, d, l) {
                        Ih.setClass(e, f, k, a.selections(), b, c)
                    }, function (b, c, d) {
                        Ih.transform(e, f, k, a.selections(), b).each(function (a) {
                            z(a, function (a) {
                                m.remove(a, "class")
                            });
                            C(a)
                        })
                    }, function (b, c, d, l) {
                        Ih.transform(e, f, k, a.selections(), b).each(function (a) {
                            z(a, function (a) {
                                m.set(a, "class", c)
                            });
                            C(a)
                        })
                    });
                    f.uiChanged()
                })
            },
            V = Aa("region content undo selections keyboard listConstructor type styles textkey menuTextkey".split(" "), []),
            X = V({
                region: e,
                content: f,
                undo: k,
                selections: a.selections(),
                keyboard: a.keyboard(),
                listConstructor: u(im.unordered, q),
                type: "bullist",
                styles: ["default", "disc", "circle", "square"],
                textkey: x.key("action.bullist"),
                menuTextkey: x.key("list.unordered.menu")
            });
        V = V({
            region: e,
            content: f,
            undo: k,
            selections: a.selections(),
            keyboard: a.keyboard(),
            listConstructor: u(im.ordered, q),
            type: "numlist",
            styles: "default decimal upper-alpha lower-alpha upper-roman lower-roman lower-greek".split(" "),
            textkey: x.key("action.numlist"),
            menuTextkey: x.key("list.ordered.menu")
        });
        var Hc = function (a) {
            return x.translate("block.describe",
                x.get(a.textkey()))
        };
        X = u(Vy, X);
        V = u(Vy, V);
        return {
            ui: wb.ui({
                "blocktag.dropdown": function () {
                    return {
                        name: "blocktag",
                        textkey: x.key("block.styles"),
                        menuTextkey: x.key("block.menu"),
                        updateDropdown: J,
                        action: G,
                        values: d.everything(),
                        render: l,
                        tooltip: qb.get,
                        toggle: !1,
                        describe: Hc
                    }
                },
                "bullist.widget": X,
                "numlist.widget": V,
                "bullist.general": h(Zy.ul(a)),
                "numlist.general": h(Zy.ol(a))
            }, ca), events: c.registry, destroy: t
        }
    }

    function jb(a, b, c, d) {
        return {context: a, profile: b, action: c, label: h(d)}
    }

    function eV(a) {
        var b = a.content(),
            c = hd.destroyable();
        return {
            ui: wb.ui({
                "bookmark.general": {
                    toggle: !1, value: "bookmark", textkey: x.key("insert.bookmark"), action: function () {
                        b.getSelection().each(function (a) {
                            var c = r.fromTag("span"), d = b.getSelectedText().fold(function () {
                                return jm.generate("textbox-bookmark")
                            }, function (a) {
                                a = 50 < a.length ? a.substr(0, 50) : a;
                                return jm.generate(Ld.getAnchorValue(a, "textbox-bookmark"))
                            });
                            m.set(c, "id", d);
                            a = id.after(a.startContainer(), a.startOffset(), a.endContainer(), a.endOffset()) ? Sc(a.endContainer(), a.endOffset(),
                                a.endContainer(), a.endOffset()) : Sc(a.startContainer(), a.startOffset(), a.startContainer(), a.startOffset());
                            var k = r.fromText(mb());
                            sd.insertAt(b, a, [c, k]).each(function (a) {
                                var c = A.nextSibling(a.element()).filter(function (a) {
                                    return wa.isCursorPosition(a) && !N.eq(k, a)
                                }).getOrThunk(function () {
                                    var b = r.fromText(" ");
                                    y.after(a.element(), b);
                                    return b
                                });
                                b.win().each(function (a) {
                                    Wa.setExact(a, c, 0, c, 0)
                                })
                            })
                        })
                    }, updateGeneral: t, icon: !0, shortcut: !1, hasPopup: !1, hasDialog: !0
                }
            }), destroy: function () {
                c.clear()
            }
        }
    }

    function fV(a,
                b) {
        return {
            is: function (c) {
                return m.get(c, a) === b
            }, remove: function (b) {
                m.remove(b, a)
            }, set: function (c) {
                m.set(c, a, b)
            }
        }
    }

    function gV(a) {
        var b = a.content(), c = H.create({analytics: p(["message", "properties"])}), d = function (a, c) {
            $y.readDir(b).map(function (b) {
                return b[a]
            }).fold(Da.unchanged, xb).fold(c.deselect, t, c.select)
        };
        return {
            ui: wb.ui({
                "ltrdir.general": {
                    value: "ltrdir",
                    textkey: x.key("directionality.ltrdir"),
                    action: u(az.dirLtr, a),
                    updateGeneral: u(d, "ltrdir"),
                    toggle: !0
                }, "rtldir.general": {
                    value: "rtldir", textkey: x.key("directionality.rtldir"),
                    action: u(az.dirRtl, a), updateGeneral: u(d, "rtldir"), toggle: !0
                }
            }), events: c.registry, destroy: t
        }
    }

    function bz(a, b) {
        return cz(document.createElement("canvas"), a, b)
    }

    function dz(a) {
        return a.getContext("2d")
    }

    function cz(a, b, c) {
        a.width = b;
        a.height = c;
        return a
    }

    function ez(a, b) {
        return new (Kc.getOrDie("Blob"))(a, b)
    }

    function Zq() {
        return new (Kc.getOrDie("FileReader"))
    }

    function fz(a) {
        return new (Kc.getOrDie("Uint8Array"))(a)
    }

    function gz(a) {
        return new Md(function (b, c) {
            function d() {
                l();
                b(k)
            }

            function e() {
                l();
                c("Unable to load data of type " +
                    a.type + ": " + f)
            }

            var f = URL.createObjectURL(a), k = new Image, l = function () {
                k.removeEventListener("load", d);
                k.removeEventListener("error", e)
            };
            k.addEventListener("load", d);
            k.addEventListener("error", e);
            k.src = f;
            k.complete && d()
        })
    }

    function hz(a) {
        return new Md(function (b, c) {
            var d = new XMLHttpRequest;
            d.open("GET", a, !0);
            d.responseType = "blob";
            d.onload = function () {
                200 == this.status && b(this.response)
            };
            d.onerror = function () {
                if (0 === this.status) {
                    var a = Error("No access to download image");
                    a.code = 18;
                    a.name = "SecurityError"
                } else a =
                    Error("Error " + this.status + " downloading image");
                c(a)
            };
            d.send()
        })
    }

    function iz(a) {
        var b = a.split(",");
        a = /data:([^;]+)/.exec(b[0]);
        if (!a) return g.none();
        a = a[1];
        b = km.atob(b[1]);
        for (var c = b.length, d = Math.ceil(c / 1024), e = Array(d), f = 0; f < d; ++f) {
            for (var k = 1024 * f, l = Math.min(k + 1024, c), q = Array(l - k), C = 0; k < l; ++C, ++k) q[C] = b[k].charCodeAt(0);
            e[f] = fz(q)
        }
        return g.some(ez(e, {type: a}))
    }

    function $q(a) {
        return new Md(function (b, c) {
            iz(a).fold(function () {
                c("uri is not base64: " + a)
            }, b)
        })
    }

    function jz(a) {
        return new Md(function (b) {
            var c =
                new Zq;
            c.onloadend = function () {
                b(c.result)
            };
            c.readAsDataURL(a)
        })
    }

    function ar(a, b, c) {
        function d(b, c) {
            return a.then(function (a) {
                return jd.canvasToDataURL(a, b, c)
            })
        }

        return {
            getType: h(b.type), toBlob: function () {
                return Md.resolve(b)
            }, toDataURL: function () {
                return c
            }, toBase64: function () {
                return c.split(",")[1]
            }, toAdjustedBlob: function (b, c) {
                return a.then(function (a) {
                    return jd.canvasToBlob(a, b, c)
                })
            }, toAdjustedDataURL: d, toAdjustedBase64: function (a, b) {
                return d(a, b).then(function (a) {
                    return a.split(",")[1]
                })
            }, toCanvas: function () {
                return a.then(Uc.clone)
            }
        }
    }

    function kz(a) {
        return jd.blobToDataUri(a).then(function (b) {
            return ar(jd.blobToCanvas(a), a, b)
        })
    }

    function hV(a) {
        var b = a.filter();
        b.addSelector(b.output(), "a[data-ephox-href]", Na.removeAttr("data-ephox-href"));
        b.addSelector(b.output(), "img[data-ephox-src]", Na.removeAttr("data-ephox-src"));
        var c = H.create({insertAssets: p(["assets"]), insertHtml: p(["html"])}), d = a.content(), e = g.none(),
            f = function (a) {
                d.win().each(function (b) {
                    Wa.getAtPoint(b, a.x(), a.y()).each(function (a) {
                        Wa.setExact(b, a.start(), a.soffset(),
                            a.finish(), a.foffset())
                    })
                })
            }, k = function (a) {
                f(a);
                c.trigger.insertAssets(a.assets())
            }, l = function (b) {
                f(b);
                b = b.html();
                a.undo().save();
                b = qe.fromHtml(b);
                sd.insertAtCursor(d, b)
            };
        d.events.ready.bind(function (a) {
            var b = a.api(), c = g.none();
            e = g.some(iV.forImages(a.api().canvas(), c, !0));
            e.each(function (a) {
                var c = function (a) {
                    var b = function (a, b, c) {
                        var d = m.get(a, c);
                        d !== m.get(a, b) && m.set(a, b, d);
                        m.remove(a, c)
                    };
                    z(a, function (a) {
                        "a" === D.name(a) && m.has(a, "data-ephox-href") ? b(a, "href", "data-ephox-href") : "img" === D.name(a) &&
                            m.has(a, "data-ephox-src") && b(a, "src", "data-ephox-src")
                    })
                };
                b.events.mousedown.bind(function () {
                    b.getSelection().each(function (d) {
                        var e = xj.findDescendants(d.startContainer(), d.startOffset(), d.endContainer(), d.endOffset(), "a,img"),
                            f = 0 < e.length ? e : xj.findAncestors(d.startContainer(), d.endContainer(), "a,img");
                        if (0 < f.length) {
                            lz.processLinksAndImages(b, f);
                            var k = function () {
                                b.events.mouseup.unbind(l);
                                a.events.dragend.unbind(l);
                                a.events.dragndropinternal.unbind(k)
                            }, l = function () {
                                c(f);
                                k()
                            };
                            b.events.mouseup.bind(l);
                            a.events.dragend.bind(l);
                            a.events.dragndropinternal.bind(k)
                        }
                    })
                });
                a.events.dragndropimages.bind(k);
                a.events.dragndrophtml.bind(l);
                a.events.dragndropinternal.bind(function () {
                    c(Fa.all("a[data-ephox-href],img[data-ephox-src]", b.body()))
                })
            })
        });
        return {
            events: c.registry, destroy: function (a) {
                e.each(function (a) {
                    a.destroy()
                })
            }
        }
    }

    function lm(a, b) {
        var c = void 0 !== b ? b : 36E5, d = O("result", "timestamp"), e = {}, f = function (a, b, c) {
            e[a] = d(b, c)
        };
        b = function (a) {
            var b = yj.now();
            eb(a, function (a, d) {
                b - a.timestamp < c && f(d, a.result, a.timestamp)
            })
        };
        ic(a) && b(a);
        return {
            set: f, get: function (a, b) {
                return g.from(e[b]).filter(function (b) {
                    return a - b.timestamp() < c
                }).map(function (a) {
                    return a.result()
                })
            }, dump: function () {
                return eb(e, function (a) {
                    return {result: a.result(), timestamp: a.timestamp()}
                })
            }
        }
    }

    function jV(a) {
        return Ga.nu(function (b) {
            var c = Zq();
            c.onload = function (a) {
                b(a.target.result)
            };
            c.readAsText(a)
        })
    }

    function kV(a, b, c) {
        var d = lm(c),
            e = mm.get("ephox.media.service.one", br.requestOne(), a + "/1/embed?url=${url}&maxWidth=${maxWidth}", b);
        return {
            checkOne: function (a,
                                b, c) {
                var f = yj.now();
                c = nm.single(function (c, d) {
                    return e.execute({url: encodeURIComponent(a), maxWidth: b, fresh: d})
                }, d, b + "&" + a, f, void 0 !== c ? c : !1);
                return hf.foldSync(c, mz.failed, mz.success)
            }, dumpCache: d.dump
        }
    }

    function lV(a, b, c) {
        var d = cr.embedChecking(), e = a.internalevents(), f = a.communication(),
            k = kV(c.url, f.newHeaders(), b.cache), l = a.undo(), q = a.content();
        a = a.filter();
        cr.configure(a);
        var C = ["img", "video", "audio"], g = function (a, b) {
            y.after(a, b);
            F.remove(a)
        }, h = function (a, b) {
            n.add(a, d);
            var e = k.checkOne(b, 400);
            hf.handle(e,
                function (b) {
                    n.remove(a, d)
                }, function (e) {
                    n.remove(a, d);
                    l.save();
                    var f = mV(e.recommended().html().trim());
                    U(C, D.name(f)) || m.set(f, "data-ephox-embed-iri", b);
                    var k = r.fromTag("div");
                    y.append(k, f);
                    c.inlineStyles && q.doc().each(function (a) {
                        nz.inlinePrefixedStyles(a, k, ".ephox-summary-card")
                    });
                    q.getSelection().fold(function () {
                        g(a, f)
                    }, function (b) {
                        var c = N.eq(b.startContainer(), a) || N.contains(a, b.startContainer());
                        g(a, f);
                        var d = A.nextSibling(f).filter(wa.isCursorPosition).getOrThunk(function () {
                            var a = r.fromTag("br");
                            y.after(f, a);
                            return a
                        });
                        (c || A.parent(f).filter(function (a) {
                            return b.collapsed() && (N.eq(b.startContainer(), a) || N.contains(a, b.startContainer()))
                        }).isSome()) && q.setSelection(d, 0, d, 0)
                    })
                })
        }, G = function (a) {
            var b = a.command(), c = a.data();
            m.has(c, rb.bookmarkAnchorDataAttr()) || "insertLink" !== b && "updateLink" !== b || A.parent(c).each(function (a) {
                var b = Vb.get(a).replace(mb(), ""), d = m.get(c, "href");
                if (b === d || "http://" + b === d) h(c, d); else {
                    var e = A.children(a), f = qa(kd(e), function (a) {
                        return "br" === D.name(a) && om.documentPositionPreceding(c.dom(),
                            a.dom())
                    }).map(function (a) {
                        a = Gc(e, a).getOr(-1);
                        return e.slice(a + 1, e.length)
                    }).getOr(e);
                    a = qa(e, function (a) {
                        return "br" === D.name(a) && om.documentPositionPreceding(a.dom(), c.dom())
                    }).map(function (a) {
                        a = Gc(f, a).getOr(0);
                        return f.slice(0, a)
                    }).getOr(f);
                    a = hb(a, function (a, b) {
                        return a + Vb.get(b)
                    }, "").replace(mb(), "");
                    a !== d && "http://" + a !== d || h(c, d)
                }
            })
        };
        e.events.internal.bind(G);
        return {
            destroy: function () {
                e.events.internal.unbind(G)
            }, state: function () {
                return {cache: k.dumpCache()}
            }
        }
    }

    function oz(a) {
        var b = function () {
            return null ===
            a.project.apiKey ? {} : {"textbox-api-key": a.project.apiKey}
        }, c = function (a) {
            var b = a + (-1 === a.indexOf("?") ? "?" : "&") + "url=";
            return function (a) {
                return g.some(b + encodeURIComponent(a))
            }
        };
        c = void 0 === a.imageEdit.proxy ? g.none : c(a.imageEdit.proxy);
        return {
            headers: function () {
                return {headers: b(), xhrFields: {withCredentials: !0}}
            }, newHeaders: b, proxy: c, destroy: t
        }
    }

    function nV(a) {
        var b = "true" === m.get(a, "contenteditable");
        m.set(a, "contenteditable", "true");
        var c = K.bind(a, "keydown", function (a) {
            A.trigger.keydown(a)
        }), d = K.bind(a,
            "keyup", function (a) {
                A.trigger.keyup(a)
            }), e = K.bind(a, "keypress", function (a) {
            A.trigger.keypress(a)
        }), f = K.bind(a, "mousedown", function (a) {
            A.trigger.mousedown(a)
        }), k = K.bind(a, "mouseout", function (a) {
            A.trigger.mouseout(a)
        }), l = K.bind(a, "mouseup", function (a) {
            A.trigger.mouseup(a)
        }), q = K.bind(a, "contextmenu", function (a) {
            A.trigger.contextmenu(a)
        }), C = K.bind(a, "cut", function (a) {
            A.trigger.cut(a)
        }), w = K.bind(a, "copy", function (a) {
            A.trigger.copy(a)
        }), J = K.bind(a, "paste", function (a) {
            A.trigger.paste(a)
        }), G = K.bind(r.fromDom(document),
            "selectionchange", function (a) {
                A.trigger.selectionchange(a)
            }), V = function () {
            A.trigger.paint()
        }, X = K.capture(a, "load", V);
        pz.bind(a, V);
        var Hc = qz.browser.isFirefox() ? "focus" : "focusin", u = K.bind(a, Hc, function (a) {
            A.trigger.focus(a)
        }), v = K.bind(a, "focusout", function (a) {
            A.trigger.focusOut(a)
        }), y = K.bind(a, "dblclick", function (a) {
            A.trigger.dblclick(a)
        }), x = function (b) {
            return N.eq(a, b)
        };
        Hc = {loaded: Ga.pure(I.error("no iframe in inline mode")), stylesheetLoad: Ga.pure(g.none())};
        var A = H.create({
            keydown: p(["original"]),
            keyup: p(["original"]),
            keypress: p(["original"]),
            mousedown: p(["original"]),
            mouseup: p(["original"]),
            mouseout: p(["original"]),
            contextmenu: p(["original"]),
            cut: p(["original"]),
            copy: p(["original"]),
            paste: p(["original"]),
            focus: p(["original"]),
            dblclick: p(["original"]),
            focusOut: p(["original"]),
            selectionchange: p(["original"]),
            paint: p([])
        }), B = h(g.from(document.baseURI).getOr(window.location.href));
        return {
            win: h(window), doc: h(r.fromDom(document)), body: h(a), baseURI: B, get: function () {
                return Ea.get(a)
            }, set: function (b) {
                Ea.set(a,
                    b)
            }, focus: function () {
                qz.browser.isIE() ? a.dom().setActive(!0) : Z.focus(a)
            }, focused: function () {
                return document.activeElement === a.dom()
            }, blur: function () {
                a.dom().blur()
            }, destroy: function () {
                b || m.remove(a, "contenteditable");
                z([c, d, e, f, l, k, q, C, w, J, u, v, y, G, X], function (a) {
                    a.unbind()
                });
                pz.unbind(a, V)
            }, events: A.registry, futures: Hc, background: t, foreground: t, hasRange: function (a) {
                return Ja.closest(a.startContainer(), x).isSome() && Ja.closest(a.endContainer(), x).isSome()
            }, isActive: function () {
                return n.has(a, be.active())
            }
        }
    }

    function rz(a, b, c) {
        var d = u(N.eq, b), e = function (c) {
            var e = kb.freefallRtl(b).element();
            return L.ancestor(e, "table", d).filter(oV(a, c)).map(sz.above)
        }, f = function (b, d, e, f, g) {
            b.kill();
            Wa.setExact(a, d, e, f, g);
            c()
        };
        return function (c) {
            var k = c.y();
            e(k).orThunk(function () {
                var c = kb.freefallLtr(b).element();
                return L.ancestor(c, "table", d).filter(pV(a, k)).map(sz.below)
            }).fold(function () {
                if ("html" === D.name(c.target())) {
                    var e = c.x(), k = c.y();
                    Wa.getAtPoint(a, e, k).each(function (a) {
                        var e = function (a) {
                            return L.closest(a, '[contenteditable="false"]',
                                d).isSome()
                        }, k = e(a.start());
                        e = e(a.finish());
                        (k || e) && pm.browser.isIE() || Z.focus(b);
                        if (pm.browser.isIE() && 1 === A.childNodesCount(b) && (k = A.children(b)[0], "p" === D.name(k) && 0 === A.childNodesCount(k))) {
                            y.append(k, r.fromTag("br"));
                            f(c, k, 0, k, 0);
                            return
                        }
                        f(c, a.start(), a.soffset(), a.finish(), a.foffset())
                    })
                }
            }, function (a) {
                var b = r.fromHtml("<p><br /></p>");
                a.fold(function (a) {
                    y.after(a, b)
                }, function (a) {
                    y.before(a, b)
                });
                f(c, b, 0, b, 0)
            })
        }
    }

    function tz(a) {
        var b = null, c = function () {
            b = null;
            $b.get(a.win()).each(function (b) {
                b.collapsed() &&
                a.focused() && d.trigger.loiter(b.startContainer(), b.startOffset())
            })
        }, d = H.create({loiter: p(["node", "offset"])});
        return {
            reset: function () {
                null !== b && (clearTimeout(b), b = null);
                b = setTimeout(c, 1E3)
            }, destroy: function () {
                null !== b && (clearTimeout(b), b = null)
            }, events: d.registry
        }
    }

    function uz(a, b) {
        var c = g.none(), d = Hd.tap(function () {
            d.control.block();
            var f = a();
            f.filter(function (a) {
                return ja.inBody(a.startContainer())
            }).each(function (a) {
                var d = function () {
                    e.trigger.nodeChanged(a.startContainer(), a.startOffset(), c.map(function (a) {
                        return a.startContainer()
                    }))
                };
                c.fold(d, function (c) {
                    var e = N.eq, f = a.startContainer(), k = a.endContainer(), l = c.startContainer(),
                        q = c.endContainer(), g = c.startOffset() !== a.startOffset();
                    c = c.endOffset() !== a.endOffset();
                    (!e(l, f) || !e(q, k) || !D.isText(f) && g || !D.isText(k) && c) && !1 === qV([a.startContainer()], b) && d()
                })
            });
            c = f;
            d.control.unblock()
        }), e = H.create({nodeChanged: p(["node", "offset", "prev"])});
        return {
            update: function () {
                d.instance()
            }, clear: function () {
                c = g.none()
            }, destroy: function () {
                c = g.none();
                d.control.block()
            }, events: e.registry
        }
    }

    function rV() {
        var a =
            g.none();
        return {
            get: function () {
                return a
            }, restore: function (b) {
                a.each(b)
            }, update: function (b) {
                a = b.or(a)
            }, clear: function () {
                a = g.none()
            }
        }
    }

    function sV(a, b) {
        var c = function () {
            return V().orThunk(f.get)
        }, d = K.bind(a.body(), "click", rz(a.win(), a.body(), t)), e = uz(c, b), f = rV(), k = function () {
            e.update();
            G()
        }, l = function () {
            f.restore(function (a) {
                X(a.startContainer(), a.startOffset(), a.endContainer(), a.endOffset())
            })
        };
        e.events.nodeChanged.bind(function (a) {
            x.trigger.nodeChanged(a.node(), a.offset(), a.prev());
            x.trigger.uiStale()
        });
        a.events.keyup.bind(function (a) {
            x.trigger.keyup(a.original());
            k();
            q.reset();
            x.trigger.interaction()
        });
        a.events.mouseout.bind(function (a) {
            G()
        });
        a.events.mouseup.bind(function (a) {
            x.trigger.mouseup(a.original());
            k();
            q.reset();
            x.trigger.interaction()
        });
        var q = tz(a);
        q.events.loiter.bind(function (a) {
            x.trigger.loiter(a.node(), a.offset())
        });
        var C = function () {
                V().isNone() ? l() : G()
            }, g = function () {
                a.isActive() && (C(), vz.focus(a, c, n))
            }, h = function () {
                x.trigger.domChanged()
            }, G = function () {
                var a = V();
                f.update(a)
            }, V = function () {
                return $b.get(window).filter(a.hasRange)
            },
            X = function (a, b, c, d) {
                try {
                    $b.setExact(window, a, b, c, d)
                } catch (Hoa) {
                    console.log("Skipping restoring invalid cursor position")
                }
            }, m = function (b) {
                v(function (c) {
                    a.isActive() && b();
                    k()
                }, dr.build(a.focused, C, g, r.fromDom(document)))
            }, n = function (a, b, c, d) {
                m(function () {
                    X(a, b, c, d)
                })
            }, u = function (a, b) {
                var c = $b.get(window);
                l();
                a = a(b);
                b.toOld();
                c.each(function (a) {
                    X(a.startContainer(), a.startOffset(), a.endContainer(), a.endOffset());
                    tV.browser.isEdge() && (b.isSet() || b.toOld())
                });
                return a
            }, v = function (a, b) {
                a = a(b);
                b.toOld();
                return a
            }, z = function (b) {
                var c = dr.build(a.focused, C, g, r.fromDom(document));
                return (V().isSome() ? v : u)(b, c)
            };
        b = function (a) {
            return function () {
                var b = arguments;
                return z(function (c) {
                    c.toEditor();
                    return a(b)
                })
            }
        }(function (a) {
            document.execCommand.apply(document, a);
            G()
        });
        var y = function (a, b) {
            return Ra(a, b)
        }, x = H.create({
            nodeChanged: p(["node", "offset", "prev"]),
            loiter: p(["node", "offset"]),
            uiStale: p([]),
            domChanged: p([]),
            interaction: p([]),
            keyup: p(["original"]),
            mouseup: p(["original"]),
            keydown: Q(["original"], a.events.keydown),
            keypress: Q(["original"], a.events.keypress),
            mousedown: Q(["original"], a.events.mousedown),
            contextmenu: Q(["original"], a.events.contextmenu),
            cut: Q(["original"], a.events.cut),
            copy: Q(["original"], a.events.copy),
            paste: Q(["original"], a.events.paste),
            focus: Q(["original"], a.events.focus),
            focusOut: Q(["original"], a.events.focusOut),
            dblclick: Q(["original"], a.events.dblclick),
            selectionchange: p(["original"]),
            paint: Q([], a.events.paint)
        });
        a.events.selectionchange.bind(function (a) {
            V().each(function () {
                x.trigger.selectionchange(a.original())
            })
        });
        return {
            win: a.win,
            doc: a.doc,
            body: a.body,
            baseURI: a.baseURI,
            canvas: a.body,
            getContent: a.get,
            setContent: a.set,
            resetContent: function (b) {
                a.set(b);
                f.clear();
                e.clear();
                b = kb.freefallLtr(a.body());
                n(b.element(), b.offset(), b.element(), b.offset());
                h()
            },
            blur: a.blur,
            focus: function () {
                dr.toEditor(a.focused, C, g, r.fromDom(document))
            },
            uiChanged: function () {
                z(function () {
                    x.trigger.uiStale()
                })
            },
            domChanged: h,
            clearSelection: function () {
                $b.clearAll(window)
            },
            getSelection: c,
            setSelection: n,
            setRelativeSelection: function (a, b) {
                m(function () {
                    $b.setRelative(window,
                        a, b)
                })
            },
            backupSelection: G,
            replaceSelection: function (a) {
                V().fold(function () {
                    l();
                    V().each(function () {
                        $b.replace(window, a);
                        k()
                    })
                }, function (b) {
                    $b.replace(window, a);
                    k()
                })
            },
            execCommand: b,
            destroy: function () {
                a.destroy();
                q.destroy();
                d.unbind();
                e.destroy()
            },
            events: x.registry,
            futures: a.futures,
            background: a.background,
            foreground: a.foreground,
            translateScreen: y,
            translateLocation: y
        }
    }

    function er() {
        var a = null, b = [], c = function () {
            return null !== a
        }, d = function () {
            z(b, function (a) {
                e(a)
            })
        }, e = function (b) {
            setTimeout(function () {
                b.apply(null,
                    a)
            }, 0)
        };
        return {
            get: function (a) {
                c() ? e(a) : b.push(a)
            }, set: function () {
                a = Array.prototype.slice.call(arguments);
                d();
                b = []
            }, isSet: c
        }
    }

    function uV(a, b, c) {
        var d = r.fromTag("div");
        S.presentation(d);
        v.set(d, "display", "none");
        var e = Ea.get(a);
        (function (b) {
            var c = A.owner(a);
            z(b, function (a) {
                vV.addLinkIfMissing(c, a)
            })
        })(b);
        b = er();
        var f = nV(a), k = sV(f, c);
        b.set(k);
        return {
            element: function () {
                return a
            }, onCanvas: function (a) {
                a(k.canvas())
            }, initial: h(e), placeholder: function () {
                return d
            }, tabindex: function (b) {
                m.set(a, "tabindex",
                    b)
            }, destroy: function () {
                F.remove(d);
                k.destroy()
            }, loaded: b.get, isInline: h(!0)
        }
    }

    function wV(a, b) {
        var c = a.doc();
        return {
            execCommand: function (a) {
                var d = arguments, f = a.toLowerCase(), k = yb("This should not be in hare.");
                k = {fontsize: k, forecolor: k, fontname: k, bgcolor: k, inserthtml: k, blockquote: k};
                (void 0 !== k[f] ? k[f] : function () {
                    c.dom().execCommand.apply(c.dom(), d)
                })();
                b.update()
            }
        }
    }

    function xV(a) {
        var b = function () {
            return $b.get(a.win())
        }, c = function (b, c, f, k) {
            b = Sc(b, c, f, k);
            $b.set(a.win(), b)
        };
        return {
            clearSelection: function () {
                $b.clearAll(a.win())
            },
            getSelection: b, replaceSelection: function (b) {
                $b.replace(a.win(), b)
            }, setSelection: c, setRelativeSelection: function (b, c) {
                $b.setRelative(a.win(), b, c)
            }, restore: t, backup: t, nativeCall: xb, focus: function () {
                vz.focus(a, b, c)
            }, destroy: t, clear: t
        }
    }

    function yV(a, b) {
        var c = g.none(), d = K.bind(b, "blur", function (a) {
            f()
        }), e = function () {
            c = g.none()
        }, f = function () {
            $b.get(a.win()).fold(t, function (a) {
                c = g.some(a)
            })
        }, k = function (b, d) {
            try {
                d(a.win(), b), c = g.some(b)
            } catch (G) {
                wz()
            }
        }, l = function (a) {
            k(a, $b.set)
        }, q = function () {
            c.each(l)
        }, C =
            function (a) {
                var b = document.activeElement;
                a = a();
                null !== b && void 0 !== b && b !== document.activeElement && void 0 !== b.focus && b.focus();
                return a
            };
        return {
            clearSelection: function () {
                Z.hasFocus(b) && $b.clearAll(a.win())
            }, getSelection: function () {
                return Z.hasFocus(b) ? $b.get(a.win()) : c
            }, replaceSelection: function (c) {
                Z.hasFocus(b) || q();
                $b.replace(a.win(), c)
            }, setSelection: function (a, c, d, e) {
                C(function () {
                    var f = Sc(a, c, d, e);
                    Z.hasFocus(b) ? l(f) : k(f, t)
                })
            }, setRelativeSelection: function (b, c) {
                C(function () {
                    e();
                    try {
                        $b.setRelative(a.win(),
                            b, c)
                    } catch (G) {
                        wz()
                    }
                    f()
                })
            }, restore: q, backup: f, nativeCall: function (a) {
                return C(function () {
                    Z.hasFocus(b) || q();
                    return a()
                })
            }, focus: function () {
                if (document.activeElement !== b.dom()) {
                    var d = c;
                    a.focus();
                    d.each(l)
                } else $b.get(a.win()).fold(q, t)
            }, destroy: function () {
                d.unbind()
            }, clear: e
        }
    }

    function zV(a, b, c) {
        var d = aa.detect(), e = d.browser.isIE() || d.browser.isEdge() ? yV(a, b) : xV(a),
            f = K.bind(a.doc(), "click", rz(a.win(), a.body(), e.backup)), k = function () {
                return e.getSelection()
            }, l = uz(k, c), q = wV(a, l);
        (d.browser.isChrome() ||
            d.browser.isSafari()) && q.execCommand("defaultParagraphSeparator", !1, "p");
        l.events.nodeChanged.bind(function (a) {
            X.trigger.nodeChanged(a.node(), a.offset(), a.prev());
            X.trigger.uiStale()
        });
        a.events.keyup.bind(function (a) {
            e.backup();
            l.update(a)
        });
        var C = jf(l.update, 300);
        a.events.mouseup.bind(function (a) {
            e.backup();
            C.throttle(a)
        });
        var g = tz(a);
        g.events.loiter.bind(function (a) {
            X.trigger.loiter(a.node(), a.offset())
        });
        c = function () {
            g.reset();
            X.trigger.interaction()
        };
        a.events.keyup.bind(c);
        a.events.mouseup.bind(c);
        a.events.paint.bind(function (a) {
            return X.trigger.paint()
        });
        var h = function () {
            X.trigger.domChanged()
        }, G = function (a, b, c, d) {
            e.setSelection(a, b, c, d);
            l.update()
        }, V = function (a, c) {
            return bb.absolute(b).translate(a, c)
        }, X = H.create({
            nodeChanged: p(["node", "offset", "prev"]),
            loiter: p(["node", "offset"]),
            uiStale: p([]),
            domChanged: p([]),
            interaction: p([]),
            keydown: Q(["original"], a.events.keydown),
            keyup: Q(["original"], a.events.keyup),
            keypress: Q(["original"], a.events.keypress),
            mousedown: Q(["original"], a.events.mousedown),
            mouseup: Q(["original"], a.events.mouseup),
            contextmenu: Q(["original"], a.events.contextmenu),
            cut: Q(["original"], a.events.cut),
            copy: Q(["original"], a.events.copy),
            paste: Q(["original"], a.events.paste),
            focus: Q(["original"], a.events.focus),
            focusOut: Q(["original"], a.events.focusOut),
            dblclick: Q(["original"], a.events.dblclick),
            selectionchange: Q(["original"], a.events.selectionchange),
            paint: p([])
        });
        return {
            win: a.win,
            doc: a.doc,
            body: a.body,
            baseURI: a.baseURI,
            canvas: a.doc,
            getContent: a.get,
            setContent: a.set,
            resetContent: function (b) {
                a.set(b);
                e.clear();
                l.clear();
                b = kb.freefallLtr(a.body());
                G(b.element(), b.offset(), b.element(), b.offset());
                h()
            },
            blur: a.blur,
            focus: function () {
                e.focus()
            },
            uiChanged: function () {
                X.trigger.uiStale()
            },
            domChanged: h,
            clearSelection: function () {
                e.clearSelection()
            },
            getSelection: k,
            setSelection: G,
            setRelativeSelection: function (a, b) {
                e.setRelativeSelection(a, b);
                l.update()
            },
            backupSelection: function () {
                e.backup()
            },
            replaceSelection: function (a) {
                e.replaceSelection(a);
                l.update()
            },
            execCommand: function () {
                var a = arguments;
                e.nativeCall(function () {
                    q.execCommand.apply(null,
                        a);
                    X.trigger.uiStale()
                })
            },
            destroy: function () {
                e.destroy();
                a.destroy();
                g.destroy();
                f.unbind();
                l.destroy()
            },
            events: X.registry,
            futures: a.futures,
            background: a.background,
            foreground: a.foreground,
            translateScreen: V,
            translateLocation: function (b, c) {
                var d = Za.get(a.doc());
                return V(b, c).translate(-d.left(), -d.top())
            }
        }
    }

    function AV(a) {
        return {
            background: t,
            foreground: t,
            focus: t,
            keydown: t,
            mousedown: g.some,
            mouseup: g.some,
            selectionchange: function (a) {
                return jf(a, 300).throttle
            }
        }
    }

    function BV(a, b) {
        return {
            background: t, foreground: t,
            focus: function (a, d, e) {
                Za.preserve(r.fromDom(document), function () {
                    Za.preserve(A.owner(e), function () {
                        b.browser.isEdge() && window.getSelection().removeAllRanges();
                        e.dom().focus()
                    })
                })
            }, keydown: t, mousedown: g.some, mouseup: g.some, selectionchange: h(t)
        }
    }

    function CV(a) {
        var b = function (a) {
            return "body" === D.name(a.target()) || "html" === D.name(a.target()) ? g.none() : g.some(a)
        };
        return {
            background: function (a, b, e) {
                A.owner(b).dom().defaultView.focus()
            }, foreground: function (a, b, e) {
                void 0 !== a.focus && a.focus()
            }, focus: t, keydown: function (a) {
                void 0 !==
                a.focus && a.focus()
            }, mousedown: function (a) {
                return b(a)
            }, mouseup: function (a) {
                return b(a)
            }, selectionchange: h(t)
        }
    }

    function DV(a, b) {
        var c = a.dom().contentWindow, d = xz.doc(a), e = L.descendant(d, "body").getOrDie();
        ma.add(e, [be.base(), be.active()]);
        b.autoresize && n.add(A.documentElement(e), be.autoresize());
        var f = EV.browser.isFirefox(), k = H.create({
                keydown: p(["original"]),
                keyup: p(["original"]),
                keypress: p(["original"]),
                mousedown: p(["original"]),
                mouseup: p(["original"]),
                contextmenu: p(["original"]),
                cut: p(["original"]),
                copy: p(["original"]),
                paste: p(["original"]),
                focus: p(["original"]),
                dblclick: p(["original"]),
                focusOut: p(["original"]),
                paint: p([]),
                selectionchange: p(["original"])
            }), l = FV.get(k), q = function () {
                return ka(d.dom().styleSheets, function (a) {
                    try {
                        return 0 <= a.cssRules.length
                    } catch (Ioa) {
                        return b.needStyles && console.warn("Unable to access rules from " + a.href), !1
                    }
                })
            }, C = {
                stylesheetLoad: Ga.nu(function (a) {
                    var b = 0, d = setInterval(function () {
                        50 < b || 0 >= c.stillToLoad ? (clearInterval(d), a(g.some(q()))) : b++
                    }, 100)
                })
            }, w = K.bind(d,
            "keydown", function (a) {
                l.keydown(c);
                k.trigger.keydown(a)
            }), J = K.bind(d, "keyup", function (a) {
                k.trigger.keyup(a)
            }), G = K.bind(d, "keypress", function (a) {
                k.trigger.keypress(a)
            }), V = K.bind(d, "mousedown", function (a) {
                l.mousedown(a).fold(function () {
                    a.kill()
                }, k.trigger.mousedown)
            }), X = K.bind(d, "mouseup", function (a) {
                l.mouseup(a).fold(function () {
                    a.kill()
                }, k.trigger.mouseup)
            }), m = K.bind(d, "contextmenu", function (a) {
                k.trigger.contextmenu(a)
            }), r = K.bind(d, "cut", function (a) {
                k.trigger.cut(a)
            }), t = K.bind(d, "copy", function (a) {
                k.trigger.copy(a)
            }),
            u = K.bind(d, "paste", function (a) {
                k.trigger.paste(a)
            }), v = K.bind(d, f ? "focus" : "focusin", function (a) {
                k.trigger.focus(a)
            }), x = K.bind(d, "focusout", function (a) {
                k.trigger.focusOut(a)
            }), y = K.bind(d, "dblclick", function (a) {
                k.trigger.dblclick(a)
            }), B = l.selectionchange(function (a) {
                k.trigger.mouseup(a)
            }), D = K.bind(d, "selectionchange", function (a) {
                B(a);
                k.trigger.selectionchange(a)
            }), E = K.bind(d, "touchstart", function (a) {
                k.trigger.mousedown(a)
            }), F = K.bind(d, "touchend", function (a) {
                k.trigger.mouseup(a);
                O()
            }), I = function () {
                k.trigger.paint()
            },
            N = K.capture(d, "load", I), M = function () {
                c.addEventListener("resize", I, !1);
                return {
                    unbind: function () {
                        c.removeEventListener && c.removeEventListener("resize", I, !1)
                    }
                }
            }(), O = function () {
                l.foreground(c, a, e)
            };
        f = h(g.from(d.baseURI).or(b.base).getOr(window.location.href));
        return {
            win: h(c), doc: h(d), body: h(e), baseURI: f, get: function () {
                return Ea.get(e)
            }, set: function (a) {
                Ea.set(e, a)
            }, focus: function () {
                l.focus(c, a, e)
            }, focused: function () {
                return document.activeElement === a.dom()
            }, blur: function () {
                e.dom().blur()
            }, destroy: function () {
                z([w,
                    J, G, V, X, m, r, t, u, v, x, D, y, E, F, N, M], function (a) {
                    a.unbind()
                })
            }, events: k.registry, futures: C, background: function () {
                l.background(c, a, e)
            }, foreground: O
        }
    }

    function GV(a) {
        var b = r.fromTag("iframe");
        n.add(b, HV.resolve("content-iframe"));
        var c = g.none(), d = er(), e = K.bind(b, "load", function () {
            e.unbind();
            var f = IV(a);
            yz.write(b, f);
            f = zz.onShow(b, function () {
                c.each(xb);
                c = g.none();
                ja.inBody(b) && d.set(DV(b, a))
            });
            c = g.some(f)
        });
        return {
            element: function () {
                return b
            }, tabindex: function (a) {
                m.set(b, "tabindex", a)
            }, destroy: function () {
                F.remove(b);
                e.unbind();
                c.each(xb)
            }, loaded: d.get
        }
    }

    function JV(a, b) {
        var c = GV(a), d = er(), e = t;
        c.loaded(function (f) {
            var k = aa.detect().browser.isIE(), l = zV(f, c.element(), b), q = c.element(),
                C = A.parent(q).fold(function () {
                    return 0
                }, function (a) {
                    return parseInt(v.get(a, "min-height"))
                }), g = function (a) {
                    v.remove(l.body(), "min-height");
                    a = sa.get(A.documentElement(l.body()));
                    var b = sa.get(q);
                    a !== b && (b = parseInt(v.get(q, "margin-top")), b = C - b, a = a > b ? a : b, v.set(q, "min-height", a + "px"), 150 > a ? v.set(q, "height", a + "px") : v.remove(q, "height"))
                },
                h = function (a) {
                    a = sa.get(l.body());
                    var b = sa.get(c.element());
                    a !== b && sa.set(l.body(), b)
                }, G = uj(g, 0);
            k = k ? G.throttle : g;
            k = a.autoresize ? k : h;
            g = a.autoresize ? g : h;
            l.events.uiStale.bind(u(k, "uiStale"));
            l.events.domChanged.bind(u(k, "domChanged"));
            l.events.paint.bind(u(k, "paint"));
            f.events.keyup.bind(u(g, "keyup"));
            f.events.mouseup.bind(u(g, "mouseup"));
            setTimeout(function () {
                d.set(l);
                e = l.destroy
            }, 0)
        });
        return {
            element: c.element, onCanvas: function (a) {
                d.get(function (b) {
                    a(b.canvas())
                })
            }, initial: h(""), placeholder: c.element,
            tabindex: c.tabindex, destroy: function () {
                e();
                c.destroy()
            }, loaded: d.get, isInline: h(!1)
        }
    }

    function KV(a) {
        var b = g.none(), c = g.none(), d = function () {
            b.each(function (b) {
                a.setSelection(b.startContainer(), b.startOffset(), b.endContainer(), b.endOffset())
            });
            c.each(function (a) {
                a.restore()
            })
        }, e = function () {
            b = g.none();
            c = g.none()
        };
        return {
            restore: function () {
                d();
                e()
            }, save: function () {
                b = a.getSelection();
                c = a.doc().map(Za.capture)
            }, get: function () {
                return b
            }, clear: e, attempt: function (a) {
                b = a.or(b)
            }
        }
    }

    function fr() {
        var a = H.create({
            fail: p(["url",
                "image"]), success: p(["url", "image"]), start: p(["url"])
        }), b = function (a, b, c) {
            var d = a.dom();
            d.addEventListener(b, c, !1);
            return {
                unbind: function () {
                    d.removeEventListener(b, c, !1)
                }
            }
        }, c = function (c) {
            var d = m.get(c, "src"), f = b(c, "load", function () {
                f.unbind();
                k.unbind();
                (!0 === c.dom().complete ? a.trigger.success : a.trigger.fail)(d, c)
            }), k = b(c, "error", function () {
                f.unbind();
                k.unbind();
                a.trigger.fail(d, c)
            })
        };
        return {
            go: function (b) {
                a.trigger.start(b);
                var d = new Image;
                d.src = b;
                c(r.fromDom(d))
            }, monitor: c, events: a.registry
        }
    }

    function LV(a) {
        var b =
            na({}), c = na([]), d = {}, e = g.none();
        return {
            structure: b.get, all: c.get, main: function () {
                return c.get()[0]
            }, update: function (f) {
                z(c.get(), function (a) {
                    F.remove(a)
                });
                e = g.some(f);
                var k = cb(d);
                Ma(d, function (a) {
                    a.assign(e)
                });
                var l = eb(d, function (a, b) {
                    return a.situation(f)
                }), q = MV.derive(a, k, l), C = NV.derive(a, k, l);
                k = Eb(k, function (a, b) {
                    return ua(a, l[b].submenus())
                }, {});
                if (0 === q.length) c.set([]); else {
                    var w = zb.mainmenu(a, B.resolve("main-context-menu"), []);
                    P.append(w, q);
                    S.menu(w, x.translate("aria.context.menu.generic"));
                    q = [w].concat(C);
                    z(q, function (a) {
                        n.add(a, B.resolve("layer-menus"))
                    });
                    c.set(q);
                    b.set(k)
                }
            }, handle: function (a) {
                var b = gr.type(a);
                b = d[b];
                void 0 !== b && b.handle(a)
            }, register: function (a, b) {
                d[a] = b
            }
        }
    }

    function OV(a, b, c, d, e, f) {
        var k = [], l = {
            register: function (a, b) {
                k = k.concat([{name: a, feature: b}])
            }, destroy: t
        };
        b.events.ready.bind(function (q) {
            l = PV(a, b, c, d, e, f);
            z(k, function (a) {
                l.register(a.name, a.feature)
            })
        });
        return {
            register: function (a, b) {
                l.register(a, b)
            }, destroy: function () {
                l.destroy()
            }
        }
    }

    function QV(a, b, c, d) {
        var e = function (c) {
            b.get().fold(t,
                function (b) {
                    c.stopper();
                    d.transaction(function () {
                        z(b, RV)
                    });
                    a.domChanged();
                    a.toEditing();
                    qa(b, function (a) {
                        return Fa.is(a, te.lastSelectedSelector())
                    }).bind(kc.first).each(function (b) {
                        a.setSelection(b, 0, b, 0)
                    })
                }, t)
        }, f = c.editor();
        f.events.del.bind(e);
        f.events.backspace.bind(e);
        f.on();
        return {
            destroy: function () {
                f.off()
            }
        }
    }

    function SV() {
        var a = !0;
        return {
            isHandled: function () {
                return a
            }, handle: function () {
                a = !1
            }
        }
    }

    function TV(a, b) {
        var c = H.create({preLinebreak: p(["handler"]), postLinebreak: p([])});
        UV.listen(a);
        var d =
            function (d) {
                b.save();
                a.getSelection().each(function (b) {
                    var e = SV();
                    c.trigger.preLinebreak(e);
                    a.getSelection().each(function (b) {
                        e.isHandled() && (Az.preLinebreak(a), (d ? Bz.soft : Bz.hard)(b, a.isRoot).each(function (b) {
                            a.setRelativeSelection(b.start(), b.finish());
                            a.domChanged();
                            a.cursorIntoView()
                        }));
                        c.trigger.postLinebreak()
                    })
                })
            }, e = se.isTextArea;
        a.events.keydown.bind(function (a) {
            fe.isEnter(a) && !e(a.original().target()) && (a.original().raw().preventDefault(), d(a.original().raw().shiftKey))
        });
        return {
            linebreak: d,
            destroy: t, events: c.registry
        }
    }

    function hr(a, b) {
        return {
            find: function (b) {
                return Y.descendants(b, a)
            }, cleaner: b
        }
    }

    function VV() {
        var a = [];
        return {
            add: function (b) {
                a.push(b)
            }, get: function () {
                return a.slice(0)
            }
        }
    }

    function WV() {
        var a = {}, b = function (b) {
            return g.from(a[b])
        };
        return {
            get: b, getOrInit: function (b) {
                var c = a[b];
                void 0 === c && (a[b] = VV(), c = a[b]);
                return c
            }, filterDom: function (a, d) {
                b(a).each(function (a) {
                    qm.filterDom(d, a.get())
                })
            }, filterHtml: function (a, d) {
                return b(a).fold(function () {
                    return d
                }, function (a) {
                    return qm.filterHtml(d,
                        a.get())
                })
            }
        }
    }

    function XV(a, b) {
        return {
            find: function (b) {
                return ed.descendants(b, a)
            }, cleaner: b
        }
    }

    function YV(a) {
        var b = WV(), c = h("output"), d = h("input"), e = h("history"), f = h("internal"), k = h("paste"), l = [],
            q = function (a, c, d) {
                a = b.getOrInit(a);
                c = hr(c, d);
                a.add(c)
            }, C = function (a, c, d) {
                a = b.getOrInit(a);
                c = XV(c, d);
                a.add(c)
            };
        a = fy(a, q, C);
        return {
            add: function (a, b, c) {
                q(a, "." + b, c)
            },
            addSelector: q,
            addPredicate: C,
            filterHtml: b.filterHtml,
            filterDom: b.filterDom,
            internal: f,
            output: c,
            input: d,
            paste: k,
            history: e,
            customFilters: h(a),
            state: a.state,
            destroy: t,
            addExcludedContext: function (a) {
                l = l.concat(a)
            },
            includeContext: function (a) {
                return !Xa(l, u(Fa.is, a))
            }
        }
    }

    function ZV(a, b, c) {
        var d = !1, e = H.create({
            maximize: p(["layout"]),
            restore: p(["layout"]),
            analytics: p(["message"]),
            select: p([]),
            deselect: p([])
        }), f = function () {
            e.trigger.maximize(c.alternate)
        }, k = function () {
            e.trigger.restore(c.alternate)
        }, l = function (a) {
            d ? a.select() : a.deselect()
        }, q = function () {
            e.trigger.analytics("fullscreen_" + (d ? "off" : "on"));
            a.focus();
            (d ? k : f)()
        }, C = function (a, b) {
            a = x.key(d ? "action.toggle.fullscreen" :
                "action.fullscreen");
            return qb.get(a, b)
        };
        b.events.fullscreen.bind(q);
        b = wb.ui({
            "fullscreen.general": function () {
                return {
                    toggle: !0,
                    value: "fullscreen",
                    textkey: x.key("action.fullscreen"),
                    tooltip: C,
                    action: q,
                    updateGeneral: l,
                    icon: !0,
                    shortcut: !0,
                    selected: d
                }
            }
        }, ca);
        var g = wb.actions({maximize: f, restore: k});
        return {
            ui: b, actions: g, select: function () {
                d = !0
            }, deselect: function () {
                d = !1
            }, destroy: t, events: e.registry
        }
    }

    function $V() {
        var a = {inputLinks: "insertLink"}, b = H.create({internal: p(["command", "data"])}), c = function (c, e) {
            g.from(a[c]).fold(function () {
                throw Error("invalid internal event: " +
                    c);
            }, function (a) {
                z(e, function (c) {
                    b.trigger.internal(a, c)
                })
            })
        };
        return {
            input: function (a) {
                a = Ld.many(a);
                c("inputLinks", a)
            }, destroy: t, events: b.registry
        }
    }

    function aW(a, b, c) {
        var d = pj(),
            e = [K.bind(b, "keydown", d.keydown), K.bind(b, "keypress", d.keypress), K.bind(c, "keydown", d.keydown), K.bind(c, "keypress", d.keypress)],
            f = function (a) {
                d.keydown(a.original())
            }, k = function (a) {
                d.keypress(a.original())
            };
        a.events.keydown.bind(f);
        a.events.keypress.bind(k);
        return {
            off: d.off,
            on: d.on,
            swallowShortcuts: d.swallowShortcuts,
            yieldShortcuts: d.yieldShortcuts,
            swallowChars: d.swallowChars,
            yieldChars: d.yieldChars,
            swallowKeys: d.swallowKeys,
            yieldKeys: d.yieldKeys,
            destroy: function () {
                z(e, function (a) {
                    a.unbind()
                });
                a.events.keydown.unbind(f);
                a.events.keypress.unbind(k)
            },
            events: d.events
        }
    }

    function bW(a) {
        var b = pj(), c = function (a) {
            b.keydown(a.original())
        }, d = function (a) {
            b.keypress(a.original())
        };
        a.events.keydown.bind(c);
        a.events.keypress.bind(d);
        return {
            off: b.off,
            on: b.on,
            swallowShortcuts: b.swallowShortcuts,
            yieldShortcuts: b.yieldShortcuts,
            swallowChars: b.swallowChars,
            yieldChars: b.yieldChars,
            swallowKeys: b.swallowKeys,
            yieldKeys: b.yieldKeys,
            events: b.events,
            destroy: function () {
                a.events.keydown.unbind(c);
                a.events.keypress.unbind(d)
            }
        }
    }

    function cW(a) {
        var b = pj(), c = K.bind(a, "keydown", b.keydown), d = K.bind(a, "keypress", b.keypress);
        return {
            off: b.off,
            on: b.on,
            swallowShortcuts: b.swallowShortcuts,
            yieldShortcuts: b.yieldShortcuts,
            swallowChars: b.swallowChars,
            yieldChars: b.yieldChars,
            swallowKeys: b.swallowKeys,
            yieldKeys: b.yieldKeys,
            destroy: function () {
                c.unbind();
                d.unbind()
            },
            events: b.events
        }
    }

    function dW(a, b) {
        return {
            all: function () {
                return aW(a,
                    b.element(), b.uiContainerParent())
            }, container: function (a) {
                return cW(a)
            }, editor: function () {
                return bW(a)
            }, destroy: t
        }
    }

    function Cz(a) {
        return {backup: ca, restore: h(g.none()), element: h(a)}
    }

    function eW(a, b) {
        var c = B.resolve("ops-eph-cursor");
        a.add(a.internal(), c, Na.remove);
        a.add(a.output(), c, Na.remove);
        a.addExcludedContext(["." + c]);
        var d = function (a) {
            var d = function (d) {
                d = Dz.diagnose(b.isRoot, d)(c, a);
                d.cursor().each(function (a) {
                    ja.inBody(a.startContainer()) && ja.inBody(a.endContainer()) && b.getSelection().each(function (c) {
                        b.setSelection(a.startContainer(),
                            a.startOffset(), a.endContainer(), a.endOffset())
                    })
                });
                return d.result()
            };
            return function () {
                return b.getSelection().fold(a, d)
            }
        };
        return {
            destroy: t, run: function (a) {
                return d(a)()
            }
        }
    }

    function fW(a, b) {
        var c = eW(a, b), d = function (a, c) {
            a = a();
            var d = Ez.handle(c);
            b.getSelection().forall(function (a) {
                return !N.eq(a.startContainer(), d.startContainer()) || !N.eq(a.endContainer(), d.endContainer()) || a.startOffset() !== d.startOffset() || a.endOffset() !== d.endOffset()
            }) && b.setSelection(d.startContainer(), d.startOffset(), d.endContainer(),
                d.endOffset());
            return a
        }, e = function (a) {
            return D.isText(a) || "br" === D.name(a)
        };
        return {
            destroy: function () {
            }, run: c.run, preserve: u(Og.preserve, b), lightweightWith: function (a, b) {
                return e(b.startContainer()) && e(b.endContainer()) || vc.detect(g.some(b)).isSome() ? d(a, b) : c.run(a)
            }, adapt: function (a) {
                b.getSelection().each(function (b) {
                    c.run(function () {
                        a(b.startContainer(), b.endContainer())
                    })
                })
            }, pure: function (a) {
                b.getSelection().each(function (b) {
                    a(b.startContainer(), b.endContainer())
                })
            }, atomic: function (a) {
                return c.run(a)
            }
        }
    }

    function Fz() {
        var a = H.create({back: p([]), abort: p([])});
        return {
            ui: wb.ui({
                "back.general": {
                    toggle: !1,
                    value: "mobile-back",
                    textkey: x.key("toolbar.backbutton"),
                    action: function () {
                        a.trigger.back()
                    },
                    updateGeneral: t,
                    icon: !0,
                    label: !0
                }
            }), events: a.registry, destroy: t
        }
    }

    function kf(a, b) {
        return I.error({small: h(a), big: h(b)})
    }

    function gW(a, b, c, d, e) {
        var f = function (a, b) {
            return a() ? b : {feature: g.none()}
        };
        c = f(function () {
            return !a && xc.isLargeDesktop()
        }, {
            feature: c.ui(),
            command: "fullscreen",
            type: "general",
            unsupported: "Fullscreen is not supported in inline mode"
        });
        e = xc.choice([zj(xc.isLargeDesktop, {
            feature: d.fileupload().ui(),
            command: "fileupload",
            type: "general"
        }), zj(xc.isLargeTouch, {
            feature: d.fileupload().ui(),
            command: "fileupload",
            type: "menu"
        })], ir.make({feature: d.fileupload().ui(), command: "fileupload"}, e.allowLocalImages ? ["camera"] : []));
        var k = f(xc.isLargeDesktop, {feature: d.accessibility().ui(), command: "a11ycheck", type: "general"});
        f = f(xc.isLarge, {feature: d.specialchar().ui(), command: "specialchar", type: "general"});
        var l = xc.choice([zj(xc.isLarge, {
                feature: d.blocktag().ui(),
                command: "bullist", type: "split-widget"
            })], {feature: d.blocktag().ui(), command: "bullist", type: "general"}), q = xc.choice([zj(xc.isLarge, {
                feature: d.blocktag().ui(),
                command: "numlist",
                type: "split-widget"
            })], {feature: d.blocktag().ui(), command: "numlist", type: "general"}),
            C = {feature: d.formatting().ui(), command: "superscript", type: "general"},
            w = {feature: d.formatting().ui(), command: "subscript", type: "general"},
            h = {feature: d.formatting().ui(), command: "strikethrough", type: "general"}, G = {
                feature: d.font().ui(), command: "fontface",
                type: "dropdown"
            }, V = xc.choice([zj(xc.isTouch, {
                feature: d.font().ui(),
                command: "fontsize",
                type: "general"
            })], {feature: d.font().ui(), command: "fontsize", type: "inline-widget"}),
            X = {feature: d.font().ui(), command: "fontcolor", type: "widget"}, m = {
                feature: d.spelling().hasAutocorrect() ? d.macros().ui() : g.none(),
                command: "autocorrect",
                type: "general"
            }, n = {
                feature: d.spelling().ui(),
                command: "spelling",
                type: d.spelling().hasDropdown() ? "dropdown" : "general"
            }, r = {feature: d.macros().ui(), command: "capitalisation", type: "general"},
            p = {feature: d.help().ui(), command: "help", type: "general"},
            t = {feature: d.wordcount().ui(), command: "wordcount", type: "general"};
        return {
            link: {feature: d.link().ui(), command: "link", type: "general"},
            wordcount: t,
            media: {feature: d.media().ui(), command: "media", type: "general"},
            hr: {feature: d.horizontalrule().ui(), command: "horizontalrule", type: "general"},
            specialchar: f,
            fileupload: e,
            table: {feature: d.table().ui(), command: "table", type: "widget"},
            undo: {feature: b.ui(), command: "undo", type: "general"},
            redo: {
                feature: b.ui(), command: "redo",
                type: "general"
            },
            styles: {feature: d.blocktag().ui(), command: "blocktag", type: "dropdown"},
            language: {feature: d.parlance().ui(), command: "parlance", type: "dropdown"},
            ltrdir: {feature: d.directionality().ui(), command: "ltrdir", type: "general"},
            rtldir: {feature: d.directionality().ui(), command: "rtldir", type: "general"},
            bold: {feature: d.formatting().ui(), command: "bold", type: "general"},
            italic: {feature: d.formatting().ui(), command: "italic", type: "general"},
            underline: {feature: d.formatting().ui(), command: "underline", type: "general"},
            bookmark: {feature: d.bookmark().ui(), command: "bookmark", type: "general"},
            strikethrough: h,
            superscript: C,
            subscript: w,
            ul: l,
            ol: q,
            removeformat: {feature: d.formatting().ui(), command: "removeformat", type: "general"},
            alignment: {feature: d.alignindent().ui(), command: "alignment", type: "dropdown"},
            outdent: {feature: d.alignindent().ui(), command: "outdent", type: "general"},
            indent: {feature: d.alignindent().ui(), command: "indent", type: "general"},
            blockquote: {feature: d.alignindent().ui(), command: "blockquote", type: "general"},
            "font-menu": {
                name: "font",
                textkey: x.key("font.menu-button"),
                menuTextkey: x.key("font.menu"),
                type: "submenu",
                contentFocus: !0,
                commands: [{category: "Font-menu", items: [G, V, X, C, w, h]}]
            },
            "font-face": G,
            "font-size": V,
            "font-color": X,
            fullscreen: c,
            find: {feature: d.findreplace().ui(), command: "find", type: "general"},
            accessibility: k,
            usersettings: {
                name: "usersettings",
                textkey: x.key("cog.menu-button"),
                menuTextkey: x.key("cog.menu"),
                type: "submenu",
                flatten: ir.never(),
                contentFocus: !0,
                commands: [{category: "a", items: [t]}, {
                    category: "b",
                    items: [n, m, r]
                }, {caetgory: "", items: [p]}]
            }
        }
    }

    function Gz() {
        var a = {
            id: "insert",
            label: x.key("insert.menu-button"),
            menuLabel: x.key("insert.menu"),
            items: [["link", "bookmark", "fileupload", "media", "table"], ["specialchar", "hr"]]
        };
        return {
            undo: {label: x.key("category.undo"), items: ["undo", "redo"]},
            insert: {label: x.key("category.insert"), items: [a]},
            style: {label: x.key("category.style"), items: ["styles"]},
            language: {label: x.key("category.language"), items: ["language", "ltrdir", "rtldir"]},
            emphasis: {
                label: x.key("category.emphasis"),
                items: ["bold", "italic", "underline"]
            },
            align: {label: x.key("category.align"), items: ["alignment"]},
            listindent: {label: x.key("category.listindent"), items: ["ul", "ol", "outdent", "indent", "blockquote"]},
            format: {label: x.key("category.format"), items: ["font-menu", "removeformat"]},
            tools: {label: x.key("category.tools"), items: ["find", "accessibility", "fullscreen", "usersettings"]},
            "table-tools": {label: x.key("category.table"), items: ["table-tools"]},
            "image-tools": {label: x.key("category.image"), items: ["image-tools", "crop-tools"]}
        }
    }

    function rm(a) {
        return {
            closeMenus: function (b) {
                b = b ? b.target() : a;
                Hz.target(b, "mousedown")
            }
        }
    }

    function hW(a) {
        return function (b, c) {
            var d = K.bind(a, "touchmove", b.move), e = K.bind(a, "touchend", b.drop);
            return {
                element: h(a), start: t, stop: t, destroy: function () {
                    d.unbind();
                    e.unbind()
                }
            }
        }
    }

    function Iz(a, b, c, d) {
        var e = na(g.none());
        c = sm.mode({
            compare: jr.compare, extract: jr.extract, sink: c, mutate: function (a, c) {
                e.get().each(function (a) {
                    jr.resize(b, a, c)
                })
            }
        });
        var f = tj.transform({}, {mode: c}), k = K.bind(a, "touchstart", function (a) {
            "img" ===
            D.name(a.target()) && 2 === a.raw().touches.length && (e.set(g.some(a.target())), f.on(), f.go(b))
        });
        f.events.stop.bind(function () {
            e.get().each(function (a) {
                v.remove(a, "transform")
            });
            d()
        });
        return {
            destroy: function () {
                k.unbind();
                f.destroy()
            }
        }
    }

    function iW(a, b, c) {
        var d = c.toolbar.element(), e = Jz.tag(), f = [], k = r.fromDom(document), l = rm(d), q = null, C = hd.api(),
            w = g.none(), h = function () {
                C.run(function (a) {
                    a.toEditing()
                })
            }, G = function () {
                l.closeMenus()
            }, V = function () {
                a.getSelection().each(function (a) {
                    a = a.collapsed() ? "0px" : "23px";
                    v.set(d, "margin-top", a)
                })
            }, X = function (a) {
                v.set(d, "margin-top", "0px")
            }, m = function () {
                var c = [K.bind(d, "touchmove", l.closeMenus)];
                f = a.doc().map(function (a) {
                    return b || !0 === jW ? [] : [K.bind(a, "selectionchange", V), K.bind(k, "focusin", X)]
                }).getOr([]).concat(c)
            }, p = function () {
                z(f, function (a) {
                    a.unbind()
                })
            };
        return {
            enter: function () {
                a.body().each(function (b) {
                    a.doc().each(function (c) {
                        a.win().each(function (d) {
                            Z.focus(b);
                            q = Jh.onChange();
                            var e = hW(c);
                            e = Iz(c, b, e, t);
                            w = g.some(e);
                            d = kW.setup(window, d);
                            C.set(d);
                            a.events.toEditing.bind(h);
                            q.events.change.bind(G)
                        })
                    })
                });
                n.add(d, "ephox-polish-mobile-show");
                c.toolbar.refresh();
                e.maximize();
                m()
            }, exit: function () {
                C.clear();
                a.events.toEditing.unbind(h);
                q.events.change.unbind(G);
                null !== q && q.destroy();
                e.restore();
                p()
            }, destroy: function () {
                w.each(function (a) {
                    a.destroy()
                });
                p()
            }
        }
    }

    function Kz() {
        var a = r.fromTag("div");
        n.add(a, B.resolve("disabled-mask"));
        var b = !1, c = T.div();
        n.add(c, B.resolve("content-container"));
        var d = T.div();
        S.hidden(d, !0);
        n.add(d, B.resolve("tap-icon"));
        y.append(c, d);
        var e = T.div();
        n.add(e, B.resolve("disclosure"));
        y.append(e, r.fromText(x.translate("taptoedit")));
        y.append(c, e);
        y.append(a, c);
        S.textButton(a, c);
        var f = H.create({fullscreen: p([])}), k = function (b) {
            var c = a.dom().getClientRects()[0];
            return ob(b, function (a) {
                return a.pageY >= c.top && a.pageY <= c.top + c.height && a.pageX >= c.left && a.pageX <= c.left + c.width
            })
        }, l = [K.bind(a, "touchmove", function (a) {
            b = !0
        }), K.bind(a, "touchend", function (a) {
            var c = a.raw().changedTouches;
            k(c) && !b && (a.kill(), f.trigger.fullscreen())
        }), K.bind(a, "touchstart", function (a) {
            b =
                !1
        }), K.bind(a, "click", function (a) {
            a.kill();
            f.trigger.fullscreen()
        })];
        return {
            element: h(a), events: f.registry, destroy: function () {
                z(l, function (a) {
                    a.unbind()
                });
                F.remove(d);
                F.remove(e);
                F.remove(c);
                F.remove(a)
            }, show: function () {
                v.remove(a, "display")
            }, hide: function () {
                v.set(a, "display", "none")
            }
        }
    }

    function Lz(a, b, c, d, e, f) {
        var k = f.element(), l = iW(a, e.fillscreen, f), q = function () {
            l.enter();
            d.actions().maximize()
        }, C = function () {
            var a = Kz();
            y.append(f.element(), a.element());
            a.events.fullscreen.bind(function (a) {
                d.actions().maximize()
            })
        };
        return {
            init: function () {
                f.socket(a);
                a.events.scrollToCursor.bind(function () {
                    Og.cursorIntoView(a)
                })
            }, loaded: function () {
                var a = !0 === e.fillscreen;
                (n.has(k, B.resolve("fullscreen-maximized")) || a ? q : C)()
            }, restoreEditor: function () {
                d.actions().restore();
                l.exit()
            }, destroy: function () {
                a.body().each(Z.blur)
            }
        }
    }

    function lW(a, b, c, d, e) {
        var f = d.toolbar.items, k = function (k) {
            var l = Lz(a, b, c, e, d, k), C = Fz();
            k = Aj.config({items: [["back"]].concat(f), contextual: []}, {
                back: {
                    feature: C.ui(),
                    command: "back",
                    type: "general"
                }
            }, {allowLocalImages: d.allowLocalImages});
            C.events.back.bind(function () {
                l.restoreEditor()
            });
            return {
                init: l.init, loaded: l.loaded, config: k, destroy: function () {
                    l.destroy();
                    C.destroy()
                }
            }
        };
        return {tabbed: k, full: k, destroy: t}
    }

    function mW(a, b, c, d, e) {
        var f = d.toolbar.items, k = function (k) {
            var l = Lz(a, b, c, e, d, k);
            k = Aj.config({items: f, contextual: []}, {}, {allowLocalImages: d.allowLocalImages});
            return {
                init: l.init, loaded: l.loaded, config: k, destroy: function () {
                    l.destroy()
                }
            }
        };
        return {tabbed: k, full: k, destroy: t}
    }

    function nW(a, b, c, d) {
        b = function (b) {
            return {
                init: function () {
                    b.socket(a);
                    a.events.scrollToCursor.bind(function () {
                        Og.cursorIntoView(a)
                    });
                    a.events.toEditing.bind(a.focus)
                }, loaded: t, config: Aj.config(d.toolbar, {}, {allowLocalImages: d.allowLocalImages}), destroy: t
            }
        };
        return {tabbed: b, full: b, destroy: t}
    }

    function oW(a, b) {
        var c = Jz.tag(), d = g.none(), e = Kz();
        return {
            maximize: function () {
                d = g.some(document.body.scrollTop);
                v.set(e.element(), "display", "none");
                n.add(a, B.resolve("fullscreen-maximized"));
                Mz.clobberStyles(a, b);
                c.maximize()
            }, restore: function () {
                Mz.restoreStyles();
                n.remove(a, B.resolve("fullscreen-maximized"));
                c.restore();
                v.remove(e.element(), "display");
                d = d.bind(function (a) {
                    document.body.scrollTop = a;
                    return g.none()
                })
            }, destroy: function () {
                e.destroy()
            }, mask: h(e)
        }
    }

    function pW(a, b) {
        var c = a.document, d = r.fromTag("div");
        n.add(d, ue.resolve("unfocused-selections"));
        y.append(r.fromDom(c.documentElement), d);
        var e = K.bind(d, "touchstart", function (c) {
            c.prevent();
            kr.resume(a, b);
            k()
        }), f = function (a) {
            var b = r.fromTag("span");
            ma.add(b, [ue.resolve("layer-editor"), ue.resolve("unfocused-selection")]);
            v.setAll(b, {
                left: a.left + "px",
                top: a.top + "px", width: a.width + "px", height: a.height + "px"
            });
            return b
        }, k = function () {
            F.empty(d)
        };
        return {
            update: function () {
                k();
                var b = lr.getRectangles(a);
                b = E(b, f);
                P.append(d, b)
            }, isActive: function () {
                return 0 < A.children(d).length
            }, destroy: function () {
                e.unbind();
                F.remove(d)
            }, clear: k
        }
    }

    function qW(a) {
        var b = na(lf.pure({}));
        return {
            start: function (c) {
                var d = lf.nu(function (b) {
                    return a(c).get(b)
                });
                d.get(ca);
                b.set(d)
            }, idle: function (a) {
                b.get().get(function () {
                    a()
                })
            }
        }
    }

    function rW(a) {
        return function (b, c) {
            var d = K.bind(a, "touchmove",
                b.move), e = K.bind(a, "touchend", b.drop), f = K.bind(a, "gesturestart", function (a) {
                "img" === D.name(a.target()) && a.prevent()
            });
            return {
                element: h(a), start: t, stop: t, destroy: function () {
                    d.unbind();
                    e.unbind();
                    f.unbind()
                }
            }
        }
    }

    function sW(a, b, c, d, e, f, k, l) {
        var q = [], C = f.toolbar.element(), w = f.banners(), h = f.viewport(), G = g.none(), V = rm(C), X = null,
            m = hd.api(), p = g.none(), t = Vc.event(h),
            u = Aa("cWin ceBody socket toolstrip toolbar contentElement cursor keyboardType isScrolling".split(" "), []),
            x = function () {
                m.run(function (a) {
                    a.highlightSelection()
                })
            },
            y = function () {
                m.run(function (a) {
                    a.refreshSelection()
                })
            }, A = function (a) {
                var b = bb.absolute(a).top() - h.dom().scrollTop;
                m.run(function (c) {
                    c.scrollIntoView(b, b + sa.get(a))
                })
            }, D = function () {
                Nz.insertAtCursor(d, a, function (a) {
                    var b = a.absolute().top() - h.dom().scrollTop;
                    m.run(function (c) {
                        c.scrollIntoView(b, b + a.height())
                    })
                })
            }, E = function (a) {
                D();
                m.run(function (a) {
                    a.syncHeight()
                })
            }, F = function (a) {
                var b = sa.get(C);
                m.run(function (a) {
                    a.setViewportOffset(b)
                });
                y();
                E()
            }, H = function (a) {
                A(a.element())
            }, I = jf(E, 300), M = function () {
                V.closeMenus()
            },
            O = function () {
                U();
                var a = setInterval(function () {
                    0 === window.pageYOffset && (clearInterval(a), E())
                }, 100)
            }, P = function () {
                m.run(function (a) {
                    a.clearSelection()
                })
            }, Q = function () {
                P();
                I.throttle()
            }, S = function () {
                m.run(function (a) {
                    a.toEditing()
                })
            }, R = function () {
                m.run(function (a) {
                    a.toReading()
                })
            }, T = function (a) {
                m.run(function (b) {
                    b.onToolbarTouch(a)
                })
            }, U = function () {
                (Jh.get().isPortrait() ? n.remove : n.add)(f.element(), B.resolve("mobile-landscape"))
            }, W = function (a) {
                var b = v.get(a, "background-color");
                void 0 !== b && "" !== b && v.set(a,
                    "-webkit-tap-highlight-color", b)
            }, Y = function (b) {
                var c = a.win().getOrDie(), d = function (a) {
                    Z.focus(b);
                    a = a.raw().changedTouches[0];
                    Wa.getAtPoint(c, a.pageX, a.pageY).each(function (a) {
                        Wa.setExact(c, a.start(), a.soffset(), a.finish(), a.foffset())
                    })
                }, e = a.doc().map(function (a) {
                    var c = rW(a);
                    c = Iz(a, b, c, E);
                    p = g.some(c);
                    var e = r.fromDom(a.dom().documentElement);
                    return [K.bind(a, "touchend", function (a) {
                        (N.eq(e, a.target()) || N.eq(b, a.target())) && d(a)
                    })]
                }).getOr([]), f = [K.capture(C, "touchstart", function (a) {
                    x();
                    T(a)
                }), K.bind(b,
                    "touchstart", P), tm.handle(b, aa), K.bind(C, "touchmove", V.closeMenus)];
                q = e.concat(f)
            }, aa = function (a) {
                a.kill()
            };
        return {
            exit: function () {
                a.body().each(function (b) {
                    v.remove(w, "display");
                    v.set(f.viewport(), "overflow", "hidden");
                    G = G.bind(function (a) {
                        a.unbind();
                        return g.none()
                    });
                    n.remove(C, B.resolve("mobile-show"));
                    m.clear();
                    Z.blur(b);
                    v.remove(b, "padding-top");
                    z(q, function (a) {
                        a.unbind()
                    });
                    k.restore();
                    a.events.keyup.unbind(Q);
                    a.events.domChanged.unbind(I.throttle);
                    a.events.scrollToCursor.unbind(I.throttle);
                    a.events.scrollToElement.unbind(H);
                    a.events.domChanged.unbind(y);
                    a.events.nodeChanged.unbind(y);
                    a.events.toEditing.unbind(S);
                    a.events.toReading.unbind(R);
                    X.events.change.unbind(M);
                    X.events.ready.unbind(O);
                    f.toolbar.events.transitionend.unbind(F);
                    null !== X && X.destroy()
                })
            }, enter: function (b) {
                a.body().each(function (b) {
                    a.win().each(function (d) {
                        X = Jh.onChange();
                        k.maximize();
                        Y(b);
                        Z.focus(b);
                        G = g.some(Oz.exclusive(c, "." + Vc.scrollable()));
                        v.getRaw(C, "overflow-x").is("auto") && L.descendant(C, ".ephox-chameleon-toolbar").each(function (a) {
                            Oz.markAsHorizontal(a);
                            Vc.register(a)
                        });
                        W(b);
                        U();
                        document.body.scrollTop = 0;
                        n.add(C, B.resolve("mobile-show"));
                        f.toolbar.refresh();
                        v.set(w, "display", "block");
                        L.descendant(C, ".ephox-chameleon-toolbar").each(function (c) {
                            m.set(tW.setup(u({
                                cWin: d,
                                ceBody: b,
                                socket: h,
                                toolstrip: C,
                                toolbar: c,
                                contentElement: a.element(),
                                cursor: a.cursor(),
                                keyboardType: uW.stubborn,
                                isScrolling: t.isScrolling
                            })))
                        });
                        a.events.keyup.bind(Q);
                        a.events.domChanged.bind(I.throttle);
                        a.events.scrollToCursor.bind(I.throttle);
                        a.events.scrollToElement.bind(H);
                        a.events.domChanged.bind(y);
                        a.events.nodeChanged.bind(y);
                        a.events.toEditing.bind(S);
                        a.events.toReading.bind(R);
                        X.events.change.bind(M);
                        X.events.ready.bind(O);
                        f.toolbar.events.transitionend.bind(F);
                        E()
                    })
                })
            }, destroy: function () {
                p.each(function (a) {
                    a.destroy()
                });
                G.each(function (a) {
                    a.unbind()
                });
                t.destroy()
            }
        }
    }

    function Pz(a, b, c, d, e) {
        var f = oW(e.element(), a), k = r.fromDom(document), l = a.element(), q = h(!0 === d.fillscreen),
            C = sW(a, b, k, c, l, e, f, q), g = function (a) {
                var b = A.children(a), c;
                if (!(c = 0 === b.length)) {
                    if (b = 1 === b.length) b = Ea.get(a), b = 10 === b.charCodeAt(0) &&
                        10 === b.charCodeAt(1);
                    c = b
                }
                c && (b = r.fromHtml("<p><br></p>"), y.append(a, b));
                C.enter()
            }, J = function (a) {
                y.append(e.element(), f.mask().element());
                f.mask().events.fullscreen.bind(function (a) {
                    C.enter()
                })
            }, G = function (a) {
                (q() ? g : J)(a)
            };
        return {
            init: function () {
                e.socket(a)
            }, loaded: function () {
                a.body().each(G)
            }, restoreEditor: function () {
                a.body().each(Z.blur);
                a.element().dom().focus();
                a.element().dom().blur();
                C.exit();
                Z.focus(f.mask().element())
            }, destroy: function () {
                a.body().each(Z.blur);
                C.destroy();
                f.destroy()
            }
        }
    }

    function vW(a,
                b, c, d) {
        var e = d.toolbar.items;
        return {
            tabbed: function (f) {
                var k = Pz(a, b, c, d, f), l = Fz();
                f = Aj.config({items: [["back"]].concat(e), contextual: []}, {
                    back: {
                        feature: l.ui(),
                        command: "back",
                        type: "general"
                    }
                }, {allowLocalImages: d.allowLocalImages});
                l.events.back.bind(function () {
                    k.restoreEditor()
                });
                return {
                    init: k.init, loaded: k.loaded, config: f, destroy: function () {
                        k.destroy();
                        l.destroy()
                    }
                }
            }, full: yb("mobile does not support fullscreen layout"), destroy: t
        }
    }

    function wW(a, b, c, d) {
        var e = d.toolbar.items;
        return {
            tabbed: function (f) {
                var k =
                    Pz(a, b, c, d, f);
                f = Aj.config({items: e, contextual: []}, {}, {allowLocalImages: d.allowLocalImages});
                return {
                    init: k.init, loaded: k.loaded, config: f, destroy: function () {
                        k.restoreEditor();
                        k.destroy()
                    }
                }
            }, full: yb("mobile does not support fullscreen layout"), destroy: t
        }
    }

    function xW(a, b, c, d, e) {
        return (Qz.deviceType.isiOS() ? !0 === e.fillscreen ? wW : vW : Qz.deviceType.isAndroid() ? !0 === e.fillscreen ? mW : lW : nW)(a, b, c, e, d)
    }

    function Bj(a, b) {
        b = um.readOr(a, b);
        var c = na(b), d = function (a) {
            c.set(a)
        };
        return {
            setAndCache: function (b) {
                d(b);
                um.write(a,
                    b)
            }, set: d, get: function () {
                return c.get()
            }
        }
    }

    function yW(a) {
        var b = Bj("native.spelling", a.nativeSpelling), c = Bj("spelling", a.spelling),
            d = Bj("autocorrect", a.autocorrect), e = Bj("linkpreviews", a.linkpreviews),
            f = Bj("capitalisation", a.capitalisation);
        return {
            spelling: h(c),
            nativeSpelling: h(b),
            autocorrect: h(d),
            linkpreviews: h(e),
            capitalisation: h(f),
            state: function () {
                return {
                    nativeSpelling: b.get(),
                    spelling: c.get(),
                    autocorrect: d.get(),
                    linkpreviews: e.get(),
                    capitalisation: f.get()
                }
            },
            destroy: t
        }
    }

    function zW(a, b, c) {
        var d =
            b.all();
        d.on();
        var e = [];
        d.events.backspace.bind(function () {
            mr.get(a, e, Cj.left).each(F.remove)
        });
        b = function (b) {
            var d = b.stopper();
            mr.get(a, e, Cj.left).each(function (b) {
                d();
                Rz.upOrLeft(a, c, b)
            })
        };
        d.events.right.bind(function (b) {
            var d = b.stopper();
            mr.get(a, e, Cj.right).each(function (b) {
                d();
                Rz.right(a, c, b)
            })
        });
        d.events.left.bind(b);
        d.events.up.bind(b);
        return {
            registerSkip: function (a) {
                e.push(a)
            }, destroy: function () {
                d.destroy()
            }
        }
    }

    function AW(a, b) {
        (b.error ? g.some(b.error) : g.none()).map(function (a) {
            return nj(mf.get(a.name,
                [a]))
        }).each(a.displayBanner);
        return {destroy: t}
    }

    function Sz(a) {
        return {
            elementFromPoint: function (b, c) {
                return r.fromPoint(r.fromDom(a.document), b, c)
            }, getRect: function (a) {
                return a.dom().getBoundingClientRect()
            }, getRangedRect: function (b, c, d, e) {
                b = Lc.exact(b, c, d, e);
                return Wa.getFirstRect(a, b).map(function (a) {
                    return eb(a, xb)
                })
            }, getSelection: function () {
                return Wa.get(a).map(function (b) {
                    return Kh.convertToRange(a, b)
                })
            }, fromSitus: function (b) {
                b = Lc.relative(b.start(), b.finish());
                return Kh.convertToRange(a, b)
            },
            situsFromPoint: function (b, c) {
                return Wa.getAtPoint(a, b, c).map(function (a) {
                    return {start: h(la.on(a.start(), a.soffset())), finish: h(la.on(a.finish(), a.foffset()))}
                })
            }, clearSelection: function () {
                Wa.clear(a)
            }, setSelection: function (b) {
                Wa.setExact(a, b.start(), b.soffset(), b.finish(), b.foffset())
            }, setRelativeSelection: function (b, c) {
                Wa.setRelative(a, b, c)
            }, selectContents: function (b) {
                Wa.setToElement(a, b)
            }, getInnerHeight: function () {
                return a.innerHeight
            }, getScrollY: function () {
                return Za.get(r.fromDom(a.document)).top()
            },
            scrollBy: function (b, c) {
                Za.by(b, c, r.fromDom(a.document))
            }
        }
    }

    function BW(a, b, c, d) {
        var e = g.none(), f = function () {
            e = g.none()
        };
        return {
            mousedown: function (a) {
                d.clear(b);
                e = Tz(a.target(), c)
            }, mouseover: function (f) {
                e.each(function (e) {
                    d.clear(b);
                    Tz(f.target(), c).each(function (f) {
                        Sf.identify(e, f, c).each(function (c) {
                            var k = c.boxes().getOr([]);
                            if (1 < k.length || 1 === k.length && !N.eq(e, f)) d.selectRange(b, k, c.start(), c.finish()), a.selectContents(f)
                        })
                    })
                })
            }, mouseup: function () {
                e.each(f)
            }
        }
    }

    function CW(a) {
        var b = function (b) {
            return !a.isRoot(b) &&
                (Dj.isBlock(b) || "li" === D.name(b))
        }, c = function (a) {
            return D.isText(a) && 0 === Ya.get(a).trim().length
        }, d = function (b, c, d, e) {
            return Ja.closest(b, function (b) {
                return A.parent(b).exists(a.isRoot)
            }, a.isRoot).fold(function () {
                return W.point(b, c)
            }, function (a) {
                return d(a, b, c) ? e(a) : W.point(b, c)
            })
        }, e = function (a, b) {
            return "p" === D.name(a) && 1 === A.childNodesCount(a) && A.firstChild(a).filter(function (a) {
                return "br" === D.name(a)
            }).isSome() ? W.point(a, b) : kb.toLeaf(a, b)
        }, f = function (e, f) {
            var k = function (b) {
                return wc.before(b, a.isRoot).fold(function () {
                    return W.point(e,
                        f)
                }, function (a) {
                    return c(a) ? k(a) : W.point(a, wa.getEnd(a))
                })
            };
            return Ja.closest(e, function (a) {
                return b(a) && A.prevSibling(a).isSome()
            }, a.isRoot).fold(function () {
                return d(e, f, Qg.isAtLeftEdge, k)
            }, function (a) {
                return b(e) || Qg.isAtLeftEdge(a, e, f) ? k(a) : W.point(e, f)
            })
        }, k = function (e, f) {
            var k = function (b) {
                return wc.after(b, a.isRoot).fold(function () {
                    return W.point(e, f)
                }, function (a) {
                    return c(a) ? k(a) : W.point(a, 0)
                })
            };
            return Ja.closest(e, function (a) {
                return b(a) && A.nextSibling(a).isSome()
            }, a.isRoot).fold(function () {
                return d(e,
                    f, Qg.isAtRightEdge, k)
            }, function (a) {
                return b(e) || Qg.isAtRightEdge(a, e, f) ? k(a) : W.point(e, f)
            })
        }, l = function (a, b) {
            return N.eq(a.element(), b.element()) ? a.offset() <= b.offset() : id.after(a.element(), a.offset(), b.element(), b.offset())
        };
        return {
            getSelection: function (a) {
                return a.getSelection().bind(function (a) {
                    var b = a.startContainer();
                    var c = a.endContainer();
                    N.eq(b, c) ? (c = A.child(b, a.startOffset()), b = A.child(b, a.endOffset()), b = c.filter(pa.isList).isSome() || b.filter(pa.isList).isSome()) : b = !0;
                    if (b) {
                        if (id.after(a.startContainer(),
                            a.startOffset(), a.endContainer(), a.endOffset())) return b = e(a.startContainer(), a.startOffset()), a = e(a.endContainer(), a.endOffset()), b = wa.isStart(b.element(), b.offset()) ? f(b.element(), b.offset()) : W.point(b.element(), b.offset()), a = wa.isEnd(a.element(), a.offset()) ? k(a.element(), a.offset()) : W.point(a.element(), a.offset()), a = l(b, a) ? g.some(Sc(b.element(), b.offset(), a.element(), a.offset())) : g.some(Sc(a.element(), a.offset(), b.element(), b.offset())), a;
                        b = e(a.startContainer(), a.startOffset());
                        a = e(a.endContainer(),
                            a.endOffset());
                        b = wa.isEnd(b.element(), b.offset()) ? k(b.element(), b.offset()) : W.point(b.element(), b.offset());
                        a = wa.isStart(a.element(), a.offset()) ? f(a.element(), a.offset()) : W.point(a.element(), a.offset());
                        a = l(b, a) ? g.some(Sc(a.element(), a.offset(), b.element(), b.offset())) : g.some(Sc(b.element(), b.offset(), a.element(), a.offset()));
                        return a
                    }
                    return g.some(a)
                })
            }
        }
    }

    function DW(a, b, c) {
        EW.configure(b);
        var d = CW(c), e = H.create({beforeScan: p([]), afterScan: p([])}), f = Uz.byClass(te);
        b = function () {
            c.body().each(function (a) {
                c.getSelection().each(function (b) {
                    nf.sharedOne(sb.table,
                        [b.startContainer(), b.endContainer()]).fold(function () {
                        f.clear(a)
                    }, t)
                })
            })
        };
        (Vz.browser.isChrome() || Vz.browser.isSafari()) && c.events.contextmenu.bind(b);
        c.events.nodeChanged.bind(b);
        var k = na([]);
        c.runOrOnLoaded(function (b) {
            var d = A.defaultView(b).dom(), l = Wz.mouse(d, b, c.isRoot, f), q = Wz.keyboard(d, b, c.isRoot, f);
            k.set([vm.leftDown.bind(b, l.mousedown), vm.leftPressedOver.bind(b, l.mouseover), vm.leftUp.bind(b, l.mouseup), K.bind(b, "keyup", function (a) {
                a.raw().shiftKey && Nd.isNavigation(a.raw().which) && c.getSelection().each(function (b) {
                    q.keyup(a,
                        b.startContainer(), b.startOffset(), b.endContainer(), b.endOffset()).each(function (b) {
                        g(a, b)
                    })
                }, t)
            }), K.bind(b, "keydown", function (b) {
                c.getSelection().each(function (c) {
                    e.trigger.beforeScan();
                    var d = a.directionAt(c.endContainer()).isRtl() ? Nd.rtl : Nd.ltr;
                    q.keydown(b, c.startContainer(), c.startOffset(), c.endContainer(), c.endOffset(), d).each(function (a) {
                        g(b, a)
                    });
                    e.trigger.afterScan()
                })
            })]);
            var g = function (a, b) {
                b.kill() && a.kill();
                b.selection().each(function (a) {
                    c.setRelativeSelection(a.start(), a.finish())
                })
            }
        });
        var l = function (a) {
            return {
                win: a.win, doc: a.doc, execCommand: a.execCommand, getSelection: function () {
                    return d.getSelection(a)
                }, setSelection: a.setSelection, setRelativeSelection: a.setRelativeSelection, focus: a.focus
            }
        }, q = function (a, b) {
            return {
                doc: b.doc,
                win: b.win,
                execCommand: b.execCommand,
                focus: b.focus,
                setSelection: t,
                setRelativeSelection: t,
                getSelection: function () {
                    return g.some(C(a))
                }
            }
        }, C = function (a) {
            return {startContainer: h(a), startOffset: h(0), endContainer: h(a), endOffset: h(wa.getEnd(a))}
        };
        return {
            get: function () {
                return c.on(function (a) {
                    return c.body().fold(Zb.none,
                        function (b) {
                            return Xz.retrieve(b, te.selectedSelector()).fold(function () {
                                return a.getSelection().fold(Zb.none, function (b) {
                                    b = d.getSelection(a).getOr(b);
                                    return Zb.single(b, l(a))
                                })
                            }, function (b) {
                                var c = E(b, function (b) {
                                    return q(b, a)
                                });
                                return Zb.multiple(b, c)
                            })
                        })
                }).getOrThunk(Zb.none)
            }, surround: C, events: e.registry, destroy: function () {
                var a = k.get();
                z(a, function (a) {
                    a.unbind()
                })
            }
        }
    }

    function FW(a) {
        a = ua({scopes: [r.fromDom(document)], shortcuts: [], swallow: !1}, a);
        var b = pj(a), c = [], d = [];
        z(a.scopes, function (a) {
            c.push(K.bind(a,
                "keydown", b.keydown).unbind);
            d.push(K.bind(a, "keypress", b.keypress).unbind)
        });
        return {
            off: b.off,
            on: b.on,
            destroy: function () {
                z(c, xb);
                z(d, xb)
            },
            events: b.events,
            swallowShortcuts: b.swallowShortcuts,
            yieldShortcuts: b.yieldShortcuts,
            swallowChars: b.swallowChars,
            yieldChars: b.yieldChars,
            swallowKeys: b.swallowKeys,
            yieldKeys: b.yieldKeys
        }
    }

    function GW(a, b) {
        var c = H.create({
            undo: p([]),
            redo: p([]),
            context: p([]),
            toolbar: p([]),
            plaincode: p([]),
            bold: p([]),
            italic: p([]),
            underline: p([]),
            indent: p([]),
            outdent: p([]),
            link: p([]),
            blockquote: p([]),
            search: p([]),
            help: p([]),
            fullscreen: p([])
        }), d = HW(c), e = [d.undo, d.redo, d.context, d.toolbar];
        d = [d.plaincode, d.bold, d.italic, d.underline, d.indent, d.outdent, d.link, d.search, d.blockquote, d.help, d.fullscreen];
        e = (b = !0 === b.features) ? e.concat(d) : e;
        var f = ia(e, function (a) {
            return a.keys()
        }), k = E(e, function (a) {
            return IW(a.keys(), a.trigger())
        }), l = g.none();
        a.onCanvas(function (a) {
            a = FW({scopes: [a], shortcuts: f});
            l = g.some(a);
            a.swallowShortcuts(f);
            a.events.command.bind(function (a) {
                var b = a.command();
                yc(k,
                    function (a) {
                        return a(b)
                    }).each(xb)
            });
            a.on()
        });
        return {
            isHelpShortcutEnabled: h(b), events: c.registry, destroy: function () {
                l.each(function (a) {
                    a.destroy()
                })
            }
        }
    }

    function JW() {
        var a = [], b = function () {
            a = ka(a, function (a) {
                return sc.isVisible(a.popup().panel())
            })
        };
        return {
            recalculate: function () {
                b();
                E(a, function (a) {
                    a.anchor().recalculate(a.popup())
                })
            }, dismiss: function () {
                b();
                E(a, function (a) {
                    a.anchor().isAnchored() || a.popup().close()
                })
            }, update: function (b, d) {
                a = KW.put(a, b, d, LW, function (a) {
                    return a.popup() === b
                })
            }, destroy: function () {
            }
        }
    }

    function MW(a, b, c, d) {
        var e = JW(), f = a.isInline() ? t : gc(function () {
            var b = function (b) {
                e.dismiss();
                a.focus()
            }, c = !0 === d.autoresize ? r.fromDom(document) : a.doc().getOrDie();
            k = Yz.bind(c, b);
            !0 !== d.autoresize && !0 === d.toolbar.sticky && (l = Yz.bind(r.fromDom(document), b))
        }), k = null, l = null, q = T.div();
        ma.add(q, [B.resolve("ui-container"), B.resolve("layer-above-editor")]);
        d.editorName.each(function (a) {
            m.set(q, "data-ephox-editor", a)
        });
        var g = K.bind(q, "keydown", function (a) {
            var b;
            if (b = U(R.BACKSPACE(), a.raw().which)) b = a.target(),
                b = u(Fa.is, b), b = !Xa(["textarea", "input", '[contenteditable="true"]'], b);
            b && a.kill()
        });
        return {
            uiContainer: h(q), uiOrigin: function () {
                return Lh.relativeOrigin(q)
            }, refresh: e.recalculate, bounds: b, show: function (a, b) {
                f();
                e.update(a, b);
                b.place(a)
            }, destroy: function () {
                null !== k && k.unbind();
                null !== l && k.unbind();
                e.destroy();
                g.unbind();
                F.remove(q)
            }
        }
    }

    function NW(a, b, c) {
        a = ky(c, a);
        c = function () {
            var a = setTimeout(function () {
                clearTimeout(a);
                d.trigger.expired()
            }, b);
            return {
                clear: function () {
                    clearTimeout(a)
                }
            }
        };
        var d = H.create({
            expired: p([]),
            close: p([])
        }), e = 0 < b ? c() : {clear: t};
        a.events.close.bind(function () {
            e.clear();
            d.trigger.close()
        });
        return {element: a.element, action: a.action, destroy: a.destroy, events: d.registry}
    }

    function OW(a, b, c, d, e, f, k, l) {
        var q = k.layout.build(a, b, c, d, e, f, k, l);
        b = function (a) {
            Db.closest(a.target(), 'input,div[contenteditable="true"],textarea,.ephox-polish-dialog.ephox-polish-help-modal,select,.ephox-polish-bottom-bar,.ephox-polish-side-bar') || a.prevent()
        };
        var g = [K.bind(q.element(), "mousedown", b), K.bind(c.uiContainer(), "mousedown",
            b)];
        (function () {
            var b = n.toggler(q.element(), B.resolve("content-ltr")),
                c = n.toggler(q.element(), B.resolve("content-rtl")),
                d = n.toggler(q.uiContainerParent(), B.resolve("content-ltr")),
                e = n.toggler(q.uiContainerParent(), B.resolve("content-rtl")), k = function () {
                    b.off();
                    d.off()
                }, l = function () {
                    b.on();
                    d.on()
                }, g = function () {
                    c.off();
                    e.off()
                }, C = function () {
                    c.on();
                    e.on()
                }, h = function () {
                    var a = f.uiDirection().isRtl(), b = a ? C : g;
                    (a ? k : l)();
                    b()
                };
            a.events.uiStale.bind(function () {
                $y.readDir(a).fold(h, function (a) {
                    a.ltrdir().fold(k,
                        t, l);
                    a.rtldir().fold(g, t, C);
                    b.isOn() === c.isOn() && h()
                })
            })
        })();
        return {
            element: q.element,
            connect: q.connect,
            viewport: q.viewport,
            uiContainerParent: q.uiContainerParent,
            socket: q.socket,
            showMessage: function (a, b, c) {
                a = NW(a, b, c);
                b = u(q.hideBanner, a);
                a.events.expired.bind(b);
                q.displayBanner(a);
                return b
            },
            displayBanner: q.displayBanner,
            hideBanner: q.hideBanner,
            init: q.init,
            refocus: q.tabstrip.refocus,
            tabstrip: q.tabstrip,
            refresh: q.refresh,
            position: q.position,
            state: q.state,
            destroy: function () {
                q.destroy();
                z(g, function (a) {
                    a.unbind()
                })
            },
            dialogContainer: q.dialogContainer
        }
    }

    function Ej(a) {
        var b = void 0 !== a ? a.slice(0) : [];
        return {
            pop: function () {
                return g.from(b.pop())
            }, push: function (a) {
                b.push(a)
            }, peek: function () {
                return g.from(b[b.length - 1])
            }, pushAll: function (a) {
                b = b.concat(a)
            }, clear: function () {
                b = []
            }, isEmpty: function () {
                return 0 === b.length
            }, size: function () {
                return b.length
            }, state: function () {
                return b.slice(0)
            }
        }
    }

    function Zz(a) {
        var b = H.create({changed: p([]), reset: p([])}), c = a.initial, d = Ej(a.undo), e = Ej(a.redo),
            f = function (a) {
                d.isEmpty() && d.push(c);
                d.push(a);
                b.trigger.changed()
            }, k = function (a, b) {
                b(d.peek().getOr(c), a) ? (d.pop(), d.push(a)) : (f(a), e.clear())
            };
        return {
            save: k, checkChanged: function (a, b) {
                return !b(d.peek().getOr(c), a)
            }, undo: function (a, c) {
                k(a, c);
                return d.pop().bind(function (a) {
                    d.isEmpty() || (e.push(a), b.trigger.changed());
                    return d.peek()
                })
            }, redo: function (a, b) {
                b(d.peek().getOr(c), a) || e.clear();
                return e.pop().bind(function (a) {
                    f(a);
                    return d.peek()
                })
            }, reset: function (a) {
                c = a;
                d.clear();
                e.clear();
                b.trigger.reset()
            }, state: function () {
                return {
                    initial: c,
                    undo: d.state(), redo: e.state()
                }
            }, rewrite: function (a) {
                var f = a(c), k = E(d.state(), a);
                a = E(e.state(), a);
                c = f;
                d = Ej(k);
                e = Ej(a);
                d.isEmpty() && e.isEmpty() || b.trigger.changed()
            }, events: b.registry
        }
    }

    function PW(a, b, c, d, e) {
        var f = QW.fromState($z(e, RW)),
            k = H.create({changed: Q([], f.events.changed), reset: Q([], f.events.reset), undo: p([]), redo: p([])}),
            l = function (b, c) {
                var d;
                (d = "" === b.raw() && SW.isDefaultEmpty(c.raw())) || (b = a.filterHtml(a.internal(), b.raw()), c = a.filterHtml(a.internal(), c.raw()), d = b === c);
                return d
            }, q = function () {
                var c =
                    a.filterHtml(a.history(), b.getContent()), d = a.filterHtml(a.history(), b.serialize());
                return wm(c, d)
            }, g = function (a) {
                return b.deserialize(a.marked())
            };
        e = function () {
            var a = q();
            f.undo(a, l).each(g);
            b.domChanged();
            b.toEditing();
            k.trigger.undo()
        };
        var w = function () {
            var a = q();
            f.redo(a, l).each(g);
            b.domChanged();
            b.toEditing();
            k.trigger.redo()
        }, J = Hd.tap(function (a, b) {
            a() && (a = q(), f.save(a, b))
        }), G = function () {
            J.instance(function () {
                return b.getSelectionStart().exists(ja.inBody)
            }, l)
        }, V = function (a) {
            var b = J.control.isBlocked();
            J.control.block();
            a = a();
            b || J.control.unblock();
            return a
        }, m = c.editor();
        m.events.enter.bind(G);
        m.on();
        d.events.undo.bind(e);
        d.events.redo.bind(w);
        b.events.undoChanged.bind(G);
        b.events.loiter.bind(G);
        c = wb.ui({
            "undo.general": {
                toggle: !1,
                value: "undo",
                textkey: x.key("action.undo"),
                action: e,
                shortcut: !0,
                updateGeneral: ca,
                tooltip: qb.get
            },
            "redo.general": {
                toggle: !1,
                value: "redo",
                textkey: x.key("action.redo"),
                action: w,
                shortcut: !0,
                updateGeneral: ca,
                tooltip: qb.get
            }
        });
        return {
            undo: e, redo: w, save: G, checkChanged: function () {
                var a =
                    q();
                return f.checkChanged(a, l)
            }, reset: function (a) {
                f.reset(wm(a, a))
            }, destroy: function () {
                m.off();
                m.destroy()
            }, state: function () {
                return $z(f.state(), TW)
            }, rewrite: function (a, b) {
                f.rewrite(function (c) {
                    return wm(c.raw().replace(a, b), c.marked().replace(a, b))
                })
            }, transaction: function (a) {
                G();
                a = V(a);
                G();
                return a
            }, disable: V, replaceTop: function () {
                J.instance(h(!0), h(!0))
            }, ui: c, events: k.registry
        }
    }

    function UW(a, b) {
        var c = hd.unbindable(), d = H.create({onChange: p([])}), e = uj(function () {
            d.trigger.onChange()
        }, 1E3), f = function () {
            a.runOrOnLoaded(function (d) {
                (b ?
                    g.some(r.fromDom(document)) : a.doc()).each(function (a) {
                    c.set(K.bind(a, "scroll", function (a) {
                        e.throttle()
                    }));
                    e.throttle()
                })
            })
        };
        a.isInline() || f();
        var k = function () {
            if (b) {
                var c = a.element().dom().getBoundingClientRect();
                return function (a) {
                    a = aA(a);
                    return {left: a.left, right: a.right, top: a.top + c.top, bottom: a.bottom + c.top}
                }
            }
            return aA
        }, l = function () {
            return a.body().bind(function (c) {
                return (b ? g.some(window) : a.win()).map(function (a) {
                    var b = k(), d = a.innerHeight, e = A.children(c);
                    return Va(e, function (a) {
                        if (!D.isElement(a)) return !1;
                        a = b(a);
                        return a.top < d && 0 < a.bottom
                    }).map(function (a) {
                        var c = Va(e.slice(a + 1), function (a) {
                            if (!D.isElement(a)) return !1;
                            a = b(a);
                            return !(a.top < d && 0 < a.bottom)
                        }).map(function (b) {
                            return a + 1 + b
                        }).getOr(e.length);
                        return e.slice(a, c)
                    }).getOr([c])
                })
            }).getOr([])
        };
        return {
            sections: function () {
                return l()
            }, setOn: f, setOff: function () {
                c.clear()
            }, viewport: function () {
                var c = (b ? g.some(window) : a.win()).map(function (a) {
                    return a.innerHeight
                }).getOr(0), d = k();
                return {
                    assess: function (a) {
                        if (!D.isElement(a)) return Rg.inView(a);
                        var b =
                            d(a);
                        b = 0 > b.bottom ? Rg.aboveView : b.top > c ? Rg.belowView : Rg.inView;
                        return b(a)
                    }
                }
            }, destroy: function () {
                c.clear();
                e.cancel()
            }, events: d.registry
        }
    }

    function bA() {
        var a = cA.single(), b = H.create({upload: p(["assets"])});
        a.events.upload.bind(function (a) {
            ve.multiple(a.files()).get(function (a) {
                b.trigger.upload(a)
            })
        });
        return {element: a.element, open: a.open, destroy: a.destroy, events: b.registry}
    }

    function nr(a) {
        var b = g.none(), c = function (c) {
                d();
                c = nj(c);
                c.events.close.bind(function () {
                    b = g.none()
                });
                b = g.some(c);
                a().displayBanner(c)
            },
            d = function () {
                b.each(a().hideBanner);
                b = g.none()
            };
        return {
            show: c, showKey: function (a) {
                var b = mf.get.apply(void 0, arguments);
                c(b)
            }, hide: d, reset: function () {
                b = g.none()
            }
        }
    }

    function dA(a, b) {
        a = ua({layerClass: void 0, zindex: void 0, padding: "0px"}, a);
        var c = H.create({exiting: p([])}), d = r.fromTag("div");
        S.presentation(d);
        n.add(d, lc.resolve("modal"));
        n.add(d, lc.resolve("modal-hidden"));
        v.setAll(d, {position: "fixed", left: a.padding, top: a.padding, right: a.padding, bottom: a.padding});
        void 0 !== a.background && v.set(d, "background",
            a.background);
        void 0 !== a.zindex && v.set(d, "z-index", a.zindex);
        void 0 !== a.layerClass && n.add(d, a.layerClass);
        var e = void 0 !== b ? b : L.first("body").getOrDie();
        y.append(e, d);
        return {
            element: function () {
                return d
            }, content: function (a) {
                F.empty(d);
                y.append(d, a)
            }, show: function () {
                n.add(e, lc.resolve("modal-active"));
                n.remove(d, lc.resolve("modal-hidden"));
                n.add(d, lc.resolve("modal-show"))
            }, hide: function () {
                n.remove(e, lc.resolve("modal-active"));
                n.add(d, lc.resolve("modal-hidden"));
                n.remove(d, lc.resolve("modal-show"))
            },
            destroy: function () {
                F.remove(d);
                n.remove(e, lc.resolve("modal-active"))
            }, events: c.registry
        }
    }

    function VW(a, b) {
        var c = Jh.onChange(), d = H.create({exiting: p([])});
        a = ua({layerClass: null, zindex: null, padding: "0px", background: "rgba(0, 0, 0, 0.5)"}, a);
        var e = r.fromTag("div");
        S.presentation(e);
        n.add(e, lc.resolve("moodal"));
        n.add(e, lc.resolve("moodal-hidden"));
        v.setAll(e, {left: a.padding, top: a.padding, right: a.padding, bottom: a.padding});
        a.background && v.set(e, "background", a.background);
        a.zindex && v.set(e, "z-index", a.zindex);
        a.layerClass && n.add(e, a.layerClass);
        var f = void 0 !== b ? b : L.first("body").getOrDie();
        y.append(f, e);
        var k = r.fromTag("div");
        S.presentation(k);
        n.add(k, lc.resolve("moodal-flexor"));
        y.append(e, k);
        var l = function () {
            v.setAll(k, {top: window.scrollY + "px", height: window.innerHeight + "px"})
        }, q = function () {
            g.unbind();
            c.destroy();
            F.remove(e);
            n.remove(f, lc.resolve("modal-active"))
        }, g = K.bind(e, "click", function () {
            d.trigger.exiting();
            q()
        });
        c.events.ready.bind(function () {
            l()
        });
        return {
            element: h(e), content: function (a) {
                F.empty(k);
                y.append(k, a)
            }, show: function () {
                n.add(f, lc.resolve("moodal-active"));
                n.remove(e, lc.resolve("moodal-hidden"));
                n.add(e, lc.resolve("moodal-show"));
                l()
            }, hide: function () {
                n.remove(f, lc.resolve("moodal-active"));
                n.add(e, lc.resolve("moodal-hidden"));
                n.remove(e, lc.resolve("moodal-show"))
            }, destroy: q, events: d.registry
        }
    }

    function WW(a) {
        var b = oa({layerClass: void 0, zindex: void 0, modal: {}}, a);
        a = void 0 !== a.container ? a.container : L.first("body").getOrDie();
        var c = (aa.detect().os.isiOS() ? VW : dA)(b.modal, a), d = c.element(),
            e = H.create({exiting: Q([], c.events.exiting)});
        void 0 !== b.zindex && v.set(d, "z-index", b.zindex);
        void 0 !== b.layerClass && n.add(d, b.layerClass);
        n.add(d, lc.resolve("centered-dialog"));
        y.append(a, d);
        return {
            content: c.content, show: function () {
                c.show()
            }, hide: function () {
                c.hide()
            }, destroy: function () {
                F.remove(d);
                c.destroy()
            }, events: e.registry
        }
    }

    function XW() {
        var a = function (a, b) {
                n.add(a, B.resolve(b));
                return a
            }, b = a(T.div(), "dialog"), c = a(T.div(), "top"), d = a(T.span(), "dialog-title"),
            e = a(T.span(), "dialog-close"), f = a(T.div(),
            "dialog-content"), k = a(T.div(), "dialog-controls");
        m.set(b, "tabindex", -1);
        m.set(e, "tabindex", -1);
        S.button(e, x.translate("button.close"));
        var l = K.bind(e, "click", function () {
            q.trigger.close()
        });
        P.append(b, [c, f, k]);
        P.append(c, [d, e]);
        var q = H.create({close: p([])});
        return {
            element: function () {
                return b
            }, focus: function () {
                Z.focus(b)
            }, setTitle: function (a) {
                F.empty(d);
                y.append(d, r.fromText(a));
                YW || (S.dialog(b, a), a = Ha("ephox-aria"), m.set(d, "id", a), S.labelledBy(b, a))
            }, setContent: function (a) {
                F.empty(f);
                y.append(f, a);
                a = Ha("ephox-aria");
                m.set(f, "id", a);
                S.describedBy(b, a)
            }, setControls: function (a) {
                F.empty(k);
                y.append(k, a)
            }, close: function () {
                q.trigger.close()
            }, destroy: function () {
                F.remove(b);
                l.unbind()
            }, events: q.registry
        }
    }

    function we(a) {
        var b = XW(), c = g.none(), d = WW({
            container: a,
            layerClass: B.resolve("layer-dialog"),
            modal: {layerClass: B.resolve("layer-below-dialog")}
        });
        d.content(b.element());
        d.events.exiting.bind(function () {
            Vc.unlock([ja.body()]);
            b.close()
        });
        var e = function () {
            d.hide();
            Vc.unlock([ja.body()])
        };
        return {
            element: b.element,
            destroy: function () {
                b.destroy();
                c.each(function (a) {
                    a.unbind()
                });
                e();
                d.destroy()
            }, setTitle: b.setTitle, setContent: b.setContent, setControls: b.setControls, show: function () {
                d.content(b.element());
                d.show();
                b.focus();
                ZW.deviceType.isTouch() && (c = g.some(K.bind(b.element(), "click", function (a) {
                    a.stop()
                })));
                Vc.lock([ja.body()])
            }, hide: e, events: b.events
        }
    }

    function eA(a, b, c, d, e, f) {
        var k = td.okCancel("file-upload"), l = d(e), q = null, g = aa.detect(), h = H.create({
            close: p([]), analytics: p(["message"]), escaped: p([]), insertAssets: p(["assets"]),
            opened: p([])
        }), J = function () {
            q.unbind();
            V.hide();
            h.trigger.close();
            h.trigger.analytics("insert_image_closed");
            G()
        }, G = function () {
            l.reset();
            k.ok().disable()
        }, V = we(c);
        V.setTitle(x.translate("fileupload.title"));
        V.setContent(l.element());
        V.setControls(k.element());
        V.events.close.bind(J);
        n.add(V.element(), B.resolve("imageupload-dialog"));
        var m = f(V.element(), l.keylayouts(), Ba.dialog({
            cancel: k.cancel().element(),
            ok: k.ok().element(),
            execute: Kb.click,
            index: 0
        }));
        l.events.upload.bind(function (a) {
            h.trigger.insertAssets(a.assets());
            J()
        });
        l.events.dragndrop.bind(function (a) {
            h.trigger.insertAssets(a.assets());
            J()
        });
        l.events.success.bind(function (a) {
            k.ok().enable()
        });
        l.events.lookup.bind(function (a) {
            k.ok().disable()
        });
        l.events.setActive.bind(function (a) {
            G()
        });
        k.events.ok.bind(function () {
            l.selected().each(function (a) {
                h.trigger.insertAssets([a]);
                J()
            })
        });
        k.events.cancel.bind(J);
        G();
        return {
            show: function () {
                g.deviceType.isiOS() && (S.hidden(b.element(), !0), setTimeout(function () {
                    l.focus();
                    S.hidden(b.element(), !1)
                }, 250));
                V.show();
                m.enter();
                h.trigger.analytics("insert_image_opened");
                h.trigger.opened();
                var c = r.fromDom(window);
                q = K.bind(c, "orientationchange", function () {
                    a.foreground()
                })
            }, element: V.element, events: h.registry, destroy: function () {
                m.exit();
                m.destroy();
                V.hide();
                V.destroy();
                l.destroy();
                k.destroy()
            }
        }
    }

    function $W(a) {
        var b = H.create({success: p(["assets"]), invalidUrl: p(["url"]), empty: p([]), lookup: p([])}), c = [],
            d = T.div(), e = n.toggler(d, Sb.resolve("url-indicator-loading")), f = fr();
        f.events.start.bind(function () {
            e.on()
        });
        f.events.fail.bind(function (a) {
            e.off();
            b.trigger.invalidUrl(a.url());
            c = []
        });
        f.events.success.bind(function (a) {
            e.off();
            var d = fa.get(C);
            a.url() === d ? ve.fromImages([a.image()]).get(function (a) {
                c = a;
                b.trigger.success(c)
            }) : f.go(d)
        });
        var k = T.div();
        n.add(k, Sb.resolve("url-selector"));
        var l = r.fromTag("label");
        a = r.fromText(a("fileupload.web.url"));
        var q = Ha(Sb.resolve("input-id"));
        m.set(l, "for", q);
        n.add(l, Sb.resolve("url-input-label"));
        y.append(l, a);
        var C = r.fromTag("input");
        m.setAll(C, {id: q, type: "url", placeholder: "http://www.example.com/image.jpg"});
        n.add(C, Sb.resolve("url-input"));
        fA.os.isAndroid() && m.set(C, "autofocus", "true");
        fA.browser.isSafari() && m.setAll(C, {
            autocomplete: "off",
            autocorrect: "off",
            autocapitalize: "off",
            spellcheck: "false"
        });
        S.required(C);
        a = r.fromHtml("<span role=presentation>*</span>");
        n.add(a, Sb.resolve("url-input-required"));
        y.append(l, a);
        P.append(k, [l, C, d]);
        var w = jf(function (a) {
            "" !== a && f.go(a)
        }, 1E3), J = K.bind(C, "input", function () {
            var a = fa.get(C);
            "" === a.trim() ? (b.trigger.empty(), w.throttle("")) : (b.trigger.lookup(), w.throttle(a))
        });
        return {
            element: h(k), input: h(C), events: b.registry, reset: function () {
                e.off();
                fa.set(C, "")
            }, focus: function () {
                Z.focus(C)
            }, selected: function () {
                return g.from(c[0])
            }, destroy: function () {
                J.unbind()
            }
        }
    }

    function gA(a) {
        var b = H.create({lookup: p([]), success: p([])}), c = T.span(),
            d = r.fromHtml('<div role=presentation><span role=presentation class="' + Sb.resolve("url-input-required") + '">*</span> ' + a("fileupload.weburlhelp") + "</div>"),
            e = Ha(Sb.resolve("help-message"));
        m.set(d, "id", e);
        n.add(d, Sb.resolve("fileupload-weburl-help"));
        var f = r.fromHtml("<div role=presentation><div role=presentation>" + a("fileupload.invalid1") + "</div><div role=presentation>" + a("fileupload.invalid2") + "</div><div role=presentation>" + a("fileupload.invalid3") + "</div></div>");
        n.add(f, Sb.resolve("fileupload-weburl-help"));
        n.add(f, Sb.resolve("fileupload-weburl-help-invalid"));
        var k = function (a) {
            F.empty(w);
            y.append(w, a)
        }, l = function (a) {
            var b = r.fromTag("img");
            y.append(w, b);
            aX.previewAsset(a, b)
        }, q = T.div();
        n.add(q, Sb.resolve("web-url-container"));
        var g = $W(a),
            w = T.div();
        n.add(w, Sb.resolve("image-preview-container"));
        a = Ha("ephox-hermes-url-state");
        S.live(w, a, "polite");
        S.controls(g.input(), a);
        S.describedBy(g.input(), e);
        e = T.div();
        n.add(e, Sb.resolve("hbox"));
        P.append(e, [g.element(), w, d]);
        y.append(q, e);
        g.events.lookup.bind(function (a) {
            b.trigger.lookup();
            F.empty(w)
        });
        g.events.success.bind(function (a) {
            z(a.assets(), l);
            b.trigger.success()
        });
        g.events.invalidUrl.bind(function () {
            k(f)
        });
        g.events.empty.bind(function () {
            k(c)
        });
        k(c);
        return {
            element: h(q), selected: g.selected,
            input: g.input, events: b.registry, focus: g.focus, reset: function () {
                k(c);
                g.reset()
            }, destroy: function () {
                g.destroy()
            }
        }
    }

    function bX(a) {
        a = T.div();
        var b = gA(x.translate), c = H.create({
            upload: p(["assets"]),
            dragndrop: p(["assets"]),
            dragover: p([]),
            dragleave: p([]),
            drop: p([]),
            setActive: p(["item"]),
            lookup: Q([], b.events.lookup),
            success: Q([], b.events.success)
        }), d = [function () {
            var a = b.input();
            return ha.input(a, Ba.input({}))
        }()];
        y.append(a, b.element());
        return {
            element: h(a), events: c.registry, keylayouts: h(d), reset: function () {
                b.reset()
            },
            focus: b.focus, selected: b.selected, destroy: function () {
                b.destroy()
            }
        }
    }

    function cX(a, b, c, d, e) {
        var f = H.create({insertAsset: p(["asset"]), open: p([]), done: p([]), abort: p([])}), k = r.fromDom(document);
        d = zb.mainmenu(k, "file-upload-menu", []);
        var l = function (a, b) {
            a = zb.item(k, a, x.get(b) + "...");
            S.menuItem(a, g.some(x.get(b)), g.none());
            return a
        }, q = l("from-url", x.key("image.from-url"));
        l = l("from-camera", x.key("image.from-camera"));
        q = !0 === e.allowLocalImages ? [q, l] : [q];
        var C = bA();
        C.events.upload.bind(function (a) {
            g.from(a.assets()[0]).each(function (a) {
                J();
                f.trigger.insertAsset(a)
            })
        });
        var w = function (a) {
            a = a.assets();
            z(a, function (a) {
                f.trigger.insertAsset(a)
            })
        }, J = function () {
            Hz.target(c.uiContainer(), "mousedown")
        };
        P.append(d, q);
        d = {
            name: "image",
            textkey: x.key("image.menu-button"),
            menuTextkey: x.key("image.menu"),
            icon: g.none,
            tooltip: qb.get,
            contentFocus: !1,
            toggle: !1
        };
        q = [[{
            handlers: h({
                "from-url": function (d) {
                    f.trigger.open();
                    var k = eA(a, b, c.uiContainer(), bX, e, ha.dialog);
                    k.events.insertAssets.bind(w);
                    d = function () {
                        a.focus();
                        k.destroy()
                    };
                    k.events.opened.bind(J);
                    k.events.close.bind(d);
                    k.events.escaped.bind(d);
                    k.show()
                }, "from-camera": function () {
                    f.trigger.open();
                    C.open()
                }
            }), destroyer: t, refreshMenu: t, structure: h({}), submenus: h([]), items: h(q), events: f.registry
        }]];
        d = df.menu(d, q, x.get, rj.menu({focusActive: !0}));
        q = {label: h(!1), hasDialog: !0};
        return ua(d, q)
    }

    function dX(a) {
        var b = r.fromTag("button");
        m.set(b, "type", "button");
        n.add(b, lb.resolve("independent-button"));
        return Gq(b, g.none(), a)
    }

    function eX(a) {
        var b = cA.multiple(), c = T.div();
        n.add(c, Sb.resolve("drop-container"));
        var d = hA.register(c,
            g.some(Sb.resolve("drop-active")), !1), e = dX();
        e.content(Rc(a("fileupload.chooseimage")));
        n.add(e.element(), Sb.resolve("default-action"));
        n.add(e.element(), Sb.resolve("file-selector-trigger"));
        var f = r.fromTag("p");
        n.add(f, Sb.resolve("help-text-drop-icon"));
        var k = r.fromTag("p");
        n.add(k, Sb.resolve("help-text-drop"));
        ra.disable(k);
        y.append(k, r.fromText(a("fileupload.dropimages")));
        P.append(c, [f, k, e.element(), b.element()]);
        return {
            container: h(c), dropper: h(d), picker: h(b), button: h(e), focus: function () {
                Z.focus(e.element())
            },
            destroy: function () {
                b.destroy();
                d.destroy();
                e.destroy()
            }
        }
    }

    function fX(a) {
        var b = eX(a);
        a = b.picker();
        var c = b.container(), d = b.dropper(), e = b.button(), f = H.create({
            upload: p(["assets"]),
            dragndrop: p(["assets"]),
            dragover: Q([], d.events.dragover),
            dragleave: Q([], d.events.dragleave),
            drop: Q([], d.events.drop)
        }), k = function (a) {
            return function (b) {
                ve.multiple(b.files()).get(function (b) {
                    a(b)
                })
            }
        };
        a.events.upload.bind(k(f.trigger.upload));
        d.events.dragndropimages.bind(k(f.trigger.dragndrop));
        e.events.click.bind(a.open);
        return {
            element: h(c),
            button: h(e),
            input: a.element,
            focus: b.focus,
            events: f.registry,
            destroy: function () {
                b.destroy()
            }
        }
    }

    function iA(a, b, c) {
        var d = [], e = O("view", "item", "container"), f = H.create({setActive: p(["item"])}), k = T.div();
        n.add(k, lb.resolve("tablayout-wrapper"));
        n.add(k, lb.resolve("tablayout-wrapper-" + a));
        void 0 !== c && n.add(k, c);
        var l = T.div();
        n.add(l, lb.resolve("tablayout-body"));
        var q = r.fromTag("div");
        n.add(q, lb.resolve("tablayout-menu"));
        P.append(k, [q, l]);
        var g = function (a) {
            var b = Hq(a);
            b.content(Rc(a));
            n.add(b.element(), lb.resolve("tablayout-item"));
            return b
        }, w = [], J = E(b, function (a) {
            var b = g(a.heading());
            m.set(b.element(), "data-ephox-pastry-tablayout-tab", a.heading());
            y.append(q, b.element());
            var c = r.fromTag("div");
            n.add(c, lb.resolve("tablayout-content"));
            m.set(c, "data-ephox-pastry-tablayout-view", a.heading());
            y.append(l, c);
            w.push(c);
            var f = e(a, b, c);
            d.push(f);
            b.events.click.bind(function () {
                G(f)
            });
            return b
        }), G = function (a) {
            z(d, function (b) {
                var c = b.view(), d = b.item(), e = b.container();
                b === a ? (n.add(e, lb.resolve("tablayout-active")),
                    d.select(), c.renderer().render(e), f.trigger.setActive(d)) : (n.remove(e, lb.resolve("tablayout-active")), d.deselect())
            })
        };
        G(d[0]);
        return {
            element: function () {
                return k
            }, tabs: h(J), body: h(l), menu: h(q), tabContent: h(w), destroy: function () {
                z(J, function (a) {
                    a.destroy()
                })
            }, events: f.registry
        }
    }

    function jA(a) {
        return {
            render: function (b) {
                F.empty(b);
                y.append(b, a)
            }
        }
    }

    function gX(a) {
        var b = T.div(), c = fX(x.translate), d = gA(x.translate), e = function (a, b) {
            a = x.translate(a);
            b = jA(b);
            return Sg(a, b)
        }, f = e("fileupload.tabweburl", d.element());
        a = (a.allowLocalImages ? [e("fileupload.tablocal", c.element())] : []).concat(f);
        var k = iA(or.top(), a, "file-upload");
        S.hidden(c.input(), !0);
        e = function () {
            var a = c.button();
            n.add(a.element(), B.resolve("dialog-button-default"));
            var b = aa.detect().browser.isFirefox(), d = {execute: Kb.button};
            b = b ? ua(d, {process: t}) : d;
            b = Ba.button(b);
            return ha.button(a.element(), b)
        }();
        S.tabList(k.menu());
        f = function () {
            var a = d.input();
            return ha.input(a, Ba.input({}))
        }();
        var l = ha.flow(k.menu(), {item: h(".ephox-pastry-statebutton")}, Ba.flow({
            trigger: Kb.button,
            executeOnArrow: !0
        }));
        e = [l].concat(e).concat(f);
        var q = k.tabs();
        z(k.tabContent(), function (a) {
            S.tabPanel(a)
        });
        z(a, function (a, b) {
            var c = q[b];
            S.tabButton(c.element(), a.heading());
            n.add(c.element(), B.resolve("tab-button"));
            c.events.click.bind(function () {
                l.clickFocus(c.element())
            })
        });
        z(k.tabContent(), function (a, b) {
            b = q[b];
            var c = Ha("ephox-aria");
            m.set(b.element(), "id", c);
            S.labelledBy(a, c)
        });
        a = H.create({
            upload: Q(["assets"], c.events.upload),
            dragndrop: Q(["assets"], c.events.dragndrop),
            dragover: Q([], c.events.dragover),
            dragleave: Q([], c.events.dragleave),
            drop: Q([], c.events.drop),
            lookup: Q([], d.events.lookup),
            success: Q([], d.events.success),
            setActive: Q(["item"], k.events.setActive)
        });
        k.events.setActive.bind(function (a) {
            a = m.get(a.item().element(), "data-ephox-pastry-tablayout-tab");
            a === x.translate("fileupload.tablocal") ? c.focus() : a === x.translate("fileupload.tabweburl") && d.focus()
        });
        y.append(b, k.element());
        return {
            element: h(b), events: a.registry, focus: d.focus, keylayouts: h(e), reset: function () {
                d.reset()
            }, selected: d.selected,
            destroy: function () {
                k.destroy();
                c.destroy();
                d.destroy()
            }
        }
    }

    function ge(a, b, c) {
        a = parseFloat(a);
        a > c ? a = c : a < b && (a = b);
        return a
    }

    function Tf(a, b) {
        var c, d, e, f, k = [], l = Array(10);
        for (c = 0; 5 > c; c++) {
            for (d = 0; 5 > d; d++) k[d] = b[d + 5 * c];
            for (d = 0; 5 > d; d++) {
                for (e = f = 0; 5 > e; e++) f += a[d + 5 * e] * k[e];
                l[d + 5 * c] = f
            }
        }
        return l
    }

    function pr(a, b) {
        b = ge(b, 0, 1);
        return a.map(function (a, d) {
            a = 0 === d % 6 ? 1 - (1 - a) * b : a * b;
            return ge(a, 0, 1)
        })
    }

    function xm(a, b) {
        return a.toCanvas().then(function (c) {
            var d = a.getType(), e = Uc.get2dContext(c), f = e.getImageData(0, 0, c.width,
                c.height), k = f.data, l, q = b[0], g = b[1], h = b[2], J = b[3], G = b[4], V = b[5], m = b[6],
                n = b[7], p = b[8], r = b[9], t = b[10], u = b[11], v = b[12], z = b[13], y = b[14], x = b[15],
                A = b[16], B = b[17], D = b[18], E = b[19];
            for (l = 0; l < k.length; l += 4) {
                var F = k[l];
                var H = k[l + 1];
                var I = k[l + 2];
                var K = k[l + 3];
                k[l] = F * q + H * g + I * h + K * J + G;
                k[l + 1] = F * V + H * m + I * n + K * p + r;
                k[l + 2] = F * t + H * u + I * v + K * z + y;
                k[l + 3] = F * x + H * A + I * B + K * D + E
            }
            e.putImageData(f, 0, 0);
            return xe.fromCanvas(c, d)
        })
    }

    function kA(a, b) {
        return a.toCanvas().then(function (c) {
            return hX(c, a.getType(), b)
        })
    }

    function hX(a, b, c) {
        var d =
            Uc.get2dContext(a);
        var e = d.getImageData(0, 0, a.width, a.height);
        var f = d.getImageData(0, 0, a.width, a.height);
        f = function (a, b, c) {
            function d(a, b, c) {
                a > c ? a = c : a < b && (a = b);
                return a
            }

            var e, f, k, l, q, g;
            var h = Math.round(Math.sqrt(c.length));
            var m = Math.floor(h / 2);
            var n = a.data;
            var p = b.data;
            var r = a.width;
            var t = a.height;
            for (e = 0; e < t; e++) for (a = 0; a < r; a++) {
                for (g = f = k = l = 0; g < h; g++) for (q = 0; q < h; q++) {
                    var u = d(a + q - m, 0, r - 1);
                    var v = d(e + g - m, 0, t - 1);
                    u = 4 * (v * r + u);
                    v = c[g * h + q];
                    f += n[u] * v;
                    k += n[u + 1] * v;
                    l += n[u + 2] * v
                }
                u = 4 * (e * r + a);
                p[u] = d(f, 0, 255);
                p[u +
                1] = d(k, 0, 255);
                p[u + 2] = d(l, 0, 255)
            }
            return b
        }(e, f, c);
        d.putImageData(f, 0, 0);
        return xe.fromCanvas(a, b)
    }

    function lA(a) {
        return function (b, c) {
            return b.toCanvas().then(function (d) {
                var e = b.getType(), f = Uc.get2dContext(d), k, l = Array(256);
                for (k = 0; k < l.length; k++) l[k] = a(k, c);
                k = f.getImageData(0, 0, d.width, d.height);
                var q = k.data, g;
                for (g = 0; g < q.length; g += 4) q[g] = l[q[g]], q[g + 1] = l[q[g + 1]], q[g + 2] = l[q[g + 2]];
                f.putImageData(k, 0, 0);
                return xe.fromCanvas(d, e)
            })
        }
    }

    function Mh(a) {
        return function (b, c) {
            return xm(b, a(of.identity(), c))
        }
    }

    function mA(a) {
        return function (b) {
            return kA(b, a)
        }
    }

    function nA(a, b, c) {
        var d = Nh.getWidth(a), e = Nh.getHeight(a);
        d = b / d;
        var f = c / e;
        e = !1;
        if (.5 > d || 2 < d) d = .5 > d ? .5 : 2, e = !0;
        if (.5 > f || 2 < f) f = .5 > f ? .5 : 2, e = !0;
        a = iX(a, d, f);
        return e ? a.then(function (a) {
            return nA(a, b, c)
        }) : a
    }

    function iX(a, b, c) {
        return new Md(function (d) {
            var e = Nh.getWidth(a), f = Nh.getHeight(a), k = Math.floor(e * b), l = Math.floor(f * c),
                q = Uc.create(k, l);
            Uc.get2dContext(q).drawImage(a, 0, 0, e, f, 0, 0, k, l);
            d(q)
        })
    }

    function jX(a, b, c, d, e) {
        var f = a.content(), k = a.smartview(), l =
            a.ui().tabstrip, q = nr(a.ui), g = Fj.processResults(q.showKey), w = function (d) {
            a.undo().save();
            d = kX.validate(d);
            (d.failure() ? u(q.showKey, "fileupload.invalidimages") : q.hide)();
            c.assets(d.assets()).bind(oA.maybeDoRotate).map(g).get(function (a) {
                qr.insertAssets(f, b, a)
            })
        }, J = function (a) {
            w(a.assets())
        };
        d.events.insertAssets.bind(function (a) {
            e.allowLocalImages ? w(a.assets()) : mf.getOrLog("errors.dragdrop.images.disallowed")
        });
        var G = f.cursor();
        d = H.create({analytics: p(["message"])});
        return {
            ui: wb.ui({
                "fileupload.general": h({
                    value: "image",
                    textkey: x.key("insert.image"), icon: !0, updateGeneral: ca, action: function () {
                        var b = eA(f, l, k.uiContainer(), gX, e, ha.dialog);
                        b.events.insertAssets.bind(J);
                        b.events.close.bind(function () {
                            f.focus();
                            b.destroy()
                        });
                        b.events.escaped.bind(function () {
                            f.focus();
                            b.destroy()
                        });
                        a.content().hideInlineSelection();
                        b.show()
                    }, hasDialog: !0
                }), "fileupload.menu": function () {
                    var c = cX(f, l, k, a.ui(), e);
                    c.events.insertAsset.bind(function (a) {
                        G.get().bind(function (c) {
                            qr.insertMobileAssets(f, c, b, [a.asset()])
                        })
                    });
                    c.events.open.bind(function (a) {
                        f.getSelection().each(G.save)
                    });
                    return c
                }, "camera.general": function () {
                    var a = bA();
                    a.events.upload.bind(function (a) {
                        G.get().bind(function (c) {
                            qr.insertMobileAssets(f, c, b, a.assets())
                        })
                    });
                    return {
                        value: "image",
                        textkey: x.key("image.from-camera"),
                        icon: !0,
                        updateGeneral: ca,
                        action: function () {
                            f.getSelection().each(G.save);
                            f.toReading();
                            a.open()
                        },
                        hasDialog: !0
                    }
                }
            }, ca), events: d.registry, destroy: function () {
            }
        }
    }

    function pA(a, b, c) {
        var d = function () {
            b.counter.update(0, 0)
        }, e = function (e) {
            e.all.fold(d, function (d) {
                b.counter.update(e.pos + 1, d.length);
                d = d[e.pos][0];
                a.setSelection(d, 0, d, 0);
                c.element(d)
            })
        }, f = function () {
            c.cursor();
            d()
        }, k = function (a, b, c) {
            pf.clear(a);
            pf.search(a, b, c).fold(f, e);
            return g.some(b)
        }, l = function (a, b) {
            a = (!0 === b ? pf.prev : pf.next)(a);
            a.fold(f, e);
            return a
        }, q = function (b) {
            a.body().each(function (c) {
                pf.replace(c, b).fold(f, e);
                a.domChanged();
                a.undoChanged()
            })
        }, C = g.none(), w = function () {
            C = g.none()
        };
        b.events.search.bind(function (b) {
            a.body().each(function (a) {
                k(a, b.term(), b.matchcase())
            })
        });
        b.events.next.bind(function () {
            a.body().each(function (a) {
                l(a, !1)
            })
        });
        b.events.prev.bind(function () {
            a.body().each(function (a) {
                l(a, !0)
            })
        });
        b.events.replace.bind(function (a) {
            q(a.value())
        });
        b.events.replaceAll.bind(function (b) {
            a.body().each(function (c) {
                pf.replaceAll(c, b.value()).fold(f, e);
                a.undoChanged()
            })
        });
        b.events.interactive.bind(function (b) {
            a.body().each(function (a) {
                C = k(a, b.term(), b.matchcase())
            })
        });
        b.events.encase.bind(function (b) {
            a.body().each(function (a) {
                C.each(function (c) {
                    k(a, c, b.matchcase())
                })
            })
        });
        b.events.clear.bind(function (b) {
            a.body().each(function (a) {
                pf.clear(a);
                w()
            })
        });
        return {
            zeroCount: d, updateMatch: e, enterSearchAction: function (c, d) {
                a.body().each(function (a) {
                    var e = b.getCase();
                    C = C.filter(function (a) {
                        return c === a
                    }).fold(function () {
                        return k(a, c, e)
                    }, function (b) {
                        return l(a, d.isShift()).fold(function () {
                            return k(a, c, e)
                        }, h(C))
                    })
                });
                (0 === c.length ? b.counter.hide : b.counter.show)()
            }, enterReplaceAction: q, clearLastSearch: w
        }
    }

    function qA(a) {
        var b = a.content();
        a = function (a) {
            b.elementIntoView(a)
        };
        var c = function () {
            b.cursorIntoView()
        };
        a = {
            element: rA ? a : u(Og.elementIntoView, b),
            cursor: rA ? c : u(Og.cursorIntoView, b)
        };
        return {get: h(a)}
    }

    function sA() {
        var a = T.div();
        n.add(a, B.resolve("search-widget"));
        var b = ym.searchField(), c = (xc.isSmallTouch() ? ym.dummyCounter : ym.counter)(b.input()),
            d = ym.replaceDrawer(), e = d.element(), f = H.create({
                next: Q([], b.events.next),
                prev: Q([], b.events.previous),
                replace: p(["value"]),
                replaceAll: p(["value"]),
                search: p(["term", "matchcase", "isShift"]),
                interactive: p(["term", "matchcase"]),
                encase: p(["matchcase"]),
                clear: p([])
            });
        ra.setPressed(d.matchcase.element(), d.matchcase.selected());
        var k = wy(e);
        S.linkElements(b.moreToggle.element(), e);
        tA(k.visible(), b.moreToggle.element(), e);
        b.moreToggle.events.click.bind(function () {
            (k.visible() ? k.hide : k.show)()
        });
        b.events.input.bind(function () {
            var a = fa.get(b.input()), d = sa.get(b.element());
            v.set(c.element(), "height", d + "px");
            3 <= a.length ? q.throttle(a) : (f.trigger.clear(), c.hide(), c.update(0, 0))
        });
        d.replace.events.click.bind(function () {
            var a = fa.get(d.input.element());
            f.trigger.replace(a)
        });
        d.replaceAll.events.click.bind(function () {
            var a = fa.get(d.input.element());
            f.trigger.replaceAll(a)
        });
        d.matchcase.events.click.bind(function () {
            ra.setPressed(d.matchcase.element(), d.matchcase.selected());
            f.trigger.encase(l())
        });
        var l = function () {
            return d.matchcase.selected()
        }, q = jf(function (a) {
            c.show();
            f.trigger.interactive(a, l())
        }, 500), g = K.bind(e, "transitionend", function (a) {
            "opacity" === a.raw().propertyName && n.remove(e, "ephox-chameleon-toolbar-more-open");
            tA(k.visible(), b.moreToggle.element(), e)
        });
        P.append(a, [c.element(), b.element(), d.element()]);
        return {
            element: h(a), search: b,
            focus: function () {
                b.focus()
            }, drawer: d, counter: c, getCase: l, destroy: function () {
                g.unbind();
                b.destroy();
                d.destroy();
                c.destroy();
                k.destroy();
                F.remove(a)
            }, events: f.registry
        }
    }

    function lX(a) {
        var b = a.content(), c = sA();
        a = qA(a);
        var d = pA(b, c, a.get()), e = function (a) {
            var c = a.endContainer();
            a = a.endOffset();
            b.setSelection(c, a, c, a)
        };
        a = Ba.button({execute: Kb.button});
        a = [ha.input(c.search.input(), Ba.input({
            execute: function (a, b) {
                d.enterSearchAction(a, b)
            }
        })), ha.button(c.search.previous(), a), ha.button(c.search.next(), a), ha.button(c.search.moreToggle.element(),
            a), ha.input(c.drawer.input.element(), Ba.input({
            execute: function (a, b) {
                d.enterReplaceAction(a)
            }
        })), ha.button(c.drawer.matchcase.element(), a), ha.button(c.drawer.replace.element(), a), ha.button(c.drawer.replaceAll.element(), a)];
        var f = H.create({done: p([])});
        return {
            element: c.element,
            anchorName: h("search-widget-anchor"),
            textkey: h("action.search"),
            dialogTextkey: h("search.menu"),
            destroy: function () {
                c.destroy()
            },
            keylayouts: h(a),
            openWidget: function () {
                d.enterSearchAction(fa.get(c.search.input()), Od.shiftKeyState(!1))
            },
            closeWidget: function () {
                b.body().each(function (a) {
                    b.getSelection().each(e);
                    pf.clear(a)
                });
                d.clearLastSearch()
            },
            events: f.registry
        }
    }

    function mX(a, b) {
        var c = a.content(), d = sA();
        a = qA(a);
        var e = pA(c, d, a.get());
        a = H.create({toEditor: p([])});
        b = Gj.text(d.search.element(), d.search.input());
        return {
            element: d.element, addEscape: function (a) {
                y.append(d.search.element(), a.element())
            }, open: function () {
                e.enterSearchAction(fa.get(d.search.input()), Od.shiftKeyState(!1));
                setTimeout(d.focus, 250)
            }, close: function () {
                c.body().each(function (a) {
                    pf.clear(a).fold(e.zeroCount,
                        e.updateMatch)
                });
                e.clearLastSearch()
            }, execute: function (a) {
                if (Z.hasFocus(d.search.input())) {
                    a = Od.shiftKeyState(!0 === a.raw().shiftKey);
                    var b = fa.get(d.search.input());
                    e.enterSearchAction(b, a)
                } else a = fa.get(d.drawer.input.element()), e.enterReplaceAction(a)
            }, type: h(b), events: a.registry, destroy: function () {
                d.destroy()
            }
        }
    }

    function zm(a, b) {
        nX(b);
        var c = a.content(), d = a.ui().tabstrip.element();
        n.add(b.element(), B.resolve("slick-widget"));
        oX.browser.isSafari() && z(Y.descendants(b.element(), "input,textarea"), function (a) {
            m.setAll(a,
                {autocomplete: "off", autocorrect: "off", autocapitalize: "off", spellcheck: "false"})
        });
        var e = function () {
            var a = Y.descendants(b.element(), "input,textarea");
            Va(a, Z.hasFocus).each(function (b) {
                b = (b + 1) % a.length;
                0 <= b && b < a.length && Z.focus(a[b])
            })
        }, f = Gj.cata(b.type(), function (a, c) {
            n.add(a, B.resolve("slick-widget-field"));
            n.add(c, B.resolve("slick-widget-input"));
            var d = K.bind(b.element(), "keydown", function (a) {
                var c = {original: h(a)};
                fe.isEnter(c) ? (b.execute(a), a.kill()) : fe.isTab(c) ? (e(), a.kill()) : fe.isEscape(c) && (w(),
                    a.kill())
            }), f = K.bind(c, "blur", function (a) {
                g.from(a.raw().relatedTarget).each(function (a) {
                    !0 === Ja.ancestor(r.fromDom(a), function (a) {
                        return n.has(a, "ephox-polish-mobile-toolbar-hide")
                    }).isSome() && rr.refreshInput(c)
                })
            });
            return {
                destroy: function () {
                    d.unbind();
                    f.unbind()
                }
            }
        });
        a = Oc("shizniz");
        var k = x.translate("toolbar.backbutton"), l = bf([va.resolve("icon")]);
        a.content(l);
        m.set(a.element(), "title", k);
        S.toolbarButton(a.element(), k, !1, !1);
        b.addEscape(a);
        var q = na(!1);
        y.prepend(d, b.element());
        var C = H.create({
            done: p([]),
            abort: p([]), open: p([]), close: p([])
        }), w = function () {
            G();
            c.toEditing()
        };
        b.events.toEditor.bind(w);
        var J = gc(function (a) {
            return Y.children(d, "." + va.resolve("toolbar"))
        }), G = function () {
            b.close();
            q.set(!1);
            z(J(), function (a) {
                n.remove(a, B.resolve("mobile-toolbar-hide"))
            });
            n.remove(b.element(), B.resolve("mobile-toolbar-show"));
            n.add(b.element(), B.resolve("mobile-toolbar-hide"));
            C.trigger.close()
        };
        c.events.mousedown.bind(G);
        G();
        a.events.click.bind(function () {
            w();
            C.trigger.abort()
        });
        return {
            element: b.element, destroy: function () {
                c.events.mousedown.unbind(G);
                f.destroy();
                b.destroy()
            }, events: C.registry, open: function () {
                var a = K.bind(d, "transitionend", function () {
                    b.open();
                    C.trigger.open();
                    a.unbind()
                });
                q.set(!0);
                z(J(), function (a) {
                    n.remove(a, B.resolve("mobile-toolbar-show"));
                    n.add(a, B.resolve("mobile-toolbar-hide"))
                });
                n.remove(b.element(), B.resolve("mobile-toolbar-hide"));
                n.add(b.element(), B.resolve("mobile-toolbar-show"))
            }, close: G, isOpen: function () {
                return q.get()
            }
        }
    }

    function pX(a) {
        var b = a.filter();
        Od.configure(b);
        var c = H.create({analytics: p(["message"])}), d =
            gc(function () {
                var b = qX(a);
                b.events.open.bind(function () {
                    c.trigger.analytics("search_tool_open")
                });
                b.events.abort.bind(b.close);
                return b
            });
        b = function () {
            var a = d();
            (a.isOpen() ? a.close : a.open)()
        };
        a.shortcuts().events.search.bind(b);
        return {
            ui: wb.ui({
                "find.general": {
                    toggle: !1,
                    hasPopup: !1,
                    value: "search",
                    textkey: x.key("action.search"),
                    action: b,
                    updateGeneral: function (a) {
                        n.add(a.element(), B.resolve("search"))
                    },
                    icon: !0,
                    tooltip: qb.get
                }
            }), events: c.registry, destroy: function () {
                d().destroy()
            }
        }
    }

    function Hj(a, b) {
        var c =
            Oc();
        ma.add(c.element(), a);
        S.button(c.element(), x.translate(b));
        m.set(c.element(), "title", x.translate(b));
        return c
    }

    function rX(a, b) {
        var c = sX(Am.configuration()), d = c.i18nNamespace(), e = c.cssNamespace();
        b = T.div();
        n.add(b, B.resolve("fontsize-widget"));
        var f = T.span();
        n.add(f, B.resolve("fontsize-widget-field"));
        var k = T.div();
        n.add(k, B.resolve("fontsize-widget-exit"));
        var l = r.fromTag("input");
        n.add(l, B.resolve("fontsize-widget-input"));
        S.label(l, x.translate(d + ".stepper.input"));
        var q = function (b) {
            n.remove(l,
                B.resolve("slick-widget-invalid-input"));
            S.invalid(l, !1);
            fa.set(l, b);
            Uf.partialSize(a.content(), a.undo(), a.selections(), b);
            ib.speak(ja.body(), b)
        }, g = function () {
            n.add(l, B.resolve("slick-widget-invalid-input"));
            S.invalid(l, !0);
            ib.speak(ja.body(), x.translate("aria.input.invalid"));
            Z.focus(l)
        }, w = function (a) {
            return function () {
                var b = fa.get(l);
                b = a(c.specials(), b);
                Vf.validate(b, c.tag(), c.property()).fold(g, q)
            }
        }, J = w(Bm.decrease);
        w = w(Bm.increase);
        var G = function (a, b) {
            return Hj([B.resolve(e + a), B.resolve("stepper-button")],
                d + b)
        }, m = G("-stepper-decrease", ".stepper.decrease");
        G = G("-stepper-increase", ".stepper.increase");
        m.events.click.bind(J);
        G.events.click.bind(w);
        P.append(f, [m.element(), l, G.element()]);
        y.append(b, f);
        y.append(b, k);
        f = Gj.text(f, l);
        var X = H.create({toEditor: p([]), size: p(["value"])}), Hc = function () {
            fa.set(l, "")
        }, u = function (a) {
            a = Vf.sanitise(a);
            Vf.validate(a, c.tag(), c.property()).fold(g, function (a) {
                n.remove(l, B.resolve("slick-widget-invalid-input"));
                S.invalid(l, !1)
            });
            fa.set(l, a)
        };
        return {
            element: h(b), addEscape: function (a) {
                y.append(k,
                    a.element())
            }, open: function () {
                Z.focus(l)
            }, close: t, execute: function () {
                var a = fa.get(l);
                Vf.validate(a, c.tag(), c.property()).fold(g, function (a) {
                    q(a);
                    X.trigger.toEditor()
                })
            }, destroy: t, type: h(f), represent: function (a) {
                a.fold(Hc, u, u)
            }, events: X.registry
        }
    }

    function tX(a, b) {
        var c = a.content(), d = na(g.none()), e = function () {
            var c = rX(a, b), e = zm(a, c);
            c = {represent: c.represent, refreshValue: c.refreshValue, open: e.open, close: e.close, isOpen: e.isOpen};
            d.set(g.some(c));
            return c
        }, f = {
            toggle: !1, value: "size", textkey: x.key("font.size"),
            action: function () {
                var b = d.get().getOrThunk(e);
                if (b.isOpen()) b.close(); else {
                    var f = Cm.getState(a.selections(), c);
                    b.open();
                    b.represent(f.readState.size())
                }
            }, updateGeneral: t, icon: !0, shortcut: !1, hasPopup: !1, hasDialog: !1
        };
        return {general: h(f)}
    }

    function uA(a) {
        var b = a.hex(), c = r.fromTag("span");
        n.add(c, B.resolve("palette-detail-action"));
        m.set(c, "title", x.get(a.name()));
        S.option(c, x.get(a.name()), !1, !1);
        var d = H.create({selected: p(["value"])}), e = K.bind(c, "click", function () {
            Z.focus(c);
            d.trigger.selected(b)
        });
        return {
            element: function () {
                return c
            }, value: h(b), destroy: function () {
                e.unbind();
                F.remove(c)
            }, events: d.registry
        }
    }

    function uX() {
        var a = [], b = T.div(), c = r.fromTag("span");
        S.listBox(c);
        n.add(c, B.resolve("palette-detail-actions"));
        n.add(c, B.resolve("palette-color-options"));
        S.label(c, x.translate("aria.font.palette"));
        y.append(b, c);
        var d = Ql.create(), e = H.create({selected: p(["value"])});
        return {
            element: function () {
                return b
            }, add: function (b) {
                a.push(b.destroy);
                y.append(c, b.element());
                d.bind(b.events.selected, function (a) {
                    e.trigger.selected(a.value())
                })
            },
            remove: function (a) {
                F.remove(a.element());
                d.unbind(a.events.selected)
            }, show: function () {
                n.add(b, B.resolve("palette-detail-active"));
                ra.showPanel(b);
                v.remove(b, "display")
            }, hide: function () {
                n.remove(b, B.resolve("palette-detail-active"));
                ra.hidePanel(b);
                v.set(b, "display", "none")
            }, count: function () {
                return a.length
            }, destroy: function () {
                z(a, xb);
                F.remove(b);
                a = []
            }, events: e.registry
        }
    }

    function Dm(a) {
        var b = Ij.makeLayout(a, ".ephox-polish-palette-detail-action.ephox-polish-palette-color-option:not(.ephox-polish-palette-color-option-spacer)",
            {isValid: vA}), c = b.layout();
        return {
            isFocused: c.isFocused,
            enterGrid: c.enter,
            grid: c,
            refresh: b.refresh,
            destroy: c.destroy,
            clear: c.clear,
            isActive: function () {
                return vA(a)
            }
        }
    }

    function vX() {
        var a = r.fromTag("div");
        wX() ? S.presentation(a) : S.menuItem(a, g.none(), g.none());
        n.add(a, B.resolve("color-widget"));
        var b = r.fromTag("div");
        n.add(b, B.resolve("color-widget-controls"));
        S.tabList(b);
        var c = r.fromTag("div");
        n.add(c, B.resolve("color-widget-palettes"));
        S.toolbarGroup(c);
        var d = $d("text-color");
        n.add(d.element(), B.resolve("tab-button"));
        d.content(Rc(x.translate("font.color")));
        S.tabButton(d.element(), x.translate("aria.font.color"));
        var e = $d("highlight-color");
        n.add(e.element(), B.resolve("tab-button"));
        e.content(Rc(x.translate("font.highlight")));
        S.tabButton(e.element(), x.translate("aria.font.highlight"));
        y.append(b, d.element());
        y.append(b, e.element());
        y.append(a, b);
        y.append(a, c);
        return {
            element: h(a),
            colorToggle: h(d),
            highlightToggle: h(e),
            content: h(c),
            controls: h(b),
            destroy: function () {
                d.destroy();
                e.destroy();
                F.remove(c);
                F.remove(b)
            }
        }
    }

    function xX(a, b) {
        var c = null;
        return {
            cancel: function () {
                null !== c && (sr(c), c = null)
            }, schedule: function () {
                for (var d = [], e = 0; e < arguments.length; e++) d[e] = arguments[e];
                c = Kf(function () {
                    a.apply(null, d);
                    c = null
                }, b)
            }
        }
    }

    function yX() {
        var a = {}, b = function (a, b) {
            return Jj(b).fold(function () {
                return g.none()
            }, function (c) {
                c = Kj(c);
                return a.bind(c).map(function (a) {
                    return zX(b, a)
                })
            })
        };
        return {
            registerId: function (b, d, e) {
                Ma(e, function (c, e) {
                    var f = void 0 !== a[e] ? a[e] : {};
                    var k = u.apply(void 0, [c.handler].concat(b));
                    c = c.purpose();
                    k =
                        {cHandler: k, purpose: h(c)};
                    f[d] = k;
                    a[e] = f
                })
            }, unregisterId: function (b) {
                Ma(a, function (a, c) {
                    a.hasOwnProperty(b) && delete a[b]
                })
            }, filterByType: function (b) {
                return zc(a, b).map(function (a) {
                    return Nf(a, function (a, b) {
                        return {id: h(b), descHandler: h(a)}
                    })
                }).getOr([])
            }, find: function (c, d, e) {
                var f = Kj(d)(a);
                return AX(e, function (a) {
                    return b(f, a)
                }, c)
            }
        }
    }

    function BX() {
        var a = yX(), b = {}, c = function (a) {
                var b = a.element();
                return Jj(b).fold(function () {
                    var b = a.element(), c = Ha(CX + "uid-");
                    m.set(b, wA, c);
                    return c
                }, function (a) {
                    return a
                })
            },
            d = function (c) {
                Jj(c.element()).each(function (c) {
                    b[c] = void 0;
                    a.unregisterId(c)
                })
            };
        return {
            find: function (b, c, d) {
                return a.find(b, c, d)
            }, filter: function (b) {
                return a.filterByType(b)
            }, register: function (e) {
                var f = c(e);
                if (ye(b, f)) {
                    var k = b[f];
                    if (k === e) d(e); else throw Error('The tagId "' + f + '" is already used by: ' + Tg(k.element()) + "\nCannot use it for: " + Tg(e.element()) + "\nThe conflicting element is" + (ja.inBody(k.element()) ? " " : " not ") + "already in the DOM");
                }
                a.registerId([e], f, e.events());
                b[f] = e
            }, unregister: d,
            getById: function (a) {
                return Kj(a)(b)
            }
        }
    }

    function DX(a) {
        var b = H.create({color: p(["color"]), close: p([])}), c = we(a), d = td.okCancel("custom-color"),
            e = r.fromTag("div");
        S.presentation(e);
        n.add(c.element(), B.resolve("dialog-narrow"));
        c.setTitle(x.translate("font.coloroption"));
        c.setContent(e);
        c.setControls(d.element());
        a = EX();
        var f = Lb.create("ephox-acid"), k = function (a) {
            return f.resolve(a)
        }, l = FX.makeFactory(x.translate, k), q = Em(l.sketch({
            dom: {tag: "div", classes: [k("color-picker-container")], attributes: {role: "presentation"}},
            onValidHex: function () {
                d.ok().enable()
            }, onInvalidHex: function () {
                d.ok().disable()
            }
        }));
        a.add(q);
        GX(e, a);
        e = Y.descendants(e, "input");
        k = e[e.length - 1];
        e = [ha.input(e[0], Ba.input({})), ha.input(k, Ba.input({}))];
        var g = Kb.setup(c, d, e), h = function () {
            b.trigger.close();
            g.exit()
        };
        c.events.close.bind(function () {
            h()
        });
        d.events.ok.bind(function () {
            ze.getCurrent(q).fold(function () {
                console.error("Could not find colour picker hex.")
            }, function (a) {
                Wb.getValue(a).hex.each(function (a) {
                    b.trigger.color("#" + a)
                })
            });
            h()
        });
        d.events.cancel.bind(h);
        return {
            element: a.element, events: b.registry, open: function () {
                c.show();
                g.enter()
            }, destroy: function () {
                c.destroy();
                d.destroy();
                g.destroy()
            }, close: h
        }
    }

    function HX(a, b) {
        var c = DX(b), d = H.create({color: Q(["color"], c.events.color), close: p([])}), e = function () {
            d.trigger.close();
            f();
            a.focus()
        }, f = function () {
            c.events.close.unbind(e);
            c.destroy()
        };
        c.events.close.bind(e);
        return {
            show: function () {
                a.toReading();
                c.open()
            }, close: e, destroy: f, events: d.registry
        }
    }

    function IX(a, b, c) {
        var d = Ij.create(c.colors.buttons), e = Ij.create(c.colors.buttons),
            f = (c.colors.custom ? Fm.create : Fm.stub)(a, b), k = H.create({
                color: p(["value"]),
                highlight: p(["value"]),
                abort: p([]),
                menuDone: Q([], f.events.menuDone)
            });
        d.events.selected.bind(function (a) {
            k.trigger.color(a.value())
        });
        e.events.selected.bind(function (a) {
            k.trigger.highlight(a.value())
        });
        var l = vX();
        f.events.selected.bind(function (a) {
            a = a.color();
            J.isActive() ? k.trigger.highlight(a) : k.trigger.color(a)
        });
        var q = l.colorToggle(), g = l.highlightToggle();
        S.linkTabToPanel(q.element(), d.element());
        S.linkTabToPanel(g.element(),
            e.element());
        y.append(l.content(), d.element());
        y.append(l.content(), e.element());
        P.append(l.content(), f.elements);
        var w = Dm(d.element()), J = Dm(e.element()),
            G = ha.flow(l.controls(), {item: h(".ephox-pastry-statebutton")}, Ba.flow({
                trigger: function (a, b) {
                    return L.descendant(a, ".ephox-pastry-button").map(function (a) {
                        a.dom().click();
                        return a
                    })
                }, executeOnArrow: !0
            })), m = ha.multiple(l.element(), [G, w.grid, J.grid].concat(f.layouts));
        m.events.exit.bind(function (a) {
            k.trigger.abort()
        });
        var X = function () {
            e.hide();
            q.select();
            g.deselect();
            ra.tabSelected(q.element(), [g.element()]);
            w.refresh();
            J.refresh();
            d.show()
        };
        q.events.click.bind(function () {
            G.clickFocus(q.element());
            X()
        });
        g.events.click.bind(function () {
            G.clickFocus(g.element());
            d.hide();
            q.deselect();
            ra.tabSelected(g.element(), [q.element()]);
            e.show()
        });
        return {
            element: l.element, destroy: function () {
                f.destroy();
                d.destroy();
                m.destroy();
                e.destroy();
                l.destroy()
            }, open: function () {
                f.refresh();
                m.clear();
                m.refresh();
                q.click();
                X();
                m.enter()
            }, close: function () {
                m.exit()
            }, events: k.registry
        }
    }

    function JX() {
        var a = g.none(), b = function (b) {
            a.each(function (a) {
                a[b]()
            })
        };
        return {
            enter: u(b, "enter"), exit: u(b, "exit"), destroy: u(b, "destroy"), set: function (b) {
                a = g.some(b)
            }
        }
    }

    function KX(a, b) {
        var c = b.i18nNamespace();
        b = b.cssNamespace();
        var d = H.create({plus: p([]), minus: p([]), validate: p([]), abort: p([])}), e = Oc(), f = Oc(), k = T.div(),
            l = T.div(), q = r.fromTag("input");
        S.label(q, x.translate(c + ".stepper.input"));
        S.toolbarButton(e.element(), x.translate(c + ".stepper.increase"), !1, !1);
        S.toolbarButton(f.element(), x.translate(c +
            ".stepper.decrease"), !1, !1);
        m.set(q, "tabindex", "-1");
        m.set(e.element(), "tabindex", "-1");
        m.set(f.element(), "tabindex", "-1");
        n.add(l, B.resolve(b + "-stepper-input"));
        n.add(k, B.resolve(b + "-stepper-options"));
        n.add(e.element(), B.resolve("stepper-button"));
        e.content(bf([B.resolve(b + "-stepper-increase")]));
        n.add(f.element(), B.resolve("stepper-button"));
        f.content(bf([B.resolve(b + "-stepper-decrease")]));
        y.append(l, q);
        P.append(k, [e.element(), f.element()]);
        P.append(a, [l, k]);
        e.events.click.bind(function () {
            Z.focus(e.element());
            d.trigger.plus()
        });
        f.events.click.bind(function () {
            Z.focus(f.element());
            d.trigger.minus()
        });
        var C = function () {
            q.dom().setSelectionRange(0, fa.get(q).length)
        }, w = K.capture(a, "click", function (a) {
            N.eq(a.target(), l) && J.enter()
        }), J = JX(), G = n.toggler(q, B.resolve("invalid-" + b + "-size"));
        return {
            destroy: function () {
                e.destroy();
                f.destroy();
                J.destroy();
                w.unbind();
                F.remove(q)
            }, highlight: function () {
                G.on();
                m.set(q, "title", x.translate("aria.stepper.input.invalid"));
                ib.shout(q, x.translate("aria.stepper.input.invalid"))
            },
            dehighlight: function () {
                G.off();
                m.remove(q, "title")
            }, input: h(q), focus: function () {
                Z.focus(q);
                C()
            }, enter: J.enter, exit: J.exit, initLayout: function () {
                var b = ha.single(q, [ea.basic(R.ENTER()[0], function () {
                    d.trigger.validate();
                    return g.some(!0)
                })], g.none());
                b.events.enter.bind(C);
                var c = Ba.button({
                    execute: function (a) {
                        a.dom().click();
                        Z.focus(a);
                        return g.some(a)
                    }
                });
                b = ha.multiple(a, [b, ha.button(e.element(), c), ha.button(f.element(), c)]);
                b.events.exit.bind(function () {
                    A.parent(l).each(Z.focus);
                    d.trigger.abort()
                });
                J.set(b)
            }, events: d.registry
        }
    }

    function Gm(a) {
        var b = LX(a), c = T.div(), d = KX(c, b);
        n.add(c, B.resolve(b.cssNamespace() + "-size-widget"));
        var e = function () {
            return fa.get(d.input())
        }, f = function (a) {
            var b = e();
            a = a(b);
            a = Vf.sanitise(a);
            fa.set(d.input(), a);
            k.trigger.action(a);
            d.dehighlight()
        };
        d.events.validate.bind(function (a) {
            a = e();
            Vf.validate(a, b.tag(), b.property()).fold(function () {
                d.highlight()
            }, function (a) {
                fa.set(d.input(), a);
                k.trigger.action(a);
                d.dehighlight();
                k.trigger.close()
            })
        });
        d.events.plus.bind(function (a) {
            f(u(Bm.increase,
                b.specials()))
        });
        d.events.minus.bind(function (a) {
            f(u(Bm.decrease, b.specials()))
        });
        var k = H.create({close: p([]), action: p(["value"]), abort: Q([], d.events.abort)}),
            l = K.bind(c, "click", function (a) {
                (N.eq(a.target(), c) || N.eq(a.target(), d.input())) && d.enter()
            });
        return {
            element: h(c),
            input: d.input,
            getCurrentValue: e,
            focus: d.focus,
            enter: d.enter,
            initLayout: d.initLayout,
            destroy: function () {
                l.unbind();
                d.destroy();
                F.remove(c)
            },
            updateInlineWidget: function (a, e) {
                var f = function (a) {
                    Vf.validate(a, b.tag(), b.property()).each(function (a) {
                        fa.set(d.input(),
                            a);
                        d.dehighlight()
                    })
                };
                a.size().fold(function () {
                    f(e);
                    n.add(c, B.resolve("default-" + b.cssNamespace() + "-size"))
                }, t, function (a) {
                    f(a);
                    n.remove(c, B.resolve("default-" + b.cssNamespace() + "-size"))
                })
            },
            open: t,
            close: t,
            events: k.registry
        }
    }

    function MX(a, b, c, d) {
        var e = c();
        c = td.okCancel("font-size");
        var f = we(b), k = null, l = H.create({close: p([]), open: p([]), analytics: p(["message"]), ok: p(["value"])});
        b = function () {
            k.unbind();
            f.hide();
            l.trigger.close()
        };
        f.setTitle(x.translate("font.size"));
        f.setContent(e.element());
        f.setControls(c.element());
        f.events.close.bind(b);
        c.events.ok.bind(function () {
            l.trigger.ok(e.getCurrentValue())
        });
        c.events.cancel.bind(b);
        n.add(f.element(), B.resolve("widget-dialog"));
        return {
            show: function () {
                f.show();
                var b = r.fromDom(window);
                k = K.bind(b, "orientationchange", function () {
                    a.foreground()
                });
                l.trigger.open()
            }, element: f.element, contents: e, events: l.registry, destroy: function () {
                f.hide();
                f.destroy();
                e.destroy()
            }
        }
    }

    function NX(a, b) {
        var c = a.content(), d = a.undo(), e = {}, f = function (a) {
                return E(a.split(/,\s?/g), function (a) {
                    return a.trim().replace(/^['"](.*)['"]$/,
                        "$1")
                }).join(",")
            }, k = (0 === b.faces.length ? g.none() : g.some(b.faces)).fold(xA.faces, function (a) {
                return E(a, function (a) {
                    var b = f(a.value);
                    e[b] = a.value;
                    return Oh.face(x.raw(a.text), b, g.none())
                })
            }), l = aa.detect().deviceType.isiOS(), q = H.create({analytics: p(["message", "properties"])}),
            C = g.some(Xy.face), w = function (a) {
                var b = f(a);
                a = qa(k, function (a) {
                    return a.value() === b
                });
                var c = Oh.face(x.raw(b), b, g.none());
                return a.getOr(c)
            }, J = l ? OX : PX;
        l = tX(a, b);
        return {
            ui: wb.ui({
                "fontface.dropdown": h({
                    name: "fontface", textkey: x.key("font.face"),
                    menuTextkey: x.key("font.menu"), updateDropdown: function (b) {
                        var c = QX.face(a.selections()).map(w);
                        b.populate([{label: g.none, items: h(k)}]);
                        cm.updateMenu(b, c, Da.on(), k, C)
                    }, action: function (b) {
                        b = e.hasOwnProperty(b) ? e[b] : b;
                        Uf.face(c, d, a.selections(), b)
                    }, values: k, render: C, describe: function (a) {
                        return x.translate("font.describe", x.get(a.textkey()))
                    }, hasPopup: !0
                }), "fontcolor.widget": function (c) {
                    return RX.widget(a, b)
                }, "fontsize.widget": function (b) {
                    return J.widget(a, b)
                }, "fontsize.general": l.general
            }, ca), events: q.registry,
            destroy: t
        }
    }

    function yA(a, b, c) {
        var d = iA(a, b, c);
        S.tabList(d.menu());
        E(d.tabs(), function (a) {
            var b = '.ephox-pastry-tablayout-content[data-ephox-pastry-tablayout-view="' + a.name() + '"]';
            m.set(a.element(), "tabindex", "-1");
            n.add(a.element(), B.resolve("tab-button"));
            L.descendant(d.body(), b).each(function (b) {
                var c = Ha("ephox-aria");
                m.set(a.element(), "id", c);
                S.tabButton(a.element(), a.name());
                S.tabPanel(b);
                S.linkTabToPanel(a.element(), b);
                S.labelledBy(b, c)
            })
        });
        return {
            element: d.element, tabs: d.tabs, body: d.body, menu: d.menu,
            destroy: d.destroy, events: d.events
        }
    }

    function SX(a) {
        var b = 2 === cb(a.integration).length, c = Wf.aboutTags(b, a.integration);
        return {
            content: function (a) {
                return hb(c, function (a, b) {
                    return a.replace(b.str(), b.replace())
                }, a)
            }, dom: b ? function (a) {
                L.descendant(a, ".ephox-polish-help-integration").each(function (a) {
                    v.set(a, "display", "block")
                })
            } : t
        }
    }

    function Lj(a, b, c) {
        var d = g.none(), e = g.none(), f = TX(c), k = function (a, c) {
            c = b.content(c.trim());
            d = g.some(c);
            l(a, c)
        }, l = function (a, c) {
            c = r.fromHtml(c.trim());
            b.dom(c);
            F.empty(a);
            n.remove(a,
                B.resolve("tablayout-loading"));
            q(c);
            var d = r.fromTag("div");
            S.document(d);
            y.append(d, c);
            y.append(a, d)
        }, q = function (a) {
            w();
            e = L.descendant(a, ".ephox-license-link").map(function (a) {
                return K.bind(a, "click", function (a) {
                    window.open(f, "", "height=700,width=620,resizable=yes,scrollbars=yes")
                })
            })
        }, h = function (b) {
            a.get(function (a) {
                a.fold(function (a) {
                    b("&nbsp;");
                    console.error("Unable to download help article", a)
                }, b)
            })
        }, w = function () {
            e.each(function (a) {
                a.unbind()
            })
        };
        return {
            render: function (a) {
                d.fold(function () {
                    n.add(a,
                        B.resolve("tablayout-loading"));
                    h(u(k, a))
                }, function (b) {
                    l(a, b)
                })
            }, destroy: function () {
                w()
            }
        }
    }

    function UX(a) {
        var b = {content: ca, dom: t}, c = aa.detect();
        if (!0 === a.source) {
            var d = a.baseUrl + "/help/" + qf.get() + "/";
            d = {
                about: Ae.get(d + "about.html", Be.text(), he.xhr()),
                accessibility: Ae.get(d + "accessibility.html", Be.text(), he.xhr()),
                a11ycheck: Ae.get(d + "a11ycheck.html", Be.text(), he.xhr()),
                markdown: Ae.get(d + "markdown.html", Be.text(), he.xhr()),
                shortcuts: Ae.get(d + "shortcuts.html", Be.text(), he.xhr())
            }
        } else d = VX(a.baseUrl +
            "/help_" + qf.get() + ".js?" + Wf.resourceParam());
        c = !c.deviceType.isTouch();
        a = [Mj(c, Sg(x.translate("help.dialog.shortcuts"), Lj(d.shortcuts, b, a))), Mj(c, Sg(x.translate("help.dialog.accessibility"), Lj(d.accessibility, b, a))), Mj(!0, Sg(x.translate("help.dialog.markdown"), Lj(d.markdown, b, a))), Mj(c, Sg(x.translate("help.dialog.a11ycheck"), Lj(d.a11ycheck, b, a))), Mj(!0, Sg(x.translate("help.dialog.about"), Lj(d.about, SX(a), a)))];
        return ee(a)
    }

    function WX(a, b) {
        var c = H.create({close: p([])}), d = we(a), e = UX(b), f = yA(or.left(),
            e, "help");
        m.set(f.body(), "tabindex", "-1");
        n.add(d.element(), B.resolve("help-modal"));
        a = A.children(f.element());
        z(a, Vc.register);
        d.setTitle(x.translate("cog.help"));
        d.setContent(f.element());
        var k = XX(f);
        a = YX(f);
        var l = ha.multiple(d.element(), [k, a]);
        f.events.setActive.bind(function (a) {
            k.clickFocus(a.item().element())
        });
        var q = function () {
            d.hide()
        };
        d.events.close.bind(function () {
            l.exit();
            q()
        });
        l.events.exit.bind(function () {
            q();
            c.trigger.close()
        });
        return {
            element: d.element, open: function () {
                d.show();
                l.enter()
            },
            destroy: function () {
                f.destroy();
                d.destroy();
                l.destroy();
                z(e, function (a) {
                    a.renderer().destroy()
                })
            }, hide: q, events: c.registry
        }
    }

    function ZX(a, b) {
        var c = WX(a, b), d = function () {
            e.trigger.analytics("help_screen_hide");
            e.trigger.close();
            f()
        }, e = H.create({close: p([]), analytics: p(["message"])});
        c.events.close.bind(d);
        var f = function () {
            c.events.close.unbind(d);
            c.destroy()
        };
        return {
            show: function () {
                e.trigger.analytics("help_screen_show");
                c.open()
            }, destroy: f, events: e.registry
        }
    }

    function $X(a, b) {
        var c = a.content(), d = a.smartview(),
            e = a.shortcuts(), f = H.create({analytics: p(["message"])}), k = hd.destroyable(), l = function () {
                var e = ZX(d.uiContainer(), b);
                k.set(e);
                e.events.close.bind(function () {
                    c.toEditing();
                    k.clear()
                });
                e.events.analytics.bind(function (a) {
                    f.trigger.analytics(a.message())
                });
                c.toReading();
                a.content().hideInlineSelection();
                e.show()
            };
        e.events.help.bind(l);
        return {
            ui: wb.ui({
                "help.general": {
                    toggle: !1,
                    value: "help",
                    textkey: x.key("cog.help"),
                    action: l,
                    updateGeneral: t,
                    icon: !0,
                    hasPopup: !1,
                    hasDialog: !0,
                    tooltip: qb.get
                }
            }), events: f.registry,
            destroy: function () {
                k.clear()
            }
        }
    }

    function aY(a, b, c) {
        var d = a.filter(), e = a.content(), f = a.operations();
        rf.configure(d);
        var k = void 0 === c.external ? [] : E(c.external, function (a) {
            return bY(a.prefix, a.suffix, a.style)
        });
        z(k, function (a) {
            var c = $x(a.prefix(), a.suffix(), function (b) {
                var c = r.fromTag("span");
                ma.add(c, [rf.highlightClass()]);
                v.setAll(c, a.style());
                var d = r.fromTag("div");
                y.append(c, r.fromText(a.prefix() + b + a.suffix()));
                y.append(d, c);
                return Ea.get(d)
            });
            b.customMacros().add(c)
        });
        a = function (a) {
            e.getSelection().each(function (b) {
                a.prev().each(function (a) {
                    L.ancestor(a,
                        "." + rf.placeholderClass()).each(function (a) {
                        zA.rehighlight(f, k, a)
                    })
                });
                L.ancestor(b.startContainer(), "." + rf.highlightClass()).each(function (a) {
                    zA.unhighlight(f, a)
                })
            })
        };
        return 0 < k.length ? (e.events.nodeChanged.bind(a), {
            run: function () {
                cY.run(e, k)
            }, destroy: t
        }) : {run: t, destroy: t}
    }

    function dY(a) {
        var b = a.content();
        return {
            ui: wb.ui({
                "horizontalrule.general": {
                    toggle: !1, value: "horizontalrule", textkey: x.key("insert.horizontalrule"), action: function () {
                        sd.insertAtCursor(b, [r.fromTag("hr")]).each(function (a) {
                            a = la.after(a.element());
                            b.setRelativeSelection(a, a);
                            b.toEditing()
                        })
                    }, updateGeneral: t, icon: !0, shortcut: !1, hasPopup: !1
                }
            }), destroy: t
        }
    }

    function AA(a) {
        var b = B.resolve("dialog-float-selected"), c = r.fromTag("fieldset");
        m.set(c, "role", "radiogroup");
        a = r.fromHtml("<legend>" + x.translate(a) + "</legend>");
        var d = Ha("ephox-aria");
        m.set(a, "id", d);
        m.set(c, "aria-labelledby", d);
        var e = T.div();
        n.add(e, B.resolve("dialog-float-options"));
        P.append(c, [a, e]);
        var f = function () {
            z(k, function (a) {
                n.remove(a.element(), b);
                ra.checked(a.element(), !1)
            })
        }, k = E(["none",
            "center", "left", "right"], function (a) {
            var c = Oc(), d = x.translate("align." + a);
            m.setAll(c.element(), {tabindex: "-1", "data-float-value": a, title: d, "aria-label": d, role: "radio"});
            a = T.div();
            d = T.div();
            var e = T.div(), k = T.div();
            S.hidden(a, !0);
            n.add(d, B.resolve("dialog-float-icon-inner-left"));
            n.add(e, B.resolve("dialog-float-icon-inner-center"));
            n.add(k, B.resolve("dialog-float-icon-inner-right"));
            P.append(a, [d, e, k]);
            c.events.click.bind(function () {
                f();
                n.add(c.element(), b);
                ra.checked(c.element(), !0);
                Z.focus(c.element())
            });
            n.add(c.element(), B.resolve("dialog-float-container"));
            n.add(a, B.resolve("dialog-float-icon"));
            y.append(c.element(), a);
            return c
        });
        P.append(e, E(k, function (a) {
            return a.element()
        }));
        var l = Kb.radio(c, "." + B.resolve("dialog-float-container"), "." + B.resolve("dialog-float-selected"));
        return {
            element: function () {
                return c
            }, get: function () {
                return L.child(e, "." + b).map(function (a) {
                    return m.get(a, "data-float-value")
                })
            }, select: function (a) {
                f();
                a.each(function (a) {
                    L.child(e, 'span[data-float-value="' + a + '"]').or(A.firstChild(e)).each(function (a) {
                        n.add(a,
                            b);
                        ra.checked(a, !0)
                    })
                });
                l.refresh()
            }, keylayout: h(l), destroy: function () {
                z(k, function (a) {
                    a.destroy()
                })
            }
        }
    }

    function eY() {
        var a = T.div(), b = T.div(), c = T.div(), d = T.div();
        n.add(c, B.resolve("image-url-controls"));
        n.add(d, B.resolve("image-size-controls"));
        var e = AA("image.dialog.fields.align"), f = Wc.input("image-url", "image.dialog.fields.url"),
            k = Wc.input("image-alt", "image.dialog.fields.alt"),
            l = Wc.input("image-width", "image.dialog.fields.width"),
            q = Wc.input("image-height", "image.dialog.fields.height"), C = r.fromTag("input");
        m.set(C, "type", "hidden");
        var w = $d("lock");
        n.add(w.element(), B.resolve("dialog-button"));
        var J = bf([B.resolve("icon"), B.resolve("image-lock-button")]);
        m.set(w.element(), "title", x.translate("image.dialog.fields.constrain.on"));
        S.toolbarButton(w.element(), x.translate("image.dialog.fields.constrain.label"), !1, !0);
        ra.press(w.element());
        w.select();
        w.content(J);
        w.events.click.bind(function () {
            Z.focus(w.element());
            var a = w.selected() ? "on" : "off";
            m.set(w.element(), "title", x.translate("image.dialog.fields.constrain." +
                a));
            (w.selected() ? ra.press : ra.release)(w.element())
        });
        J = T.div();
        n.add(J, B.resolve("form-group"));
        n.add(J, B.resolve("form-group-lock"));
        var G = r.fromHtml("<label>" + x.translate("image.dialog.fields.constrain.label") + "</label>"),
            V = "constrain" + Ha("");
        m.set(w.element(), "id", V);
        m.set(G, "for", V);
        var X = function (a) {
            a.isLocal() ? (m.set(f.input(), "disabled", "disabled"), fa.set(f.input(), x.translate("image.dialog.fields.urllocal"))) : (m.remove(f.input(), "disabled"), fa.set(f.input(), a.url()))
        }, p = function (a, b, c) {
            var d =
                parseFloat(fa.get(C));
            a = fa.get(a);
            fa.set(b, c(d, a).getOrThunk(function () {
                return fa.get(b)
            }));
            Mc.dehighlight(b)
        };
        V = function (a) {
            Mc.validateField(a.target(), "width", g.some("px")).fold(function () {
                Mc.highlight(a.target())
            }, function (b) {
                Mc.dehighlight(a.target());
                b = a.target();
                w.selected() && (N.eq(b, l.input()) ? p(l.input(), q.input(), tr.fromWidth) : N.eq(b, q.input()) && p(q.input(), l.input(), tr.fromHeight))
            })
        };
        var t = function (a) {
                if (m.has(a.target(), "placeholder")) {
                    var b = m.get(a.target(), "placeholder");
                    "" === fa.get(a.target()) &&
                    fa.set(a.target(), b)
                }
            }, v = K.bind(l.input(), "input", V), z = K.bind(q.input(), "input", V), y = K.bind(l.input(), "focus", t),
            A = K.bind(q.input(), "focus", t);
        P.append(J, [G, w.element()]);
        P.append(b, [e.element()]);
        P.append(c, [f.element(), k.element()]);
        P.append(d, [l.element(), q.element(), J]);
        P.append(a, [c, d, b]);
        b = [ha.input(f.input(), Ba.input({})), ha.input(k.input(), Ba.input({})), ha.input(l.input(), Ba.input({})), ha.input(q.input(), Ba.input({})), ha.button(w.element(), Ba.button({execute: Kb.button})), e.keylayout()];
        return {
            element: h(a),
            destroy: function () {
                w.destroy();
                v.unbind();
                z.unbind();
                y.unbind();
                A.unbind();
                e.destroy()
            }, dehighlight: u(Mc.clearHighlights, a), highlight: Mc.highlight, keylayouts: h(b), set: function (a) {
                X(a);
                fa.set(k.input(), a.alt());
                fa.set(l.input(), a.width());
                fa.set(q.input(), a.height());
                var b = a.computedWidth().bind(function (b) {
                    return a.computedHeight().bind(function (a) {
                        return tr.calculate(b, a)
                    })
                }).getOr(1);
                a.computedWidth().each(u(m.set, l.input(), "placeholder"));
                a.computedHeight().each(u(m.set, q.input(), "placeholder"));
                fa.set(C, b);
                e.select(a.align())
            }, get: function () {
                return Mc.validate([Mc.rule(l.input(), "width", g.some("px")), Mc.rule(q.input(), "height", g.some("px"))]).map(function (a) {
                    return Hm.properties({
                        url: fa.get(f.input()),
                        alt: fa.get(k.input()),
                        width: a.width(),
                        height: a.height(),
                        isLocal: m.has(f.input(), "disabled"),
                        align: e.get()
                    })
                })
            }
        }
    }

    function fY(a) {
        var b = H.create({ok: p(["image", "properties"]), close: p([])}), c = na(g.none()), d = we(a),
            e = td.okCancel("image-properties"), f = eY();
        d.setContent(f.element());
        n.add(d.element(),
            B.resolve("dialog-narrow"));
        a = function () {
            var a = f.get();
            f.dehighlight();
            a.fold(function (a) {
                f.highlight(a)
            }, function (a) {
                c.get().each(function (c) {
                    b.trigger.ok(c, a)
                })
            })
        };
        e.events.ok.bind(a);
        e.events.cancel.bind(function () {
            d.hide();
            b.trigger.close()
        });
        d.setTitle(x.translate("image.dialog.title"));
        d.setControls(e.element());
        d.events.close.bind(function () {
            b.trigger.close()
        });
        var k = Kb.setup(d, e, f.keylayouts());
        return {
            element: d.element, open: function () {
                d.show();
                k.enter()
            }, hide: function () {
                k.exit();
                d.hide()
            },
            destroy: function () {
                d.destroy();
                k.destroy();
                e.destroy();
                f.destroy()
            }, represent: function (a) {
                var b = Hm.divine(a);
                c.set(g.some(a));
                f.set(b)
            }, execute: a, events: b.registry
        }
    }

    function gY(a, b) {
        b = BA.image(a.content());
        var c = H.create({changed: p(["image"]), contextmenu: Q(["image"], b.events.contextmenu)}), d = function (b) {
            var d = a.content(), e = fY(a.smartview().uiContainer()),
                l = CA.generate(a.keyboard(), e, ["image", "properties"]);
            l.events.ok.bind(function (a) {
                Hm.apply(a.image(), a.properties());
                c.trigger.changed(a.image());
                l.destroy();
                d.domChanged();
                d.focus();
                d.uiChanged()
            });
            l.events.close.bind(function (a) {
                l.destroy();
                d.focus()
            });
            l.represent(b);
            l.open()
        };
        b.events.properties.bind(function (a) {
            d(a.image())
        });
        return {destroy: t, situation: b.situation, handle: b.handle, assign: b.assign, events: c.registry}
    }

    function hY(a) {
        var b = function (b) {
            return Ae.get(b, Be.blob(), he.xhr(), a.newHeaders())
        }, c = function (a) {
            return !(ur.local(a) || ur.sameDomain(a, String(Xf.location)))
        };
        return {
            getImage: function (d) {
                var e = m.get(d, "src");
                return (c(e) ? a.proxy(e) :
                    g.none()).fold(function () {
                    return Ua.fromPromise(Nj.imageToBlob(d.dom()))
                }, b)
            }
        }
    }

    function iY(a, b, c) {
        var d = g.none();
        return {
            setTarget: function (a) {
                d = g.some(a)
            }, clearTarget: function () {
                d = g.none()
            }, mutate: function (e, f) {
                d.each(function (d) {
                    var k = Fb.delta({top: f, left: e}), q = Ug.updatePosition(c, function (b) {
                        return d(a, b, k)
                    });
                    Ug.drawAtOrigin(c, a);
                    b.update(q)
                })
            }
        }
    }

    function jY(a) {
        var b = H.create({reposition: p(["direction", "delta"])}), c = Yf("top", "n", g.none()),
            d = Yf("bottom", "s", g.none()), e = Yf("right", "e", g.none()), f =
                Yf("left", "w", g.none()), k = Yf("top-left", "nw", g.some(a("image.crop.handle.nw"))),
            l = Yf("top-right", "ne", g.some(a("image.crop.handle.ne"))),
            q = Yf("bottom-right", "se", g.some(a("image.crop.handle.se"))),
            C = Yf("bottom-left", "sw", g.some(a("image.crop.handle.sw"))), w = lf.nu(function (a) {
                setTimeout(function () {
                    v.reflow(c);
                    var b = Ia.get(c), d = sa.get(c);
                    a(h(3 * b + 2 * d))
                }, 0)
            }), J = b.trigger.reposition;
        a = [c, d, e, f, l, k, q, C];
        J = [ha.single(k, Oj.navigation("nw", J), g.none()), ha.single(l, Oj.navigation("ne", J), g.none()), ha.single(q,
            Oj.navigation("se", J), g.none()), ha.single(C, Oj.navigation("sw", J), g.none())];
        return {
            elements: h(a), keylayouts: h(J), events: b.registry, refresh: function (a, b) {
                a = DA.calculate(a, b);
                Zf(c, a.n());
                Zf(d, a.s());
                Zf(e, a.e());
                Zf(f, a.w());
                Zf(k, a.nw());
                Zf(C, a.sw());
                Zf(q, a.se());
                Zf(l, a.ne());
                w.get(function (a) {
                    EA([c, d], b.width, a);
                    EA([e, f], b.height, a)
                })
            }
        }
    }

    function kY() {
        var a = Im("left"), b = Im("top"), c = Im("right"), d = Im("bottom");
        return {
            elements: h([a, b, c, d]), refresh: function (e, f) {
                e = lY.derive(e, f);
                Jm(a, e.leftRim());
                Jm(b, e.topRim());
                Jm(c, e.rightRim());
                Jm(d, e.bottomRim())
            }
        }
    }

    function mY(a, b, c, d) {
        var e = r.fromTag("div");
        n.add(e, FA.magicBox());
        Vg.base(e, d("image.crop.begin"));
        Km.effect(e, "execute");
        var f = r.fromTag("div");
        m.set(f, "role", "row");
        var k = kY(), l = jY(d), q = function (a) {
            v.setAll(e, {top: a.top() + "px", left: a.left() + "px"})
        };
        d = function (b) {
            var c = a();
            q(c);
            k.refresh(c, b);
            l.refresh(c, b);
            C.trigger.updated(b)
        };
        P.append(f, Qb([k.elements(), [b], l.elements()]));
        y.append(e, f);
        var C = H.create({
            updated: p(["newBounds"]), reposition: Q(["direction",
                "delta"], l.events.reposition)
        });
        d(c);
        b = l.keylayouts();
        return {
            element: h(e), bitsbox: h(f), keylayouts: h(b), move: q, update: d, destroy: function () {
                F.remove(e)
            }, events: C.registry, tryMovement: function (a) {
                return L.closest(a, "." + tb.resolve("corner-wrapper")).bind(function (a) {
                    a = m.get(a, "data-" + tb.resolve("direction"));
                    return void 0 !== Lm[a] ? g.some(Lm[a]) : g.none()
                })
            }
        }
    }

    function nY(a, b, c, d) {
        var e = r.fromTag("div");
        ma.add(e, [tb.resolve("panel-central"), tb.resolve("side-panel")]);
        m.set(e, "tabindex", "-1");
        Vg.cell(e, d("image.crop.handle.shade"));
        Km.grab(e, !1);
        var f = oY(a());
        Ug.writePosition(e, f);
        Ug.drawAtOrigin(e);
        var k = mY(a, e, f, d);
        y.append(b, k.element());
        var l = iY(a(), k, e), q = tj.transform(l), C = K.bind(e, "dblclick", function () {
            t.trigger.apply()
        }), w = pY.bind(k.element(), function (a) {
            k.tryMovement(a).orThunk(function () {
                return L.closest(a, "." + tb.resolve("panel-central")).map(function () {
                    return Lm.translate
                })
            }).each(J)
        }), J = function (a) {
            q.off();
            l.clearTarget();
            l.setTarget(a);
            q.on();
            q.go(c)
        }, G = function (b, c) {
            var d = Ug.updatePosition(e, function (d) {
                return Lm[b](a(),
                    d, c)
            });
            Ug.drawAtOrigin(e);
            k.update(d)
        };
        d = Qb([k.keylayouts(), [ha.single(e, Oj.navigation("translate", G), g.none())]]);
        var V = function () {
            var c = a();
            return K.bind(A.defaultView(b), "resize", function () {
                var b = a();
                if (b.height() !== c.height() || b.width() !== c.width()) t.trigger.cancel(); else if (b.top() !== c.top() || b.left() !== c.left()) k.move(b), c = b
            })
        }();
        f = function (a) {
            return function () {
                Z.active(A.owner(b)).each(function (b) {
                    Km.grab(b, a)
                })
            }
        };
        var X = f("true"), n = f("false");
        z(d, function (a) {
            a.events.enter.bind(X);
            a.events.exit.bind(n)
        });
        k.events.reposition.bind(function (a) {
            G(a.direction(), a.delta())
        });
        var t = H.create({updated: Q(["newBounds"], k.events.updated), apply: p([]), cancel: p([])});
        return {
            element: k.element, keylayouts: h(d), destroy: function () {
                q.destroy();
                V.unbind();
                w.unbind();
                C.unbind();
                k.destroy()
            }, boxes: function () {
                return {box: a, magic: k.element, shade: h(e)}
            }, get: function () {
                return Ug.readPosition(e)
            }, events: t.registry
        }
    }

    function qY(a, b, c, d, e) {
        var f = u(rY, a), k = nY(f, b, c, e);
        return {
            element: k.element, keylayouts: k.keylayouts, crop: function () {
                var b =
                    k.get();
                var c = Ia.get(a), e = sa.get(a);
                b = sY({
                    cropX: b.left(),
                    cropY: b.top(),
                    cropWidth: b.width(),
                    cropHeight: b.height(),
                    displayWidth: c,
                    displayHeight: e
                });
                return d.animate(k.boxes().magic(), a, k.boxes(), b)
            }, destroy: function () {
                k.destroy()
            }, events: k.events
        }
    }

    function tY(a) {
        var b = a.content(), c = H.create({ok: p(["cropAction", "image", "cleanup"])}), d = hd.value(), e = hd.value(),
            f = function (a) {
                var f = b.body().getOrDie();
                ib.speak(ja.body(), x.translate("image.crop.announce"));
                var k = A.documentElement(a), g = qY(a, k, k, uY.slide(),
                    x.translate), h = jf(function (a, b) {
                    ib.speak(ja.body(), x.translate("aria.image.crop.size", a, b))
                }, 500);
                g.events.updated.bind(function (a) {
                    a = a.newBounds();
                    h.throttle(a.width(), a.height())
                });
                var J = function () {
                    d.clear();
                    r.exit();
                    r.destroy();
                    t.unbindAll();
                    p.clear()
                }, G = function () {
                    J();
                    e.clear();
                    g.destroy()
                }, m = function () {
                    G();
                    ie.select(b, a)
                }, X = function () {
                    J();
                    g.crop().get(function (b) {
                        p.clear();
                        ib.speak(ja.body(), x.translate("image.crop.apply"));
                        var d = Wg.crop(b.cropX(), b.cropY(), b.cropWidth(), b.cropHeight()), e = vr.changedBounds(a);
                        c.trigger.ok(function (a) {
                            return Fj.resampleAction(e, a, d)
                        }, a, function (a) {
                            G();
                            return a
                        })
                    })
                };
                d.set(X);
                e.set(G);
                vY(b, a);
                var n = function () {
                    ib.speak(ja.body(), x.translate("image.crop.cancel"));
                    m()
                }, p = hd.unbindable();
                setTimeout(function () {
                    p.set(K.bind(f, "focus", function (a) {
                        n()
                    }))
                });
                var r = ha.inlineDialog(k, g.keylayouts(), Ba.inlineDialog({ok: X, cancel: n}));
                r.enter();
                var t = Ql.create();
                t.bind(b.events.domChanged, m);
                t.bind(b.events.nodeChanged, function (a) {
                    ja.inBody(a.node()) && m()
                });
                t.bind(g.events.apply, X);
                t.bind(g.events.cancel,
                    m)
            };
        return {
            apply: function () {
                d.on(xb)
            }, open: function () {
                vc.detect(b.getSelection()).each(function (a) {
                    f(a.image())
                })
            }, destroy: function () {
                e.on(xb)
            }, isActive: d.isSet, events: c.registry
        }
    }

    function wY(a) {
        a = xY.parse(a.preferredWidth, a.preferredHeight);
        var b = a.fold(yY, Fj.instance), c = a.fold(zY, function () {
            return AY(b)
        });
        return {
            assets: function (a) {
                return Ce(a, b)
            }, correlated: function (a) {
                return Ce(a, c)
            }
        }
    }

    function BY(a, b, c) {
        var d = hY(a.communication()), e = nr(a.ui), f = a.content(), k = function (c) {
            return function (d) {
                d.fold(function (a) {
                    a =
                        wr.diagnoseImageEdit(a, m.get(c, "src"));
                    e.show(a.bannerMessage());
                    console.error("Image edit operation failed: ", a.consoleMessage())
                }, function (c) {
                    b.uploadAssets([c]);
                    f.focus();
                    a.undo().save();
                    f.domChanged()
                });
                ie.select(f, c);
                return d
            }
        }, l = function (b, c) {
            a.undo().save();
            var e = xr.applyEdit(b);
            return xr.run(d, c, e)(b)
        }, q = tY(a);
        q.events.ok.bind(function (a) {
            var b = a.image(), c = a.cropAction();
            a = a.cleanup();
            var d = sf.updater(sf.keepCrop, b);
            l(b, c).map(d).map(a).get(k(b))
        });
        var g = function () {
                return vc.detectForEditing(f.getSelection(),
                    f.imageExcludes)
            }, w = function (a, b) {
                return function () {
                    g().each(function (c) {
                        c = c.image();
                        var d = ca, e = sf.updater(b, c);
                        l(c, a).map(e).map(d).get(k(c))
                    })
                }
            },
            J = [Ph.make("crop-begin", "image.crop.begin", q.open), Ph.make("rotate-left", "image.toolbar.rotateleft", w(Wg.rotateLeft, sf.keepRotate)), Ph.make("rotate-right", "image.toolbar.rotateright", w(Wg.rotateRight, sf.keepRotate)), Ph.make("flip-horizontal", "image.toolbar.fliphorizontal", w(Wg.flipHorizontal, sf.keepFlip)), Ph.make("flip-vertical", "image.toolbar.flipvertical",
                w(Wg.flipVertical, sf.keepFlip))], G = [Ph.make("crop-apply", "image.crop.apply", q.apply)];
        w = wb.ui({
            "edit.palette": u(GA.edit, a.ui().refresh, g, q.isActive, J),
            "crop.palette": u(GA.crop, a.ui().refresh, q.isActive, G)
        }, ca);
        J = BA.imageEdit(q.isActive, G, J, f.imageExcludes);
        c = wY(c);
        return {
            destroy: function () {
                q.destroy()
            },
            ui: w,
            insertResample: h(c),
            situation: J.situation,
            handle: J.handle,
            assign: J.assign,
            name: h("imageEdit")
        }
    }

    function CY(a, b) {
        var c = B.resolve("cursor-pointer"), d = b.os.isOSX(), e = g.none(), f = function (b) {
            return a.isInline() ?
                bb.absolute(b).top() : 0
        }, k = function (b) {
            var c = m.get(b, "href");
            if ("top" === m.get(b, rb.bookmarkAnchorDataAttr())) a.doc().each(function (b) {
                a.body().each(function (a) {
                    var c = Za.get(b);
                    Za.to(c.left(), f(a), b)
                })
            }); else if ("bottom" === m.get(b, rb.bookmarkAnchorDataAttr())) a.win().each(function (b) {
                a.doc().each(function (c) {
                    a.body().each(function (a) {
                        var d = f(a), e = Za.get(c);
                        a = d + sa.get(a) - b.innerHeight;
                        Za.to(e.left(), a, c)
                    })
                })
            }); else if (/^#/.test(c)) {
                var d = c.substr(1);
                a.body().each(function (b) {
                    Ld.anchorTarget(b, d).each(function (b) {
                        a.win().each(function (a) {
                            Za.setToElement(a,
                                b)
                        })
                    })
                })
            } else window.open(c)
        }, l = function (a, b) {
            var c = d ? R.META() : R.CTRL();
            U(c, a) && b()
        };
        b = r.fromDom(window);
        var q = g.none();
        a.events.ready.bind(function (a) {
            a = a.api().body();
            var b = tm.handle(a, function (a) {
                var b = a.target();
                (d ? a.raw().metaKey : a.raw().ctrlKey) && L.closest(b, "a[href]").each(function (b) {
                    a.prevent();
                    k(b)
                })
            });
            q = g.some(b);
            e = g.some(n.toggler(a, c))
        });
        var h = function () {
            e.each(function (a) {
                a.on()
            })
        }, w = function () {
            e.each(function (a) {
                a.off()
            })
        }, J = function (a) {
            l(a.original().raw().which, w)
        };
        a.events.keyup.bind(J);
        var G = K.bind(b, "keyup", function (a) {
            l(a.raw().which, w)
        }), V = function (a) {
            l(a.original().raw().which, h)
        };
        a.events.keydown.bind(V);
        var X = K.bind(b, "keydown", function (a) {
            l(a.raw().which, h)
        });
        return {
            follow: k, destroy: function () {
                q.each(function (a) {
                    a.unbind()
                });
                a.events.keyup.unbind(J);
                a.events.keydown.unbind(V);
                G.unbind();
                X.unbind()
            }
        }
    }

    function DY(a, b, c, d) {
        var e = r.fromTag("div");
        S.dialog(e, x.get(d));
        ma.add(e, [B.resolve("expandable-inline-popup")]);
        d = T.div();
        n.add(d, B.resolve("inline-popup-content"));
        var f = T.div();
        ma.add(f, [B.resolve("inline-popup-content-expand"), Pj]);
        var k = T.div();
        n.add(k, B.resolve("inline-popup-controls"));
        var l = T.div();
        n.add(l, B.resolve("inline-popup-expand-button-wrapper"));
        var q = r.fromTag("span");
        ma.add(q, [B.resolve("inline-popup-expand-button"), B.resolve("icon")]);
        var g = x.translate("aria.label.more");
        m.set(q, "title", g);
        S.button(q, g);
        S.group(f);
        S.linkElements(q, f);
        y.append(l, q);
        g = T.div();
        n.add(g, B.resolve("inline-popup-body"));
        P.append(g, [d, f, l]);
        P.append(e, [g, k]);
        P.append(d, a);
        P.append(f,
            b);
        P.append(k, c);
        n.add(e, Pj);
        var w = "0px", J = function () {
            n.remove(e, Pj);
            n.add(f, B.resolve("expand-close"));
            S.hidden(f, !0);
            v.setAll(f, {opacity: "0", height: "0px", visibility: "hidden"});
            ra.collapsed(q)
        }, G = K.bind(f, "transitionend", function (a) {
            ma.remove(f, [B.resolve("expand-close"), B.resolve("expand-open")])
        }), V = K.bind(q, "click", function (a) {
            n.has(e, Pj) ? J() : (n.add(e, Pj), n.add(f, B.resolve("expand-open")), S.hidden(f, !1), v.setAll(f, {
                opacity: "1",
                height: w,
                visibility: "visible"
            }), ra.expanded(q))
        });
        a = [ha.button(q, Ba.button({execute: Kb.click}))];
        return {
            element: h(e), keylayouts: h(a), destroy: function () {
                F.remove(e);
                V.unbind();
                G.unbind()
            }, show: function () {
                w = sa.getOuter(f) + "px";
                J();
                v.reflow(e);
                n.add(e, B.resolve("enable-transition"))
            }
        }
    }

    function EY(a) {
        var b = FY();
        a.url().each(function (a) {
            fa.set(b.input(), a)
        });
        var c = Wc.input("text-to-display", "link.properties.text.label"), d = na(!1);
        n.add(c.element(), B.resolve("text-to-display"));
        m.setAll(c.input(), {
            placeholder: x.translate("link.properties.text.placeholder"),
            autocomplete: "off",
            autocorrect: "off"
        });
        a.text().each(function (a) {
            fa.set(c.input(),
                a)
        });
        var e = Wc.input("title-text", "link.properties.title.label");
        n.add(e.element(), B.resolve("title-container"));
        m.setAll(e.input(), {
            placeholder: x.translate("link.properties.title.placeholder"),
            autocomplete: "off",
            autocorrect: "off"
        });
        a.title().each(function (a) {
            fa.set(e.input(), a)
        });
        var f = GY.target(a), k = K.bind(c.input(), "input", function () {
            d.set(!0)
        });
        return {
            url: h(b), text: h(c), textChanged: d.get, title: h(e), target: h(f), keylayouts: function () {
                return [ha.input(b.input(), Ba.input({})), ha.input(c.input(), Ba.input({})),
                    ha.input(e.input(), Ba.input({})), ha.button(f.input(), Ba.button({execute: Kb.click, process: t}))]
            }, destroy: function () {
                k.unbind()
            }
        }
    }

    function HY(a) {
        var b = $e(a) ? a : 1E4, c = um.access("local.linkCache");
        a = c.read();
        var d = function (a) {
            return 0 > b - a.length ? a.slice(0, b) : a
        }(Mb(a) ? a : []), e = function (a) {
            d.splice(a, 1)
        }, f = function () {
            return d.slice(0)
        };
        return {
            add: function (a) {
                "#" !== a.charAt(0) && (d.length >= b && d.pop(), Gc(d, a).each(e), d.unshift(a))
            }, state: f, destroy: function () {
                c.write(f())
            }
        }
    }

    function IY(a, b) {
        return {
            position: function (c,
                                d) {
                c = c.isRtl() ? Qh.allRtl() : Qh.all();
                var e = Fh(0, 0);
                d = Lh.element(a, d);
                Mm.simple(d, b, e, c, {})
            }
        }
    }

    function JY(a, b, c, d) {
        var e = H.create({change: p([])}), f = function () {
            var a = b.body().map(Ld.all).getOr([]);
            a = ia(a, function (a) {
                var b = m.get(a, "href");
                return Gb(b, "#") || m.has(a, rb.bookmarkAnchorDataAttr()) ? [] : [b]
            });
            a = d.state().concat(a);
            a = KY(a);
            return E(a, function (a) {
                var b = g.none();
                return LY(a, h(!1), b, t)
            })
        }, k = function (a, b, c) {
            var d = Ld.getAnchorValue(a, jm.generate("textbox-heading"));
            return g.some(HA("#" + d, c, function () {
                m.set(b,
                    "id", d)
            }))
        }, l = function (a) {
            var b = "h1" !== D.name(a), c = Vb.get(a);
            return m.has(a, "id") || m.has(a, "name") ? (a = m.has(a, "id") ? m.get(a, "id") : m.get(a, "name"), g.some(HA("#" + a, b, t))) : 0 === c.trim().length ? g.none() : k(c, a, b)
        }, q = function (a) {
            m.remove(a, rb.bookmarkAnchorDataAttr())
        }, C = function (a) {
            var b = rb.reservedUrls()[a.toLowerCase()];
            return function (a) {
                m.set(a, rb.bookmarkAnchorDataAttr(), b)
            }
        }, w = function () {
            var a = b.body().map(Ld.findLinkTargets).getOr([]), c = 1E3 < a.length;
            a = E(a, function (a) {
                return l(a).map(function (b) {
                    var d =
                        (c ? Ld.linkTargetFastText : Ld.linkTargetText)(50, a);
                    return yr(b.url(), b.indent(), b.action(), d.before(), d.innerText(), d.after())
                })
            });
            a = ee(a);
            var d = C(rb.topAnchorUrl());
            d = yr(rb.topAnchorUrl(), !1, d, "", "\u2014 " + rb.topAnchorUrl() + " \u2014", "");
            var e = C(rb.bottomAnchorUrl());
            e = yr(rb.bottomAnchorUrl(), !1, e, "", "\u2014 " + rb.bottomAnchorUrl() + " \u2014", "");
            return [d].concat(a).concat([e])
        };
        return {
            predict: function (b, d, k) {
                var l = gc(function () {
                    var a = f(), d = w();
                    a = Nm.config({
                        container: c, translate: x.translate, sections: [Nm.section({
                            id: "recent",
                            highlight: "strong",
                            contentLimit: 50,
                            items: a,
                            itemLimit: 10,
                            render: IA.anchors,
                            extractors: [Qj.title, Qj.url]
                        }), Nm.section({
                            id: "anchors",
                            highlight: "strong",
                            contentLimit: 50,
                            items: d,
                            render: IA.standard,
                            extractors: [Qj.innerText, Qj.url]
                        })]
                    });
                    var e = Nm.init(b, a);
                    ma.add(e.element(), [B.resolve("layer-menus"), B.resolve("tarot-inline")]);
                    e.events.click.bind(function (a) {
                        e.hide();
                        J(b, a.item())
                    });
                    a = Ia.get(b);
                    v.setAll(e.element(), {"min-width": a + "px", "box-sizing": "border-box"});
                    return e
                }), h = na(g.none()), J = function (a, b) {
                    var c =
                        b.url();
                    fa.set(a, c);
                    MY && a.dom().click();
                    h.set(g.some(b));
                    e.trigger.change()
                }, G = k.container(b);
                G.swallowKeys([R.UP(), R.DOWN()]);
                G.events.up.bind(function (a) {
                    a.stopper()();
                    a = l();
                    m(a);
                    a.moveup()
                });
                G.events.down.bind(function (a) {
                    a.stopper()();
                    a = l();
                    m(a);
                    a.movedown()
                });
                G.events.escape.bind(function (a) {
                    var b = l();
                    b.isShowing() && (b.hide(), a.stopper()())
                });
                G.events.enter.bind(function (a) {
                    l().getSelectedData().each(function (c) {
                        a.stopper()();
                        var d = l();
                        d.hide();
                        d.reset();
                        J(b, c)
                    })
                });
                G.on();
                var m = function (c) {
                    if (!c.isShowing()) {
                        var d =
                            fa.get(b);
                        "" === d ? c.resetFull() : c.filter(d);
                        c.isShowing() || c.show(a.uiDirection())
                    }
                }, V = [K.bind(b, "input", function (c) {
                    e.trigger.change();
                    c = l();
                    h.set(g.none());
                    var d = fa.get(b);
                    0 < d.length ? (c.filter(d), c.isShowing() || c.show(a.uiDirection())) : (c.reset(), c.hide())
                }), K.bind(b, "focus", function (a) {
                    l()
                }), K.bind(b, "blur", function (a) {
                    var c = l().hide;
                    Z.active().fold(c, function (a) {
                        N.eq(a, b) || c()
                    })
                }), K.bind(c, "click", function (a) {
                    l().hide()
                }), K.bind(d, "click", function (a) {
                    a.stop();
                    a = l();
                    a.isShowing() ? a.hide() : m(a)
                })];
                return {
                    destroy: function () {
                        l().destroy();
                        G.destroy();
                        z(V, function (a) {
                            a.unbind()
                        })
                    }, getSelectedValue: function () {
                        return h.get().fold(function () {
                            var a = fa.get(b), c = rb.isReservedUrl(a) ? C(a) : q;
                            return JA(a, c)
                        }, function (a) {
                            return JA(a.url(), a.action())
                        })
                    }
                }
            }, events: e.registry
        }
    }

    function NY(a, b, c, d, e, f, k) {
        var l = HY(1337), q = EY(f), h = k();
        k = [q.url().element()];
        var w = [q.text().element(), q.title().element(), q.target().element()],
            J = DY(k, w, h.elements(), h.dialogTitle());
        n.add(J.element(), B.resolve("inline-link-dialog"));
        var G = df.popup(d.uiContainer, d.bounds, a, [], Mg.editorContainer()).initMenu(J.element());
        n.add(G.element(), B.resolve("bubble-box"));
        k = G.element();
        k = JY(a, c, k, l);
        var V = k.predict(q.url().input(), q.url().dropArrow(), b);
        f.invalid() && (q.url().showInvalid(), k.events.change.bind(function () {
            q.url().hideInvalid()
        }));
        var X = {
            before: function () {
                v.set(G.panel(), "visibility", "hidden");
                G.open()
            }, after: function () {
                v.remove(G.panel(), "visibility");
                v.remove(G.panel(), "display")
            }
        }, r = H.create({
            remove: Q([], h.events().remove),
            cancel: p([]), execute: Q([], h.events().execute)
        }), u = function (a) {
            var b = a.command();
            a = a.data();
            m.has(a, rb.bookmarkAnchorDataAttr()) || "insertLink" !== b && "updateLink" !== b || (b = m.get(a, "href"), l.add(b))
        };
        e.events.internal.bind(u);
        b = function () {
            r.trigger.cancel()
        };
        h.events().cancel.bind(b);
        G.events.close.bind(b);
        b = Qb([q.keylayouts(), J.keylayouts(), h.keylayouts()]);
        var z = ha.inlineDialog(J.element(), b, Ba.inlineDialog({ok: h.execute.click, cancel: t}));
        z.events.exit.bind(function () {
            G.close();
            r.trigger.cancel()
        });
        return {
            showPopup: function (b) {
                X.before();
                Hh.preserve(function () {
                    b.showExpandable(a, c, d, G, J);
                    X.after();
                    J.show();
                    z.enter()
                }, J.element())
            }, hide: function () {
                G.closed() || z.exit()
            }, getValues: function () {
                var a = V.getSelectedValue(), b = fa.get(q.text().input()).trim(), c = fa.get(q.title().input());
                return Rh.properties({
                    url: "" === a.url() ? g.none() : g.some(a.url()),
                    textChanged: q.textChanged(),
                    text: g.some(b),
                    title: g.some(c),
                    target: zr.getValue(q.target().input()),
                    action: g.some(a.action()),
                    invalid: !1
                })
            }, destroy: function () {
                l.destroy();
                e.events.internal.unbind(u);
                V.destroy();
                q.destroy();
                z.destroy();
                h.destroy();
                G.destroy();
                J.destroy()
            }, events: r.registry
        }
    }

    function OY(a, b) {
        var c = a.filter(), d = a.content(), e = a.smartview(), f = KA.enabled(d), k = a.internalevents(),
            l = aa.detect();
        Rh.configure(c);
        var q = CY(d, l);
        c = function () {
            d.getSelection().each(function (a) {
                d.setSelection(a.startContainer(), a.startOffset(), a.endContainer(), a.endOffset())
            })
        };
        var h = l.browser.isIE() ? c : t,
            w = H.create({insert: p(["properties"]), update: p(["properties"]), unlink: p([])}),
            J = hd.destroyable(), G = function (b, c) {
                b = NY(a.region(), a.keyboard(), d, e, k, b, c);
                b.events.remove.bind(function (a) {
                    w.trigger.unlink();
                    V()
                });
                b.events.cancel.bind(function (a) {
                    d.focus();
                    V();
                    h()
                });
                J.set(b);
                d.events.mousedown.bind(V);
                return b
            }, V = function () {
                J.clear();
                d.events.mousedown.unbind(V)
            }, X = function (a) {
                var b = G(a, LA.update);
                b.events.execute.bind(function (a) {
                    w.trigger.update(b.getValues());
                    V()
                });
                b.showPopup(Ar)
            };
        f.events.properties.bind(function (a) {
            a = a.link();
            var b = m.has(a, rb.bookmarkAnchorDataAttr()) ? rb.getReservedUrl(m.get(a,
                rb.bookmarkAnchorDataAttr())) : m.get(a, "href"), c = g.from(Vb.get(a).trim());
            a = Rh.properties({
                url: g.from(b),
                textChanged: !1,
                text: c,
                title: g.from(m.get(a, "title")),
                target: g.from(m.get(a, "target")),
                action: g.none(),
                invalid: n.has(a, De.validationHighlight())
            });
            X(a)
        });
        f.events.follow.bind(function (a) {
            d.focus();
            setTimeout(function () {
                q.follow(a.link())
            }, 0)
        });
        f.events.ignore.bind(function (a) {
            b.ignore(a.link())
        });
        f.events.remove.bind(function () {
            w.trigger.unlink()
        });
        return {
            showContext: X, showInsert: function (a) {
                var b =
                    G(a, LA.insert);
                b.events.execute.bind(function (a) {
                    w.trigger.insert(b.getValues());
                    V()
                });
                b.showPopup(Ar)
            }, situation: f.situation, handle: f.handle, assign: f.assign, events: w.registry, destroy: function () {
                V();
                q.destroy()
            }
        }
    }

    function PY(a) {
        var b = na(g.none());
        a = T.div();
        n.add(a, B.resolve("link-widget"));
        var c = T.span();
        n.add(c, B.resolve("link-widget-field"));
        var d = r.fromTag("input");
        n.add(d, B.resolve("link-widget-input"));
        S.label(d, x.translate("link.properties.url.placeholder"));
        y.append(c, d);
        m.set(d, "type", "url");
        m.set(d, "placeholder", x.translate("link.dialog.tooltip"));
        var e = Gj.text(c, d), f = Hj([B.resolve("link-widget-insert")], "insert.link"),
            k = Hj([B.resolve("link-widget-update")], "link.dialog.update"),
            l = Hj([B.resolve("link-widget-remove")], "link.dialog.remove");
        y.append(a, c);
        var q = H.create({insert: p(["properties"]), update: p(["properties"]), unlink: p([]), toEditor: p([])}),
            C = function (a, b) {
                return Rh.properties({
                    url: g.some(a),
                    textChanged: b.isSome(),
                    text: b,
                    title: g.none(),
                    target: g.none(),
                    action: g.none(),
                    invalid: !1
                })
            },
            w = function () {
                var a = fa.get(d), c = b.get().fold(function () {
                    return C(a, a)
                }, function (b) {
                    return b.text().fold(function () {
                        return C(a, g.some(a))
                    }, function (b) {
                        b = g.from(b).filter(function (a) {
                            return "" !== a.trim()
                        });
                        return C(a, b)
                    })
                });
                q.trigger.insert(c);
                b.set(g.none());
                q.trigger.toEditor()
            }, J = function () {
                var a = fa.get(d);
                q.trigger.update(C(a, g.none()));
                b.set(g.none());
                q.trigger.toEditor()
            };
        f.events.click.bind(w);
        k.events.click.bind(J);
        l.events.click.bind(function () {
            q.trigger.unlink();
            q.trigger.toEditor()
        });
        return {
            element: h(a),
            addEscape: function (a) {
                y.append(c, a.element())
            }, type: h(e), execute: function () {
                sc.isVisible(f.element()) ? w() : sc.isVisible(k.element()) && J()
            }, open: function () {
                Z.focus(d)
            }, close: t, destroy: t, represent: function (a) {
                z([f.element(), k.element(), l.element()], F.remove);
                a.url().fold(function () {
                    fa.set(d, "http://");
                    y.after(d, f.element())
                }, function (a) {
                    P.after(d, [k.element(), l.element()]);
                    fa.set(d, a)
                });
                b.set(g.some(a))
            }, events: q.registry
        }
    }

    function QY(a) {
        var b = PY(a), c = zm(a, b);
        a = KA.disabled();
        var d = H.create({
            insert: p(["properties"]),
            update: p(["properties"]), unlink: p([])
        });
        b.events.insert.bind(function (a) {
            d.trigger.insert(a.properties())
        });
        b.events.update.bind(function (a) {
            d.trigger.update(a.properties())
        });
        b.events.unlink.bind(function (a) {
            d.trigger.unlink()
        });
        return {
            showContext: function (a) {
                b.represent(a);
                c.open()
            }, showInsert: function (a) {
                b.represent(a);
                c.open()
            }, situation: a.situation, handle: a.handle, assign: a.assign, events: d.registry, destroy: function () {
                c.close();
                c.destroy()
            }
        }
    }

    function RY(a, b) {
        var c = a.content(), d = a.undo(), e = a.shortcuts(),
            f = aa.detect().deviceType.isTouch() ? QY(a) : OY(a, b), k = H.create({analytics: p(["message"])});
        f.events.insert.bind(function (b) {
            d.transaction(function () {
                var d = Br.insert(c, b.properties());
                a.internalevents().input(d)
            });
            c.domChanged();
            c.cursorIntoView();
            k.trigger.analytics("link_inserted")
        });
        f.events.update.bind(function (a) {
            d.transaction(function () {
                var b = a.properties();
                Br.update(c, b)
            });
            c.domChanged();
            c.cursorIntoView()
        });
        f.events.unlink.bind(function (a) {
            d.save();
            Br.unlink(c);
            c.domChanged();
            c.cursorIntoView()
        });
        b = function () {
            c.getSelection().each(function (a) {
                Ld.sharedLinkOrClosest(a, c.isRoot).fold(function () {
                    c.selectWord();
                    var a = c.getSelectedText().map(function (a) {
                        return a.trim()
                    });
                    f.showInsert(Rh.properties({
                        url: g.none(),
                        textChanged: !1,
                        text: a,
                        title: g.none(),
                        target: g.none(),
                        action: g.none(),
                        invalid: !1
                    }))
                }, function (a) {
                    var b = g.from(Vb.get(a).trim());
                    f.showContext(Rh.properties({
                        url: g.from(m.get(a, "href")),
                        textChanged: !1,
                        text: b,
                        title: g.from(m.get(a, "title")),
                        target: g.from(m.get(a, "target")),
                        action: g.none(),
                        invalid: n.has(a,
                            De.validationHighlight())
                    }))
                })
            })
        };
        var l = wb.ui({
            "link.general": {
                toggle: !1,
                value: "link",
                textkey: x.key("insert.link"),
                action: b,
                updateGeneral: t,
                icon: !0,
                shortcut: !0,
                hasPopup: !1,
                hasDialog: !0
            }
        });
        e.events.link.bind(b);
        return {
            ui: l,
            situation: f.situation,
            handle: f.handle,
            assign: f.assign,
            events: k.registry,
            destroy: function () {
                f.destroy()
            }
        }
    }

    function SY(a, b, c) {
        var d = lm(c), e = mm.get("ephox.link.service.one", MA.one(), a + "/1/check?url=${url}&fresh=${fresh}", b),
            f = mm.post("ephox.link.service.many", MA.many(), a + "/1/check",
                b), k = function (a) {
                return {url: a.url, result: NA.derive(a.url, a.result)}
            };
        return {
            checkOne: function (a, b) {
                var c = yj.now();
                b = nm.single(function (b, c) {
                    return e.execute({url: encodeURIComponent(a), fresh: c})
                }, d, a, c, void 0 !== b ? b : !1);
                return hf.mapSync(b, k)
            }, checkMany: function (a, b) {
                var c = yj.now();
                a = nm.multiple(function (a, b) {
                    return f.execute({urls: a})
                }, d, a, function (a) {
                    return TY(a.results, "url")
                }, function (a) {
                    return a.url
                }, c, void 0 !== b ? b : !1);
                return hf.mapSync(a, function (a) {
                    return eb(a, k)
                })
            }, dumpCache: d.dump
        }
    }

    function UY(a) {
        var b =
            a.slice(0), c = function (a) {
            var c = m.get(a, "href");
            if (Gb(c, "#") || m.has(a, rb.bookmarkAnchorDataAttr())) a = I.error(a); else {
                var d = A.owner(a).dom().baseURI;
                d = g.from(d).getOr(window.location);
                d = Cr.resolve(d, a.dom().href);
                if (U(b, d)) a = I.error(a); else {
                    var k = Sh.parse(d).protocol;
                    a = "https" === k || "http" === k ? I.value(VY(c, d)) : I.error(a)
                }
            }
            return a
        };
        return {
            extract: c, ignore: function (a) {
                c(a).each(function (a) {
                    b.push(a.resolved())
                })
            }, state: function () {
                return b.slice(0)
            }
        }
    }

    function WY(a, b, c) {
        var d = a.content(), e = a.filter(), f =
                a.communication(), k = a.undo(), l = a.viewablearea(), q = l.viewport(), h = UY(b.ignore),
            w = De.validationHighlight(), J = De.invalidLink(), G = De.unknownLink();
        De.configure(e);
        var m = SY(c.url, f.newHeaders(), b.cache), X = function (a) {
            a = E(a, function (a) {
                return Rg.cata(q.assess(a), g.none, Pb(g.some, h.extract), g.none)
            });
            a = ee(a);
            a = Rj.partition(a);
            z(a.errors, y);
            var b = XY.generate(a.values);
            a = cb(b);
            a = E(a, function (a) {
                return {url: a}
            });
            a = m.checkMany(a);
            r(a, function (a) {
                Ma(a, function (a) {
                    var c = b[a.url];
                    void 0 === c ? console.warn("Link validator response from server was unknown: ",
                        a.url, a.result) : z(c, function (b) {
                        A(a.result, b)
                    })
                })
            })
        };
        a = function () {
            var a = l.sections();
            a = Ld.many(a);
            a = ka(a, function (a) {
                return !n.has(a, cr.embedChecking())
            });
            X(a)
        };
        var p = jf(a, 500).throttle;
        l.events.onChange.bind(p);
        d.events.domChanged.bind(p);
        var r = function (a, b) {
            hf.handle(a, function (a) {
                console.error("Link Validation server failure: ", a)
            }, function (a) {
                b(a)
            })
        }, u = function (a) {
            return d.body().map(function (b) {
                return Ld.hrefUrl(b, a)
            })
        }, v = function (a, b) {
            u(a).each(function (a) {
                z(a, function (a) {
                    n.has(a, De.validationHighlight()) ||
                    ma.add(a, [w, b])
                })
            })
        }, y = function (a) {
            n.has(a, De.validationHighlight()) && ma.remove(a, De.allClasses())
        }, x = function (a) {
            u(a).each(function (a) {
                z(a, y)
            })
        }, A = function (a, b) {
            NA.cata(a, function (a) {
                v(b, J)
            }, function (a) {
                v(b, G)
            }, function (a) {
                x(b)
            })
        };
        k.events.undo.bind(a);
        k.events.redo.bind(a);
        return {
            destroy: t, refresh: p, ignore: function (a) {
                k.save();
                h.ignore(a);
                p();
                d.focus();
                d.domChanged();
                d.cursorIntoView()
            }, state: function () {
                return {ignore: h.state(), cache: m.dumpCache()}
            }
        }
    }

    function YY(a, b, c) {
        return {
            patterns: function () {
                return [/(\W)(\w+)(\W*)$/gi,
                    /(^)(\w+)(\W*)$/gi]
            }, useCursor: h(!0), generate: function (a, b) {
                a = r.fromText(b.text());
                return Zd.species({
                    elements: h([a]), cursor: g.none, dictation: h(g.some(function () {
                        return c(b.text())
                    })), notify: g.none
                })
            }, derive: function (a) {
                var c = a.index + a[1].length, d = c + a[2].length;
                return b(a[2]).map(function (a) {
                    return {startIndex: h(c), finishIndex: h(d), text: h(a)}
                })
            }, label: a
        }
    }

    function Dr(a, b) {
        var c = Cb.sanitise(a);
        return {
            patterns: function () {
                return [new RegExp("(" + c + ")", "gi")]
            }, useCursor: h(!0), generate: function (a, c) {
                a = r.fromTag("span",
                    a.dom());
                a.dom().innerHTML = b;
                return Zd.species({elements: h([a]), cursor: g.none, dictation: g.none, notify: g.none})
            }, derive: function (a) {
                var b = a.index;
                a = b + a[0].length;
                return g.some({startIndex: h(b), finishIndex: h(a)})
            }
        }
    }

    function Xg(a, b, c) {
        var d = Cb.sanitise(b);
        return {
            patterns: function () {
                return [new RegExp("^(" + d + "\\s)(.+)", "gi")]
            }, useCursor: fd, generate: function (b, d) {
                var e = r.fromTag(a, b.dom());
                v.set(e, "list-style-type", c);
                var f = r.fromTag("li", b.dom()), q = r.fromTag("li", b.dom());
                y.append(q, r.fromTag("br", b.dom()));
                P.append(e, [f, q]);
                P.append(f, d.clones());
                return Zd.species({
                    elements: h([e]),
                    cursor: h(g.some(W.point(q, 0))),
                    dictation: g.none,
                    notify: g.none
                })
            }, derive: function (a) {
                var b = a[1];
                return g.some({startIndex: h(a.index), finishIndex: h(a.index + b.length)})
            }
        }
    }

    function Om(a, b, c, d) {
        var e = Cb.sanitise(b), f = Cb.sanitise(c);
        return {
            patterns: function () {
                return [new RegExp(e + "([^\\s].*?[^\\s])" + f, "gi"), new RegExp(e + "([^\\s])" + f, "gi")]
            }, useCursor: Jb, generate: function (a, b) {
                a = r.fromTag(d, a.dom());
                b = r.fromText(b.text());
                y.append(a,
                    b);
                return Zd.species({elements: h([a]), cursor: g.none, dictation: g.none, notify: g.none})
            }, derive: function (a) {
                return g.some({startIndex: h(a.index), finishIndex: h(a.index + a[0].length), text: h(a[1])})
            }
        }
    }

    function ZY(a, b) {
        var c = Cb.sanitise(a);
        return {
            patterns: function () {
                return [new RegExp("(" + c + ")", "gi")]
            }, useCursor: Jb, generate: function (a, c) {
                return Zd.species({
                    elements: h([r.fromTag(b, a.dom())]),
                    cursor: g.none,
                    dictation: g.none,
                    notify: g.none
                })
            }, derive: function (a) {
                return g.some({
                    startIndex: h(a.index), finishIndex: h(a.index +
                        a[0].length)
                })
            }
        }
    }

    function $Y(a, b, c) {
        var d = c.allowed.fold(aZ, function (a) {
            return function (b, c) {
                return U(a, b) ? c : []
            }
        }), e = function (a) {
            return {
                derive: a.derive,
                generate: a.generate,
                patterns: a.patterns,
                useCursor: a.useCursor,
                allowed: h(!0)
            }
        }, f = function (a, b) {
            return {
                derive: a.derive,
                generate: a.generate,
                patterns: a.patterns,
                useCursor: a.useCursor,
                allowed: function (a) {
                    return !1 === Db.closest(a, b)
                }
            }
        };
        c = d("headings", [e(Th.spaced("######", "h6")), e(Th.spaced("#####", "h5")), e(Th.spaced("####", "h4")), e(Th.spaced("###", "h3")),
            e(Th.spaced("##", "h2")), e(Th.spaced("#", "h1"))]);
        var k = d("lists", [e(Xg("ul", "*", "disc")), e(Xg("ol", "1.", "decimal")), e(Xg("ol", "a.", "lower-alpha")), e(Xg("ol", "i.", "lower-roman")), e(Xg("ol", "1)", "decimal")), e(Xg("ol", "a)", "lower-alpha")), e(Xg("ol", "i)", "lower-roman"))]),
            l = d("semantics", [e(Om("bold", "**", "**", "strong")), e(Om("bold", "__", "__", "strong")), e(Om("italic", "*", "*", "em")), e(Om("italic", "_", "_", "em"))]),
            q = d("entities", [e(Dr("(c)", "&copy;")), e(Dr("--", "&mdash;")), e(Dr("-", "&mdash;"))]),
            g = [e(OA.normalise()),
                e(OA.capitalise())], w = function (a) {
                return x.translate("aria.autocorrect.announce", a)
            };
        a = a.hasAutocorrect() ? [e(YY("autocorrect", a.lookup, w))] : [];
        w = d("hr", [e(ZY("---", "hr"))]);
        var J = gc(function (a) {
            a.runOrOnLoaded(function (b) {
                var c = gc(function () {
                    A.owner(b).dom().execCommand("AutoUrlDetect", !1, !1)
                });
                a.events.focus.bind(function () {
                    c()
                })
            });
            return d("link", [f(bZ, "a")])
        });
        return {
            headings: h(c), semantics: h(l), entities: h(q), cases: h(g), lists: h(k), dynCustoms: function () {
                var a = b.get();
                return E(a, e)
            }, link: J, hr: h(w),
            corrections: h(a)
        }
    }

    function cZ(a, b, c, d, e, f, k, l) {
        var q = g.none(), h = g.none(), w = $Y(e, f, l), J = Qb([w.link(b), w.hr(), w.semantics(), w.entities()]),
            G = function () {
                return Qb([J, a.autocorrect().get() ? w.corrections() : [], a.capitalisation().get() ? w.cases() : [], w.dynCustoms()])
            }, m = w.headings().concat(w.lists()), X = function (a, b, c, d) {
                var e = PA.descend(b, c), f = dZ.get(e.element(), e.offset());
                c = ka(d, function (a) {
                    return a.allowed(b)
                });
                return yc(c, function (b) {
                    return a(f, b, e.element(), e.offset())
                })
            }, n = function (a, c) {
                b.undoOperation(function () {
                    a(function () {
                        return c.execute(b,
                            k)
                    }).each(function (a) {
                        b.setSelection(a.element(), a.offset(), a.element(), a.offset())
                    });
                    b.domChanged()
                })
            };
        return {
            spaceDown: function () {
                b.getSelection().map(function (a) {
                    a.collapsed() && (q = X(Er.inline, a.startContainer(), a.startOffset(), G()))
                })
            }, spaceUp: function () {
                var a = u(n, d.run);
                q.each(a);
                q = g.none()
            }, enterDown: function () {
                b.getSelection().map(function (a) {
                    a.collapsed() && (h = X(Er.block, a.startContainer(), a.startOffset(), m.concat()));
                    h = h.orThunk(function () {
                        return X(Er.inline, a.startContainer(), a.startOffset(),
                            G())
                    })
                })
            }, enterUp: function () {
                var a = u(n, xb);
                h.each(a);
                h = g.none()
            }
        }
    }

    function eZ(a, b, c, d) {
        var e = a.profile(), f = a.content(), k = a.undo(), l = a.context(), q = a.operations(), g = a.internalevents(),
            w = H.create({analytics: p(["message"])}), J = Dq(c.customs), G = cZ(e, f, k, q, b, J, g, d);
        f.events.keydown.bind(function (a) {
            fe.isSpace(a) && G.spaceDown()
        });
        f.events.keyup.bind(function (a) {
            fe.isSpace(a) && G.spaceUp()
        });
        l.events.preLinebreak.bind(function (a) {
            G.enterDown()
        });
        l.events.postLinebreak.bind(function (a) {
            G.enterUp()
        });
        var m = function (a) {
            return function () {
                var b =
                    a.get();
                a.setAndCache(!b)
            }
        }, X = function (a) {
            return function (b) {
                (!0 === a.get() ? b.select : b.deselect)()
            }
        };
        b = function (a, b, c) {
            return {
                toggle: !0,
                value: a,
                textkey: x.key(b),
                action: m(c),
                updateGeneral: X(c),
                icon: !1,
                tooltip: qb.get
            }
        };
        return {
            ui: wb.ui({
                "capitalisation.general": b("capitalisation", "cog.capitalisation", a.profile().capitalisation()),
                "autocorrect.general": b("autocorrect", "cog.autocorrect", a.profile().autocorrect())
            }), destroy: t, events: w.registry, customMacros: h(J), state: function () {
                return {customs: J.state()}
            }
        }
    }

    function fZ() {
        var a = H.create({insert: p(["embed"]), input: p(["raw"])}), b = r.fromTag("span"),
            c = Wc.textarea("media-embed", "media.embed"), d = x.translate("media.placeholder"),
            e = ib.describe(c.textarea(), d);
        y.append(c.element(), e);
        e = T.span();
        S.hidden(e, !0);
        n.add(e, B.resolve("media-icon"));
        m.set(e, "alt", x.translate("media.insert"));
        var f = Oc(), k = x.translate("media.insert");
        f.content(Rc(k));
        n.add(f.element(), B.resolve("media-insert"));
        td.makeDefault(f.element());
        S.button(f.element(), k);
        m.set(c.textarea(), "placeholder",
            d);
        QA(f);
        a.registry.input.bind(function () {
            var a = fa.get(c.textarea());
            f.disabled() ? "" !== a && (f.enable(), ra.enable(f.element())) : "" === a && QA(f)
        });
        var l = K.bind(c.textarea(), "input", a.trigger.input);
        P.append(b, [e, c.element(), f.element()]);
        var q = function () {
            var b = fa.get(c.textarea());
            a.trigger.insert(b);
            gZ && Z.blur(c.textarea())
        };
        d = [ha.input(c.textarea(), Ba.input({})), ha.button(f.element(), Ba.button({execute: Kb.click}))];
        f.events.click.bind(function () {
            q()
        });
        return {
            element: h(b), execute: q, empty: function () {
                fa.set(c.textarea(),
                    "")
            }, keylayouts: h(d), events: a.registry, destroy: function () {
                l.unbind();
                f.destroy();
                F.remove(b)
            }
        }
    }

    function hZ(a) {
        var b = a.region(), c = a.content(), d = a.smartview(), e = fZ(),
            f = ha.inlineDialog(e.element(), e.keylayouts(), Ba.inlineDialog({ok: e.execute, cancel: t}));
        S.dialog(e.element(), x.translate("insert.media"));
        var k = df.popup(d.uiContainer, d.bounds, b, [], Mg.editorContainer()).initMenu(e.element());
        ma.add(e.element(), [B.resolve("media-embed-dialog"), B.resolve("inline-dialog")]);
        f.events.exit.bind(function () {
            l()
        });
        var l = function () {
            k.closed() || (k.close(), e.empty(), c.focus(), f.exit())
        };
        a = H.create({insert: Q(["embed"], e.events.insert)});
        return {
            element: e.element, showPopup: function (a) {
                k.open();
                a.show(b, c, d, k, e);
                f.enter()
            }, isClosed: k.closed, events: a.registry, destroy: function () {
                l();
                f.destroy();
                e.destroy();
                k.destroy()
            }
        }
    }

    function iZ(a) {
        a = T.div();
        n.add(a, B.resolve("media-widget"));
        var b = T.span();
        n.add(b, B.resolve("media-widget-field"));
        var c = r.fromTag(xc.isLarge() ? "textarea" : "input");
        n.add(c, B.resolve("media-widget-input"));
        var d = x.translate("media.placeholder");
        m.set(c, "placeholder", d);
        m.set(c, "title", d);
        y.append(b, c);
        d = Hj([B.resolve("media-widget-insert")], "insert.media");
        y.append(b, d.element());
        y.append(a, b);
        var e = Gj.text(b, c), f = H.create({insert: p(["embed"]), toEditor: p([])}), k = function () {
            var a = fa.get(c);
            a = jZ ? a.replace(/=\u201c([^\u201d]*)\u201d/g, '="$1"') : a;
            f.trigger.insert(a);
            f.trigger.toEditor()
        };
        d.events.click.bind(function () {
            k()
        });
        return {
            element: h(a), addEscape: function (a) {
                y.append(b, a.element())
            }, open: function () {
                fa.set(c,
                    "");
                Z.focus(c)
            }, close: t, execute: function () {
                k()
            }, destroy: t, type: h(e), events: f.registry
        }
    }

    function kZ(a) {
        var b = a.content(), c = function () {
            var c = hd.destroyable(), d = function () {
                c.clear();
                b.events.mousedown.unbind(d)
            };
            return {
                open: function () {
                    var e = hZ(a);
                    e.events.insert.bind(function (c) {
                        c = c.embed();
                        a.insertFilteredHtmlAtCursor(c);
                        b.cursorIntoView();
                        d()
                    });
                    e.showPopup(Ar);
                    b.events.mousedown.bind(d);
                    c.set(e)
                }, destroy: function () {
                    d()
                }
            }
        }, d = function () {
            var c = iZ(a);
            c.events.insert.bind(function (c) {
                c = c.embed();
                a.insertFilteredHtmlAtCursor(c);
                b.cursorIntoView()
            });
            return zm(a, c)
        }, e = (aa.detect().deviceType.isTouch() ? d : c)();
        return {
            ui: wb.ui({
                "media.general": {
                    toggle: !1,
                    value: "media",
                    textkey: x.key("insert.media"),
                    action: e.open,
                    updateGeneral: t,
                    icon: !0,
                    shortcut: !1,
                    hasPopup: !1,
                    hasDialog: !0
                }
            }), destroy: function () {
                e.destroy()
            }
        }
    }

    function lZ(a, b) {
        var c = r.fromTag("div");
        n.add(c, B.resolve("mentions-business-card"));
        var d = a.initMenu(c), e = null, f = function (a, b, e) {
            F.empty(c);
            y.append(c, e);
            d.open();
            a(b, d)
        };
        return {
            showFull: function (a) {
                return function (b, c) {
                    clearTimeout(e);
                    e = setTimeout(function () {
                        f(a, b, c)
                    }, 500)
                }
            }(b.showUnder), showMini: u(f, b.showAtSide), hide: function () {
                clearTimeout(e);
                d.close()
            }, destroy: function () {
                clearTimeout(e);
                d.destroy()
            }
        }
    }

    function mZ(a) {
        var b = g.none();
        return {
            fetch: function (b, d) {
                a.fetch(b, function (a, b) {
                    a = RA("fetch()", a, b);
                    d(a)
                })
            }, fetchExtra: function (b, d, e) {
                a.menuExtra(b, d, function (a, b) {
                    a = RA("menuExtra()", a, b);
                    e(a)
                })
            }, menuHover: function (c, d) {
                b = g.some(c.userid);
                a.menuHover(c, function (a) {
                    a = Fr("menuHover() callback", a);
                    b.is(c.userid) && d(a)
                })
            }, hover: function (b,
                                d) {
                a.hover(b.dom(), function (a) {
                    a = Fr("hover() callback", a);
                    d(a)
                })
            }, menuComplete: function (b) {
                b = a.menuComplete(b);
                return Fr("menuComplete result", b)
            }, hoverSelector: function () {
                return a.hoverSelector
            }, isTrigger: function (a) {
                return 64 === a
            }
        }
    }

    function nZ(a) {
        var b = zb.mainmenu(r.fromDom(document), B.resolve("mentions-list"), []), c = na({}), d = function (a) {
            return a.userid
        }, e = function (a) {
            return a.name
        }, f = function (a, b) {
            L.child(a, ".ephox-gopher-item-text").each(function (a) {
                Ea.set(a, b)
            })
        }, k = function (a) {
            return E(a, function (a) {
                var b =
                    zb.item(r.fromDom(document), a.userid, a.name);
                f(b, a.name);
                return b
            })
        }, l = function (a) {
            return Eb(a, function (a, b) {
                var c = {};
                c[b.userid] = b;
                return ua(a, c)
            }, {})
        }, q = function (a, b) {
            a = k(a);
            b = E(b, function (a) {
                return zb.item(r.fromDom(document), a.key, a.value)
            });
            return a.concat(b)
        }, C = function (a) {
            var b = m.get(a, "data-ephox-gopher-item-value"), d = c.get();
            return void 0 !== d[b] ? Gr.fetched(d[b].userid, d[b].name, d[b].rawname, d[b], a) : U([SA, TA], b) ? Gr.none(a) : Gr.extra(b, a)
        };
        return {
            element: h(b), selected: function () {
                return L.descendant(b,
                    ".ephox-gopher-item-selected")
            }, setData: function (d, e) {
                var f = l(d);
                c.set(ua(c.get(), f));
                d = 0 === d.length ? [{userid: TA, name: a.get("mentions.lookahead.noresults")}] : d;
                e = q(d, e);
                F.empty(b);
                P.append(b, e)
            }, getInfo: C, getUserId: function (a) {
                return C(a).fold(g.none, g.none, Pb(g.some, d))
            }, setLoading: function () {
                var c = [{userid: SA, name: a.get("mentions.lookahead.searching")}];
                c = q(c, []);
                F.empty(b);
                P.append(b, c)
            }, getName: function (a) {
                return C(a).fold(g.none, g.none, Pb(g.some, e))
            }, refind: function (a) {
                a = m.get(a, "data-ephox-gopher-item-value");
                return void 0 !== a && null !== a ? L.descendant(b, '[data-ephox-gopher-item-value="' + a + '"]') : g.none()
            }, isOpen: function () {
                return sc.isVisible(b)
            }
        }
    }

    function oZ(a, b, c) {
        var d = function (a) {
            ib.speak(ja.body(), a)
        }, e = nZ(c);
        a.setView(e.element());
        var f = na(""), k = function (b) {
            q(b.rawData(), b.extra());
            a.reposition(g.none())
        }, l = function (a) {
            var b = e.selected();
            a();
            return b.bind(e.refind)
        }, q = function (b, f) {
            d(c.get("mentions.lookahead.open"));
            a.updateItems(l, function () {
                e.setData(b, f)
            })
        }, h = function (a) {
            return e.isOpen() && 2 <= a.length ?
                Hr.refetch(a) : 2 <= a.length ? Hr.open(a) : Hr.nothing()
        }, w = function (a) {
            a.fold(m, k)
        }, J = H.create({accept: p(["information"]), menuHover: p(["element", "info"]), none: p([])}), m = function () {
            a.cancel()
        };
        return {
            setData: q, isOpen: function () {
                return e.isOpen()
            }, lookup: function (c, d) {
                c = Gb(c, "@") ? c.substring(1) : c;
                f.set(c);
                var k = t;
                h(c).fold(k, function (a) {
                    b.fetch(a, w)
                }, function (c) {
                    e.setLoading();
                    a.open(d);
                    b.fetch(c, w)
                })
            }, close: function () {
                a.close()
            }, onClick: function (a) {
                e.getInfo(a).fold(function () {
                    J.trigger.none()
                }, function (a,
                             c) {
                    b.fetchExtra(a, f.get(), w)
                }, function (a, b, d, e, f) {
                    ib.speak(ja.body(), c.get("mentions.lookahead.selected", d));
                    J.trigger.accept(e)
                })
            }, onHover: function (a) {
                d(Vb.get(a));
                e.getInfo(a).fold(t, t, function (a, b, c, d, e) {
                    J.trigger.menuHover(e, d)
                })
            }, events: J.registry
        }
    }

    function pZ(a, b, c, d) {
        var e = r.fromTag("div");
        n.add(e, B.resolve("mentions-lookahead-container"));
        var f = c.initMenu(e), k = na(g.none()), l = H.create({close: p([])}), q = function () {
            return sc.isVisible(e)
        };
        c = function () {
            k.set(g.none());
            f.close()
        };
        f.events.close.bind(function () {
            b.close();
            l.trigger.close()
        });
        a.events.mousedown.bind(c);
        return {
            element: h(e), destroy: function () {
                k.set(g.none());
                f.destroy()
            }, setView: function (a) {
                F.empty(e);
                y.append(e, a)
            }, updateItems: function (a, c) {
                a(c).fold(function () {
                    b.setActiveMenu(e)
                }, function (a) {
                    b.select(a)
                })
            }, reposition: function (a) {
                a.isSome() && k.set(a);
                q() && k.get().each(function (a) {
                    d.showUnder(a, f)
                })
            }, open: function (c) {
                a.body().each(function (a) {
                    f.open();
                    d.showUnder(c, f);
                    k.set(g.some(c));
                    b.open([b.sandbox()], a)
                })
            }, isOpen: q, cancel: function () {
                k.set(g.none());
                l.trigger.close()
            }, close: c, events: l.registry
        }
    }

    function qZ(a, b, c, d, e, f) {
        var k = pZ(a, b, c, d), l = oZ(k, e, f);
        a = H.create({
            menuHover: Q(["element", "info"], l.events.menuHover),
            accept: Q(["information"], l.events.accept),
            close: Q([], k.events.close)
        });
        l.events.none.bind(k.close);
        return {
            onHover: l.onHover, onClick: l.onClick, close: function () {
                l.isOpen() && l.close();
                k.isOpen() && k.cancel()
            }, isOpen: k.isOpen, lookup: function (a, b) {
                k.reposition(g.some(b));
                l.lookup(a, b)
            }, destroy: function () {
                k.destroy()
            }, events: a.registry
        }
    }

    function rZ(a,
                b) {
        var c = na([]), d = null, e = null,
            f = H.create({contentHover: p(["target"]), stopHover: p([]), menuHover: p(["info"])});
        a.runOrOnLoaded(function (a) {
            c.set([K.bind(a, "mouseover", function (a) {
                h(a)
            }), K.bind(ja.body(), "mouseover", function (a) {
                L.closest(a.target(), Ir).each(l)
            }), K.bind(a, "mouseout", function (a) {
                w(a)
            }), K.bind(ja.body(), "mouseout", function (a) {
                J(a)
            })])
        });
        var k = function (a) {
            clearTimeout(d);
            clearTimeout(e);
            d = setTimeout(function () {
                f.trigger.contentHover(a)
            }, 300)
        }, l = function () {
            clearTimeout(e)
        }, q = function () {
            clearTimeout(d);
            e = setTimeout(function () {
                f.trigger.stopHover()
            }, 300)
        }, h = function (a) {
            L.closest(a.target(), b).each(function (a) {
                k(a);
                f.trigger.contentHover(a)
            })
        }, w = function (a) {
            if (!Db.closest(a.target(), b)) return !1;
            g.from(a.raw().relatedTarget || a.raw().toElement).map(r.fromDom).filter(function (a) {
                return Db.closest(a, b)
            }).isNone() && q()
        }, J = function (a) {
            if (!Db.closest(a.target(), Ir)) return !1;
            g.from(a.raw().relatedTarget || a.raw().toElement).map(r.fromDom).filter(function (a) {
                return Db.closest(a, Ir)
            }).isNone() && q()
        };
        return {
            destroy: function () {
                z(c.get(),
                    function (a) {
                        a.unbind()
                    })
            }, events: f.registry
        }
    }

    function sZ(a) {
        return {
            get: function (b) {
                var c = a[b];
                return xa(c) ? tZ(c, Array.prototype.slice.call(arguments, 1)) : x.translate.apply(void 0, arguments)
            }
        }
    }

    function UA(a) {
        return {
            show: function (b, c, d, e, f) {
                c = Fh(0, 0);
                b = b.directionAt(a);
                b = Pm.mainmenu(d, h(a), c, b);
                d.show(e, b);
                e.setComponents([a, f.element()])
            }, showWith: function (b, c, d, e, f) {
                b = b.directionAt(a);
                b = Pm.submenu(d, h(a), b);
                d.show(e, b);
                e.setComponents([a, f.element()])
            }
        }
    }

    function uZ(a, b, c, d) {
        return {
            showAtSide: function (d,
                                  f) {
                UA(d).showWith(a, b, c, f, {element: h(f.element())})
            }, showUnder: function (d, f) {
                UA(d).show(a, b, c, f, {element: h(f.element())})
            }
        }
    }

    function vZ(a, b) {
        var c = sZ(b.aria), d = a.content(), e = a.smartview(), f = a.region(), k = a.operations(), l = mZ(b),
            q = df.menuSystem(e.uiContainer, h("mentions"), rj.menu({focusActive: !1}));
        v.set(q.sandbox(), "z-index", String(void 0 !== b.zIndex ? b.zIndex : 1E6));
        b = df.popup(q.sandbox, e.bounds, f, [], Mg.editorContainer());
        e = uZ(f, d, e, q.sandbox());
        var g = qZ(d, q, b, e, l, c), w = lZ(b, e);
        wZ.configure(a.filter());
        var J = rZ(d, l.hoverSelector());
        g.events.menuHover.bind(function (a) {
            l.menuHover(a.info(), function (b) {
                b.fold(t, function (b) {
                    sc.isVisible(a.element()) && w.showMini(a.element(), b)
                })
            })
        });
        J.events.contentHover.bind(function (a) {
            l.hover(a.target(), function (b) {
                b.fold(t, function (b) {
                    g.close();
                    w.showFull(a.target(), b)
                })
            })
        });
        J.events.stopHover.bind(function (a) {
            w.hide()
        });
        q.events.itemHover.bind(function (a) {
            a = a.item();
            g.onHover(a);
            d.backupSelection();
            Z.focus(a);
            d.focus()
        });
        q.events.itemAction.bind(function (a) {
            g.onClick(a.item())
        });
        d.events.nodeChanged.bind(function (a) {
            d.getSelection().each(function (b) {
                b.collapsed() && (Uh.detectOn(b, l).fold(g.close, g.close, t, g.close), a.prev().each(function (a) {
                    Jr.validatePrevious(a, b.startContainer())
                }))
            })
        });
        d.events.keyup.bind(function (a) {
            d.getSelection().each(function (b) {
                b.collapsed() && (U(m, a.original().raw().which) || Uh.withinIncomplete(b.startContainer()).each(function (a) {
                    var b = ed.descendants(a, D.isText);
                    b = E(b, Ya.get).join("");
                    g.lookup(b, a);
                    w.hide()
                }))
            })
        });
        d.events.keypress.bind(function (a) {
            var b =
                a.original();
            l.isTrigger(b.raw().which) && d.getSelection().each(function (a) {
                VA.isValidMention(a.startContainer(), a.startOffset()) && (a = function () {
                    var a = Jr.create();
                    sd.insertAtCursor(d, [a]).each(function (a) {
                        d.setSelection(a.element(), a.offset(), a.element(), a.offset())
                    });
                    b.kill();
                    ib.speak(ja.body(), c.get("mentions.initiated"))
                }, Uh.detect(d, l).fold(a, a, t, t))
            })
        });
        var m = Qb([R.ENTER(), R.DOWN(), R.UP()]);
        a.context().events.preLinebreak.bind(function (a) {
            V(function (b, c) {
                g.isOpen() ? a.handler().handle() : p()
            }, t)
        });
        d.events.keydown.bind(function (a) {
            var b = a.original().raw().which;
            U(R.ESCAPE(), b) ? V(function () {
                p();
                a.original().kill()
            }, t) : U(m, b) && g.isOpen() && (q.simulateKey(a.original()), a.original().kill())
        });
        var V = function (a, b) {
            Uh.detect(d, l).fold(b, b, a, b)
        }, X = function (a) {
            V(function (b, c) {
                l.menuComplete(a).each(function (a) {
                    y.after(c, a);
                    F.remove(c);
                    var b = r.fromText(mb());
                    y.after(a, b);
                    d.setRelativeSelection(la.after(b), la.after(b));
                    n()
                })
            }, n)
        }, n = function () {
            w.hide();
            g.close()
        }, p = function () {
            V(function (a, b) {
                ib.speak(ja.body(),
                    c.get("mentions.lookahead.cancelled"));
                k.atomic(function () {
                    Jr.cancel(b)
                });
                n()
            }, n)
        };
        g.events.close.bind(p);
        g.events.accept.bind(function (a) {
            X(a.information())
        });
        return {
            destroy: function () {
                g.destroy();
                w.destroy();
                J.destroy();
                q.destroy()
            }
        }
    }

    function xZ(a) {
        var b = function (a) {
            var b = {zh: "zh_cn", pt: "pt_br"};
            b = void 0 === b[a] ? a : b[a];
            b = x.has("parlance." + b) ? x.key("parlance." + b) : x.raw(b);
            return yZ(b, a, g.none())
        }, c = E(a.languages, b);
        return {
            build: function (d) {
                return d.filter(function (b) {
                    return !U(a.languages, b)
                }).fold(function () {
                        return c
                    },
                    function (a) {
                        return c.concat([b(a)])
                    })
            }
        }
    }

    function zZ(a, b, c) {
        var d = a.content(), e = a.undo(), f = xZ(c), k = function () {
            return d.on(function (a) {
                return Yg.language(a).fold(Da.off, Da.on)
            }).getOrThunk(Da.unchanged)
        };
        return {
            ui: wb.ui({
                "parlance.dropdown": h({
                    name: "parlance",
                    textkey: x.key("parlance.set"),
                    menuTextkey: x.key("parlance.menu"),
                    updateDropdown: function (a) {
                        var b = k(), c = b.fold(g.none, g.none, g.some);
                        c = f.build(c);
                        a.populate([{label: g.none, items: h(c)}]);
                        b.fold(a.deactivate, t, a.activate);
                        b.fold(a.untick, t, a.tick)
                    },
                    action: function (c) {
                        var f = function (a) {
                            return rd.language(d.isRoot, a, c)
                        };
                        b.lock(function () {
                            Zb.cata(a.selections().get(), t, fm.multiple(d, e, f), fm.single(d, e, f));
                            d.getSelection().each(function (a) {
                                b.check(a.startContainer(), a.startOffset(), a.endContainer(), a.endOffset())
                            })
                        });
                        setTimeout(function () {
                            d.uiChanged()
                        }, 0)
                    },
                    values: f.build(g.none()),
                    render: g.none(),
                    toggle: !1,
                    describe: function () {
                        return x.key("parlance.set")
                    }
                })
            }, ca), destroy: t
        }
    }

    function AZ() {
        var a = r.fromTag("textarea");
        S.label(a, x.translate("plaincode.dialog.editor"));
        S.textarea(a);
        return {element: h(a)}
    }

    function BZ(a) {
        var b = H.create({execute: p(["html"]), close: p([])}), c = we(a);
        n.add(c.element(), B.resolve("plaincode-modal"));
        c.setTitle(x.translate("plaincode.dialog.title"));
        var d = function () {
            e();
            b.trigger.close()
        }, e = function () {
            c.hide()
        }, f = AZ();
        c.setContent(f.element());
        a = td.okCancel("plaincode");
        a.events.ok.bind(function () {
            b.trigger.execute(fa.get(f.element()));
            d()
        });
        a.events.cancel.bind(function () {
            d()
        });
        c.events.close.bind(function () {
            k.exit();
            d()
        });
        c.setControls(a.element());
        var k = Kb.setup(c, a, [ha.single(f.element(), [ea.rule(ea.is(R.ENTER()[0]), function (a) {
            a.raw().stopPropagation();
            return g.none()
        })], g.none())]);
        return {
            element: c.element, open: function () {
                c.show();
                k.enter()
            }, setHtml: function (a) {
                fa.set(f.element(), a)
            }, destroy: function () {
                c.destroy();
                k.destroy()
            }, hide: e, events: b.registry
        }
    }

    function CZ(a) {
        var b = BZ(a), c = function () {
            d.trigger.close();
            b.events.close.unbind(c);
            b.events.execute.unbind(e);
            b.destroy()
        }, d = H.create({execute: p(["html"]), close: p([])}), e = function (a) {
            d.trigger.execute(a.html())
        };
        b.events.close.bind(c);
        b.events.execute.bind(e);
        return {
            show: function () {
                b.open()
            }, setHtml: b.setHtml, events: d.registry
        }
    }

    function DZ(a, b) {
        var c = a.content(), d = a.shortcuts(), e = a.smartview(), f = b.setContent, k = b.getContent;
        d.events.plaincode.bind(function () {
            l()
        });
        var l = function () {
            var a = CZ(e.uiContainer());
            a.events.close.bind(function () {
                c.toEditing()
            });
            a.events.execute.bind(function (a) {
                f(a.html())
            });
            c.toReading();
            a.setHtml(k());
            a.show()
        };
        return {destroy: t}
    }

    function EZ() {
        var a = H.create({grow: p(["x", "y"])}),
            b = 1, c = 1, d = g.none(), e = function (a) {
                return v.getRaw(a, "width").bind(function (a) {
                    return je(a, "px") ? g.some(parseInt(a, 10)) : g.none()
                }).getOrThunk(function () {
                    return Ia.get(a)
                })
            };
        return {
            setTarget: function (a) {
                d = g.some(a);
                c = Ia.get(a) / (sa.get(a) + 0)
            }, setMultiplier: function (a) {
                b = a
            }, clearTarget: function () {
                d = g.none()
            }, mutate: function (f, k) {
                d.each(function (d) {
                    var l = e(d) + b * f, g = 1 === l ? 1 : Math.floor(l / c);
                    5 <= l && 5 <= g && (Ia.set(d, l), sa.set(d, g));
                    a.trigger.grow(f, k)
                })
            }, events: a.registry, destroy: t
        }
    }

    function FZ(a) {
        var b = g.none(),
            c = EZ();
        c.events.grow.bind(function () {
            f()
        });
        var d = tj.transform(c, {layerClass: B.resolve("layer-below-dialog")});
        n.add(d.element(), B.resolve("resize-eph-block"));
        var e = GZ.create();
        e.events.click.bind(function (e) {
            b.each(function (b) {
                c.setMultiplier(e.multiplier());
                a.body().each(function (a) {
                    d.go(A.documentElement(a));
                    var c = function () {
                        d.events.stop.unbind(c);
                        k.trigger.stop(b)
                    };
                    d.events.stop.bind(c)
                })
            })
        });
        var f = function () {
            e.clear();
            b.each(Kr.clean);
            b = g.none()
        }, k = H.create({stop: p(["target"])});
        return {
            showHandles: function (a) {
                var f =
                    A.documentElement(a);
                c.setTarget(a);
                b = g.some(a);
                d.on();
                e.refresh(f, a)
            }, hideHandles: f, handlesShowing: function () {
                return b.isSome()
            }, events: k.registry, destroy: function () {
                e.destroy();
                c.destroy();
                d.destroy();
                b = g.none()
            }
        }
    }

    function HZ(a) {
        var b = a.content(), c = a.undo();
        a = a.filter();
        Kr.configure(a);
        var d = FZ(b), e = function (a) {
            vc.detect(b.getSelection()).each(function (d) {
                c.save();
                ie.remove(b, d.image());
                b.domChanged();
                c.save();
                a.original().kill()
            })
        }, f = function (a) {
            vc.detect(b.getSelection()).each(function (c) {
                b.setRelativeSelection(la.before(c.image()),
                    la.before(c.image()));
                a.original().kill()
            })
        }, k = function (a) {
            vc.detect(b.getSelection()).each(function (c) {
                b.setRelativeSelection(la.after(c.image()), la.after(c.image()));
                a.original().kill()
            })
        }, l = function () {
            vc.detectForEditing(b.getSelection(), b.imageExcludes).fold(function () {
                d.hideHandles()
            }, function (a) {
                a = a.image();
                d.showHandles(a);
                ie.reselect(b, a)
            })
        };
        b.events.loaded.bind(l);
        b.events.domChanged.bind(l);
        b.events.paint.bind(l);
        b.events.nodeChanged.bind(l);
        b.events.selectionchange.bind(function (a) {
            vc.detect(b.getSelection()).fold(l,
                function () {
                    IZ || d.handlesShowing() || l()
                })
        });
        var q = g.none();
        b.events.ready.bind(function (a) {
            a = a.api().body();
            q = g.some(tm.handle(a, function (a) {
                "img" === D.name(a.target()) && ie.select(b, a.target())
            }))
        });
        b.events.mousedown.bind(function (a) {
            a = a.original().target();
            "img" === D.name(a) && Kr.disableNativeResize(a)
        });
        b.events.keydown.bind(function (a) {
            fe.isDel(a) || fe.isBackspace(a) ? e(a) : fe.isLeftOrUp(a) ? f(a) : fe.isRightOrDown(a) && k(a)
        });
        d.events.stop.bind(function (a) {
            a = a.target();
            JZ ? (d.showHandles(a), ie.select(b,
                a)) : (d.showHandles(a), ie.reselect(b, a))
        });
        return {
            destroy: function () {
                d.destroy();
                q.each(function (a) {
                    a.unbind()
                })
            }
        }
    }

    function KZ(a, b) {
        var c = a.content(), d = a.filter(), e = a.selections(), f = u(d.filterDom, d.output());
        c.events.ready.bind(function (a) {
            a = a.api();
            var b = LZ(a, d), k = function (a, k) {
                Zb.cata(e.get(), t, function (c) {
                    MZ(c, f).each(function (d) {
                        b(a, d.text, d.html, u(k, function () {
                            NZ(c)
                        }))
                    })
                }, function (e, f) {
                    OZ(e, f, d).each(function (d) {
                        b(a, d.text, d.html, u(k, function () {
                            c.insertHtmlAtCursor("")
                        }))
                    })
                })
            };
            a.events.cut.bind(function (a) {
                k(a.original(),
                    xb)
            });
            a.events.copy.bind(function (a) {
                k(a.original(), t)
            })
        });
        return {destroy: t}
    }

    function PZ(a, b) {
        var c = function (a, b, c) {
            a(c, b);
            return g.some({
                element: h(b), cleanup: function () {
                    F.remove(b)
                }, splits: h([])
            })
        }, d = function (a) {
            return {
                none: g.none, start: u(c, y.before, a), end: u(c, y.after, a), middle: function (b, d, e) {
                    return c(y.after, a, d)
                }
            }
        }, e = function (a) {
            var b = function (a) {
                return function (b, c) {
                    y.appendAt(b, c, a)
                }
            };
            return {
                prepend: u(c, y.prepend, a),
                before: u(c, y.before, a),
                after: u(c, y.after, a),
                insertAt: function (d, e) {
                    return c(b(e),
                        a, d)
                },
                append: u(c, y.append, a)
            }
        };
        return {
            before: {
                text: d(a),
                element: {hasPrevious: e(a).insertAt, first: e(a).prepend, empty: e(a).before, otherwise: e(a).append}
            },
            after: {
                text: d(b),
                element: {hasNext: e(b).insertAt, rightEdge: e(b).append, empty: e(b).after, otherwise: e(b).append}
            },
            general: {insertBefore: e(a).before, insertAfter: e(b).after}
        }
    }

    function QZ(a) {
        var b = Qm.fromUnsafe(a), c = r.fromTag("span"), d = r.fromTag("span");
        z([c, d], a.markAsEphemeral);
        var e = PZ(c, d);
        return {
            backup: function () {
                a.getSelection().each(function (f) {
                    f.collapsed() ?
                        (sd.insertAtCursor(a, [c]), F.unwrap(d), b.begin()) : WA.both(e, f.startContainer(), f.startOffset(), f.endContainer(), f.endOffset())
                })
            }, insert: function (e, k, l) {
                a.setRelativeSelection(la.after(c), ja.inBody(d) ? la.before(d) : la.after(c));
                sd.insertAtCursorWith(a, e, k, l).each(function (b) {
                    !Db.ancestor(b.element(), "table") || "td" !== D.name(b.element()) && "th" !== D.name(b.element()) ? a.setRelativeSelection(la.after(b.element()), la.after(b.element())) : a.setSelection(b.element(), 0, b.element(), 0)
                });
                b.end();
                Og.cursorIntoView(a);
                z([c, d], F.unwrap)
            }, cancel: function () {
                z([c, d], F.unwrap)
            }
        }
    }

    function XA(a, b, c) {
        return function (c, e, f) {
            var d = function (a) {
                c.receive(a)
            }, l = function (a, b, c) {
                c = void 0 !== c ? c : a.type() === Ab.END_ELEMENT_TYPE;
                return Ab.token(b, c, {})
            }, g = {
                emit: d, emitTokens: function (a) {
                    z(a, d)
                }, receive: function (b) {
                    a(g, b, l)
                }, document: window.document
            };
            b(g);
            return g
        }
    }

    function Lr(a, b, c) {
        return {pred: a, action: b, label: h(c)}
    }

    function YA(a, b, c) {
        var d = ZA(a + " :: FALLBACK --- ", c);
        c = function (c, f, k) {
            qa(b, function (a) {
                return a.pred(f, k)
            }).fold(h(d),
                function (b) {
                    var c = b.label();
                    return void 0 === c ? b.action : ZA(a + " :: " + c, b.action)
                })(c, f, k)
        };
        c.toString = function () {
            return "Handlers for " + a
        };
        return c
    }

    function RZ(a, b) {
        var c = mc.state(0, void 0, [], []), d = function (c) {
            z(c.result(), function (c) {
                c = c(b);
                a.emit(c)
            })
        };
        return {
            closeAllLists: function () {
                var a = $A.closeAllLists(c, 0);
                c = a.state();
                d(a)
            }, openItem: function (a, b, k) {
                k && ("UL" === k.tag && SZ[a - 1] === k.type && (k = {tag: "UL"}), a = $A.openItem(c, a, b, k), c = a.state(), d(a))
            }, getCurrentListType: function () {
                return c.type()
            }, getCurrentLevel: function () {
                return c.level()
            }
        }
    }

    function aB(a, b) {
        var c = H.create({
            cancel: p([]),
            error: p(["message"]),
            insert: p(["elements", "assets", "correlated", "isInternal"])
        }), d = function (d, e, l) {
            d = bB.choose(a, b, d);
            d.capture() && l();
            l = E(d.steps(), function (a) {
                return a(e)
            });
            bB.run(l, d.input()).get(function (a) {
                var b = a.bundle().isInternal().getOr(!1);
                db.cata(a.response(), function (a) {
                    c.trigger.error(a)
                }, function (a, d) {
                    c.trigger.insert(a, cB(d), d, b)
                }, function () {
                    c.trigger.cancel()
                }, function (a, d, e) {
                    c.trigger.insert(a, cB(d), d, b);
                    c.trigger.error(e)
                })
            })
        }, e = Hd.tap(function (a) {
            Wa.getExact(a.target.ownerDocument.defaultView).each(function (b) {
                n.has(b.start(),
                    dB.bin()) || (b = TZ.fromEvent(a), eB.willBlock() && (e.control.block(), a.preventDefault()), d(b, e.control, function () {
                    a.preventDefault()
                }))
            })
        });
        return {
            paste: e.instance, pasteCustom: function (a) {
                var b = Hd.tap(t);
                d(a, b.control, t)
            }, isBlocked: e.control.isBlocked, destroy: t, events: c.registry
        }
    }

    function Sj() {
        return function (a, b) {
            return La.sync(function (a) {
                var c = function () {
                    La.call(a, {response: b.response(), bundle: b.bundle()})
                }, e = function (c, d) {
                    Ce(c, UZ).get(function (c) {
                        La.call(a, {response: d(c), bundle: b.bundle()})
                    })
                };
                db.cata(b.response(),
                    c, function (a, b) {
                        e(b, function (b) {
                            return db.paste(a, b)
                        })
                    }, c, function (a, b, c) {
                        e(b, function (b) {
                            return db.incomplete(a, b, c)
                        })
                    })
            })
        }
    }

    function Mr(a) {
        return function (b, c) {
            return La.sync(function (b) {
                var d = function () {
                    La.call(b, {response: c.response(), bundle: c.bundle()})
                }, f = function (a) {
                    var d = VZ(a), e = Ce(d, function (a) {
                        return a.asset()
                    }), f = E(d, function (a) {
                        return a.image()
                    });
                    e.get(function (d) {
                        d = tf.updateSources(d, f);
                        La.call(b, {response: db.paste(a, d), bundle: c.bundle()})
                    })
                }, k = function (e, k, g) {
                    !1 === a.allowLocalImages ?
                        (k = ka(fB(e), gB), z(k, F.remove), La.call(b, {
                            response: 0 < k.length ? WZ(e) : c.response(),
                            bundle: c.bundle()
                        })) : 0 === k.length ? f(e) : d()
                };
                db.cata(c.response(), d, k, d, k)
            })
        }
    }

    function hB(a) {
        var b = a.translations,
            c = H.create({insert: p(["elements", "correlated"]), incomplete: p(["elements", "correlated", "message"])});
        return {
            events: c.registry, processRtf: function (a, e, f, k) {
                f = uf.images(f);
                var d = Tj.find(a);
                XZ.convert(d, f, function (b, d) {
                    var f = A.children(a);
                    b = b.concat(e);
                    d ? c.trigger.incomplete(f, b, "errors.imageimport.failed") : c.trigger.insert(f,
                        b);
                    k()
                }, b)
            }
        }
    }

    function YZ(a, b) {
        var c = H.create({insert: p(["elements", "correlated"]), incomplete: p(["elements", "correlated", "message"])}),
            d = hB(b);
        d.events.incomplete.bind(function (a) {
            c.trigger.incomplete(a.elements(), a.correlated(), a.message())
        });
        d.events.insert.bind(function (a) {
            c.trigger.insert(a.elements(), a.correlated())
        });
        return {
            events: c.registry, gordon: function (e, f) {
                var k = function (a) {
                    d.processRtf(e, f, a.rtf(), a.hide())
                }, l = function (a) {
                    var b = Tj.find(e);
                    z(b, F.remove);
                    c.trigger.incomplete(A.children(e),
                        f, a)
                }, g = function () {
                    var a = Tj.find(e);
                    z(a, F.remove);
                    c.trigger.insert(A.children(e), f)
                }, h = function (a) {
                    l(a.message())
                };
                if (!0 === b.allowLocalImages && !0 === b.enableFlashImport) {
                    var w = a(b);
                    w.events.response.bind(k);
                    w.events.cancel.bind(g);
                    w.events.failed.bind(h);
                    w.events.error.bind(h);
                    w.open()
                } else l("errors.local.images.disallowed")
            }
        }
    }

    function iB(a, b) {
        var c = YZ(a, b), d = na(g.none()), e = function (a) {
            d.get().each(function (b) {
                La.call(b, {response: a, bundle: Xb.nu({})})
            })
        };
        c.events.insert.bind(function (a) {
            e(db.paste(a.elements(),
                a.correlated()))
        });
        c.events.incomplete.bind(function (a) {
            e(db.incomplete(a.elements(), a.correlated(), a.message()))
        });
        return function (a, b) {
            return La.sync(function (a) {
                var e = function () {
                    La.call(a, {response: b.response(), bundle: b.bundle()})
                }, f = function (b, f, k) {
                    d.set(g.some(a));
                    var l = r.fromTag("div");
                    P.append(l, b);
                    Tj.exists(l) ? c.gordon(l, f, k) : e()
                };
                db.cata(b.response(), e, f, e, f)
            })
        }
    }

    function ZZ(a, b) {
        var c = b.translations, d = function (a, b, c) {
            c(g.some(ua(b, {officeStyles: a, htmlStyles: a})))
        }, e = function (b, e) {
            var f = r.fromTag("div");
            n.add(f, ud.resolve("styles-dialog-content"));
            var k = r.fromTag("p"), h = qe.fromHtml(c("cement.dialog.paste.instructions"));
            P.append(k, h);
            y.append(f, k);
            k = {
                text: c("cement.dialog.paste.clean"),
                tabindex: 0,
                className: ud.resolve("clean-styles"),
                click: function () {
                    w.destroy();
                    d(!1, b, e)
                }
            };
            h = {
                text: c("cement.dialog.paste.merge"),
                tabindex: 1,
                className: ud.resolve("merge-styles"),
                click: function () {
                    w.destroy();
                    d(!0, b, e)
                }
            };
            var w = a(!0);
            w.setTitle(c("cement.dialog.paste.title"));
            w.setContent(f);
            w.setButtons([k, h]);
            w.events.close.bind(function () {
                e(g.none());
                w.destroy()
            });
            w.show()
        };
        return {
            get: function (a, c) {
                a = b[a ? "officeStyles" : "htmlStyles"];
                "clean" === a ? d(!1, b, c) : "merge" === a ? d(!0, b, c) : e(b, c)
            }, destroy: t
        }
    }

    function $Z(a) {
        return {
            play: function (b, c, d) {
                var e = r.fromTag("div"), f = r.fromTag("iframe");
                v.setAll(e, {display: "none"});
                var k = K.bind(f, "load", function () {
                    k.unbind();
                    yz.write(f, b);
                    var a = f.dom().contentWindow.document;
                    if (void 0 === a) throw"sandbox iframe load event did not fire correctly";
                    var g = r.fromDom(a);
                    a = a.body;
                    if (void 0 === a) throw"sandbox iframe does not have a body";
                    a = r.fromDom(a);
                    g = c(g, a);
                    F.remove(e);
                    setTimeout(u(d, g), 0)
                });
                y.append(e, f);
                y.append(a, e)
            }
        }
    }

    function a_(a, b, c, d, e) {
        return function (f, k) {
            var l = Xc.asEvent(f).getOrDie("Must pass through event type").nativeEvent(), g = e(), h = k.response();
            return La.sync(function (e) {
                var f = a(c);
                f.events.after.bind(function (a) {
                    a = a.container();
                    if (Nr.browser.isSafari() && Db.descendant(a, 'img[src^="webkit-fake-url"]')) a = Nr.deviceType.isWebView() ? "webview.imagepaste" : "safari.imagepaste", La.call(e, {
                        response: db.error(a),
                        bundle: Xb.nu({})
                    });
                    else {
                        b(a);
                        n.add(a, jB.binStyle());
                        var c = b_.isWord(Nr, a), f = A.children(a), k = d.findClipboardTags(f).isSome();
                        f = c_(f);
                        La.call(e, {
                            response: h,
                            bundle: Xb.nu({isWord: c, isGoogleDocs: f, isInternal: k, proxyBin: a, backgroundAssets: g})
                        })
                    }
                });
                g.convert(l);
                f.run()
            })
        }
    }

    function d_(a, b) {
        var c = hB(a), d = na(g.none()), e = function (a) {
            d.get().each(function (b) {
                La.call(b, {response: a, bundle: Xb.nu({})})
            })
        };
        c.events.insert.bind(function (a) {
            e(db.paste(a.elements(), a.correlated()))
        });
        c.events.incomplete.bind(function (a) {
            e(db.incomplete(a.elements(),
                a.correlated(), a.message()))
        });
        return function (f, k) {
            var l = Xc.asWord(f).getOrDie("Word input required for rtf data"), q = function (a) {
                return La.sync(function (b) {
                    var f = function () {
                        La.call(b, {response: k.response(), bundle: k.bundle()})
                    }, l = function (f, k) {
                        d.set(g.some(b));
                        var l = r.fromTag("div");
                        P.append(l, f);
                        a.fold(function () {
                            var a = function () {
                                z(c, F.remove);
                                var a = A.children(l);
                                e(db.incomplete(a, k, "errors.local.images.disallowed"))
                            }, b = function () {
                                var a = A.children(l);
                                e(db.paste(a, k))
                            }, c = Tj.find(l);
                            return 0 < c.length ?
                                a() : b()
                        }, function (a) {
                            c.processRtf(l, k, a, t)
                        })
                    };
                    db.cata(k.response(), f, l, f, l)
                })
            };
            return Rm.match(l.rtf(), {
                getFromFlash: function (a) {
                    return b(f, k)
                }, disabled: function () {
                    return q(g.none())
                }, fromClipboard: function (b) {
                    return q(!0 === a.allowLocalImages ? g.some(b.rtf()) : g.none())
                }
            })
        }
    }

    function e_(a, b, c) {
        var d = function (a) {
            return ob(b, function (b) {
                return vb(a[b])
            })
        }, e = !0, f = Or(function () {
            var b = a.dom();
            vb(b.PercentLoaded) && 100 === b.PercentLoaded() && d(b) && (k(), c())
        }, 500), k = function () {
            e && (Vh(f), e = !1)
        };
        return {stop: k}
    }

    function f_(a) {
        var b = H.create({
            response: p(["rtf"]),
            spin: p([]),
            cancel: p([]),
            error: p(["message"]),
            reset: p([]),
            hide: p([]),
            failed: p(["message"])
        }), c = !1, d = r.fromTag("div");
        n.add(d, ud.resolve("flashbin-target"));
        var e = g_.responsive();
        e.events.crashed.bind(function () {
            b.trigger.failed("flash.crashed")
        });
        e.events.timeout.bind(function () {
            b.trigger.failed("flash.crashed")
        });
        var f = function () {
            m.stop();
            if (!c) {
                c = !0;
                try {
                    var a = w.dom();
                    Ma(h, function (b, c) {
                        var d = a[c];
                        if (void 0 === d) throw'Flash object does not have the method "' +
                        c + '"';
                        d.call(a, b)
                    });
                    b.trigger.reset();
                    sr(X);
                    n.remove(d, ud.resolve("flash-activate"));
                    J();
                    V()
                } catch (Dh) {
                    ld.log("Flash dialog - Error during load: ", Dh)
                }
            }
        }, k = $f.permanent(f), l = function () {
            return !ja.inBody(w)
        }, g = function () {
            return !w.dom().SetVariable
        }, h = {
            setSpinCallback: $f.permanent(function () {
                e.start(1E3, 10, l, g);
                b.trigger.spin()
            }), setPasteCallback: $f.permanent(function (a) {
                e.stop();
                Kf(function () {
                    "" === a ? b.trigger.error("flash.crashed") : b.trigger.response(unescape(a))
                }, 0)
            }), setEscapeCallback: $f.permanent(b.trigger.cancel),
            setErrorCallback: $f.permanent(function (a) {
                e.stop();
                b.trigger.error(a)
            }), setStartPasteCallback: $f.permanent(t)
        }, w = function () {
            var b = a.replace(/^https?:\/\//, "//"),
                c = '    <param name="allowscriptaccess" value="always">    <param name="wmode" value="opaque">    <param name="FlashVars" value="onLoad=' + k + '">';
            if (Pr.browser.isIE() && 10 === Pr.browser.version.major) {
                var d = Ha("flash-bin");
                return r.fromHtml('<object classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" id="' + d + '"><param name="movie" value="' + b +
                    '">' + c + "</object>")
            }
            return r.fromHtml('<object type="application/x-shockwave-flash" data="' + b + '">' + c + "</object>")
        }(), J = function () {
            v.setAll(w, {width: "2px", height: "2px"})
        };
        J();
        var m = e_(w, cb(h), f);
        y.append(d, w);
        var V = function () {
            Pr.browser.isFirefox() && Zg.getSelection().removeAllRanges();
            Z.focus(w)
        }, X = null, u = function () {
            n.add(d, ud.resolve("flash-activate"));
            v.remove(w, "height");
            v.remove(w, "width");
            b.trigger.hide()
        }, x = function () {
            v.set(d, "display", "none");
            h_.each(function (a) {
                z(a, function (a) {
                    a.unbind()
                })
            })
        };
        return {
            focus: V, element: function () {
                return d
            }, activate: function () {
                X = Kf(u, 3E3);
                b.trigger.spin();
                v.set(d, "display", "block");
                V()
            }, deactivate: x, destroy: function () {
                x();
                z(Ze(h), function (a) {
                    $f.unregister(a)
                });
                $f.unregister(k);
                m.stop()
            }, events: b.registry
        }
    }

    function i_(a, b, c) {
        var d = r.fromTag("div"), e = "flashbin-wrapper-" + (j_.os.isOSX() ? "cmd" : "ctrl");
        n.add(d, ud.resolve(e));
        try {
            var f = void 0 !== k_.plugins["Shockwave Flash"]
        } catch (k) {
            f = !1
        }
        a = (f ? l_ : m_)(d, a, b, c.translations);
        return {element: h(d), reset: a.reset}
    }

    function n_(a,
                b) {
        var c = b.translations,
            d = H.create({response: p(["rtf", "hide"]), cancel: p([]), error: p(["message"]), failed: p(["message"])});
        return {
            open: function () {
                var e = f_(b.swf);
                e.deactivate();
                var f = r.fromDom(Zg), k = K.bind(f, "mouseup", e.focus), l = function () {
                    w()
                };
                f = function () {
                    w();
                    d.trigger.cancel()
                };
                e.events.cancel.bind(f);
                e.events.response.bind(function (a) {
                    d.trigger.response(a.rtf(), l)
                });
                e.events.error.bind(function (a) {
                    w();
                    d.trigger.error(a.message())
                });
                e.events.failed.bind(function (a) {
                    w();
                    d.trigger.failed(a.message())
                });
                var g = a();
                g.setTitle(c("cement.dialog.flash.title"));
                var h = i_(e, g.reflow, b);
                h.reset();
                g.setContent(h.element());
                g.events.close.bind(f);
                g.show();
                e.activate();
                var w = function () {
                    k.unbind();
                    e.destroy();
                    g.destroy()
                }
            }, events: d.registry
        }
    }

    function Qr(a, b, c, d) {
        var e = N.eq(a, c) && b === d;
        return {startContainer: h(a), startOffset: h(b), endContainer: h(c), endOffset: h(d), collapsed: h(e)}
    }

    function o_(a) {
        var b = r.fromTag("br"), c = g.none();
        return {
            cleanup: function () {
                F.remove(b)
            }, toOn: function (b, e) {
                var d = A.owner(e).dom().defaultView;
                c.each(function (c) {
                    var e = A.childNodesCount(b),
                        f = N.eq(b, c.startContainer()) && e < c.startOffset() ? e : c.startOffset;
                    e = N.eq(b, c.endContainer()) && e < c.endOffset() ? e : c.endOffset;
                    c = Qr(c.startContainer(), f, c.endContainer(), e);
                    a.set(d, c)
                })
            }, toOff: function (d, e) {
                d = A.owner(e).dom().defaultView;
                y.append(e, b);
                c = a.get(d, Qr);
                a.set(d, Qr(b, 0, b, 0))
            }
        }
    }

    function p_(a, b) {
        var c = r.fromTag("div");
        m.setAll(c, b);
        m.setAll(c, {contenteditable: "true", "aria-hidden": "true"});
        v.setAll(c, {
            position: "fixed", top: "0px", width: "100px", height: "100px",
            overflow: "hidden", opacity: "0"
        });
        ma.add(c, [kB, lB]);
        var d = function (a) {
            return n.has(a, lB)
        };
        return {
            attach: function (a) {
                F.empty(c);
                v.set(c, "left", q_(a));
                y.append(a, c)
            }, focus: function () {
                L.ancestor(c, "body").each(function (b) {
                    a.toOff(b, c)
                })
            }, contents: function () {
                r_.consolidate(c, d);
                var a = O("elements", "html", "container"), b = A.children(c), k = Ea.get(c);
                return a(b, k, c)
            }, container: function () {
                return c
            }, detach: function () {
                F.remove(c)
            }
        }
    }

    function s_(a, b, c) {
        var d = p_(a, c), e = function () {
            a.cleanup();
            var b = d.contents();
            d.detach();
            k.trigger.after(b.elements(), b.html(), d.container())
        }, f = Hd.tap(function () {
            k.trigger.before();
            d.attach(b);
            d.focus();
            eB.run(A.owner(b), f, e)
        }), k = H.create({before: p([]), after: p(["elements", "html", "container"])});
        c = t;
        return {
            instance: h(function () {
                f.instance()
            }), destroy: c, events: k.registry
        }
    }

    function t_(a) {
        return function (b) {
            var c = H.create({after: p(["container"])}), d = o_(u_), e = s_(d, b, a);
            e.events.after.bind(function (a) {
                d.toOn(b, a.container());
                c.trigger.after(a.container())
            });
            return {
                run: function () {
                    e.instance()()
                },
                events: c.registry
            }
        }
    }

    function v_() {
        return aB([ag.text()], ag.discard())
    }

    function w_(a, b) {
        return function (c) {
            var d = H.create({close: p([])}), e = we(a);
            e.events.close.bind(function () {
                d.trigger.close()
            });
            n.add(e.element(), B.resolve("external-dialog"));
            c && n.add(e.element(), B.resolve("dialog-vertical-controls"));
            var f = r.fromTag("div"), k = na([]), l = function (a) {
                var b = Oc();
                if (void 0 === a.text) throw"dialog button did not specify text";
                b.content(Rc(a.text));
                S.button(b.element(), a.text);
                void 0 !== a.tabindex && m.set(b.element(),
                    "tabindex", a.tabindex);
                void 0 !== a.className && n.add(b.element(), a.className);
                void 0 !== a.click && b.events.click.bind(a.click);
                n.add(b.element(), B.resolve("dialog-button"));
                return b
            };
            return {
                element: e.element,
                events: d.registry,
                setTitle: e.setTitle,
                setContent: e.setContent,
                setButtons: function (a) {
                    F.empty(f);
                    a = E(a, l);
                    P.append(f, E(a, function (a) {
                        return a.element()
                    }));
                    k.set(a);
                    e.setControls(f)
                },
                reflow: t,
                show: function () {
                    b.hideInlineSelection();
                    e.show();
                    var a = E(k.get(), function (a) {
                            return ha.button(a.element(), Ba.button({execute: Kb.click}))
                        }),
                        c = ha.multipleAll(e.element(), a);
                    c.events.exit.bind(function () {
                        d.trigger.close()
                    });
                    setTimeout(function () {
                        c.enter()
                    }, 0)
                },
                destroy: function () {
                    z(k.get(), function (a) {
                        a.destroy()
                    });
                    k.set([]);
                    e.destroy()
                }
            }
        }
    }

    function x_(a, b, c) {
        var d = {
            "errors.imageimport.unsupported": "errors.images.import.unsupported",
            "errors.imageimport.invalid": "errors.images.import.invalid"
        };
        return {
            baseUrl: c.baseUrl,
            enableFlashImport: c.enableFlashImport,
            swf: c.swf,
            officeStyles: c.officeStyles,
            htmlStyles: c.htmlStyles,
            translations: function (b) {
                var c =
                    Array.prototype.slice.call(arguments, 1);
                return a.translate.apply(void 0, [void 0 !== d[b] ? d[b] : b].concat(c))
            },
            allowLocalImages: c.allowLocalImages,
            intraFlag: b
        }
    }

    function y_(a, b, c, d) {
        var e = a.filter(), f = a.content(), k = a.undo(), l = a.smartview(), q = a.region(), h = a.internalevents(),
            w = !0 === d.forceText ? v_ : z_(l, e, d, f), J = g.none(), G = H.create({analytics: p(["message"])}),
            n = function (a) {
                var b = U(["flash.clipboard.no.rtf", "safari.imagepaste"], a.message()) ? "info" : "error";
                X(a.message(), b)
            }, X = function (b, c) {
                mf.getOrLog(b, []).each(function (b) {
                    b =
                        nj(b, c);
                    a.ui().displayBanner(b)
                });
                t()
            }, t = function () {
                Vc.unblock();
                f.focus()
            };
        e.add(e.history(), jB.binStyle(), Na.remove);
        e.addSelector(e.history(), "[data-ephox-polish-cement-inserted]", Na.removeAttr("data-ephox-polish-cement-inserted"));
        f.events.ready.bind(function (a) {
            var d = Rr.get(f, l, a.api().doc()), C = A_.rules(f, q, d), V = QZ(f), p = a.api(), u = w(p.body());
            J = g.some(u);
            p.events.paste.bind(function (a) {
                p.getSelection().filter(function (a) {
                    return ob(Uj.ignoreSelectors(), function (b) {
                        return !1 === Db.closest(a.startContainer(),
                            b, f.isRoot)
                    })
                }).each(function (b) {
                    u.isBlocked() || (V.backup(), Vc.block());
                    u.paste(a.original().raw())
                })
            });
            u.events.cancel.bind(function () {
                t();
                V.cancel()
            });
            var v = Fj.processResults(X);
            u.events.error.bind(n);
            u.events.insert.bind(function (a) {
                c.correlated(a.correlated()).bind(oA.maybeDoRotate).map(v).get(function (c) {
                    t();
                    k.save();
                    var d = r.fromTag("div");
                    P.append(d, a.elements());
                    e.filterDom(e.input(), d);
                    d = A.children(d);
                    z(d, function (a) {
                        D.isElement(a) && m.set(a, "data-ephox-polish-cement-inserted", !0)
                    });
                    V.insert(d,
                        [C.collapsed()], [C.ranged()]);
                    f.body().each(function (a) {
                        a = Y.descendants(a, "[data-ephox-polish-cement-inserted]");
                        z(a, function (a) {
                            m.remove(a, "data-ephox-polish-cement-inserted")
                        });
                        h.input(a)
                    });
                    f.domChanged();
                    G.trigger.analytics("paste_action");
                    b.pasteUpload();
                    b.uploadAssets(c)
                })
            })
        });
        return {
            destroy: function () {
                J.each(function (a) {
                    a.destroy()
                })
            }, events: G.registry
        }
    }

    function B_(a, b, c, d) {
        var e = KZ(a, d.copy), f = y_(a, b, c, d.paste);
        return {
            destroy: function () {
                e.destroy();
                f.destroy()
            }
        }
    }

    function C_() {
        var a = {
            latin: [{
                start: "A",
                finish: "Z"
            }, {start: "a", finish: "z"}, {start: "\u00c0", finish: "\u00ff"}],
            punctuation: [{start: "!", finish: "/"}, {start: ":", finish: "@"}, {start: "[", finish: "`"}, {
                start: "{",
                finish: "~"
            }, {start: "\u00a1", finish: "\u00bf"}, {start: "\u2010", finish: "\u2027"}, {
                start: "\u2030",
                finish: "\u205e"
            }],
            currency: [bg("$"), {start: "\u00a2", finish: "\u00a5"}, {
                start: "\u20a0",
                finish: "\u20bd"
            }, bg("\u5186"), bg("\u5143"), bg("\u5713"), bg("\u5706")],
            "extended-latin-a": [{start: "\u0100", finish: "\u017f"}],
            "extended-latin-b": [{
                start: "\u0180",
                finish: "\u024f"
            }],
            arrows: [{start: "\u2190", finish: "\u21ff"}, bg("\u2794"), {
                start: "\u2798",
                finish: "\u27af"
            }, {start: "\u27b1", finish: "\u27be"}],
            mathematical: [{start: "\u2795", finish: "\u2797"}, {start: "\u2200", finish: "\u22ff"}],
            miscellaneous: [{start: "\u2701", finish: "\u275e"}, {
                start: "\u2761",
                finish: "\u2793"
            }, bg("\u27b0"), bg("\u27bf")]
        }, b = {};
        Ma(a, function (a, d, e) {
            b[d] = ia(a, D_)
        });
        return b
    }

    function E_(a) {
        var b = H.create({insert: p(["string"]), close: p([])}), c = we(a);
        a = C_();
        a = F_.generateItems(a);
        var d = Wc.input("specialchar",
            "specialchar.selects"), e = yA(or.left(), a, B.resolve("specialchars"));
        n.add(e.body(), B.resolve("specialchar-body"));
        n.add(c.element(), B.resolve("specialchar-dialog"));
        z(A.children(e.element()), Vc.register);
        var f = K.bind(c.element(), "click", function (a) {
            a = a.target();
            L.closest(a, "[data-ephox-polish-special-char]").each(function (a) {
                Z.focus(a);
                a = m.get(a, "data-ephox-polish-special-char");
                var b = d.input(), c = fa.get(b);
                fa.set(b, c + a)
            })
        }), k = G_.controls("specialchar");
        c.setTitle(x.translate("specialchar.dialog"));
        c.setContent(e.element());
        c.setControls(k.element());
        y.after(e.element(), d.element());
        a = function () {
            c.hide();
            fa.set(d.input(), "");
            b.trigger.close()
        };
        var l = H_(e), g = I_(e), h = Kb.setup(c, k, [l, g, ha.input(d.input(), Ba.input({}))]);
        e.events.setActive.bind(function (a) {
            l.clickFocus(a.item().element())
        });
        c.events.close.bind(function () {
            h.exit();
            b.trigger.close()
        });
        k.events.cancel.bind(a);
        c.events.close.bind(a);
        k.events.insert.bind(function () {
            b.trigger.insert(fa.get(d.input()))
        });
        return {
            element: c.element(), events: b.registry,
            open: function () {
                c.show();
                h.enter()
            }, destroy: function () {
                f.unbind();
                c.destroy();
                e.destroy();
                k.destroy();
                h.destroy()
            }, close: function () {
                c.hide();
                fa.set(d.input(), "")
            }
        }
    }

    function J_(a, b) {
        var c = E_(b), d = H.create({insert: Q(["string"], c.events.insert), close: p([])}), e = function () {
            d.trigger.close();
            c.close()
        };
        c.events.close.bind(e);
        return {
            show: function () {
                a.toReading();
                c.open()
            }, close: e, destroy: function () {
                c.events.close.unbind(e);
                c.destroy()
            }, events: d.registry
        }
    }

    function K_(a) {
        var b = a.content(), c = a.smartview(),
            d = function (a) {
                a = r.fromText(a.string());
                sd.insertAtCursor(b, [a]).each(function (a) {
                    a = la.after(a.element());
                    b.setRelativeSelection(a, a);
                    b.focus();
                    b.toEditing()
                })
            }, e = hd.destroyable(), f = function () {
                e.clear()
            };
        return {
            ui: wb.ui({
                "specialchar.general": {
                    toggle: !1, value: "specialchar", textkey: x.key("specialchar.open"), action: function () {
                        var k = J_(b, c.uiContainer());
                        e.set(k);
                        k.events.close.bind(function () {
                            b.focus();
                            f()
                        });
                        k.events.insert.bind(function (a) {
                            d(a);
                            f()
                        });
                        a.content().hideInlineSelection();
                        k.show()
                    }, updateGeneral: t,
                    icon: !0, shortcut: !1, hasPopup: !1, hasDialog: !0
                }
            }), destroy: f
        }
    }

    function L_(a, b, c, d, e) {
        var f = a.content(), k = a.profile().nativeSpelling(), l = function (a) {
            m.set(a, "spellcheck", "false")
        }, q = function (a) {
            m.set(a, "spellcheck", "true")
        };
        f.runOrOnLoaded(function () {
            var a = k.get() ? q : l;
            f.body().each(a)
        });
        a = wb.ui({
            "spelling.general": {
                toggle: !0, value: "spellcheck", textkey: x.key("cog.spellcheck"), action: function () {
                    var a = !k.get();
                    k.setAndCache(a);
                    a = a ? q : l;
                    f.body().each(a)
                }, updateGeneral: function (a) {
                    (k.get() ? a.select : a.deselect)()
                },
                icon: !0, tooltip: qb.get
            }
        });
        return Eq({
            events: Gd(["analytics"]),
            init: t,
            hasDropdown: h(!1),
            hasAutocorrect: h(!1),
            check: t,
            scanView: t,
            lock: xb,
            situation: Jg.noSituation,
            handle: t,
            assign: t,
            destroy: function () {
                f.body().each(function (a) {
                    m.remove(a, "spellcheck")
                })
            },
            state: h({}),
            ui: a,
            lookup: h(g.none()),
            name: h("spelling-disabled")
        })
    }

    function M_(a, b, c) {
        var d = H.create({change: p(["language"])});
        a = c ? N_(a, d) : O_(a, b, d);
        return {ui: wb.ui(a), hasDropdown: h(c), events: d.registry}
    }

    function P_() {
        var a = [], b = !1, c = function () {
            b = !0;
            g.from(a.shift()).fold(function () {
                b =
                    !1
            }, function (a) {
                a.f()(a.area(), c)
            })
        };
        return {
            enqueue: function (d, e) {
                a.push(Q_(d, e));
                b || c()
            }, destroy: function () {
                a = []
            }
        }
    }

    function R_(a, b) {
        var c = na(a), d = P_(), e = function (a, d, e, g) {
            e = Sm.cata(e, function (a) {
                return ja.inBody(a) ? Tm.single(a, c.get(), b()) : Tm.empty()
            }, function (a, d, e, f) {
                return ja.inBody(a) && ja.inBody(e) ? Tm.range(a, d, e, f, c.get(), b()) : Tm.empty()
            });
            d(a, e, c.get(), g)
        };
        return {
            run: function (a, b, c) {
                e(a, b, c, ca)
            }, setLang: c.set, schedule: function (a, b, c, g) {
                d.enqueue(c, function (c, d) {
                    void 0 !== g && g() ? d() : e(a, b, c,
                        d)
                })
            }, destroy: function () {
                d.destroy()
            }
        }
    }

    function S_(a, b) {
        var c = function (b) {
            return E(b, function (b) {
                var c = mB.getInCache(a, b.lang(), b.words());
                return {zone: h(b), words: h(c), lang: b.lang}
            })
        }, d = function (a, b, c) {
            a(function () {
                z(b, function (a) {
                    T_.highlight(a.zone(), a.words(), c)
                })
            })
        };
        return {
            local: function (a, b, k, l) {
                b = b.zones();
                b = c(b);
                d(a, b, k);
                l()
            }, remote: function (c, f, k, l) {
                f = f.zones();
                U_.scan(a, b, f).get(function (a) {
                    d(c, a, k);
                    l()
                })
            }, destroy: t
        }
    }

    function V_(a, b, c) {
        var d = nB.initCaches(c), e = mm.post("ephox.spelling.service.many",
            W_.many(), a, b);
        return {
            checkMany: function (a, b, c) {
                c = yj.now();
                return nB.execute(e, d, a, b, c)
            }, dumpCache: function () {
                return eb(d, function (a) {
                    return a.dump()
                })
            }
        }
    }

    function X_(a, b, c, d, e) {
        var f = Y_.spelling(b), k = V_(f + "correction", a.newHeaders(), e), l = H.create({failed: p(["resource"])}),
            g = Ae.get(f + "autocorrect?language=" + c, Be.json(), he.xhr(), a.newHeaders()), C = lf.nu(function (a) {
                g.get(function (b) {
                    b.fold(function () {
                        a(b)
                    }, function (b) {
                        k.checkMany(c, ["startup"], !0).get(a)
                    })
                })
            });
        C.get(function (a) {
            a.fold(function (a) {
                console.error("Unable to communicate with the spelling service:",
                    wr.consoleMessage(a));
                l.trigger.failed(b)
            }, t)
        });
        return {
            correction: function (a, b, e, f) {
                C.get(function (l) {
                    l.fold(f, function () {
                        k.checkMany(d ? b : c, a.words).get(function (a) {
                            a.fold(function (a) {
                                console.error("Error response from the spelling service:", wr.consoleMessage(a));
                                f(a)
                            }, function (a) {
                                e(a)
                            })
                        })
                    })
                })
            }, autocorrect: h(g), events: l.registry, state: function () {
                return k.dumpCache()
            }
        }
    }

    function Z_(a) {
        var b = a.content(), c = a.profile(),
            d = X_(a.communication(), a.url(), a.language(), a.multilingual(), a.fromServiceState()),
            e = a.autocorrectOn() ? oB.active(d) : oB.inactive(), f = H.create({failed: p(["resource"])}),
            k = function (a) {
                f.trigger.failed(a.resource())
            };
        d.events.failed.bind(k);
        var l = R_(a.language(), a.viewable().viewport), g = S_(a.cache(), d), h = function (a) {
            b.body().each(function (b) {
                qm.filterDom(b, [hr("." + a, Na.unwrap)])
            })
        }, w = function () {
            return !vf.isOn(c.spelling().get())
        }, m = function () {
            h("ephox-cram-annotation-wrap")
        };
        return {
            run: function (a, b) {
                var d = c.spelling().get();
                vf.isOn(d) && (l.setLang(d), l.run(a, g.local, b), l.schedule(a,
                    g.remote, b, w))
            }, refresh: function () {
                var a = c.spelling().get();
                vf.isOn(a) || m()
            }, clear: m, lookup: e.lookup, destroy: function () {
                d.events.failed.unbind(k);
                l.destroy();
                g.destroy()
            }, state: d.state, events: f.registry
        }
    }

    function $_() {
        var a = H.create({incorrect: p(["substitution"])}), b = g.none(), c = {};
        c[Ee.spelling()] = function (c) {
            b.each(function (b) {
                b = Sr.substitute(b, m.get(c, Ee.value()));
                a.trigger.incorrect(b)
            })
        };
        return {
            assign: function (a) {
                b = a
            }, run: function (a) {
                var b = m.get(a, Ee.type());
                b = c[b];
                void 0 !== b && b(a)
            }, events: a.registry
        }
    }

    function a0(a, b, c) {
        var d = $_();
        d.events.incorrect.bind(function (c) {
            b.save();
            a.focus();
            a.domChanged();
            c.substitution().each(function (b) {
                pB.selectEnd(a, b)
            })
        });
        var e = u(function (a, b, c, d) {
            return a.marker(d).bind(a.detail).bind(function (a) {
                return c(a).map(function (a) {
                    return E(a, function (a) {
                        var c = {};
                        c[Ee.type()] = b;
                        c[Ee.value()] = a;
                        return b0(a, a, c)
                    })
                })
            })
        }, Sr, Ee.spelling(), function (a) {
            return c.suggestions(a.lang(), a.word())
        });
        return {
            assign: d.assign, handle: function (a) {
                d.run(a)
            }, situation: function (a) {
                a = e(a).getOr([]);
                return c0.generate(a, 4)
            }, destroy: t
        }
    }

    function d0(a, b) {
        var c = H.create({lookup: p(["element"])}), d = function () {
            a.getSelection().each(function (a) {
                c.trigger.lookup(a.startContainer())
            })
        };
        a.events.keyup.bind(function (a) {
            fe.isSpace(a) && d()
        });
        a.events.nodeChanged.bind(function (a) {
            a.prev().each(c.trigger.lookup)
        });
        return {events: c.registry, destroy: t}
    }

    function e0(a, b, c, d, e, f, k, l, g) {
        var q = a0(b, e, l), h = d0(b, c), m = function (a) {
            b.getSelection().each(function (b) {
                var c = kb.toLeaf(b.endContainer(), b.endOffset()), e = kb.toLeaf(b.startContainer(),
                    b.startOffset()), f;
                (f = b.collapsed()) || (f = !qB.isIE()) || (f = id.after(b.endContainer(), b.endOffset(), b.startContainer(), b.startOffset()));
                b = f && !qB.isFirefox() ? Sc(e.element(), e.offset(), c.element(), c.offset()) : b;
                return (f ? d.lightweightWith : xb)(a, b)
            })
        }, G = Hd.tap(function (a) {
            a = a.element();
            "body" !== D.name(a) && (a = Sm.single(a), n(a))
        });
        h.events.lookup.bind(function (a) {
            G.instance(a)
        });
        var n = function (a) {
            g.run(m, a)
        };
        return {
            destroy: function () {
                q.destroy();
                h.destroy()
            }, scan: n, situation: q.situation, lock: function (a) {
                var b =
                    G.control.isBlocked();
                G.control.block();
                a();
                b || G.control.unblock()
            }, assign: q.assign, handle: q.handle
        }
    }

    function f0(a, b, c, d, e) {
        e = b.language.getOr(e);
        var f = a.communication(), k = a.profile(), l = a.filter(), q = a.content(), C = a.operations(), w = a.undo(),
            J = a.smartview(), G = a.shortcuts(), n = a.context(), X = a.viewablearea();
        Tr.configure(l);
        a.profile().spelling().set(e);
        var r = g0(b.words), u = Z_(h0({
            communication: f,
            profile: k,
            content: q,
            undo: w,
            viewable: X,
            cache: r,
            url: c.url,
            autocorrectOn: c.autocorrect,
            language: d,
            fromServiceState: b.service,
            multilingual: c.multilingual
        })), v = g.none();
        b = H.create({analytics: p(["message"])});
        u.events.failed.bind(function (b) {
            b = mf.get("error.code.spelling.not.found", [b.resource()]);
            b = nj(b);
            a.ui().displayBanner(b)
        });
        q.events.ready.bind(function (a) {
            q.body().each(function (a) {
                m.set(a, "spellcheck", !1)
            });
            a = a.api().doc();
            a = e0(a, q, n, C, w, G, J, r, u);
            u.refresh();
            v = g.some(a)
        });
        d = M_(a, d, c.menu);
        d.events.change.bind(function (a) {
            (vf.isOn(a.language()) ? x : u.clear)();
            q.uiChanged();
            q.domChanged()
        });
        var y = function (a) {
            z(a, function (a) {
                a =
                    Sm.single(a);
                B(a)
            })
        }, x = c.scanView ? function () {
            var a = X.sections();
            y(a)
        } : u.clear;
        c.scanView && X.events.onChange.bind(x);
        var B = function (a) {
            v.each(function (b) {
                b.scan(a)
            })
        };
        return Eq({
            events: b.registry, destroy: function () {
                q.body().each(function (a) {
                    m.remove(a, "spellcheck")
                });
                v.each(function (a) {
                    a.destroy()
                });
                r.destroy();
                u.destroy()
            }, state: function () {
                return {words: r.state(), service: u.state(), language: g.some(a.profile().spelling().get())}
            }, init: t, hasDropdown: d.hasDropdown, hasAutocorrect: h(c.autocorrect), ui: d.ui,
            check: function (a, b, c, d) {
                a = Tr.isWrap(a) ? kb.toLeaf(a, b) : W.point(a, b);
                c = Tr.isWrap(c) ? kb.toLeaf(c, d) : W.point(c, d);
                c = Sm.range(a.element(), a.offset(), c.element(), c.offset());
                B(c)
            }, scanView: x, situation: function (a) {
                var b = {primary: h([]), secondary: h([]), submenus: h({})};
                return v.fold(h(b), function (b) {
                    return b.situation(a)
                })
            }, lock: function (a) {
                return v.fold(function () {
                    return a()
                }, function (b) {
                    return b.lock(a)
                })
            }, assign: function (a) {
                v.each(function (b) {
                    b.assign(a.bind(A.firstChild).or(a))
                })
            }, handle: function (a) {
                v.each(function (b) {
                    b.handle(a)
                })
            },
            lookup: u.lookup, name: h("spelling")
        })
    }

    function i0(a, b, c, d, e) {
        return (!0 === c.service ? f0 : L_)(a, b, c, d, e)
    }

    function rB(a) {
        var b = $d(a);
        n.add(b.element(), B.resolve("choice-button"));
        var c = T.span();
        m.set(b.element(), "title", x.translate("table." + a));
        m.set(b.element(), "tabindex", "-1");
        S.button(b.element(), x.translate("table." + a), !1);
        var d = ib.describe(b.element(), x.translate("aria.table.headerdescription"));
        y.append(b.element(), d);
        b.events.click.bind(function () {
            Z.focus(b.element());
            ra.pressed(b)
        });
        ma.add(c, [B.resolve(a),
            "ephox-pastry-icon-content", "ephox-polish-icon"]);
        b.content({element: h(c)});
        return b
    }

    function j0(a, b) {
        var c = !1, d = function (a, b, c) {
            var d = c.full();
            d.row() === b.rows() && d.column() === b.columns() || a.setSize(d.row(), d.column());
            a = a.setSelection(c.selection().row(), c.selection().column());
            Z.focus(a)
        };
        return {
            on: function () {
                c = !0
            }, off: function () {
                c = !1
            }, mousemove: function (e, f, k, l) {
                if (c) {
                    var g = Ia.get(e.element());
                    var h = sa.get(e.element());
                    g = Oa.dimensions(g, h);
                    h = bb.absolute(e.element());
                    h = Oa.coords(h.left(), h.top());
                    k = Oa.coords(k, l);
                    k = a.pickerCell(h, g, f, k);
                    k = sB.resize(k, b);
                    d(e, f, k)
                }
            }, manual: function (a, f, k, l) {
                c && (k = sB.grow(f, k, l, b), d(a, f, k))
            }
        }
    }

    function k0(a, b, c) {
        var d = H.create({select: p(["rows", "cols", "rowHeaders", "columnHeaders"])}), e = r.fromTag("table");
        S.presentation(e);
        S.hidden(e, !0);
        n.add(e, $g.table());
        var f = r.fromTag("tbody");
        y.append(e, f);
        var k = 0, l = 0, g = function (a, b) {
                k = b;
                l = a;
                C()
            }, C = function () {
                F.empty(f);
                var a = c.ids();
                ke.repeat(l, function (b) {
                    var c = r.fromTag("tr");
                    n.add(c, $g.row());
                    var d = ke.repeat(k, function (c) {
                        var d =
                            r.fromTag("td");
                        n.add(d, vd.resolve("cell-" + c + "-" + b));
                        n.add(d, $g.cell());
                        var e = r.fromTag("button");
                        m.set(e, "type", "button");
                        m.set(e, "aria-labelledby", a[b][c]);
                        n.add(e, $g.button());
                        y.append(d, e);
                        return d
                    });
                    P.append(c, d);
                    y.append(f, c)
                })
            }, w = function (a, b) {
                var c = cg.cells(e);
                z(c, function (a) {
                    n.remove(a, vd.resolve("picker-selected"))
                });
                c = cg.rows(e).slice(0, a);
                z(c, function (a, c) {
                    a = cg.cells(a).slice(0, b);
                    z(a, function (a, b) {
                        var d = cg.grid(e, "data-picker-header-row", "data-picker-header-col");
                        b = c < d.rows() || b < d.columns() ?
                            [vd.resolve("picker-selected"), vd.resolve("picker-header")] : [vd.resolve("picker-selected")];
                        ma.add(a, b)
                    })
                });
                m.set(e, "data-picker-col", b - 1);
                m.set(e, "data-picker-row", a - 1);
                a = cg.cells(c[c.length - 1]).slice(0, b);
                return cg.button(a[a.length - 1])
            }, J = function () {
                var a = parseInt(m.get(e, "data-picker-col"), 10) + 1, b = parseInt(m.get(e, "data-picker-row"), 10) + 1;
                return Oa.grid(b, a)
            }, G = {element: h(e), setSelection: w, setSize: g}, V = j0(a, b), X = K.bind(e, "mousemove", function (a) {
                V.mousemove(G, Oa.grid(l, k), a.raw().pageX, a.raw().pageY)
            }),
            t = function (a, b) {
                V.manual(G, J(), a, b)
            }, v = vm.realClick.bind(e, function (a) {
                x();
                a.raw().preventDefault()
            }), x = function () {
                var a = cg.grid(e, "data-picker-row", "data-picker-col"),
                    b = cg.grid(e, "data-picker-header-row", "data-picker-header-col");
                d.trigger.select(a.rows() + 1, a.columns() + 1, b.rows(), b.columns())
            };
        return {
            element: function () {
                return e
            },
            destroy: function () {
                v.unbind();
                X.unbind();
                F.remove(e)
            },
            setSize: g,
            setHeaders: function (a, b) {
                m.set(e, "data-picker-header-row", a);
                m.set(e, "data-picker-header-col", b)
            },
            setSelection: w,
            on: V.on,
            off: V.off,
            reset: function () {
                g(b.minRows, b.minCols);
                var a = w(1, 1);
                Z.focus(a)
            },
            refresh: function () {
                var a = J();
                C();
                return w(a.rows(), a.columns())
            },
            events: d.registry,
            sendLeft: u(t, a.isRtl() ? 1 : -1, 0),
            sendRight: u(t, a.isRtl() ? -1 : 1, 0),
            sendUp: u(t, 0, -1),
            sendDown: u(t, 0, 1),
            sendExecute: x
        }
    }

    function l0(a, b) {
        var c = Vg.createHelp(b.maxRows, b.maxCols, {
            row: function (a) {
                return x.translate("table.picker.rows", a)
            }, col: function (a) {
                return x.translate("table.picker.cols", a)
            }
        }), d = k0(a, b, c);
        S.label(d.element(), x.translate("table.picker.label"));
        b = ib.describe(d.element(), x.translate("table.picker.describepicker"));
        var e = r.fromTag("div");
        m.set(e, "tabIndex", "-1");
        S.group(e);
        ma.add(e, [B.resolve("insert-table"), B.resolve("toolbar-menu")]);
        a = r.fromTag("div");
        n.add(a, B.resolve("table-controls"));
        S.toolbarGroup(a, x.translate("table.picker.header"));
        var f = rB("row-header"), k = rB("column-header");
        P.append(a, [f.element(), k.element()]);
        P.append(e, [a, d.element(), b, c.help()]);
        var l = function () {
            d.setHeaders(f.selected() ? 1 : 0, k.selected() ? 1 : 0);
            var a = Z.active(),
                b = d.refresh();
            a.each(function (a) {
                Z.hasFocus(a) || Z.focus(b)
            })
        };
        c = function (a, b) {
            return function () {
                b();
                return g.some(!0)
            }
        };
        c = ha.single(d.element(), [ea.basic(R.LEFT()[0], c("left", d.sendLeft)), ea.basic(R.RIGHT()[0], c("right", d.sendRight)), ea.basic(R.UP()[0], c("up", d.sendUp)), ea.basic(R.DOWN()[0], c("down", d.sendDown)), ea.rule(ea.inSet(R.SPACE().concat(R.ENTER())), c("execute", d.sendExecute))], g.none());
        c.events.enter.bind(function () {
            Z.focus(d.element())
        });
        var q = ha.flow(a, {item: h(".ephox-pastry-statebutton")},
            Ba.flow({
                trigger: function (a) {
                    return L.descendant(a, ".ephox-pastry-button").map(function (a) {
                        a.dom().click();
                        return a
                    })
                }
            })), C = ha.multiple(e, [c, q]);
        f.events.click.bind(function () {
            q.clickFocus(f.element());
            l()
        });
        k.events.click.bind(function () {
            q.clickFocus(k.element());
            l()
        });
        c = H.create({
            select: Q(["rows", "cols", "rowHeaders", "columnHeaders"], d.events.select),
            exit: Q([], C.events.exit)
        });
        return {
            element: function () {
                return e
            }, destroy: function () {
                C.destroy();
                f.destroy();
                k.destroy();
                d.destroy()
            }, setSize: d.setSize,
            setSelection: d.setSelection, on: function () {
                d.on();
                C.enter()
            }, off: function () {
                d.off();
                C.isFocused() && C.exit()
            }, reset: function () {
                d.setHeaders(0, 0);
                f.deselect();
                ra.release(f.element());
                k.deselect();
                ra.release(k.element());
                d.reset()
            }, events: c.registry
        }
    }

    function m0(a, b) {
        var c = H.create({
            enabled: p(["enabled"]),
            select: p(["rows", "cols", "rowHeaders", "columnHeaders"]),
            insert: p(["table"]),
            done: p([]),
            abort: p([])
        });
        b = ua({minCols: 7, maxCols: 10, minRows: 4, maxRows: 10}, b);
        var d = l0(a, b);
        d.events.select.bind(function (a) {
            aa.detect().browser.isIE() ?
                (c.trigger.select(a.rows(), a.cols(), a.rowHeaders(), a.columnHeaders()), c.trigger.done(), e()) : (e(), c.trigger.done(), c.trigger.select(a.rows(), a.cols(), a.rowHeaders(), a.columnHeaders()))
        });
        d.events.exit.bind(function () {
            e();
            c.trigger.abort()
        });
        var e = function () {
            d.off()
        };
        return {
            element: d.element, open: function () {
                d.reset();
                d.on()
            }, close: e, destroy: function () {
                d.destroy()
            }, events: c.registry
        }
    }

    function n0() {
        var a = r.fromTag("fieldset"), b = r.fromHtml("<legend>" + x.translate("table.border") + "</legend>");
        y.append(a,
            b);
        var c = Ha("");
        b = function (a) {
            var b = r.fromTag("input");
            m.setAll(b, {type: "radio", id: "tableborder" + a + c, value: a, name: c});
            return b
        };
        var d = b("1"), e = b("0");
        P.append(a, [d, r.fromHtml('<label for="tableborder1' + c + '">' + x.translate("border.on") + "</label>"), e, r.fromHtml('<label for="tableborder0' + c + '">' + x.translate("border.off") + "</label>")]);
        var f = Kb.radio(a, 'input[type="radio"]', "input:checked");
        return {
            element: function () {
                return a
            }, get: function () {
                return Vj.find(a).map(function (a) {
                    return fa.get(a)
                })
            }, select: function (a) {
                Vj.set(e,
                    !1);
                Vj.set(d, !1);
                a.each(function (a) {
                    "0" === a ? Vj.set(e, !0) : "1" === a && Vj.set(d, !0)
                });
                f.refresh()
            }, keylayout: h(f), destroy: function () {
                F.remove(a)
            }
        }
    }

    function o0() {
        var a = T.div();
        n.add(a, B.resolve("table-size-controls"));
        var b = Wc.input("table-width", "table.width"), c = Wc.input("table-height", "table.height");
        E([b, c], function (a) {
            m.set(a.input(), "placeholder", "Auto")
        });
        P.append(a, [b.element(), c.element()]);
        var d = [ha.input(b.input(), Ba.input({})), ha.input(c.input(), Ba.input({}))], e = function (a) {
            var b = a.target();
            Mc.validateField(b, "width", g.some("px")).fold(function () {
                Mc.highlight(b)
            }, function (a) {
                Mc.dehighlight(b)
            })
        }, f = [K.bind(b.input(), "input", e), K.bind(c.input(), "input", e)];
        return {
            element: function () {
                return a
            }, get: function () {
                return Mc.validate([Mc.rule(b.input(), "width", g.some("px")), Mc.rule(c.input(), "height", g.some("px"))])
            }, set: function (a) {
                a.width().bind(u(fa.set, b.input()));
                a.height().bind(u(fa.set, c.input()))
            }, keylayouts: h(d), highlight: Mc.highlight, dehighlight: u(Mc.clearHighlights, a), destroy: function () {
                F.remove(a);
                z(f, function (a) {
                    a.unbind()
                })
            }
        }
    }

    function p0(a, b) {
        var c = H.create({ok: p(["properties"]), close: p([])}), d = we(b);
        d.setTitle(x.translate("table.dialog"));
        n.add(d.element(), B.resolve("dialog-narrow"));
        b = T.div();
        var e = AA("table.float"), f = Wc.input("tablesummary", "table.summary"),
            k = Wc.input("tablecaption", "table.caption"), l = o0(), q = n0();
        P.append(b, [k.element(), f.element(), q.element(), l.element(), e.element()]);
        var C = td.okCancel("table");
        C.events.ok.bind(function () {
            G()
        });
        C.events.cancel.bind(function () {
            d.hide();
            c.trigger.close()
        });
        d.events.close.bind(function () {
            d.hide();
            c.trigger.close()
        });
        d.setContent(b);
        d.setControls(C.element());
        var w = Kb.setup(d, C, [ha.input(k.input(), Ba.input({})), ha.input(f.input(), Ba.input({})), q.keylayout()].concat(l.keylayouts()).concat([e.keylayout()])),
            m = function () {
                return l.get().map(function (a) {
                    a = {width: h(g.some(a.width())), height: h(g.some(a.height()))};
                    return Ur.properties({
                        floatval: e.get(),
                        caption: fa.get(k.input()).trim(),
                        summary: fa.get(f.input()).trim(),
                        border: q.get(),
                        dimensions: a
                    })
                })
            },
            G = function () {
                m().fold(function (a) {
                    l.highlight(a)
                }, function (a) {
                    c.trigger.ok(a)
                })
            };
        return {
            element: d.element, events: c.registry, open: function () {
                d.show();
                w.enter()
            }, represent: function (b) {
                b = Ur.divine(a, b);
                e.select(b.floatval());
                void 0 !== b.summary() && fa.set(f.input(), b.summary());
                void 0 !== b.caption() && fa.set(k.input(), b.caption());
                l.set(b.dimensions());
                q.select(b.border())
            }, execute: G, destroy: function () {
                e.destroy();
                l.destroy();
                q.destroy();
                C.destroy();
                d.destroy();
                w.destroy()
            }, hide: function () {
                w.exit();
                d.hide()
            }
        }
    }

    function q0(a, b, c, d, e, f, k, l) {
        var q = g.none(), C = {
            "tablemenu-delete-table": Ac.erase,
            "delete-row": Ac.execute(b, nc.eraseRows, t, l),
            "delete-column": Ac.execute(b, nc.eraseColumns, t, l),
            "make-header-column": Ac.execute(b, nc.makeColumnHeader, t, l),
            "make-header-row": Ac.execute(b, nc.makeRowHeader, t, l),
            "unmake-header-column": Ac.execute(b, nc.unmakeColumnHeader, t, l),
            "unmake-header-row": Ac.execute(b, nc.unmakeRowHeader, t, l),
            "insert-row-before": Ac.execute(b, nc.insertRowBefore, t, l),
            "insert-row-after": Ac.execute(b, nc.insertRowAfter,
                t, l),
            "insert-column-before": Ac.execute(b, nc.insertColumnBefore, Vr.halve, l),
            "insert-column-after": Ac.execute(b, nc.insertColumnAfter, Vr.halve, l),
            "tablemenu-table-properties": function (b, d, l) {
                b = p0(a, k);
                var h = CA.generate(e, b, ["properties"]);
                h.events.ok.bind(function (a) {
                    c.activate();
                    q.each(function (b) {
                        sb.table(b.element(), c.isRoot).each(function (b) {
                            Pd.runTransaction(c, f, function () {
                                Ur.apply(b, a.properties())
                            })
                        })
                    });
                    h.destroy()
                });
                h.events.close.bind(function (a) {
                    h.destroy();
                    c.activate();
                    c.focus()
                });
                c.deactivate();
                h.represent(d);
                h.open();
                return g.none()
            },
            "cell-merge": Ac.execute(b, nc.mergeCells, t, l),
            "cell-unmerge": Ac.execute(b, nc.unmergeCells, t, l),
            "cell-split-cols": Ac.execute(b, nc.splitCellIntoColumns, Vr.halve, l),
            "cell-split-rows": Ac.execute(b, nc.splitCellIntoRows, t, l)
        }, w = O("value", "text", "attrs"), J = Uz.byClass(te);
        return {
            handle: function (a) {
                c.doc().each(function (b) {
                    q.each(function (b) {
                        var d = b.element();
                        sb.table(d, c.isRoot).each(function (d) {
                            var e = m.get(a, "data-ephox-gopher-item-value"), k = C[e];
                            void 0 !== k && Pd.runTransaction(c,
                                f, function () {
                                    k(c, d, b).each(function (a) {
                                        c.setSelection(a.startContainer(), a.startOffset(), a.endContainer(), a.endOffset());
                                        J.clear(d)
                                    })
                                })
                        })
                    })
                })
            }, assign: function (a) {
                q = a.bind(function (a) {
                    return sb.cell(a, c.isRoot).bind(function (a) {
                        return L.ancestor(a, "table").map(function (b) {
                            return Um.forMenu(d, b, a)
                        })
                    }).orThunk(function () {
                        return sb.notCell(a, c.isRoot).map(function (a) {
                            return Um.notCell(a)
                        })
                    })
                })
            }, situation: function (a) {
                a = q.map(function (a) {
                    var b = a.element();
                    b = sb.cell(b, c.isRoot).isSome();
                    return Qb([b ? [w("tablemenu-row",
                        x.translate("table.context.row.menu"), {})] : [], b ? [w("tablemenu-column", x.translate("table.context.column.menu"), {})] : [], [w("tablemenu-table", x.translate("table.context.table.menu"), {})], a.mergable().isSome() ? [w("cell-merge", x.translate("table.context.cell.merge"), {})] : [], a.unmergable().isSome() ? [w("cell-unmerge", x.translate("table.context.cell.unmerge"), {})] : [], b && 1 === a.selection().length && a.mergable().isNone() && a.unmergable().isNone() ? [w("cell-split-cols", x.translate("table.context.cell.split-cols"),
                        {}), w("cell-split-rows", x.translate("table.context.cell.split-rows"), {})] : []])
                }).getOr([]);
                var b = q.map(function (a) {
                    var b = a.element();
                    a = function (a, c, d) {
                        var e = a + "-menu", f = "th" === D.name(b) ? "unmake" : "make",
                            k = "make" === f ? "header" : "normal";
                        c = [w("insert-" + a + "-before", x.translate("table.context." + a + "." + c), {}), w("insert-" + a + "-after", x.translate("table.context." + a + "." + d), {}), w("delete-" + a, x.translate("table.context.common.delete"), {}), w(f + "-header-" + a, x.translate("table.context.common." + k), {})];
                        return {
                            textkey: h(x.key("table.context." +
                                a + ".title")), value: h(e), items: h(c)
                        }
                    };
                    var c = {
                        textkey: h(x.key("table.context.table.title")),
                        value: h("table-menu"),
                        items: h([w("tablemenu-table-properties", x.translate("table.context.table.properties"), {}), w("tablemenu-delete-table", x.translate("table.context.common.delete"), {})])
                    };
                    return Qb([[a("row", "insertabove", "insertbelow")], [a("column", "insertleft", "insertright")], [c]])
                }).getOr([]);
                return {
                    primary: h(a),
                    secondary: h(b),
                    submenus: h({
                        "tablemenu-row": "row-menu",
                        "tablemenu-column": "column-menu",
                        "tablemenu-table": "table-menu"
                    })
                }
            },
            destroy: t
        }
    }

    function r0() {
        var a = H.create({drag: p(["xDelta", "yDelta"])});
        return {
            mutate: function (b, c) {
                a.trigger.drag(b, c)
            }, events: a.registry
        }
    }

    function s0() {
        var a = H.create({drag: p(["xDelta", "yDelta", "target"])}), b = g.none(), c = r0();
        c.events.drag.bind(function (c) {
            b.each(function (b) {
                a.trigger.drag(c.xDelta(), c.yDelta(), b)
            })
        });
        return {
            assign: function (a) {
                b = g.some(a)
            }, get: function () {
                return b
            }, mutate: c.mutate, events: a.registry
        }
    }

    function t0(a, b, c) {
        var d = s0(), e = tj.transform(d, {}), f = g.none(), k = function (a, b) {
            return g.from(m.get(a,
                b))
        };
        d.events.drag.bind(function (a) {
            k(a.target(), "data-row").each(function (b) {
                b = Qd.getInt(a.target(), "top");
                v.set(a.target(), "top", b + a.yDelta() + "px")
            });
            k(a.target(), "data-column").each(function (b) {
                b = Qd.getInt(a.target(), "left");
                v.set(a.target(), "left", b + a.xDelta() + "px")
            })
        });
        var l = function (a, b) {
            var c = Qd.getInt(a, b);
            a = parseInt(m.get(a, "data-initial-" + b), 10);
            return c - a
        };
        e.events.stop.bind(function () {
            d.get().each(function (d) {
                f.each(function (e) {
                    k(d, "data-row").each(function (a) {
                        var b = l(d, "top");
                        m.remove(d,
                            "data-initial-top");
                        G.trigger.adjustHeight(e, b, parseInt(a, 10))
                    });
                    k(d, "data-column").each(function (a) {
                        var b = l(d, "left");
                        m.remove(d, "data-initial-left");
                        G.trigger.adjustWidth(e, b, parseInt(a, 10))
                    });
                    Fe.refresh(a, e, c, b)
                })
            })
        });
        var q = function (b, c) {
            G.trigger.startAdjust();
            d.assign(b);
            m.set(b, "data-initial-" + c, parseInt(v.get(b, c), 10));
            n.add(b, u0);
            v.set(b, "opacity", "0.2");
            e.go(a.parent())
        }, h = K.bind(a.parent(), "mousedown", function (a) {
            Fe.isRowBar(a.target()) && q(a.target(), "top");
            Fe.isColBar(a.target()) && q(a.target(),
                "left")
        }), w = function (b) {
            return N.eq(b, a.view())
        }, J = K.bind(a.view(), "mouseover", function (d) {
            "table" === D.name(d.target()) || Db.closest(d.target(), "table", w) ? (f = "table" === D.name(d.target()) ? g.some(d.target()) : L.ancestor(d.target(), "table", w), f.each(function (d) {
                Fe.refresh(a, d, c, b)
            })) : ja.inBody(d.target()) && Fe.destroy(a)
        }), G = H.create({
            adjustHeight: p(["table", "delta", "row"]),
            adjustWidth: p(["table", "delta", "column"]),
            startAdjust: p([])
        });
        return {
            destroy: function () {
                h.unbind();
                J.unbind();
                e.destroy();
                Fe.destroy(a)
            },
            refresh: function (d) {
                Fe.refresh(a, d, c, b)
            }, on: e.on, off: e.off, hideBars: u(Fe.hide, a), showBars: u(Fe.show, a), events: G.registry
        }
    }

    function v0(a, b) {
        var c = Wj.height;
        a = t0(a, b, c);
        var d = H.create({beforeResize: p(["table"]), afterResize: p(["table"]), startDrag: p([])});
        a.events.adjustHeight.bind(function (a) {
            d.trigger.beforeResize(a.table());
            var b = c.delta(a.delta(), a.table());
            Wr.adjustHeight(a.table(), b, a.row(), c);
            d.trigger.afterResize(a.table())
        });
        a.events.startAdjust.bind(function (a) {
            d.trigger.startDrag()
        });
        a.events.adjustWidth.bind(function (a) {
            d.trigger.beforeResize(a.table());
            var c = b.delta(a.delta(), a.table());
            Wr.adjustWidth(a.table(), c, a.column(), b);
            d.trigger.afterResize(a.table())
        });
        return {
            on: a.on,
            off: a.off,
            hideBars: a.hideBars,
            showBars: a.showBars,
            destroy: a.destroy,
            events: d.registry
        }
    }

    function w0(a, b) {
        var c = a.content(), d = a.keyboard(), e = a.undo(), f = a.smartview(), k = function () {
            return v.getOr(Xr.only(c.element()))
        }, l = q0(a.filter(), a.region(), c, a.selections(), d, e, f.uiContainer(), k), q = function (a, b, d) {
            e.save();
            z(b, function (b) {
                a(b, d)
            });
            e.save();
            c.focus()
        }, C = u(q, tB.setBackgroundColor);
        q = u(q, tB.setBorderColor);
        b = wb.ui({
            "table.widget": u(x0.widget, a, b), "cell.palette": h({
                items: [{
                    type: "widget",
                    build: u(uB.widget, a, b, {
                        action: C,
                        shortname: "background",
                        name: "cellbackgroundcolor",
                        textkey: "table.cell.color.background",
                        menuTextkey: "table.cell.color.background"
                    })
                }, {
                    type: "widget",
                    build: u(uB.widget, a, b, {
                        action: q,
                        shortname: "border",
                        name: "cellbordercolor",
                        textkey: "table.cell.color.border",
                        menuTextkey: "table.cell.color.border"
                    })
                }, {type: "widget", build: u(y0.widget, a)}, {
                    type: "dropdown", build: u(z0.widget,
                        a)
                }], updatePalette: function (b) {
                    var d = wf.selectedCells(a.selections(), c.isRoot),
                        e = u(b.show, g.some(x.translate("table.context.palette.show")));
                    b = u(b.hide, g.some(x.translate("table.context.palette.hide")));
                    (0 < d.length ? e : b)() && a.ui().refresh()
                }
            })
        }, ca);
        var w = function (b) {
            var d = b.stopper();
            bm.context(c).bind(function (e) {
                bm.cata(e, function (e) {
                    sb.cell(e.startContainer(), c.isRoot).each(function (e) {
                        (b.shift() ? vB.backward : vB.forward)(a.region(), c, e, k).fold(d, function (a) {
                            d();
                            c.setSelection(a.startContainer(),
                                a.startOffset(), a.endContainer(), a.endOffset())
                        })
                    })
                }, t)
            })
        }, m = function (a) {
            wB.upOrLeft(c)
        }, G = function (a) {
            wB.right(c)
        }, n = d.editor();
        n.on();
        n.events.tab.bind(w);
        n.events.left.bind(m);
        n.events.up.bind(m);
        n.events.right.bind(G);
        var p = c.cursor(), r = g.none(), v = g.none();
        c.events.ready.bind(function (b) {
            b = Rr.get(c, f, b.api().doc());
            v = g.some(b);
            var d = My(a.region().directionAt), k = v0(b, d);
            k.events.beforeResize.bind(e.save);
            k.events.afterResize.bind(function () {
                c.focus();
                e.save();
                c.domChanged();
                p.restore()
            });
            k.on();
            k.events.startDrag.bind(p.save);
            r = g.some(k);
            b = a.selections();
            b.events.beforeScan.bind(function () {
                k.hideBars()
            });
            b.events.afterScan.bind(function () {
                k.showBars()
            })
        });
        return {
            ui: b, destroy: function () {
                l.destroy();
                r.each(function (a) {
                    a.destroy()
                });
                n.off();
                n.events.tab.unbind(w);
                n.events.left.unbind(m);
                n.events.up.unbind(m);
                n.events.right.unbind(G);
                n.destroy()
            }, handle: l.handle, assign: l.assign, situation: l.situation, name: h("table")
        }
    }

    function A0() {
        var a = H.create({pasteUpload: p([]), uploadAssets: p(["assets"])});
        return {
            destroy: t,
            events: a.registry,
            pasteUpload: a.trigger.pasteUpload,
            uploadAssets: a.trigger.uploadAssets
        }
    }

    function B0(a, b) {
        a = a().uiContainer();
        var c = H.create({close: p([])}), d = we(a);
        d.setTitle(x.translate("wordcount.dialog"));
        ma.add(d.element(), [B.resolve("dialog-wordcount"), B.resolve("dialog-narrow")]);
        var e = b().body().getOrDie();
        a = Wh.toText(e, h(!1));
        e = Vb.get(e);
        b = b().getSelectedText().getOr("");
        a = xB.count(a);
        e = e.length;
        b = xB.count(b);
        var f = r.fromHtml(yB('<table class="ephox-polish-tabular ephox-polish-wordcount-table" tabindex="-1">    <thead>        <tr>            <th scope="col"> ${headerCounts}&nbsp;</th>            <th scope="col"> ${headerDocument}&nbsp;</th>            <th scope="col"> ${headerSelection}&nbsp;</th>        </tr>    </thead>    <tbody>        <tr>            <td>${wordCountLabel}&nbsp;</td>            <td class="ephox-polish-wordcount-document-words">${documentCountWords}&nbsp;</td>            <td class="ephox-polish-wordcount-selection-words">${selectionCountWords}&nbsp;</td>        </tr>        <tr>            <td>${wordCountCharsNoSpacesLabel}&nbsp;</td>            <td class="ephox-polish-wordcount-document-charsnospaces">${documentCharactersNoSpaces}&nbsp;</td>            <td class="ephox-polish-wordcount-selection-charsnospaces">${selectionCharactersNoSpaces}&nbsp;</td>        </tr>        <tr>            <td>${wordcountCharsLabel}&nbsp;</td>            <td class="ephox-polish-wordcount-document-chars">${documentCountCharsWithSpaces}&nbsp;</td>            <td class="ephox-polish-wordcount-selection-chars">${selectionCountCharsWithSpaces}&nbsp;</td>        </tr>    </tbody></table>',
            {
                headerCounts: x.translate("wordcount.counts"),
                headerDocument: x.translate("wordcount.document"),
                headerSelection: x.translate("wordcount.selection"),
                wordCountLabel: x.translate("wordcount.words"),
                wordCountCharsNoSpacesLabel: x.translate("wordcount.charactersnospaces"),
                wordcountCharsLabel: x.translate("wordcount.characters"),
                documentCountWords: a.words(),
                selectionCountWords: b.words(),
                documentCharactersNoSpaces: a.characters().withoutSpaces(),
                selectionCharactersNoSpaces: b.characters().withoutSpaces(),
                documentCountCharsWithSpaces: e,
                selectionCountCharsWithSpaces: b.characters().withSpaces()
            }));
        d.setContent(f);
        var k = ha.multiple(d.element(), []);
        b = function () {
            l();
            c.trigger.close()
        };
        var l = function () {
            d.hide()
        };
        d.events.close.bind(b);
        k.events.exit.bind(b);
        return {
            element: d.element, events: c.registry, open: function () {
                d.show();
                k.enter();
                Z.focus(f)
            }, destroy: function () {
                k.destroy();
                d.destroy()
            }, hide: l
        }
    }

    function C0(a, b) {
        var c = B0(a, b), d = H.create({close: p([])});
        c.events.close.bind(function () {
            d.trigger.close();
            c.destroy()
        });
        return {
            show: function () {
                c.open()
            },
            events: d.registry
        }
    }

    function D0(a) {
        var b = a.content, c = a.smartview;
        return {
            ui: wb.ui({
                "wordcount.general": {
                    toggle: !1,
                    value: "wordcount",
                    textkey: x.key("wordcount.open"),
                    action: function () {
                        var d = C0(c, b);
                        d.events.close.bind(function () {
                            a.ui().tabstrip.focused() || b().focus()
                        });
                        a.content().hideInlineSelection();
                        d.show()
                    },
                    updateGeneral: t,
                    icon: !0,
                    shortcut: !1,
                    hasPopup: !1,
                    hasDialog: !0
                }
            }), destroy: t
        }
    }

    function Vm(a, b, c) {
        var d = function (a, b, c, d) {
            return b.bundled ? a.apply(void 0, d.concat([b])) : c()
        }, e = E0(a, b, c);
        b = d(RU, a.formatting,
            Ta.basic, [e]);
        var f = d(PU, a.alignindent, Ta.basic, [e]), k = d(eV, a.bookmark, Ta.basic, [e]),
            l = d(gV, a.directionality, Ta.basic, [e]), q = d(w0, a.table, Ta.table, [e]),
            C = d(bV, a.blocktag, Ta.basic, [e]), w = d(NX, a.font, Ta.basic, [e]),
            J = d(D0, a.wordcount, Ta.basic, [e]), G = d(kZ, a.media, Ta.basic, [e]),
            n = d(K_, a.specialchar, Ta.basic, [e]), r = d(WY, a.linkvalidator, Ta.linkvalidator, [e, c.linkvalidator]),
            u = d(RY, a.link, Ta.basic, [e, r]), v = d(dY, a.horizontalrule, Ta.basic, [e]),
            x = d($X, a.help, Ta.dialog, [e]), y = function (b, c, d, f) {
                var k = a.ui.locale.code;
                k = void 0 !== k ? k : qf.get();
                return (!0 === c.bundled ? vf.determine(k) : g.none()).fold(function () {
                    return d()
                }, function (a) {
                    var d = e.profile().spelling().get(), k = !0 === c.menu || d === vf.offKey();
                    return b.apply(void 0, f.concat([c, a, k && !1 !== d ? d : a]))
                })
            }(i0, a.spelling, Ta.spelling, [e, c.spelling]), B = d(zZ, a.parlance, Ta.basic, [e, y]),
            D = d(HZ, a.resize, Ta.basic, [e]), F = d(eZ, a.macros, Ta.macros, [e, y, c.macros]),
            I = d(aY, a.highlighter, Ta.highlighter, [e, F]), K = d(hV, a.draganddrop, Ta.draganddrop, [e]), L = A0(),
            M = d(BY, a.imageEdit, Ta.imageEdit,
                [e, L]), N = d(gY, a.image, Ta.image, [e]),
            O = d(jX, a.fileupload, Ta.dialog, [e, L, M.insertResample(), K]),
            P = d(B_, a.smartclipboard, Ta.basic, [e, L, M.insertResample()]), S = d(vZ, a.mentions, Ta.basic, [e]),
            R = d(pX, a.findreplace, Ta.basic, [e]), T = d(KU, a.accessibility, Ta.basic, [e]),
            U = d(lV, a.embed, Ta.basic, [e, c.embed]);
        c = function () {
            var a = e.content();
            return a.body().fold(a.getContent, function (a) {
                a = Pc.deep(a);
                return Xj.output(e.filter(), a)
            })
        };
        var W = function (a) {
            var b = e.filter(), c = e.content();
            a = b.filterHtml(b.input(), a);
            c.resetContent(a);
            I.run();
            r.refresh();
            y.scanView();
            return a
        };
        d = d(DZ, {getContent: c, setContent: W, bundled: a.plaincodeview.bundled}, Ta.basic, [e]);
        e.contextmenu().register("table", q);
        e.contextmenu().register("imageEdit", M);
        e.contextmenu().register("image", N);
        e.contextmenu().register("spelling", y);
        e.contextmenu().register("link", u);
        var Z = F0({
            formatting: b,
            alignindent: f,
            bookmark: k,
            directionality: l,
            table: q,
            font: w,
            imageEdit: M,
            parlance: B,
            blocktag: C,
            wordcount: J,
            specialchar: n,
            media: G,
            link: u,
            linkvalidator: r,
            horizontalrule: v,
            help: x,
            fileupload: O,
            findreplace: R,
            accessibility: T,
            plaincodeview: d,
            macros: F,
            spelling: y
        });
        e.content().events.ready.bind(function () {
            e.ui().init(e.keyboard(), e.undo(), Z);
            y.init(e.content());
            I.run();
            r.refresh()
        });
        e.content().events.loaded.bind(function () {
            setTimeout(function () {
                Y.trigger.loaded();
                aa()
            }, 0)
        });
        var Y = H.create({
            loaded: p([]),
            ready: Q([], e.content().events.ready),
            focus: p([]),
            change: p([]),
            dirty: Q([], e.laundry().events.dirty),
            internal: p(["command", "data"]),
            paint: p(["dimensions"])
        }), aa = e.content().isInline() ?
            t : function () {
                e.content().body().each(function (a) {
                    a = A.documentElement(a);
                    var b = e.content().element();
                    Y.trigger.paint(iy({
                        width: Ia.get(b),
                        docWidth: Ia.get(a),
                        height: sa.get(b),
                        docHeight: sa.get(a)
                    }))
                })
            };
        e.undo().events.changed.bind(function () {
            Y.trigger.change()
        });
        e.undo().events.reset.bind(function () {
            Y.trigger.change()
        });
        e.content().events.paint.bind(aa);
        e.content().events.nodeChanged.bind(aa);
        e.content().events.focus.bind(function () {
            Y.trigger.focus()
        });
        e.internalevents().events.internal.bind(function (a) {
            var b =
                a.command();
            "insertLink" === b && (a = m.get(a.data(), "href"), Y.trigger.internal(b, a))
        });
        d = e.content().isInline() ? function () {
            var a = e.ui(), b = e.content(), c = a.state();
            c = void 0 !== c.toolbar && void 0 !== c.toolbar.drag ? c.toolbar.drag.isSome() : !1;
            b.activate();
            b.focus();
            e.viewablearea().setOn();
            c || a.position();
            a.refresh()
        } : t;
        b = e.content().isInline() ? function () {
            e.content().deactivate();
            e.content().blur();
            e.viewablearea().setOff()
        } : t;
        return kj.internal({
            activateInline: d,
            deactivateInline: b,
            element: e.ui().element,
            viewport: e.ui().viewport,
            connect: e.ui().connect,
            focus: e.content().focus,
            blur: e.content().blur,
            getContent: c,
            toTransfer: Pb(Lf.changed, c),
            setContent: function (a) {
                var b = e.undo();
                b.disable(function () {
                    var c = W(a);
                    b.reset(c)
                });
                e.laundry().setDirty(!1)
            },
            insertHtmlAtCursor: e.insertFilteredHtmlAtCursor,
            isDirty: e.laundry().isDirty,
            setDirty: e.laundry().setDirty,
            fromTransfer: function (a) {
                var b = e.undo();
                Lf.cata(a, function (a) {
                    b.disable(function () {
                        W(a)
                    });
                    b.replaceTop()
                }, function (a) {
                    W(a);
                    b.save()
                })
            },
            uploader: h(L),
            state: function () {
                var a = e.state();
                return ua(a, {
                    spelling: y.state(),
                    macros: F.state(),
                    filters: e.filter().customFilters().state(),
                    linkvalidator: r.state(),
                    embed: U.state()
                })
            },
            destroy: function () {
                e.content().deactivate();
                var a = E(Ze(Z), xb);
                z(a.concat([U, N, M, y, D, F, I, L, P, S, e, K]), function (a) {
                    a.destroy()
                })
            },
            events: Y.registry,
            communication: e.communication,
            fullscreen: e.fullscreen,
            content: e.content,
            ui: e.ui,
            undo: e.undo,
            smartview: e.smartview,
            keyboard: e.keyboard,
            filter: e.filter,
            operations: e.operations,
            macros: h(F),
            getMode: hc.pencil,
            isPrettyPrinting: function () {
                return !0 ===
                    a.content.prettyprint
            }
        })
    }

    function G0(a, b) {
        var c = Ta.state(b), d = na(null), e = r.fromTag("div"), f = function () {
            Ea.set(e, '<div class="e-p-s-img"></div>');
            k()
        }, k = void 0 === a.content.inline ? t : function () {
            if (!1 === a.ui.toolbar.visible) v.set(e, "display", "none"); else {
                var b = {isInline: h(!0), element: h(a.content.inline)};
                b = qd.offsetFrom(b, e, sa.get(e), a.ui);
                v.setAll(e, {position: "absolute", left: b.left + "px", top: b.top - 4 + "px"})
            }
        }, l = null;
        b = yb("API unavailable while the editor is loading");
        var q = {
            body: h(g.none()), doc: b, execCommand: b,
            getSelectedText: b, focus: b, deactivate: t, blur: t
        }, C = void 0 === a.content.inline ? d.get : function () {
            return Ea.get(a.content.inline)
        };
        return kj.internal({
            activateInline: k,
            blur: b,
            communication: h(oz(a)),
            connect: function (a) {
                l = setTimeout(f, 1E3);
                y.append(a, e);
                Yr.add();
                return !1
            },
            content: h(q),
            deactivateInline: t,
            destroy: function () {
                clearTimeout(l);
                Yr.remove();
                F.remove(e)
            },
            element: h(e),
            events: Id.events(),
            failure: function () {
                clearTimeout(l);
                Yr.remove();
                Ea.set(e, "<p>Unable to load editor. See browser console for details.</p>")
            },
            filter: c.filter,
            focus: b,
            fromTransfer: function (a) {
                Lf.cata(a, d.set, d.set)
            },
            fullscreen: Ta.fullscreen,
            getContent: C,
            getMode: b,
            insertHtmlAtCursor: b,
            isDirty: c.laundry.isDirty,
            isPrettyPrinting: function () {
                return !0 === a.content.prettyprint
            },
            keyboard: Id.keyboard,
            macros: c.macros,
            operations: Id.operations,
            setContent: function (b) {
                void 0 === a.content.inline ? d.set(b) : Ea.set(a.content.inline, b);
                c.laundry.setDirty(!1)
            },
            setDirty: c.laundry.setDirty,
            smartview: Id.smartview,
            state: function () {
                var a = xf.isEmpty(C()) ? {} : {content: {}};
                return c.getState(a)
            },
            toTransfer: Pb(Lf.unchanged, C),
            ui: Id.ui,
            undo: h(Ta.undo()),
            uploader: h(Ta.uploader()),
            viewport: h(e)
        })
    }

    function H0(a, b) {
        return (!0 === b.bundled ? I0 : J0)(a, b)
    }

    function K0(a, b) {
        var c = H.create({change: p(["type"])}),
            d = yf.removeClasses([B.resolve(hc.none()), B.resolve(hc.wait()), B.resolve(hc.pencil()), B.resolve(hc.code())]),
            e = T.div();
        S.hidden(e, "true");
        ma.add(e, [B.resolve("html-switch-wrapper"), B.resolve("layer-editor")]);
        var f = T.div();
        ma.add(f, [B.resolve("html-switch"), B.resolve("icon")]);
        y.append(e, f);
        var k = function (a) {
            d(f);
            n.add(f, B.resolve(a));
            m.set(f, "data-icon", a);
            m.remove(f, "title")
        }, l = function (a, b) {
            var c = m.get(f, "data-icon");
            a !== c && (r = c, k(a), m.set(f, "title", b))
        }, g = function (a) {
            b.showButton && a !== hc.none() ? l(a, x.translate("toolbar.switch-" + a)) : k(hc.none());
            w.control.unblock()
        }, h = hd.unbindable(), w = Hd.tap(function () {
            c.trigger.change(m.get(f, "data-icon"))
        });
        b.showButton && h.set(K.bind(e, "click", w.instance));
        var J = function (a) {
            y.append(a, e)
        }, G = ae.onDirection("right", "left"), r = hc.none();
        g(r);
        return {
            render: J, destroy: function () {
                F.remove(e);
                h.clear()
            }, switchto: g, spin: function () {
                l(hc.wait(), x.translate("loading.wait"));
                w.control.block()
            }, stopSpin: function () {
                "spin" !== r && g(r)
            }, init: function (b) {
                var c = a.get();
                J(c.viewport());
                c.events.paint.bind(function (a) {
                    var b = a.dimensions();
                    a = G(c.element());
                    b = "left" === a && (zB.isFirefox() || zB.isChrome()) ? 0 : b.width() - b.docWidth();
                    v.set(e, a, b + "px")
                });
                g(hc.none())
            }, events: c.registry
        }
    }

    function L0(a, b, c, d, e, f) {
        var k = r.fromTag("div"), l = c.uiContainer(), g = T.div();
        d.updateUi(k);
        d = [Mg.editorContainer(), "ephox-textbox-font", B.resolve("layer-editor"), B.resolve("editor-main"), B.resolve("fullscreen-maximized")];
        ma.add(k, d);
        m.set(k, "lang", qf.get());
        Zr.addClasses(k);
        y.append(k, l);
        var C = By(a, k, {}), w = df.toolbar(C, x.translate);
        b.events.toolbar.bind(w.enter);
        w.events.exit.bind(a.focus);
        var J = Ay(), G = ja.body(), p = T.div();
        n.add(p, B.resolve("socket"));
        var X = E(["dragover", "drop"], function (a) {
            return K.bind(p, a, function (a) {
                a.kill()
            })
        }), t = T.div();
        n.add(t, B.resolve("widget-container"));
        C.integrate(k, w, J, p, t);
        Ky.build(k, e.sideBar, e.bottomBar);
        var u = dA({layerClass: B.resolve("layer-below-editor"), background: "rgba(255, 255, 255, 0.92)"}),
            v = B.resolve("body-fullscreen");
        a.events.paint.bind(function (a) {
            w.repaint();
            c.refresh()
        });
        return {
            element: h(k), socket: function (a) {
                y.append(p, a.element())
            }, viewport: h(p), uiContainerParent: h(g), connect: function (a) {
                u.show();
                n.add(G, v);
                y.append(a, k);
                lj.detect(k);
                return !0
            }, destroy: function () {
                z(X, function (a) {
                    a.unbind()
                });
                w.destroy();
                n.remove(G, v);
                F.remove(k);
                F.remove(g);
                u.destroy();
                J.destroy()
            }, banners: J.element, displayBanner: J.display, hideBanner: J.hide, position: function () {
                C.init(w, J, p, t, e, f)
            }, refresh: function () {
                C.update();
                w.refresh()
            }, toolbar: w, dialogContainer: h(t)
        }
    }

    function M0(a) {
        var b = g.none(), c = g.none(), d = H.create({maximize: p([]), restore: p([])}), e = function (c) {
            b = A.parent(a.get().element());
            b.getOrDie("maximize called on editor that is not in the DOM.");
            a.swap(Vm, {
                ui: {layout: N0, isFullScreen: !0, autoresize: !1}, fullscreen: {
                    layout: void 0 !== c.layout() ? c.layout() :
                        $r
                }, content: {autoresize: !1}
            }).destroy();
            var e = a.get();
            e.fullscreen().select();
            e.connect(ja.body());
            e.events.ready.bind(function () {
                e.focus();
                d.trigger.maximize()
            })
        }, f = function (c) {
            a.swap(Vm, {ui: {layout: void 0 !== c.layout() ? c.layout() : $r, isFullScreen: !1}}).destroy();
            var e = a.get();
            e.fullscreen().deselect();
            c = b.getOrDie("restore called on editor that was not previously in the DOM.");
            a.get().connect(c);
            e.events.ready.bind(function () {
                e.focus();
                d.trigger.restore()
            })
        };
        return {
            init: function (b) {
                if (Wm.goingToDesign(b)) {
                    b =
                        a.get();
                    var d = a.get().element();
                    c.each(function (a) {
                        if (N.eq(a, d)) throw"Fullscreen init called twice on the same instance";
                    });
                    c = g.some(d);
                    b.fullscreen().events.maximize.bind(e);
                    b.fullscreen().events.restore.bind(f)
                }
            }, destroy: function () {
            }, events: d.registry
        }
    }

    function O0() {
        var a = [];
        return {
            setCallback: function (b) {
                vb(b) && a.push(b)
            }, done: function (b) {
                z(a, function (a) {
                    a.apply(null, [b])
                });
                a = []
            }
        }
    }

    function P0(a) {
        var b = function () {
            var b = a.url, c = b.lastIndexOf("/");
            b = 0 < c ? b.substr(0, c) : b;
            b = void 0 === a.basePath ? b : a.basePath;
            return je(b, "/") ? b : b + "/"
        }(), c = function (c, e, f) {
            var d = Yj.getFilename(c, e);
            e = !0 === a.credentials ? he.xhr() : he.none();
            c = AB.file(Yj.buildData("image", c, d));
            Ae.post(a.url, c, Be.text(), e).map(function (a) {
                a.fold(function (a) {
                    f(I.error(Yj.failureObject(a.message(), a.status(), a.responseText())))
                }, function (a) {
                    try {
                        var c = Nb.parse(a);
                        if (xa(c.location)) var e = c.location; else {
                            f(I.error(Yj.failureObject("JSON response did not contain a string location", 500, a)));
                            return
                        }
                    } catch (J) {
                        e = a
                    }
                    a = e.split(/\s+/);
                    a = Cr.resolve(b, 1 ===
                    a.length && "" !== a[0] ? a[0] : d);
                    f(I.value({location: a}))
                })
            })
        };
        return {
            upload: function (a, b, f) {
                a = a.imageresult();
                Yc.imageResultToBlob(a).then(function (a) {
                    c(a, b, f)
                })
            }
        }
    }

    function Q0(a) {
        var b = function (b, d, e, f) {
            var c = function (a) {
                f(I.error(a))
            }, l = function (a) {
                xa(a) ? f(I.value({location: a})) : (console.error("Image upload result was not a string"), c(""))
            }, g = Yj.getFilename(b, e), h = R0(e, g, b, d);
            setTimeout(function () {
                a(h, l, c)
            }, 0)
        };
        return {
            upload: function (a, d, e) {
                var c = a.imageresult();
                Yc.imageResultToBlob(c).then(function (a) {
                    b(a,
                        Yc.imageResultToDataURL(c), d, e)
                })
            }
        }
    }

    function S0() {
        var a = {}, b = function (a) {
            dg.revokeObjectURL(a.objurl())
        };
        return {
            add: function (b, d, e) {
                d = T0(b, d, e);
                return a[b] = d
            }, get: function (b) {
                return g.from(a[b])
            }, remove: function (c) {
                var d = a[c];
                delete a[c];
                void 0 !== d && b(d)
            }, lookupByData: function (b) {
                return U0(a, function (a) {
                    return Yc.imageResultToDataURL(a.imageresult()) === b
                })
            }, destroy: function () {
                Ma(a, b);
                a = {}
            }
        }
    }

    function V0() {
        var a = [], b = [], c = H.create({complete: p(["response"])}), d = function (d) {
            a = ka(a, function (a, b) {
                return a !==
                    d
            });
            !1 === e() && (c.trigger.complete(b), b = [])
        }, e = function () {
            return 0 < a.length
        };
        return {
            findById: W0, findAll: X0, register: function (b, c) {
                m.set(b, Xm, c);
                a.push(c)
            }, report: function (a, c, e) {
                z(c, function (a) {
                    m.remove(a, Xm);
                    b.push({success: e, element: a.dom()})
                });
                d(a)
            }, inProgress: e, isActive: function (b) {
                return U(a, b)
            }, events: c.registry
        }
    }

    function Y0(a, b) {
        var c = S0(), d = O0(), e = V0(), f = nr(a.ui), k = Z0.choose(b, f, a.communication()), l = k.uploader(),
            q = k.errors(), h = $0.instance(b, c), w = H.create({begin: p([]), finish: p([])}), m = function (a) {
                w.trigger.finish();
                d.done(a)
            };
        e.events.complete.bind(function (a) {
            m(a.response())
        });
        var G = function (a, b, d, f) {
            Zj.handleUpload(l, e, c, a, b, d, function (a) {
                a.fold(function (a) {
                    f(a)
                }, r)
            })
        }, n = function (d) {
            a.content().body().each(function (a) {
                var e = q.instance(), f = Zj.registerAssets(c, a, d.assets());
                f = Rj.partition(f);
                z(f.errors, function (a) {
                    console.error(a)
                });
                0 < f.values.length && !0 === b.immediate && (w.trigger.begin(), z(f.values, function (b) {
                    t(a, b, e)
                }))
            })
        }, r = function (b, c, d) {
            a.undo().rewrite(d.objurl(), b.location)
        }, t = function (a, c, d) {
            !1 !== b.bundled &&
            Zj.prepareForUpload(e, c.blobInfo().id(), c.image()).each(function (b) {
                G(a, b, c.blobInfo(), d)
            })
        }, u = function (a) {
            z(a, function (a) {
                e.report(a, g.none(), !1)
            })
        }, v = function (a, b) {
            b = Rj.partition(b);
            var c = b.values;
            u(b.errors);
            var d = q.instance();
            h(c).get(function (b) {
                b = Rj.partition(b);
                0 < b.errors.length && (f.showKey("imageedit.generic"), console.error("Image resample on upload errors: ", b.errors), u(b.errors));
                z(b.values, function (b) {
                    t(a, b, d)
                })
            })
        }, y = function (f) {
            vb(f) && d.setCallback(f);
            w.trigger.begin();
            !0 !== b.bundled ?
                m([]) : a.content().body().fold(function () {
                    m([])
                }, function (a) {
                    var b = Zj.findBlobs(e, c, a);
                    0 !== b.length || e.inProgress() ? v(a, b) : m([])
                })
        };
        return {
            init: function (d) {
                Wm.goingToDesign(d) && (d = a.filter(), a1.configure(d, c), a.uploader().events.uploadAssets.bind(n), a.uploader().events.pasteUpload.bind(function () {
                    !0 === b.immediate && y()
                }));
                f.reset()
            }, events: w.registry, reconstitute: y, destroy: function () {
                c.destroy()
            }
        }
    }

    function b1(a, b, c, d) {
        var e = M0(a), f = Y0(b, c.imageupload), k = H0(a, c.codeview), l = K0(a, c.codeview), g = [e, f, l],
            h = g.concat([k]);
        e.events.restore.bind(function () {
            d.restore();
            m(h, hc.code())
        });
        e.events.maximize.bind(function () {
            d.save();
            m(g, hc.code())
        });
        f.events.begin.bind(l.spin);
        f.events.finish.bind(l.stopSpin);
        k.events.change.bind(function (c) {
            a.get().events.loaded.bind(function () {
                b.focus()
            });
            b.reconnect()
        });
        l.events.change.bind(function (a) {
            w(a.type())
        });
        k.events.ready.bind(function (a) {
            l.switchto(a.type())
        });
        var w = function (b) {
            f.reconstitute(function () {
                a.get().getMode() !== b && (l.spin(), k.setMode(b))
            })
        }, m = function (a,
                         b) {
            z(a, function (a) {
                a.init(b)
            })
        };
        b.events.connected.bind(function () {
            m(h, Wm.alternate(b.getMode()))
        });
        return {
            setMode: w, uploadImages: f.reconstitute, destroy: function () {
                l.destroy();
                a.destroy();
                z(h, function (a) {
                    a.destroy()
                })
            }
        }
    }

    function c1(a) {
        var b = d1(a);
        return {
            directionAt: function (a) {
                return "rtl" === (D.isText(a) ? A.parent(a) : g.some(a)).map(ae.getDirection).getOr("ltr") ? BB : CB
            }, uiDirection: function () {
                return b ? BB : CB
            }, updateUi: function (a) {
                m.set(a, "dir", b ? "rtl" : "ltr")
            }, destroy: t
        }
    }

    function e1(a, b) {
        var c = H.create({
            create: p(["instance"]),
            loaded: p([]), focus: p([]), dirty: p([]), change: p([]), internal: p(["command", "data"])
        }), d = gc(function () {
            c.trigger.loaded()
        }), e = function (a) {
            a.events.focus.bind(function () {
                c.trigger.focus()
            });
            a.events.dirty.bind(function () {
                c.trigger.dirty()
            });
            a.events.change.bind(function () {
                c.trigger.change()
            });
            a.events.internal.bind(function (a) {
                c.trigger.internal(a.command(), a.data())
            });
            a.events.loaded.bind(d)
        };
        e(a);
        var f = a, k = Pb(c1, qf.get);
        return {
            get: function () {
                return f
            }, swap: function (a, d) {
                var l = f;
                d = oa(b, d);
                var g = l.state();
                a = a(d, k(), g);
                e(a);
                c.trigger.create(a);
                f = a;
                return {
                    old: h(l), nu: h(a), destroy: function () {
                        l.destroy()
                    }
                }
            }, destroy: function () {
                f.destroy()
            }, events: c.registry
        }
    }

    function as(a, b) {
        var c = f1(a);
        ak.setLanguage(c.ui.locale.code);
        a = oa(DB.state(), b);
        b = Vc.capture(r.fromDom(document), window);
        var d = G0(c, a), e = e1(d, c), f = rU(e);
        a = b1(e, f, c, b);
        b = H.create({
            loaded: Q([], e.events.loaded),
            focus: Q([], e.events.focus),
            dirty: Q([], e.events.dirty),
            change: Q([], e.events.change),
            connected: Q([], f.events.connected),
            internal: Q(["command", "data"],
                e.events.internal)
        });
        ak.waitForLoad().get(function (a) {
            a = ak.getFailures(a);
            if (0 === a.length) {
                a = e.swap("code" === c.codeview.mode ? gy : Vm);
                f.reconnect();
                var b = function (a) {
                    xf.isEmpty(a) || f.setContent(a)
                }, k = a.old().toTransfer();
                Lf.cata(k, b, b);
                a.destroy()
            } else z(a, function (a) {
                console.error(a)
            }), console.error("Required resources are not available. Cancelling editor load."), d.failure()
        });
        return kj.external({
            activateInline: f.activateInline,
            communication: Id.communication,
            connect: f.connect,
            content: f.content,
            deactivateInline: f.deactivateInline,
            element: f.element,
            events: b.registry,
            filter: f.filter,
            focus: f.focus,
            getContent: f.getContent,
            getMode: f.getMode,
            insertHtmlAtCursor: f.insertHtmlAtCursor,
            isDirty: f.isDirty,
            isPrettyPrinting: f.isPrettyPrinting,
            keyboard: f.keyboard,
            macros: f.macros,
            operations: f.operations,
            setContent: f.setContent,
            setDirty: f.setDirty,
            smartview: f.smartview,
            state: f.state,
            ui: f.ui,
            undo: f.undo,
            setMode: a.setMode,
            uploadImages: a.uploadImages,
            destroy: a.destroy
        })
    }

    function g1(a, b, c) {
        n.add(b, be.base());
        return {
            toolbarShow: function () {
                n.add(b,
                    be.active());
                v.set(a(), "display", "block")
            }, toolbarHide: function () {
                n.remove(b, be.active());
                v.set(a(), "display", "none")
            }, isVisible: function () {
                return n.has(b, be.active())
            }, restore: function () {
                ma.remove(b, [be.base(), be.active()]);
                m.setAll(b, c)
            }
        }
    }

    function h1(a) {
        var b = !1;
        return {
            submit: function () {
                b = !0;
                a.submit[0] ? a.submit[0].click() : a.submit.click ? a.submit.click() : a.submit();
                b = !1
            }, inprogress: function () {
                return b
            }
        }
    }

    function i1(a) {
        var b = function (b, d) {
            var c = gc(function () {
                var b = oa, c = void 0 !== d ? d : {};
                var e = oa;
                var g =
                    j1(c), h = void 0 === c.privateapi ? {} : c.privateapi;
                c = Ob(h.ui, [ba.func("bounds"), ba.bool("showHelpHint"), ba.domElement("bottomBar"), ba.domElement("sideBar")]);
                var w = Ob(h.integration, [ba.string("type"), ba.string("version")]),
                    m = Ob(void 0 === h.content ? {} : h.content, [ba.string("base"), ba.arrayOfStrings("imageExcludes")]),
                    G = EB.paramList(), n = Ob(h.mentions, G), p = cb(n).length;
                h = Ob(h.output, [ba.bool("prettyprint")]);
                if (0 < p) {
                    if (p !== G.length) throw Error("Missing @mentions configuration. Expected " + G.length + " objects, was " +
                        p);
                    n.bundled = !0
                }
                c = {ui: c, help: {integration: w}, content: ua(m, h), mentions: n};
                e = e(g, c);
                b = b(e, a);
                return FB.setupResources(b)
            });
            return {constructors: h(b), options: c}
        };
        return {
            classic: function (a) {
                return b(k1, a)
            }, inline: function (a) {
                a = oa({ui: {toolbar: {draggable: !0}}}, a);
                return b(l1, a)
            }
        }
    }

    function m1(a) {
        var b = wT(), c = i1(a), d = function (a, c) {
            a = xa(a) ? Fa.one(a).getOrThunk(yb("Selector did not match any elements: " + a)) : r.fromDom(a);
            return b.getOrCreate(a, c)
        }, e = function (a, b) {
            xa(a) ? console.error("Selector did not match a " +
                b + ": ", a) : console.error("Element was not a " + b + ": ", a);
            throw Error("Unable to create textbox.io editor");
        }, f = aa.detect(), k = function (a) {
            xa(a) || Tb(a, [ba.domElement("element")]);
            return xa(a) ? Fa.all(a) : E(a, r.fromDom)
        }, l = function (a, c) {
            a = k(a);
            a = E(a, function (a) {
                return b.getOrCreate(a, c)
            });
            return ee(a)
        };
        return Sl.makeReadOnly({
            replace: function (a, b) {
                Tb(arguments, [ba.stringOrDom("element"), Ym.object("options")]);
                return d(a, c.classic(b)).getOrThunk(u(e, a, "div or textarea"))
            }, replaceAll: function (a, b) {
                Tb(arguments,
                    [ba.stringOrArray("elements"), Ym.object("options")]);
                return l(a, c.classic(b))
            }, inline: function (a, b) {
                if (f.deviceType.isTouch()) throw Error("Mobile does not not support inline editing");
                Tb(arguments, [ba.stringOrDom("element"), Ym.object("options")]);
                return d(a, c.inline(b)).getOrThunk(u(e, a, "supported tag for inline editing"))
            }, inlineAll: function (a, b) {
                if (f.deviceType.isTouch()) throw Error("Mobile does not not support inline editing");
                Tb(arguments, [ba.stringOrArray("elements"), Ym.object("options")]);
                return l(a,
                    c.inline(b))
            }, get: function (a) {
                Tb(arguments, [ba.string("selector")]);
                return b.get(a)
            }, getActiveEditor: function () {
                return b.getActiveEditor().getOr(null)
            }, definePlugin: function (a, b) {
                Tb(arguments, [ba.string("namespace"), ba.object("code")]);
                Bq.get(a).each(function () {
                    throw Error("namespace " + a + " is already defined");
                });
                if (void 0 === b.initialize || !vb(b.initialize)) throw Error("plugin does not have an initialize function");
                return Bq.register(a, b)
            }, version: Vx, isSupported: Jb
        })
    }

    var t = function () {
            for (var a = 0; a <
            arguments.length; a++) ;
        }, Pb = function (a, b) {
            return function () {
                for (var c = 0; c < arguments.length; c++) ;
                return a(b.apply(null, arguments))
            }
        }, h = function (a) {
            return function () {
                return a
            }
        }, ca = function (a) {
            return a
        }, u = function (a) {
            for (var b = 1; b < arguments.length; b++) ;
            var c = Array(arguments.length - 1);
            for (b = 1; b < arguments.length; b++) c[b - 1] = arguments[b];
            return function () {
                for (var b = 0; b < arguments.length; b++) ;
                b = Array(arguments.length);
                for (var e = 0; e < b.length; e++) b[e] = arguments[e];
                b = c.concat(b);
                return a.apply(null, b)
            }
        }, zf = function (a) {
            return function () {
                for (var b =
                    0; b < arguments.length; b++) ;
                return !a.apply(null, arguments)
            }
        }, yb = function (a) {
            return function () {
                throw Error(a);
            }
        }, xb = function (a) {
            return a()
        }, fd = h(!1), Jb = h(!0), bk = fd, bs = Jb, ah = function () {
            return cs
        }, cs = function () {
            var a = function (a) {
                return a.isNone()
            }, b = function (a) {
                return a()
            }, c = function (a) {
                return a
            };
            a = {
                fold: function (a, b) {
                    return a()
                }, is: bk, isSome: bk, isNone: bs, getOr: c, getOrThunk: b, getOrDie: function (a) {
                    throw Error(a || "error: getOrDie called on none.");
                }, getOrNull: function () {
                    return null
                }, getOrUndefined: function () {
                },
                or: c, orThunk: b, map: ah, ap: ah, each: function () {
                }, bind: ah, flatten: ah, exists: bk, forall: bs, filter: ah, equals: a, equals_: a, toArray: function () {
                    return []
                }, toString: h("none()")
            };
            Object.freeze && Object.freeze(a);
            return a
        }(), Zm = function (a) {
            var b = function () {
                return a
            }, c = function () {
                return e
            }, d = function (b) {
                return b(a)
            }, e = {
                fold: function (b, c) {
                    return c(a)
                },
                is: function (b) {
                    return a === b
                },
                isSome: bs,
                isNone: bk,
                getOr: b,
                getOrThunk: b,
                getOrDie: b,
                getOrNull: b,
                getOrUndefined: b,
                or: c,
                orThunk: c,
                map: function (b) {
                    return Zm(b(a))
                },
                ap: function (b) {
                    return b.fold(ah,
                        function (b) {
                            return Zm(b(a))
                        })
                },
                each: function (b) {
                    b(a)
                },
                bind: d,
                flatten: b,
                exists: d,
                forall: d,
                filter: function (b) {
                    return b(a) ? e : cs
                },
                equals: function (b) {
                    return b.is(a)
                },
                equals_: function (b, c) {
                    return b.fold(bk, function (b) {
                        return c(a, b)
                    })
                },
                toArray: function () {
                    return [a]
                },
                toString: function () {
                    return "some(" + a + ")"
                }
            };
            return e
        }, g = {
            some: Zm, none: ah, from: function (a) {
                return null === a || void 0 === a ? cs : Zm(a)
            }
        }, Xh = function (a) {
            return function (b) {
                if (null === b) b = "null"; else {
                    var c = typeof b;
                    b = "object" === c && Array.prototype.isPrototypeOf(b) ?
                        "array" : "object" === c && String.prototype.isPrototypeOf(b) ? "string" : c
                }
                return b === a
            }
        }, xa = Xh("string"), ic = Xh("object"), Mb = Xh("array"), $m = Xh("boolean"), vb = Xh("function"),
        $e = Xh("number"), GB = function () {
            var a = Array.prototype.indexOf, b = function (b, c) {
                return a.call(b, c)
            }, c = function (a, b) {
                a:{
                    for (var c = 0, d = a.length; c < d; ++c) if (a[c] === b) {
                        a = c;
                        break a
                    }
                    a = -1
                }
                return a
            };
            return void 0 === a ? c : b
        }(), Gc = function (a, b) {
            a = GB(a, b);
            return -1 === a ? g.none() : g.some(a)
        }, U = function (a, b) {
            return -1 < GB(a, b)
        }, Xa = function (a, b) {
            return Va(a, b).isSome()
        },
        n1 = function (a, b) {
            for (var c = [], d = 0; d < a; d++) c.push(b(d));
            return c
        }, o1 = function (a, b) {
            for (var c = [], d = 0; d < a.length; d += b) {
                var e = a.slice(d, d + b);
                c.push(e)
            }
            return c
        }, E = function (a, b) {
            for (var c = a.length, d = Array(c), e = 0; e < c; e++) d[e] = b(a[e], e, a);
            return d
        }, z = function (a, b) {
            for (var c = 0, d = a.length; c < d; c++) b(a[c], c, a)
        }, p1 = function (a, b) {
            for (var c = a.length - 1; 0 <= c; c--) b(a[c], c, a)
        }, q1 = function (a, b) {
            for (var c = [], d = [], e = 0, f = a.length; e < f; e++) {
                var k = a[e];
                (b(k, e, a) ? c : d).push(k)
            }
            return {pass: c, fail: d}
        }, ka = function (a, b) {
            for (var c =
                [], d = 0, e = a.length; d < e; d++) {
                var f = a[d];
                b(f, d, a) && c.push(f)
            }
            return c
        }, hm = function (a, b) {
            if (0 === a.length) return [];
            for (var c = b(a[0]), d = [], e = [], f = 0, k = a.length; f < k; f++) {
                var l = a[f], g = b(l);
                g !== c && (d.push(e), e = []);
                c = g;
                e.push(l)
            }
            0 !== e.length && d.push(e);
            return d
        }, Eb = function (a, b, c) {
            p1(a, function (a) {
                c = b(c, a)
            });
            return c
        }, hb = function (a, b, c) {
            z(a, function (a) {
                c = b(c, a)
            });
            return c
        }, qa = function (a, b) {
            for (var c = 0, d = a.length; c < d; c++) {
                var e = a[c];
                if (b(e, c, a)) return g.some(e)
            }
            return g.none()
        }, Va = function (a, b) {
            for (var c = 0, d =
                a.length; c < d; c++) if (b(a[c], c, a)) return g.some(c);
            return g.none()
        }, r1 = Array.prototype.push, Qb = function (a) {
            for (var b = [], c = 0, d = a.length; c < d; ++c) {
                if (!Array.prototype.isPrototypeOf(a[c])) throw Error("Arr.flatten item " + c + " was not an array, input: " + a);
                r1.apply(b, a[c])
            }
            return b
        }, ia = function (a, b) {
            a = E(a, b);
            return Qb(a)
        }, ob = function (a, b) {
            for (var c = 0, d = a.length; c < d; ++c) if (!0 !== b(a[c], c, a)) return !1;
            return !0
        }, HB = Array.prototype.slice, kd = function (a) {
            a = HB.call(a, 0);
            a.reverse();
            return a
        }, Iq = function (a, b) {
            return ka(a,
                function (a) {
                    return !U(b, a)
                })
        }, yT = function (a, b) {
            for (var c = {}, d = 0, e = a.length; d < e; d++) {
                var f = a[d];
                c[String(f)] = b(f, d)
            }
            return c
        }, IB = function (a) {
            return [a]
        }, ds = vb(Array.from) ? Array.from : function (a) {
            return HB.call(a)
        }, Xf = "undefined" !== typeof window ? window : Function("return this;")(), bh = function (a, b) {
            a = a.split(".");
            b = void 0 !== b && null !== b ? b : Xf;
            for (var c = 0; c < a.length && void 0 !== b && null !== b; ++c) b = b[a[c]];
            return b
        }, es = function (a, b) {
            a = a.split(".");
            var c = void 0 !== b ? b : Xf;
            for (b = 0; b < a.length; ++b) {
                var d = a[b];
                if (void 0 ===
                    c[d] || null === c[d]) c[d] = {};
                c = c[d]
            }
            return c
        }, Kc = {
            getOrDie: function (a, b) {
                b = bh(a, b);
                if (void 0 === b || null === b) throw a + " not available on this browser";
                return b
            }
        }, ck = {
            isPrototypeOf: function (a) {
                var b = bh("ownerDocument.defaultView", a);
                return Kc.getOrDie("HTMLElement", b).prototype.isPrototypeOf(a)
            }
        }, dk = function (a, b, c, d, e, f) {
            return {
                name: h(a), output: h(f || a), required: h(d), validate: function (d) {
                    if (!c(d)) throw d = e(a, b), Error(d);
                }
            }
        }, ek = function (a, b) {
            return 'value of "' + a + '" is not a ' + b
        }, ch = function (a, b) {
            return 'value of "' +
                a + '" is not an ' + b
        }, Af = function (a, b, c) {
            return function (d, e) {
                return dk(d, a, b, !0, c, e)
            }
        }, JB = function (a) {
            return ck.isPrototypeOf(a)
        }, s1 = function (a) {
            return xa(a) || Mb(a) || ic(a)
        }, fs = Af("array", Mb, ch), t1 = Af("boolean", $m, ek), u1 = Af("function", vb, ek), v1 = Af("number", $e, ek),
        w1 = Af("object", ic, ch), x1 = Af("string", xa, ek), y1 = Af("DOM element", JB, ek),
        z1 = Af("string or an array", function (a) {
            return xa(a) || Mb(a)
        }, ch), A1 = Af("string or a DOM element", function (a) {
            return xa(a) || JB(a)
        }, ch), ba = {
            arrayOfStrings: function (a) {
                return dk(a,
                    "array of strings", function (b) {
                        fs(a, void 0).validate(b);
                        return ob(b, xa)
                    }, !0, ch, void 0)
            },
            arrayOfObjects: function (a) {
                return dk(a, "array of objects", function (b) {
                    fs(a, void 0).validate(b);
                    return ob(b, ic)
                }, !0, ch, void 0)
            },
            arrayOfToolbarGroups: function (a) {
                return dk(a, "array of toolbar groups", function (b) {
                    fs(a, void 0).validate(b);
                    return ob(b, s1)
                }, !0, ch, void 0)
            },
            bool: t1,
            domElement: y1,
            func: u1,
            number: v1,
            object: w1,
            string: x1,
            stringOrArray: z1,
            stringOrDom: A1,
            param: dk
        }, EB = {
            paramList: function () {
                return [ba.object("aria"),
                    ba.func("fetch"), ba.func("menuComplete"), ba.func("menuExtra"), ba.func("menuHover"), ba.string("hoverSelector"), ba.func("hover")]
            }, encodeWithEditorApi: function () {
                return ["menuComplete"]
            }
        }, B1 = Object.prototype.hasOwnProperty, KB = function (a) {
            return function () {
                for (var b = Array(arguments.length), c = 0; c < b.length; c++) b[c] = arguments[c];
                if (0 === b.length) throw Error("Can't merge zero objects");
                c = {};
                for (var d = 0; d < b.length; d++) {
                    var e = b[d], f;
                    for (f in e) B1.call(e, f) && (c[f] = a(c[f], e[f]))
                }
                return c
            }
        }, oa = KB(function (a, b) {
            return ic(a) &&
            ic(b) ? oa(a, b) : b
        }), ua = KB(function (a, b) {
            return b
        }), cb = Object.keys, Ma = function (a, b) {
            for (var c = cb(a), d = 0, e = c.length; d < e; d++) {
                var f = c[d];
                b(a[f], f, a)
            }
        }, eb = function (a, b) {
            return C1(a, function (a, d, e) {
                return {k: d, v: b(a, d, e)}
            })
        }, C1 = function (a, b) {
            var c = {};
            Ma(a, function (d, e) {
                d = b(d, e, a);
                c[d.k] = d.v
            });
            return c
        }, D1 = function (a, b) {
            var c = {}, d = {};
            Ma(a, function (a, f) {
                (b(a, f) ? c : d)[f] = a
            });
            return {t: c, f: d}
        }, Nf = function (a, b) {
            var c = [];
            Ma(a, function (a, e) {
                c.push(b(a, e))
            });
            return c
        }, U0 = function (a, b) {
            for (var c = cb(a), d = 0, e = c.length; d <
            e; d++) {
                var f = c[d], k = a[f];
                if (b(k, f, a)) return g.some(k)
            }
            return g.none()
        }, Ze = function (a) {
            return Nf(a, function (a) {
                return a
            })
        }, gs = function (a, b, c) {
            return E(a, function (a) {
                return b(a, c)
            })
        }, hs = function (a, b) {
            if (xa(a)) return a;
            if (Mb(a)) return gs(a, hs, b);
            if (ic(a) && void 0 !== a.action) return b = Pb(a.action, b), ua(a, {action: b});
            b = gs(a.items, hs, b);
            return oa(a, {items: b})
        }, Wx = {
            mentions: function (a, b) {
                var c = EB.encodeWithEditorApi();
                return eb(a, function (a, e) {
                    return U(c, e) ? function (c) {
                        return a(b(), c)
                    } : a
                })
            }, toolbar: function (a,
                                  b) {
                return void 0 === a.items ? a : {items: gs(a.items, hs, b)}
            }
        }, an = function (a) {
            return {
                is: function (b) {
                    return a === b
                }, isValue: Jb, isError: fd, getOr: h(a), getOrThunk: h(a), getOrDie: h(a), or: function (b) {
                    return an(a)
                }, orThunk: function (b) {
                    return an(a)
                }, fold: function (b, c) {
                    return c(a)
                }, map: function (b) {
                    return an(b(a))
                }, each: function (b) {
                    b(a)
                }, bind: function (b) {
                    return b(a)
                }, exists: function (b) {
                    return b(a)
                }, forall: function (b) {
                    return b(a)
                }, toOption: function () {
                    return g.some(a)
                }
            }
        }, is = function (a) {
            return {
                is: fd, isValue: fd, isError: Jb,
                getOr: ca, getOrThunk: function (a) {
                    return a()
                }, getOrDie: function () {
                    return yb(String(a))()
                }, or: function (a) {
                    return a
                }, orThunk: function (a) {
                    return a()
                }, fold: function (b, c) {
                    return b(a)
                }, map: function (b) {
                    return is(a)
                }, each: t, bind: function (b) {
                    return is(a)
                }, exists: fd, forall: Jb, toOption: g.none
            }
        }, I = {value: an, error: is}, iT = function () {
            var a = (new Date).getTime();
            return String(a).slice(-6)
        }, bn = window.Node, E1 = window.URL, F1 = window.Window, Hb = window.document, k_ = window.navigator,
        Zg = window.window, Vh = window.clearInterval, sr =
            window.clearTimeout, Or = window.setInterval, Kf = window.setTimeout, ld = window.console, fk = function (a) {
            if (null === a || void 0 === a) throw Error("Node cannot be null or undefined");
            return {dom: h(a)}
        }, r = {
            fromHtml: function (a, b) {
                b = (b || Hb).createElement("div");
                b.innerHTML = a;
                if (!b.hasChildNodes() || 1 < b.childNodes.length) throw ld.error("HTML does not have a single root node", a), "HTML must have a single root node";
                return fk(b.childNodes[0])
            }, fromTag: function (a, b) {
                a = (b || Hb).createElement(a);
                return fk(a)
            }, fromText: function (a,
                                   b) {
                a = (b || Hb).createTextNode(a);
                return fk(a)
            }, fromDom: fk, fromPoint: function (a, b, c) {
                a = a.dom();
                return g.from(a.elementFromPoint(b, c)).map(fk)
            }
        }, LB = bn.COMMENT_NODE, js = bn.DOCUMENT_NODE, gk = bn.ELEMENT_NODE, MB = bn.TEXT_NODE, Fa = {
            all: function (a, b) {
                b = void 0 === b ? Hb : b.dom();
                return b.nodeType !== gk && b.nodeType !== js || 0 === b.childElementCount ? [] : E(b.querySelectorAll(a), r.fromDom)
            }, is: function (a, b) {
                a = a.dom();
                if (a.nodeType !== gk) return !1;
                if (void 0 !== a.matches) return a.matches(b);
                if (void 0 !== a.msMatchesSelector) return a.msMatchesSelector(b);
                if (void 0 !== a.webkitMatchesSelector) return a.webkitMatchesSelector(b);
                if (void 0 !== a.mozMatchesSelector) return a.mozMatchesSelector(b);
                throw Error("Browser lacks native selectors");
            }, one: function (a, b) {
                b = void 0 === b ? Hb : b.dom();
                return b.nodeType !== gk && b.nodeType !== js || 0 === b.childElementCount ? g.none() : g.from(b.querySelector(a)).map(r.fromDom)
            }
        }, NB = function (a) {
            return a.dom().nodeName.toLowerCase()
        }, ks = function (a) {
            return a.dom().nodeType
        }, ls = function (a) {
            return function (b) {
                return ks(b) === a
            }
        }, G1 = ls(gk), H1 =
            ls(MB), I1 = ls(js), D = {
            name: NB, type: ks, value: function (a) {
                return a.dom().nodeValue
            }, isElement: G1, isText: H1, isDocument: I1, isComment: function (a) {
                return ks(a) === LB || "#comment" === NB(a)
            }
        }, xT = {
            one: function (a, b, c) {
                var d = D.name(a);
                return g.from(b[d]).map(function (b) {
                    return b.replace(a, c)
                })
            }
        }, om = {
            documentPositionPreceding: function (a, b) {
                var c = Kc.getOrDie("Node").DOCUMENT_POSITION_PRECEDING;
                return 0 !== (a.compareDocumentPosition(b) & c)
            }, documentPositionContainedBy: function (a, b) {
                var c = Kc.getOrDie("Node").DOCUMENT_POSITION_CONTAINED_BY;
                return 0 !== (a.compareDocumentPosition(b) & c)
            }
        }, gc = function (a) {
            var b = !1, c;
            return function () {
                for (var d = [], e = 0; e < arguments.length; e++) d[e] = arguments[e];
                b || (b = !0, c = a.apply(null, d));
                return c
            }
        }, OB = function () {
            return ms(0, 0)
        }, ms = function (a, b) {
            return {major: a, minor: b}
        }, cn = {
            nu: ms, detect: function (a, b) {
                b = String(b).toLowerCase();
                if (0 === a.length) a = OB(); else {
                    a:{
                        for (var c = 0; c < a.length; c++) {
                            var d = a[c];
                            if (d.test(b)) {
                                a = d;
                                break a
                            }
                        }
                        a = void 0
                    }
                    a = a ? ms(Number(b.replace(a, "$1")), Number(b.replace(a, "$2"))) : {major: 0, minor: 0}
                }
                return a
            },
            unknown: OB
        }, Yh = function (a, b) {
            return function () {
                return b === a
            }
        }, PB = function (a) {
            var b = a.current;
            return {
                current: b,
                version: a.version,
                isEdge: Yh("Edge", b),
                isChrome: Yh("Chrome", b),
                isIE: Yh("IE", b),
                isOpera: Yh("Opera", b),
                isFirefox: Yh("Firefox", b),
                isSafari: Yh("Safari", b)
            }
        }, J1 = function () {
            return PB({current: void 0, version: cn.unknown()})
        };
    h("Edge");
    h("Chrome");
    h("IE");
    h("Opera");
    h("Firefox");
    h("Safari");
    var dh = function (a, b) {
        return function () {
            return b === a
        }
    }, QB = function (a) {
        var b = a.current;
        return {
            current: b,
            version: a.version,
            isWindows: dh("Windows", b),
            isiOS: dh("iOS", b),
            isAndroid: dh("Android", b),
            isOSX: dh("OSX", b),
            isLinux: dh("Linux", b),
            isSolaris: dh("Solaris", b),
            isFreeBSD: dh("FreeBSD", b)
        }
    }, K1 = function () {
        return QB({current: void 0, version: cn.unknown()})
    };
    h("Windows");
    h("iOS");
    h("Android");
    h("Linux");
    h("OSX");
    h("Solaris");
    h("FreeBSD");
    var RB = function (a, b) {
            var c = String(b).toLowerCase();
            return qa(a, function (a) {
                return a.search(c)
            })
        }, SB = {
            detectBrowser: function (a, b) {
                return RB(a, b).map(function (a) {
                    var c = cn.detect(a.versionRegexes,
                        b);
                    return {current: a.name, version: c}
                })
            }, detectOs: function (a, b) {
                return RB(a, b).map(function (a) {
                    var c = cn.detect(a.versionRegexes, b);
                    return {current: a.name, version: c}
                })
            }
        }, L1 = function (a) {
            return "" === a ? g.none() : g.some(a.substr(0, 1))
        }, M1 = function (a) {
            return "" === a ? g.none() : g.some(a.substring(1))
        }, TB = function (a, b, c) {
            return "" === b ? !0 : a.length < b.length ? !1 : a.substr(c, c + b.length) === b
        }, yB = function (a, b) {
            return a.replace(/\$\{([^{}]*)\}/g, function (a, d) {
                d = b[d];
                var c = typeof d;
                return "string" === c || "number" === c ? d.toString() :
                    a
            })
        }, hk = function (a, b) {
            return Gb(a, b) ? a.substring(b.length) : a
        }, ik = function (a, b) {
            return je(a, b) ? a.substring(0, a.length - b.length) : a
        }, Bb = function (a, b) {
            return -1 !== a.indexOf(b)
        }, ns = function (a) {
            return L1(a).bind(function (b) {
                return M1(a).map(function (a) {
                    return b.toUpperCase() + a
                })
            }).getOr(a)
        }, Gb = function (a, b) {
            return TB(a, b, 0)
        }, je = function (a, b) {
            return TB(a, b, a.length - b.length)
        }, Zh = function (a) {
            return a.replace(/^\s+|\s+$/g, "")
        }, os = /.*?version\/ ?([0-9]+)\.([0-9]+).*/, eg = function (a) {
            return function (b) {
                return Bb(b,
                    a)
            }
        }, N1 = [{
            name: "Edge", versionRegexes: [/.*?edge\/ ?([0-9]+)\.([0-9]+)$/], search: function (a) {
                return Bb(a, "edge/") && Bb(a, "chrome") && Bb(a, "safari") && Bb(a, "applewebkit")
            }
        }, {
            name: "Chrome", versionRegexes: [/.*?chrome\/([0-9]+)\.([0-9]+).*/, os], search: function (a) {
                return Bb(a, "chrome") && !Bb(a, "chromeframe")
            }
        }, {
            name: "IE",
            versionRegexes: [/.*?msie ?([0-9]+)\.([0-9]+).*/, /.*?rv:([0-9]+)\.([0-9]+).*/],
            search: function (a) {
                return Bb(a, "msie") || Bb(a, "trident")
            }
        }, {
            name: "Opera", versionRegexes: [os, /.*?opera\/([0-9]+)\.([0-9]+).*/],
            search: eg("opera")
        }, {
            name: "Firefox",
            versionRegexes: [/.*?firefox\/ ?([0-9]+)\.([0-9]+).*/],
            search: eg("firefox")
        }, {
            name: "Safari", versionRegexes: [os, /.*?cpu os ([0-9]+)_([0-9]+).*/], search: function (a) {
                return (Bb(a, "safari") || Bb(a, "mobile/")) && Bb(a, "applewebkit")
            }
        }], O1 = [{name: "Windows", search: eg("win"), versionRegexes: [/.*?windows nt ?([0-9]+)\.([0-9]+).*/]}, {
            name: "iOS", search: function (a) {
                return Bb(a, "iphone") || Bb(a, "ipad")
            }, versionRegexes: [/.*?version\/ ?([0-9]+)\.([0-9]+).*/, /.*cpu os ([0-9]+)_([0-9]+).*/,
                /.*cpu iphone os ([0-9]+)_([0-9]+).*/]
        }, {name: "Android", search: eg("android"), versionRegexes: [/.*?android ?([0-9]+)\.([0-9]+).*/]}, {
            name: "OSX",
            search: eg("os x"),
            versionRegexes: [/.*?os x ?([0-9]+)_([0-9]+).*/]
        }, {name: "Linux", search: eg("linux"), versionRegexes: []}, {
            name: "Solaris",
            search: eg("sunos"),
            versionRegexes: []
        }, {name: "FreeBSD", search: eg("freebsd"), versionRegexes: []}], UB = {browsers: h(N1), oses: h(O1)}, P1 = {
            detect: function (a) {
                var b = UB.browsers(), c = UB.oses();
                b = SB.detectBrowser(b, a).fold(J1, PB);
                c = SB.detectOs(c,
                    a).fold(K1, QB);
                var d = c.isiOS() && !0 === /ipad/i.test(a), e = c.isiOS() && !d,
                    f = c.isAndroid() && 3 === c.version.major, k = c.isAndroid() && 4 === c.version.major;
                f = d || f || k && !0 === /mobile/i.test(a);
                var l = (k = c.isiOS() || c.isAndroid()) && !f;
                a = b.isSafari() && c.isiOS() && !1 === /safari/i.test(a);
                a = {
                    isiPad: h(d),
                    isiPhone: h(e),
                    isTablet: h(f),
                    isPhone: h(l),
                    isTouch: h(k),
                    isAndroid: c.isAndroid,
                    isiOS: c.isiOS,
                    isWebView: h(a)
                };
                return {browser: b, os: c, deviceType: a}
            }
        }, aa = {
            detect: gc(function () {
                return P1.detect(navigator.userAgent)
            })
        }, VB = function (a,
                          b) {
            return a.dom() === b.dom()
        }, Q1 = function (a, b) {
            a = a.dom();
            b = b.dom();
            return a === b ? !1 : a.contains(b)
        }, R1 = function (a, b) {
            return om.documentPositionContainedBy(a.dom(), b.dom())
        }, S1 = aa.detect().browser.isIE() ? R1 : Q1, N = {
            eq: VB, isEqualNode: function (a, b) {
                return a.dom().isEqualNode(b.dom())
            }, member: function (a, b) {
                return Xa(b, u(VB, a))
            }, contains: S1, is: Fa.is
        }, WB = function (a) {
            a = a.dom().body;
            if (null === a || void 0 === a) throw"Body is not available yet";
            return r.fromDom(a)
        }, ja = {
            body: gc(function () {
                return WB(r.fromDom(Hb))
            }),
            getBody: WB, inBody: function (a) {
                a = D.isText(a) ? a.dom().parentNode : a.dom();
                return void 0 !== a && null !== a && a.ownerDocument.body.contains(a)
            }
        }, XB = function (a, b, c) {
            a = a.dom();
            for (c = vb(c) ? c : h(!1); a.parentNode;) {
                a = a.parentNode;
                var d = r.fromDom(a);
                if (b(d)) return g.some(d);
                if (c(d)) break
            }
            return g.none()
        }, YB = function (a, b) {
            return qa(a.dom().childNodes, Pb(b, r.fromDom)).map(r.fromDom)
        }, ZB = function (a, b) {
            var c = function (a) {
                for (var d = 0; d < a.childNodes.length; d++) {
                    if (b(r.fromDom(a.childNodes[d]))) return g.some(r.fromDom(a.childNodes[d]));
                    var f = c(a.childNodes[d]);
                    if (f.isSome()) return f
                }
                return g.none()
            };
            return c(a.dom())
        }, Ja = {
            first: function (a) {
                return ZB(ja.body(), a)
            }, ancestor: XB, closest: function (a, b, c) {
                return Xx(function (a) {
                    return b(a)
                }, XB, a, b, c)
            }, sibling: function (a, b) {
                var c = a.dom();
                return c.parentNode ? YB(r.fromDom(c.parentNode), function (c) {
                    return !N.eq(a, c) && b(c)
                }) : g.none()
            }, child: YB, descendant: ZB
        }, wd = {
            any: function (a) {
                return Ja.first(a).isSome()
            }, ancestor: function (a, b, c) {
                return Ja.ancestor(a, b, c).isSome()
            }, closest: function (a, b, c) {
                return Ja.closest(a,
                    b, c).isSome()
            }, sibling: function (a, b) {
                return Ja.sibling(a, b).isSome()
            }, child: function (a, b) {
                return Ja.child(a, b).isSome()
            }, descendant: function (a, b) {
                return Ja.descendant(a, b).isSome()
            }
        }, O = function () {
            for (var a = [], b = 0; b < arguments.length; b++) a[b] = arguments[b];
            return function () {
                for (var b = [], d = 0; d < arguments.length; d++) b[d] = arguments[d];
                if (a.length !== b.length) throw Error('Wrong number of arguments to struct. Expected "[' + a.length + ']", got ' + b.length + " arguments");
                var e = {};
                z(a, function (a, c) {
                    e[a] = h(b[c])
                });
                return e
            }
        }, $B = function (a, b) {
            throw Error("All required keys (" + a.slice(0).sort().join(", ") + ") were not specified. Specified keys were: " + b.slice(0).sort().join(", ") + ".");
        }, aC = function (a) {
            throw Error("Unsupported keys for object: " + a.slice(0).sort().join(", "));
        }, ps = function (a, b) {
            if (!Mb(b)) throw Error("The " + a + " fields must be an array. Was: " + b + ".");
            z(b, function (b) {
                if (!xa(b)) throw Error("The value " + b + " in the " + a + " fields was not a string.");
            })
        }, bC = function (a) {
            var b = a.slice(0).sort();
            qa(b, function (a,
                            d) {
                return d < b.length - 1 && a === b[d + 1]
            }).each(function (a) {
                throw Error("The field: " + a + " occurs more than once in the combined fields: [" + b.join(", ") + "].");
            })
        }, Aa = function (a, b) {
            var c = a.concat(b);
            if (0 === c.length) throw Error("You must specify at least one required or optional field.");
            ps("required", a);
            ps("optional", b);
            bC(c);
            return function (d) {
                var e = cb(d);
                ob(a, function (a) {
                    return U(e, a)
                }) || $B(a, e);
                var f = ka(e, function (a) {
                    return !U(c, a)
                });
                0 < f.length && aC(f);
                var k = {};
                z(a, function (a) {
                    k[a] = h(d[a])
                });
                z(b, function (a) {
                    k[a] =
                        h(Object.prototype.hasOwnProperty.call(d, a) ? g.some(d[a]) : g.none())
                });
                return k
            }
        }, cC = {
            toArray: function (a, b) {
                var c = [], d = function (a) {
                    c.push(a);
                    return b(a)
                };
                a = b(a);
                do a = a.bind(d); while (a.isSome());
                return c
            }
        }, qs = function (a) {
            a = a.dom();
            return g.from(a.parentNode).map(r.fromDom)
        }, dC = function (a) {
            a = a.dom();
            return g.from(a.previousSibling).map(r.fromDom)
        }, eC = function (a) {
            a = a.dom();
            return g.from(a.nextSibling).map(r.fromDom)
        }, dn = function (a) {
            a = a.dom();
            return E(a.childNodes, r.fromDom)
        }, rs = function (a, b) {
            a = a.dom().childNodes;
            return g.from(a[b]).map(r.fromDom)
        }, fC = O("element", "offset"), A = {
            owner: function (a) {
                return r.fromDom(a.dom().ownerDocument)
            }, defaultView: function (a) {
                a = a.dom().ownerDocument.defaultView;
                return r.fromDom(a)
            }, documentElement: function (a) {
                return r.fromDom(a.dom().ownerDocument.documentElement)
            }, parent: qs, findIndex: function (a) {
                return qs(a).bind(function (b) {
                    b = dn(b);
                    return Va(b, function (b) {
                        return N.eq(a, b)
                    })
                })
            }, parents: function (a, b) {
                b = vb(b) ? b : h(!1);
                var c = a.dom();
                for (a = []; null !== c.parentNode && void 0 !== c.parentNode;) {
                    c =
                        c.parentNode;
                    var d = r.fromDom(c);
                    a.push(d);
                    if (!0 === b(d)) break
                }
                return a
            }, siblings: function (a) {
                return qs(a).map(dn).map(function (b) {
                    return ka(b, function (b) {
                        return !N.eq(a, b)
                    })
                }).getOr([])
            }, prevSibling: dC, offsetParent: function (a) {
                a = a.dom();
                return g.from(a.offsetParent).map(r.fromDom)
            }, prevSiblings: function (a) {
                return kd(cC.toArray(a, dC))
            }, nextSibling: eC, nextSiblings: function (a) {
                return cC.toArray(a, eC)
            }, children: dn, child: rs, firstChild: function (a) {
                return rs(a, 0)
            }, lastChild: function (a) {
                return rs(a, a.dom().childNodes.length -
                    1)
            }, childNodesCount: function (a) {
                return a.dom().childNodes.length
            }, hasChildNodes: function (a) {
                return a.dom().hasChildNodes()
            }, leaf: function (a, b) {
                var c = dn(a);
                return 0 < c.length && b < c.length ? fC(c[b], 0) : fC(a, b)
            }
        }, gC = function (a) {
            a.dom().focus()
        }, ss = function (a) {
            a = void 0 !== a ? a.dom() : Hb;
            return g.from(a.activeElement).map(r.fromDom)
        }, Z = {
            hasFocus: function (a) {
                var b = A.owner(a).dom();
                return a.dom() === b.activeElement
            }, focus: gC, blur: function (a) {
                a.dom().blur()
            }, active: ss, search: function (a) {
                return ss(A.owner(a)).filter(function (b) {
                    return a.dom().contains(b.dom())
                })
            },
            focusInside: function (a) {
                var b = A.owner(a);
                ss(b).filter(function (b) {
                    return wd.closest(b, u(N.eq, a))
                }).fold(function () {
                    gC(a)
                }, t)
            }
        }, en = function (a, b) {
            A.parent(a).each(function (c) {
                c.dom().insertBefore(b.dom(), a.dom())
            })
        }, jk = function (a, b) {
            a.dom().appendChild(b.dom())
        }, y = {
            before: en, after: function (a, b) {
                A.nextSibling(a).fold(function () {
                    A.parent(a).each(function (a) {
                        jk(a, b)
                    })
                }, function (a) {
                    en(a, b)
                })
            }, prepend: function (a, b) {
                A.firstChild(a).fold(function () {
                    jk(a, b)
                }, function (c) {
                    a.dom().insertBefore(b.dom(), c.dom())
                })
            },
            append: jk, appendAt: function (a, b, c) {
                A.child(a, c).fold(function () {
                    jk(a, b)
                }, function (a) {
                    en(a, b)
                })
            }, wrap: function (a, b) {
                en(a, b);
                jk(b, a)
            }
        }, P = {
            before: function (a, b) {
                z(b, function (b) {
                    y.before(a, b)
                })
            }, after: function (a, b) {
                z(b, function (c, d) {
                    y.after(0 === d ? a : b[d - 1], c)
                })
            }, prepend: function (a, b) {
                z(b.slice().reverse(), function (b) {
                    y.prepend(a, b)
                })
            }, append: function (a, b) {
                z(b, function (b) {
                    y.append(a, b)
                })
            }
        }, ts = function (a) {
            a = a.dom();
            null !== a.parentNode && a.parentNode.removeChild(a)
        }, F = {
            empty: function (a) {
                a.dom().textContent =
                    "";
                z(A.children(a), function (a) {
                    ts(a)
                })
            }, remove: ts, unwrap: function (a) {
                var b = A.children(a);
                0 < b.length && P.before(a, b);
                ts(a)
            }
        }, hC = function (a, b, c) {
            if (xa(c) || $m(c) || $e(c)) a.setAttribute(b, c + ""); else throw ld.error("Invalid call to Attr.set. Key ", b, ":: Value ", c, ":: Element ", a), Error("Attribute value was not simple");
        }, iC = function (a, b, c) {
            hC(a.dom(), b, c)
        }, jC = function (a, b) {
            a = a.dom().getAttribute(b);
            return null === a ? void 0 : a
        }, us = function (a, b) {
            return (a = a.dom()) && a.hasAttribute ? a.hasAttribute(b) : !1
        }, m = {
            clone: function (a) {
                return hb(a.dom().attributes,
                    function (a, c) {
                        a[c.name] = c.value;
                        return a
                    }, {})
            }, set: iC, setAll: function (a, b) {
                var c = a.dom();
                Ma(b, function (a, b) {
                    hC(c, b, a)
                })
            }, get: jC, has: us, remove: function (a, b) {
                a.dom().removeAttribute(b)
            }, hasNone: function (a) {
                a = a.dom().attributes;
                return void 0 === a || null === a || 0 === a.length
            }, transfer: function (a, b, c) {
                D.isElement(a) && D.isElement(b) && z(c, function (c) {
                    us(a, c) && !us(b, c) && iC(b, c, jC(a, c))
                })
            }
        }, af = {
            isSupported: function (a) {
                return void 0 !== a.style
            }
        }, vs = function (a, b, c) {
            if (!xa(c)) throw ld.error("Invalid call to CSS.set. Property ",
                b, ":: Value ", c, ":: Element ", a), Error("CSS value must be a string: " + c);
            af.isSupported(a) && a.style.setProperty(b, c)
        }, ws = function (a, b, c) {
            a = a.dom();
            vs(a, b, c)
        }, kC = function (a, b) {
            return af.isSupported(a) ? a.style.getPropertyValue(b) : ""
        }, fn = function (a, b) {
            a = a.dom();
            b = kC(a, b);
            return g.from(b).filter(function (a) {
                return 0 < a.length
            })
        }, T1 = function (a, b, c) {
            fn(a, c).each(function (a) {
                fn(b, c).isNone() && ws(b, c, a)
            })
        }, v = {
            copy: function (a, b) {
                a = a.dom();
                b = b.dom();
                af.isSupported(a) && af.isSupported(b) && (b.style.cssText = a.style.cssText)
            },
            set: ws, preserve: function (a, b) {
                var c = m.get(a, "style");
                b = b(a);
                (void 0 === c ? m.remove : m.set)(a, "style", c);
                return b
            }, setAll: function (a, b) {
                var c = a.dom();
                Ma(b, function (a, b) {
                    vs(c, b, a)
                })
            }, setOptions: function (a, b) {
                var c = a.dom();
                Ma(b, function (a, b) {
                    a.fold(function () {
                        af.isSupported(c) && c.style.removeProperty(b)
                    }, function (a) {
                        vs(c, b, a)
                    })
                })
            }, remove: function (a, b) {
                var c = a.dom();
                af.isSupported(c) && c.style.removeProperty(b);
                m.has(a, "style") && "" === Zh(m.get(a, "style")) && m.remove(a, "style")
            }, get: function (a, b) {
                var c = a.dom(),
                    d = Zg.getComputedStyle(c).getPropertyValue(b);
                a = "" !== d || ja.inBody(a) ? d : kC(c, b);
                return null === a ? void 0 : a
            }, getRaw: fn, getAllRaw: function (a) {
                var b = {};
                a = a.dom();
                if (af.isSupported(a)) for (var c = 0; c < a.style.length; c++) {
                    var d = a.style.item(c);
                    b[d] = a.style[d]
                }
                return b
            }, isValidValue: function (a, b, c) {
                a = r.fromTag(a);
                ws(a, b, c);
                return fn(a, b).isSome()
            }, reflow: function (a) {
                return a.dom().offsetWidth
            }, transfer: function (a, b, c) {
                D.isElement(a) && D.isElement(b) && z(c, function (c) {
                    T1(a, b, c)
                })
            }
        }, vT = {
            blur: function () {
                var a = r.fromHtml('<input type="text" />');
                v.setAll(a, {
                    "z-index": "-666",
                    background: "transparent",
                    border: "0px",
                    height: "50px",
                    position: "absolute",
                    top: "25%",
                    left: "50%"
                });
                y.append(r.fromDom(Hb.body), a);
                Z.focus(a);
                F.remove(a)
            }
        }, U1 = function (a) {
            return [eb(a, function (a) {
                return a()
            })]
        }, lT = {
            create: function () {
                var a = [];
                return {
                    eventRegistry: {
                        addListener: function (b) {
                            Tb(arguments, [ba.func("handler")]);
                            a.push(b)
                        }, removeListener: function (b) {
                            Gc(a, b).each(function (b) {
                                a.splice(b, 1)
                            })
                        }
                    }, eventTrigger: function (b) {
                        z(a, function (a) {
                            var c = U1(b);
                            a.apply(null, c)
                        })
                    }
                }
            }
        },
        Ql = {
            create: function () {
                var a = [], b = [];
                return {
                    bind: function (c, d) {
                        if (U(a, c)) throw"Invalid key, key already exists.";
                        a.push(c);
                        b.push(d);
                        c.bind(d)
                    }, unbind: function (c) {
                        Gc(a, c).fold(function () {
                            throw"Invalid key, does not exist.";
                        }, function (d) {
                            a.splice(d, 1);
                            d = b.splice(d, 1)[0];
                            c.unbind(d)
                        })
                    }, unbindAll: function () {
                        z(a, function (a, d) {
                            a.unbind(b[d])
                        });
                        a.splice(0, a.length);
                        b.splice(0, b.length)
                    }
                }
            }
        }, lC = function (a) {
            Object.freeze(a);
            Ma(a, function (a) {
                ic(a) && lC(a)
            });
            return a
        }, Sl = {makeReadOnly: lC}, xs = function (a) {
            var b =
                g.none(), c = [], d = function (a) {
                e() ? f(a) : c.push(a)
            }, e = function () {
                return b.isSome()
            }, f = function (a) {
                b.each(function (b) {
                    setTimeout(function () {
                        a(b)
                    }, 0)
                })
            };
            a(function (a) {
                b = g.some(a);
                z(c, f);
                c = []
            });
            return {
                get: d, map: function (a) {
                    return xs(function (b) {
                        d(function (c) {
                            b(a(c))
                        })
                    })
                }, isReady: e
            }
        }, lf = {
            nu: xs, pure: function (a) {
                return xs(function (b) {
                    b(a)
                })
            }
        }, V1 = function (a) {
            return function () {
                for (var b = [], c = 0; c < arguments.length; c++) b[c] = arguments[c];
                var d = this;
                setTimeout(function () {
                    a.apply(d, b)
                }, 0)
            }
        }, kk = function (a) {
            var b = function (b) {
                a(V1(b))
            };
            return {
                map: function (a) {
                    return kk(function (c) {
                        b(function (b) {
                            b = a(b);
                            c(b)
                        })
                    })
                }, bind: function (a) {
                    return kk(function (c) {
                        b(function (b) {
                            a(b).get(c)
                        })
                    })
                }, anonBind: function (a) {
                    return kk(function (c) {
                        b(function (b) {
                            a.get(c)
                        })
                    })
                }, toLazy: function () {
                    return lf.nu(b)
                }, get: b
            }
        }, Ga = {
            nu: kk, pure: function (a) {
                return kk(function (b) {
                    b(a)
                })
            }
        }, Rl = function (a, b) {
            return b(function (b) {
                var c = [], e = 0, f = function (d) {
                    return function (f) {
                        c[d] = f;
                        e++;
                        e >= a.length && b(c)
                    }
                };
                0 === a.length ? b([]) : z(a, function (a, b) {
                    a.get(f(b))
                })
            })
        }, Ce = function (a,
                          b) {
            a = E(a, b);
            return Rl(a, Ga.nu)
        }, mC = {
            install: function (a) {
                var b = u(es, a);
                es("callbacks", b());
                var c = function (a) {
                    var b = void 0 === a.count ? 0 : a.count;
                    a.count = b + 1;
                    return "callback_" + b
                }, d = function (d, k) {
                    var f = b(), g = c(f);
                    f.callbacks[g] = function () {
                        k || e(g);
                        d.apply(null, arguments)
                    };
                    return a + ".callbacks." + g
                }, e = function (a) {
                    a = a.substring(a.lastIndexOf(".") + 1);
                    var c = b();
                    void 0 !== c.callbacks[a] && delete c.callbacks[a]
                };
                return {
                    ephemeral: function (a) {
                        return d(a, !1)
                    }, permanent: function (a) {
                        return d(a, !0)
                    }, unregister: e
                }
            }
        }, W1 =
            function (a, b, c, d, e, f, k) {
                return {target: h(a), x: h(b), y: h(c), stop: d, prevent: e, kill: f, raw: h(k)}
            }, X1 = function (a, b) {
            return function (c) {
                if (a(c)) {
                    var d = r.fromDom(c.target), e = function () {
                        c.stopPropagation()
                    }, f = function () {
                        c.preventDefault()
                    }, k = Pb(f, e);
                    d = W1(d, c.clientX, c.clientY, e, f, k, c);
                    b(d)
                }
            }
        }, nC = function (a, b, c, d, e) {
            c = X1(c, d);
            a.dom().addEventListener(b, c, e);
            return {unbind: u(Y1, a, b, c, e)}
        }, Y1 = function (a, b, c, d) {
            a.dom().removeEventListener(b, c, d)
        }, ys = {
            bind: function (a, b, c, d) {
                return nC(a, b, c, d, !1)
            }, capture: function (a,
                                  b, c, d) {
                return nC(a, b, c, d, !0)
            }
        }, oC = h(!0), K = {
            bind: function (a, b, c) {
                return ys.bind(a, b, oC, c)
            }, capture: function (a, b, c) {
                return ys.capture(a, b, oC, c)
            }
        }, Z1 = mC.install("ephox.henchman.features"), oT = {
            download: function (a) {
                return lf.nu(function (b) {
                    var c = function () {
                        e.unbind();
                        f.unbind()
                    }, d = r.fromTag("script");
                    m.set(d, "src", a);
                    m.set(d, "type", "text/javascript");
                    m.set(d, "async", "async");
                    m.set(d, "data-main", Z1.ephemeral(function (a) {
                        b(I.value(a))
                    }));
                    var e = K.bind(d, "error", function () {
                        c();
                        b(I.error("Error loading external script tag " +
                            a))
                    }), f = K.bind(d, "load", c);
                    y.append(r.fromDom(document.head), d)
                })
            }
        }, pC = {
            addStylesheet: function (a, b) {
                var c = b || r.fromDom(Hb);
                b = r.fromTag("link", c.dom());
                m.setAll(b, {rel: "stylesheet", type: "text/css", href: a});
                a = r.fromDom(c.dom().head);
                y.append(a, b);
                return b
            }
        }, nT = {
            download: function (a, b) {
                return lf.nu(function (c) {
                    var d = function (b) {
                        z(f, function (a) {
                            a.unbind()
                        });
                        c(b.fold(function (b) {
                            return I.error(b + 'Unable to download editor stylesheets from "' + a + '"')
                        }, I.value))
                    }, e = pC.addStylesheet(a), f = [K.bind(e, "load", function (a) {
                        a:{
                            try {
                                var c =
                                    a.target().dom().sheet.cssRules;
                                var e = ic(c) && 0 === c.length;
                                break a
                            } catch (C) {
                            }
                            e = !1
                        }
                        e ? d(I.error("")) : b(d)
                    }), K.bind(e, "error", u(d, I.error("")))]
                })
            }
        }, qC = Yx(), gn = {
            addStylesheet: function (a, b) {
                return qC.addStylesheet(a, b)
            }, addScript: function (a, b) {
                return qC.addScript(a, b)
            }
        }, hn = O("str", "replace"), rC = function (a, b) {
            return "2.4.2" !== a ? g.some(b + (void 0 === a ? "" : " version " + a) + " appears to be cached, as it does not match editor version 2.4.2.") : g.none()
        }, Wf = {
            aboutTags: function (a, b) {
                var c = [hn("@@FULL_VERSION@@", "2.4.2.101"),
                    hn("@@CLIENT_VERSION@@", "2.4.2.144")];
                a = a ? [hn("@@INTEGRATION_TYPE@@", b.type), hn("@@INTEGRATION_VERSION@@", b.version)] : [];
                return Qb([c, a])
            }, strictMatch: rC, weakMatch: function (a, b) {
                return rC(a, b).map(function (a) {
                    return a + " This may produce unexpected results."
                })
            }, resourceParam: h("version=2.4.2"), fullParam: h("version=2.4.2.101")
        }, na = function (a) {
            var b = a;
            return {
                get: function () {
                    return b
                }, set: function (a) {
                    b = a
                }, clone: function () {
                    return na(b)
                }
            }
        }, $1 = function (a) {
            a.each(function (a) {
                Wf.weakMatch(a.version, "Code view").each(function (a) {
                    console.warn(a)
                });
                sC.set(a.codemirror());
                tC.set(a.jsbeautify())
            });
            return a
        }, sC = na(null), tC = na(null), Tl = {
            use: {codemirror: sC.get, jsbeautify: tC.get}, load: {
                codeview: function (a) {
                    a = a + "/codeview.js?" + Wf.resourceParam();
                    return gn.addScript(a, $1)
                }
            }
        }, hy = {
            beautify: function (a) {
                return Tl.use.jsbeautify().html(a, {
                    indent_size: "2",
                    indent_char: " ",
                    max_preserve_newlines: "5",
                    preserve_newlines: !0,
                    keep_array_indentation: !1,
                    break_chained_methods: !1,
                    indent_scripts: "normal",
                    brace_style: "collapse",
                    space_before_conditional: !0,
                    unescape_strings: !1,
                    jslint_happy: !1,
                    end_with_newline: !1,
                    wrap_line_length: 0,
                    indent_inner_html: !1,
                    comma_first: !1,
                    e4x: !1
                })
            }
        }, a2 = function (a) {
            return a.map(function (a) {
                return a.dom()
            }).getOr(null)
        }, Fd = {
            documentElement: function (a) {
                if (a.content().isInline()) throw Error("documentElement called on inline mode");
                return a2(a.content().doc())
            }, insertHtmlAtCursor: function (a, b) {
                Tb(arguments, [ba.object("polish"), ba.string("html")]);
                a.content().focus();
                a.insertHtmlAtCursor(b)
            }, uploadImages: function (a, b) {
                Tb(arguments, [ba.object("polish"),
                    ba.func("callback")]);
                return a.uploadImages(b)
            }, get: function (a) {
                var b = null !== Tl.use.jsbeautify() && a.isPrettyPrinting();
                a = a.getContent();
                return b ? hy.beautify(a) : a
            }, set: function (a, b) {
                Tb(arguments, [ba.object("polish"), ba.string("html")]);
                a.setContent(b)
            }, isDirty: function (a) {
                Tb(arguments, [ba.object("polish")]);
                return a.isDirty()
            }, setDirty: function (a, b) {
                Tb(arguments, [ba.object("polish"), ba.bool("state")]);
                a.setDirty(b)
            }
        }, ta = {
            generate: function (a) {
                if (!Mb(a)) throw Error("cases must be an array");
                if (0 === a.length) throw Error("there must be at least one case");
                var b = [], c = {};
                z(a, function (d, e) {
                    var f = cb(d);
                    if (1 !== f.length) throw Error("one and only one name per case");
                    var k = f[0], l = d[k];
                    if (void 0 !== c[k]) throw Error("duplicate key detected:" + k);
                    if ("cata" === k) throw Error("cannot have a case named cata (sorry)");
                    if (!Mb(l)) throw Error("case arguments must be an array");
                    b.push(k);
                    c[k] = function () {
                        var c = arguments.length;
                        if (c !== l.length) throw Error("Wrong number of arguments to case " + k + ". Expected " + l.length + " (" + l + "), got " + c);
                        var d = Array(c);
                        for (c = 0; c < d.length; c++) d[c] =
                            arguments[c];
                        return {
                            fold: function () {
                                if (arguments.length !== a.length) throw Error("Wrong number of arguments to fold. Expected " + a.length + ", got " + arguments.length);
                                return arguments[e].apply(null, d)
                            }, match: function (a) {
                                var c = cb(a);
                                if (b.length !== c.length) throw Error("Wrong number of arguments to match. Expected: " + b.join(",") + "\nActual: " + c.join(","));
                                if (!ob(b, function (a) {
                                    return U(c, a)
                                })) throw Error("Not all branches were specified when using match. Specified: " + c.join(", ") + "\nRequired: " + b.join(", "));
                                return a[k].apply(null, d)
                            }, log: function (a) {
                                console.log(a, {constructors: b, constructor: k, params: d})
                            }
                        }
                    }
                });
                return c
            }
        },
        b2 = ta.generate([{inputSelector: ["selector", "callback"]}, {outputSelector: ["selector", "callback"]}, {inputPredicate: ["predicate", "callback"]}, {outputPredicate: ["predicate", "callback"]}]),
        ij = ua(b2, {
            cata: function (a, b, c, d, e) {
                return a.fold(b, c, d, e)
            }
        }), Zx = function (a) {
            return function (b) {
                b = E(b, function (a) {
                    return a.dom()
                });
                a(b)
            }
        }, qT = function (a) {
            return function (b) {
                return a(b.dom())
            }
        }, mb = function () {
            return "\ufeff"
        },
        zs = "\\w'\\-\\u0100-\\u017F\\u00C0-\\u00FF" + mb() + "\\u2018\\u2019", c2 = "[^" + zs + "]",
        d2 = "[" + zs + "]", lk = {chars: h(zs), wordbreak: h(c2), wordchar: h(d2)}, jn = {
            token: function (a) {
                return zq(a, h(0), h(0), g.none())
            }, word: function (a) {
                a = "((?:^'?)|(?:" + lk.wordbreak() + "+'?))" + a + "((?:'?$)|(?:'?" + lk.wordbreak() + "+))";
                return zq(a, function (a) {
                    return 1 < a.length ? a[1].length : 0
                }, function (a) {
                    return 2 < a.length ? a[2].length : 0
                }, g.none())
            }
        }, As = function (a) {
            return a.replace(/[-\[\]{}()*+?.,\\\^$|#\s]/g, "\\$&")
        }, Bs = {
            sanitise: As, word: function (a) {
                a =
                    As(a);
                return jn.word(a)
            }, token: function (a) {
                a = As(a);
                return jn.token(a)
            }
        }, Cb = {
            safeword: function (a) {
                return Bs.word(a)
            }, safetoken: function (a) {
                return Bs.token(a)
            }, custom: function (a, b, c, d) {
                return zq(a, b, c, d)
            }, unsafeword: function (a) {
                return jn.word(a)
            }, unsafetoken: function (a) {
                return jn.token(a)
            }, sanitise: function (a) {
                return Bs.sanitise(a)
            }, chars: function () {
                return lk.chars()
            }, wordbreak: function () {
                return lk.wordbreak()
            }, wordchar: function () {
                return lk.wordchar()
            }
        }, eh = function (a, b) {
            return uC(a, b, {validate: vb, label: "function"})
        },
        uC = function (a, b, c) {
            if (0 === b.length) throw Error("You must specify at least one required field.");
            ps("required", b);
            bC(b);
            return function (d) {
                var e = cb(d);
                ob(b, function (a) {
                    return U(e, a)
                }) || $B(b, e);
                a(b, e);
                var f = ka(b, function (a) {
                    return !c.validate(d[a], a)
                });
                if (0 < f.length) throw Error("All values need to be of type: " + c.label + ". Keys (" + f.slice(0).sort().join(", ") + ") were not.");
                return d
            }
        }, e2 = function (a, b) {
            b = ka(b, function (b) {
                return !U(a, b)
            });
            0 < b.length && aC(b)
        }, fh = t, xd = function (a) {
            return eh(e2, a)
        }, kn = function (a,
                          b) {
            return uC(fh, a, b)
        }, f2 = eh(fh, ["elements", "cursor", "dictation", "notify"]),
        g2 = eh(fh, ["elements", "cursor", "dictation", "range", "notify"]), Zd = {species: f2, applicator: g2}, qe = {
            fromHtml: function (a, b) {
                b = (b || Hb).createElement("div");
                b.innerHTML = a;
                return A.children(r.fromDom(b))
            }, fromTags: function (a, b) {
                return E(a, function (a) {
                    return r.fromTag(a, b)
                })
            }, fromText: function (a, b) {
                return E(a, function (a) {
                    return r.fromText(a, b)
                })
            }, fromDom: function (a) {
                return E(a, r.fromDom)
            }
        }, cy = {
            addSimpleMacro: function (a, b, c, d) {
                Tb(arguments,
                    [ba.object("polish"), ba.string("startString"), ba.string("endString"), ba.func("callback")]);
                var e = $x(b, c, d);
                return a.macros().customMacros().add(e)
            }, removeMacro: function (a, b) {
                a.macros().customMacros().remove(b)
            }
        }, vC = ["error", "info", "warning"], uT = {
            message: function (a, b, c, d) {
                if (!U(vC, b)) throw'Message level: "' + b + '" is not supported. Supported levels are: [' + vC.join(", ") + "].";
                Tb(arguments, [ba.object("polish"), ba.string("level"), ba.number("timeout"), ba.string("msg")]);
                var e = a.ui().showMessage(b, c, d);
                return {
                    hide: function () {
                        e()
                    }
                }
            }
        },
        h2 = h("pencil"), i2 = h("code"), j2 = h("spin"), k2 = h("none"),
        hc = {pencil: h2, code: i2, wait: j2, none: k2}, by = {
            get: function (a) {
                return a.getMode() === hc.pencil() ? "design" : "code"
            }, set: function (a, b) {
                Tb(arguments, [ba.object("polish"), ba.string("mode")]);
                var c = b.toLowerCase();
                if ("code" !== c && "design" !== c) throw Error('Editor mode "' + b + '" not supported. Must be either design or code.');
                a.setMode("design" === c ? hc.pencil() : hc.code())
            }
        },
        sT = "body p div article aside figcaption figure footer header nav section ol ul li table thead tbody tfoot caption tr td th h1 h2 h3 h4 h5 h6 blockquote pre address".split(" "),
        Cs = function (a, b) {
            var c = [];
            z(A.children(a), function (a) {
                b(a) && (c = c.concat([a]));
                c = c.concat(Cs(a, b))
            });
            return c
        }, ed = {
            all: function (a) {
                return Cs(ja.body(), a)
            }, ancestors: function (a, b, c) {
                return ka(A.parents(a, c), b)
            }, siblings: function (a, b) {
                return ka(A.siblings(a), b)
            }, children: function (a, b) {
                return ka(A.children(a), b)
            }, descendants: Cs
        }, Y = {
            all: function (a) {
                return Fa.all(a)
            }, ancestors: function (a, b, c) {
                return ed.ancestors(a, function (a) {
                    return Fa.is(a, b)
                }, c)
            }, siblings: function (a, b) {
                return ed.siblings(a, function (a) {
                    return Fa.is(a,
                        b)
                })
            }, children: function (a, b) {
                return ed.children(a, function (a) {
                    return Fa.is(a, b)
                })
            }, descendants: function (a, b) {
                return Fa.all(b, a)
            }
        }, wC = function (a, b, c) {
            return Ja.ancestor(a, function (a) {
                return Fa.is(a, b)
            }, c)
        }, L = {
            first: function (a) {
                return Fa.one(a)
            }, ancestor: wC, sibling: function (a, b) {
                return Ja.sibling(a, function (a) {
                    return Fa.is(a, b)
                })
            }, child: function (a, b) {
                return Ja.child(a, function (a) {
                    return Fa.is(a, b)
                })
            }, descendant: function (a, b) {
                return Fa.one(b, a)
            }, closest: function (a, b, c) {
                return Xx(Fa.is, wC, a, b, c)
            }
        }, Ds =
            ay(D.isText, "text"), Ya = {
            get: function (a) {
                return Ds.get(a)
            }, getOption: function (a) {
                return Ds.getOption(a)
            }, set: function (a, b) {
                Ds.set(a, b)
            }
        }, l2 = O("element", "offset"), m2 = O("element", "deltaOffset"), n2 = O("element", "start", "finish"),
        o2 = O("begin", "end"), p2 = O("element", "text"), W = {point: l2, delta: m2, range: n2, points: o2, text: p2},
        ln = h(!1), q2 = h(!0), Es = function (a) {
            return {
                isBoundary: function () {
                    return a(q2, ln, ln)
                }, fold: a, toText: function () {
                    return a(g.none, g.none, function (a, c) {
                        return g.some(a)
                    })
                }, is: function (b) {
                    return a(ln,
                        ln, function (a, d) {
                            return d.eq(a, b)
                        })
                }, len: function () {
                    return a(h(0), h(1), function (a, c) {
                        return c.property().getText(a).length
                    })
                }
            }
        }, mn = {
            text: function (a, b) {
                return Es(function (c, d, e) {
                    return e(a, b)
                })
            }, boundary: function (a, b) {
                return Es(function (c, d, e) {
                    return c(a, b)
                })
            }, empty: function (a, b) {
                return Es(function (c, d, e) {
                    return d(a, b)
                })
            }, cata: function (a, b, c, d) {
                return a.fold(b, c, d)
            }
        }, r2 = {
            boundAt: function (a, b, c, d) {
                b = Va(a, u(d, b)).getOr(0);
                c = Va(a, u(d, c)).map(function (a) {
                    return a + 1
                }).getOr(a.length);
                return a.slice(b, c)
            }
        },
        s2 = {
            sliceby: function (a, b) {
                b = Va(a, b).getOr(-1);
                return a.slice(0, b)
            }
        }, Fs = ta.generate([{include: ["item"]}, {excludeWith: ["item"]}, {excludeWithout: ["item"]}]), $h = {
            include: Fs.include,
            excludeWith: Fs.excludeWith,
            excludeWithout: Fs.excludeWithout,
            cata: function (a, b, c, d) {
                return a.fold(b, c, d)
            }
        }, xC = function (a, b) {
            var c = [], d = [];
            z(a, function (a) {
                var e = b(a);
                $h.cata(e, function () {
                    d.push(a)
                }, function () {
                    0 < d.length && c.push(d);
                    c.push([a]);
                    d = []
                }, function () {
                    0 < d.length && c.push(d);
                    d = []
                })
            });
            0 < d.length && c.push(d);
            return c
        }, yC =
            {
                splitby: function (a, b) {
                    return xC(a, function (a) {
                        return b(a) ? $h.excludeWithout(a) : $h.include(a)
                    })
                }, splitbyAdv: xC
            }, zC = {
            splitby: function (a, b) {
                return yC.splitby(a, b)
            }, splitbyAdv: function (a, b) {
                return yC.splitbyAdv(a, b)
            }, sliceby: function (a, b) {
                return s2.sliceby(a, b)
            }, boundAt: function (a, b, c, d) {
                return r2.boundAt(a, b, c, d)
            }
        }, nn = {
            count: function (a) {
                return Eb(a, function (a, c) {
                    return c.len() + a
                }, 0)
            }, dropUntil: function (a, b) {
                return zC.sliceby(a, function (a) {
                    return a.is(b)
                })
            }, gen: function (a, b) {
                return a.fold(g.none, function (a) {
                    return g.some(W.range(a,
                        b, b + 1))
                }, function (c) {
                    return g.some(W.range(c, b, b + a.len()))
                })
            }, justText: function (a) {
                return ia(a, function (a) {
                    return a.fold(h([]), h([]), function (a) {
                        return [a]
                    })
                })
            }
        }, on = function (a, b, c) {
            if (a.property().isText(b)) return [mn.text(b, a)];
            if (a.property().isEmptyTag(b)) return [mn.empty(b, a)];
            if (a.property().isElement(b)) {
                var d = a.property().children(b), e = a.property().isBoundary(b) ? [mn.boundary(b, a)] : [];
                b = void 0 !== c && c(b) ? [] : ia(d, function (b) {
                    return on(a, b, c)
                });
                return e.concat(b).concat(e)
            }
            return []
        }, AC = function (a,
                          b, c, d, e) {
            a = on(a, d, e);
            b = nn.dropUntil(a, b);
            b = nn.count(b);
            return W.point(d, b + c)
        }, ai = {
            typed: on, items: function (a, b, c) {
                a = on(a, b, c);
                var d = function (a, b) {
                    return a
                };
                return E(a, function (a) {
                    return a.fold(d, d, d)
                })
            }, extractTo: function (a, b, c, d, e) {
                return a.up().predicate(b, d).fold(function () {
                    return W.point(b, c)
                }, function (d) {
                    return AC(a, b, c, d, e)
                })
            }, extract: function (a, b, c, d) {
                return a.property().parent(b).fold(function () {
                    return W.point(b, c)
                }, function (e) {
                    return AC(a, b, c, e, d)
                })
            }
        }, t2 = function (a, b) {
            return "img" === b.property().name(a) ?
                " " : "\n"
        }, u2 = {
            from: function (a, b, c) {
                b = ai.typed(a, b, c);
                return E(b, function (b) {
                    return b.fold(h("\n"), t2, a.property().getText)
                }).join("")
            }
        }, v2 = {
            make: function (a, b, c) {
                return hb(a, function (a, c) {
                    return b(c, a.len).fold(h(a), function (b) {
                        return {len: b.finish(), list: a.list.concat([b])}
                    })
                }, {len: void 0 !== c ? c : 0, list: []}).list
            }
        }, BC = function (a, b) {
            return b >= a.start() && b <= a.finish()
        }, CC = function (a, b) {
            return Va(a, function (a) {
                return a.start() === b
            })
        }, w2 = function (a, b) {
            return a[a.length - 1] && a[a.length - 1].finish() === b ? a.length +
                1 : -1
        }, pn = {
            get: function (a, b) {
                return qa(a, function (a) {
                    return BC(a, b)
                })
            }, find: function (a, b) {
                return qa(a, b)
            }, inUnit: BC, sublist: function (a, b, c) {
                b = CC(a, b);
                var d = CC(a, c);
                return b.bind(function (b) {
                    var e = d.getOr(w2(a, c));
                    return -1 < e ? g.some(a.slice(b, e)) : g.none()
                }).getOr([])
            }
        }, DC = {
            translate: function (a, b) {
                return E(a, function (a) {
                    return ua(a, {start: h(a.start() + b), finish: h(a.finish() + b)})
                })
            }
        }, x2 = function (a, b, c) {
            b = c(a, b);
            return DC.translate(b, a.start())
        }, y2 = {
            splits: function (a, b, c) {
                return 0 === b.length ? a : ia(a, function (a) {
                    var d =
                        ia(b, function (b) {
                            return pn.inUnit(a, b) ? [b - a.start()] : []
                        });
                    return 0 < d.length ? x2(a, d, c) : [a]
                })
            }
        }, Rd = {
            generate: function (a, b, c) {
                return v2.make(a, b, c)
            }, get: function (a, b) {
                return pn.get(a, b)
            }, find: function (a, b) {
                return pn.find(a, b)
            }, splits: function (a, b, c) {
                return y2.splits(a, b, c)
            }, translate: function (a, b) {
                return DC.translate(a, b)
            }, sublist: function (a, b, c) {
                return pn.sublist(a, b, c)
            }
        }, z2 = {
            find: function (a, b, c, d) {
                a = ai.typed(a, b, d);
                a = Rd.generate(a, nn.gen);
                return Rd.get(a, c).map(function (a) {
                    return W.point(a.element(),
                        c - a.start())
                })
            }
        }, fg = {
            extract: function (a, b, c, d) {
                return ai.extract(a, b, c, d)
            }, extractTo: function (a, b, c, d, e) {
                return ai.extractTo(a, b, c, d, e)
            }, all: function (a, b, c) {
                return ai.items(a, b, c)
            }, from: function (a, b, c) {
                return ai.typed(a, b, c)
            }, find: function (a, b, c, d) {
                return z2.find(a, b, c, d)
            }, toText: function (a, b, c) {
                return u2.from(a, b, c)
            }
        }, bi = nb(), Wh = {
            extract: function (a, b, c) {
                return fg.extract(bi, a, b, c)
            }, extractTo: function (a, b, c, d) {
                return fg.extractTo(bi, a, b, c, d)
            }, all: function (a, b) {
                return fg.all(bi, a, b)
            }, from: function (a,
                               b) {
                return fg.from(bi, a, b)
            }, find: function (a, b, c) {
                return fg.find(bi, a, b, c)
            }, toText: function (a, b) {
                return fg.toText(bi, a, b)
            }
        }, EC = function (a) {
            var b = Object.create(null);
            Ma(a, function (a, d) {
                b[d] = a
            });
            return b
        }, A2 = EC({img: !0, br: !0, hr: !0, input: !0}), B2 = EC({script: !0, style: !0, noscript: !0}),
        C2 = /[<>&\u00A0]/g, D2 = {"<": "&lt;", ">": "&gt;", "&": "&amp;", "\u00a0": "&nbsp;"}, E2 = /["<>&]/g,
        F2 = {'"': "&quot;", "<": "&lt;", ">": "&gt;", "&": "&amp;"}, FC = function (a, b, c) {
            return a.replace(b, function (a) {
                return c[a] || a
            })
        }, GC = function (a) {
            for (var b =
                "", c = 0; c < a.length; c++) {
                var d = a[c];
                d.specified && "_moz_dirty" !== d.name && (b += " " + d.name + '="' + FC(d.value, E2, F2) + '"')
            }
            return b
        }, IC = function (a) {
            var b = "";
            z(a, function (a) {
                b += HC(a)
            });
            return b
        }, G2 = function (a) {
            var b = "";
            z(a, function (a) {
                b += a.textContent
            });
            return b
        }, HC = function (a) {
            var b = a.nodeType;
            if (b === gk) {
                b = a.nodeName.toLowerCase();
                var c = a.childNodes;
                a = a.attributes;
                0 === c.length && A2[b] ? b = "<" + b + GC(a) + " />" : (c = B2[b] ? G2(c) : IC(c), b = "<" + b + GC(a) + ">" + c + "</" + b + ">");
                return b
            }
            if (b === MB) return FC(a.textContent, C2, D2);
            if (b ==
                LB) return "\x3c!--" + a.data + "--\x3e";
            throw"unsupported node type " + a.nodeType;
        }, qn = {
            writeNode: function (a) {
                if (!ic(a)) throw"sugarNode parameter must be an object";
                return HC(a.dom())
            }, writeChildren: function (a) {
                if (!ic(a)) throw"sugarNode parameter must be an object";
                return IC(a.dom().childNodes)
            }
        }, JC = function (a) {
            var b = new RegExp(mb(), "g");
            return a.replace(b, "")
        }, Xj = {
            output: function (a, b) {
                a.filterDom(a.output(), b);
                a = qn.writeChildren(b);
                return JC(a)
            }, zeroWidth: JC
        }, rn = {
            toText: function (a) {
                a = E(a, function (a) {
                    return Wh.toText(a,
                        h(!1))
                }).join("");
                return Xj.zeroWidth(a.trim())
            }, toHtml: function (a) {
                a = E(a, qn.writeNode).join("");
                return Xj.zeroWidth(a)
            }
        }, KC = function (a) {
            return a.dom().innerHTML
        }, Ea = {
            get: KC, set: function (a, b) {
                var c = A.owner(a).dom(), d = r.fromDom(c.createDocumentFragment());
                b = qe.fromHtml(b, c);
                P.append(d, b);
                F.empty(a);
                y.append(a, d)
            }, getOuter: function (a) {
                var b = r.fromTag("div");
                a = r.fromDom(a.dom().cloneNode(!0));
                y.append(b, a);
                return KC(b)
            }
        }, Vb = {
            get: function (a) {
                return a.dom().textContent
            }, set: function (a, b) {
                a.dom().textContent =
                    b
            }
        }, LC = function (a, b) {
            return Sl.makeReadOnly({
                getAttributes: function () {
                    return Sl.makeReadOnly(a.getFilteredAttributes(b))
                }, setAttributes: function (c) {
                    Tb(arguments, [ba.object("attributes")]);
                    Ma(c, function (a, b) {
                        if (!xa(a)) throw Error("attribute key " + b + " does not have a string value: " + a);
                    });
                    m.setAll(b, c);
                    a.domChanged();
                    a.undoChanged()
                }, getText: function () {
                    return rn.toText([b])
                }, setText: function (a) {
                    Tb(arguments, [ba.string("text")]);
                    Vb.set(b, a)
                }, getHtml: function () {
                    return a.getFilteredContents(b)
                }, setHtml: function (a) {
                    Tb(arguments,
                        [ba.string("html")]);
                    Ea.set(b, a)
                }, replaceElement: function (c) {
                    Tb(arguments, [ba.string("html")]);
                    var d = qe.fromHtml(c);
                    if (1 !== d.length) throw Error("replacement html must be a single node");
                    d = d[0];
                    a.replaceElement(b, d);
                    return LC(a, d)
                }
            })
        }, Aq = {
            getText: function (a) {
                return a.content().getSelectedText().getOr("")
            }, getHtml: function (a) {
                return a.content().getSelectedHtml().getOr("")
            }, findTagAtCursor: function (a, b) {
                var c = a.content();
                return c.findTagAtCursor(b).map(function (a) {
                    return LC(c, a)
                }).getOr(null)
            }
        }, MC = {},
        NC = function (a) {
            return g.from(MC[a])
        }, Bq = {
            get: NC, register: function (a, b) {
                return MC[a] = b
            }, hookup: function (a, b) {
                NC(b).fold(function () {
                    console && console.error && console.error('textbox.io Could not find plugin "' + b + '". Have you declared it?')
                }, function (b) {
                    a.events.loaded.addListener(function () {
                        b.initialize(a)
                    })
                })
            }
        }, OC = {
            attached: function (a, b) {
                b = b || r.fromDom(Hb.documentElement);
                return Ja.ancestor(a, u(N.eq, b)).isSome()
            }, windowOf: function (a) {
                var b = a.dom();
                return b === b.window && a instanceof F1 ? a : D.isDocument(a) ?
                    b.defaultView || b.parentWindow : null
            }
        }, PC = function (a, b) {
            return {
                left: h(a), top: h(b), translate: function (c, d) {
                    return PC(a + c, b + d)
                }
            }
        }, Ra = PC, sn = function (a, b) {
            return void 0 !== a ? a : void 0 !== b ? b : 0
        }, QC = function (a) {
            var b = a.dom(), c = b.ownerDocument, d = c.body;
            c = r.fromDom(c.documentElement);
            if (d === b) return Ra(d.offsetLeft, d.offsetTop);
            if (!OC.attached(a, c)) return Ra(0, 0);
            a = b.getBoundingClientRect();
            return Ra(a.left, a.top)
        }, bb = {
            absolute: function (a) {
                var b = a.dom().ownerDocument, c = b.body, d = OC.windowOf(r.fromDom(b)), e = b.documentElement;
                b = sn(d.pageYOffset, e.scrollTop);
                d = sn(d.pageXOffset, e.scrollLeft);
                var f = sn(e.clientTop, c.clientTop);
                c = sn(e.clientLeft, c.clientLeft);
                return QC(a).translate(d - c, b - f)
            }, relative: function (a) {
                a = a.dom();
                return Ra(a.offsetLeft, a.offsetTop)
            }, viewport: QC
        }, H2 = aa.detect().browser.isSafari(), tn = function (a) {
            a = void 0 !== a ? a.dom() : Hb;
            return Ra(a.body.scrollLeft || a.documentElement.scrollLeft, a.body.scrollTop || a.documentElement.scrollTop)
        }, un = function (a, b, c) {
            (void 0 !== c ? c.dom() : Hb).defaultView.scrollTo(a, b)
        }, Gs = function (a,
                          b) {
            H2 && vb(a.dom().scrollIntoViewIfNeeded) ? a.dom().scrollIntoViewIfNeeded(!1) : a.dom().scrollIntoView(b)
        }, Za = {
            get: tn, to: un, by: function (a, b, c) {
                (void 0 !== c ? c.dom() : Hb).defaultView.scrollBy(a, b)
            }, preserve: function (a, b) {
                var c = tn(a);
                b();
                b = tn(a);
                c.top() === b.top() && c.left() === b.left() || un(c.left(), c.top(), a)
            }, capture: function (a) {
                var b = g.none(), c = function () {
                    b = g.some(tn(a))
                };
                c();
                return {
                    save: c, restore: function () {
                        b.each(function (b) {
                            un(b.left(), b.top(), a)
                        })
                    }
                }
            }, intoView: Gs, intoViewIfNeeded: function (a, b) {
                b = b.dom().getBoundingClientRect();
                var c = a.dom().getBoundingClientRect();
                c.top < b.top ? Gs(a, !0) : c.bottom > b.bottom && Gs(a, !1)
            }, setToElement: function (a, b) {
                b = bb.absolute(b);
                a = r.fromDom(a.document);
                un(b.left(), b.top(), a)
            }, scrollBarWidth: function () {
                var a = r.fromHtml('<div style="width: 100px; height: 100px; overflow: scroll; position: absolute; top: -9999px;"></div>');
                y.after(ja.body(), a);
                var b = a.dom().offsetWidth - a.dom().clientWidth;
                F.remove(a);
                return b
            }
        }, RC = {
            withOptions: function (a, b) {
                return m.has(a, "tabindex") ? oa(b, {
                    content: {
                        tabindex: m.get(a,
                            "tabindex")
                    }
                }) : b
            }
        }, SC = aa.detect(), I2 = SC.browser.isIE() && 10 === SC.browser.version.major, Hs = function (a, b) {
            var c = v.getRaw(a, b).getOrThunk(function () {
                return v.get(a, b)
            });
            return I2 && "0px" === c ? "auto" : c
        }, mk = function (a, b, c) {
            a = Hs(a, b);
            return void 0 === a ? c : g.some(a)
        }, J2 = function (a) {
            return {
                width: mk(a, "width", g.none()),
                "max-width": mk(a, "max-width", g.some("none")),
                "min-width": mk(a, "min-width", g.some("none")),
                "max-height": mk(a, "max-height", g.some("none")),
                "min-height": mk(a, "min-height", g.some("1em"))
            }
        }, vn = function (a,
                          b, c) {
            var d = v.getRaw(b, "display"), e = Hs(b, "height");
            v.set(b, "display", "none");
            var f = Hs(b, "height"), k = J2(b);
            d.fold(function () {
                v.remove(b, "display")
            }, function (a) {
                v.set(b, "display", a)
            });
            Ma(k, function (a, b) {
                a.each(function (a) {
                    v.set(c, b, a)
                })
            });
            d = "auto" === f ? e : f;
            void 0 !== d && (!0 === a ? (v.set(c, "min-height", d), v.remove(c, "height")) : v.set(c, "height", d));
            v.set(c, "display", "flex")
        }, K2 = u(vn, !1), L2 = u(vn, !0), M2 = function (a) {
            vn(!1, a, a)
        }, N2 = function (a) {
            vn(!0, a, a)
        }, TC = function (a) {
            return a.replace(/\./g, "-")
        }, Lb = {
            create: function (a) {
                var b =
                    TC(a);
                return {
                    resolve: function (a) {
                        a = a.split(" ");
                        return E(a, function (a) {
                            return b + "-" + a
                        }).join(" ")
                    }
                }
            }, cssNamespace: TC, cssClass: function (a, b) {
                return a + "-" + b
            }
        }, UC = Lb.create("ephox-elder"), wn = {resolve: UC.resolve, scrollable: u(UC.resolve, "scrollable")},
        Is = function (a, b) {
            a = m.get(a, b);
            return void 0 === a || "" === a ? [] : a.split(" ")
        }, ff = {
            read: Is, add: function (a, b, c) {
                c = Is(a, b).concat([c]);
                m.set(a, b, c.join(" "));
                return !0
            }, remove: function (a, b, c) {
                var d = ka(Is(a, b), function (a) {
                    return a !== c
                });
                0 < d.length ? m.set(a, b, d.join(" ")) :
                    m.remove(a, b);
                return !1
            }
        }, VC = function (a) {
            return ff.read(a, "class")
        }, WC = function (a, b) {
            return ff.add(a, "class", b)
        }, XC = function (a, b) {
            return ff.remove(a, "class", b)
        }, md = {
            get: VC, add: WC, remove: XC, toggle: function (a, b) {
                return U(VC(a), b) ? XC(a, b) : WC(a, b)
            }, supports: function (a) {
                return void 0 !== a.dom().classList
            }
        }, YC = function (a, b) {
            return md.supports(a) && a.dom().classList.contains(b)
        }, n = {
            add: function (a, b) {
                md.supports(a) ? a.dom().classList.add(b) : md.add(a, b)
            }, remove: function (a, b) {
                md.supports(a) ? a.dom().classList.remove(b) :
                    md.remove(a, b);
                0 === (md.supports(a) ? a.dom().classList : md.get(a)).length && m.remove(a, "class")
            }, toggle: function (a, b) {
                return md.supports(a) ? a.dom().classList.toggle(b) : md.toggle(a, b)
            }, toggler: function (a, b) {
                var c = md.supports(a), d = a.dom().classList;
                return Cq(function () {
                    c ? d.remove(b) : md.remove(a, b)
                }, function () {
                    c ? d.add(b) : md.add(a, b)
                }, YC(a, b))
            }, has: YC
        }, ma = {
            add: function (a, b) {
                z(b, function (b) {
                    n.add(a, b)
                })
            }, remove: function (a, b) {
                z(b, function (b) {
                    n.remove(a, b)
                })
            }, toggle: function (a, b) {
                z(b, function (b) {
                    n.toggle(a,
                        b)
                })
            }, hasAll: function (a, b) {
                return ob(b, function (b) {
                    return n.has(a, b)
                })
            }, hasAny: function (a, b) {
                return Xa(b, function (b) {
                    return n.has(a, b)
                })
            }, get: function (a) {
                if (md.supports(a)) {
                    a = a.dom().classList;
                    for (var b = Array(a.length), c = 0; c < a.length; c++) b[c] = a.item(c);
                    a = b
                } else a = md.get(a);
                return a
            }
        }, yf = {
            addClass: function (a) {
                return function (b) {
                    n.add(b, a)
                }
            }, removeClass: function (a) {
                return function (b) {
                    n.remove(b, a)
                }
            }, removeClasses: function (a) {
                return function (b) {
                    ma.remove(b, a)
                }
            }, hasClass: function (a) {
                return function (b) {
                    return n.has(b,
                        a)
                }
            }
        }, xn = g.none(), ZC = wn.resolve("modal-scroll-lock"), $C = function (a, b) {
            z(b, function (b) {
                a(b)
            })
        }, O2 = u($C, yf.addClass(ZC)), P2 = u($C, yf.removeClass(ZC)), jf = function (a, b) {
            var c = null, d = null;
            return {
                cancel: function () {
                    null !== c && (clearTimeout(c), d = c = null)
                }, throttle: function () {
                    for (var e = [], f = 0; f < arguments.length; f++) e[f] = arguments[f];
                    d = e;
                    null === c && (c = setTimeout(function () {
                        a.apply(null, d);
                        d = c = null
                    }, b))
                }
            }
        }, uj = function (a, b) {
            var c = null;
            return {
                cancel: function () {
                    null !== c && (clearTimeout(c), c = null)
                }, throttle: function () {
                    for (var d =
                        [], e = 0; e < arguments.length; e++) d[e] = arguments[e];
                    null !== c && clearTimeout(c);
                    c = setTimeout(function () {
                        a.apply(null, d);
                        c = null
                    }, b)
                }
            }
        }, H = {
            create: function (a) {
                var b = eb(a, function (a) {
                    return {bind: a.bind, unbind: a.unbind}
                });
                a = eb(a, function (a) {
                    return a.trigger
                });
                return {registry: b, trigger: a}
            }
        }, Vc = {
            register: function (a) {
                n.add(a, wn.scrollable())
            }, deregister: function (a) {
                n.remove(a, wn.scrollable())
            }, scrollable: wn.scrollable, preserve: Za.preserve, capture: Za.capture, block: function () {
                if (xn.isNone()) {
                    var a = Za.get(), b = K.bind(r.fromDom(window),
                        "scroll", function (b) {
                            b = Za.get();
                            b.left() === a.left() && b.top() === a.top() || window.scrollTo(a.left(), a.top())
                        });
                    xn = g.some(b)
                }
            }, unblock: function () {
                xn.each(function (a) {
                    a.unbind();
                    xn = g.none()
                })
            }, lock: O2, unlock: P2, event: function (a) {
                var b = !1, c = H.create({started: p([]), stopped: p([])}), d = uj(function () {
                    !0 === b && (b = !1, c.trigger.stopped())
                }, 250), e = K.bind(a, "scroll", function () {
                    !1 === b && c.trigger.started();
                    b = !0;
                    d.throttle()
                });
                return {
                    events: c.registry, destroy: function () {
                        e.unbind()
                    }, isScrolling: function () {
                        return b
                    }
                }
            }
        },
        xf = {
            isEmpty: function (a) {
                return null === a || void 0 === a || "" === a || Mb(a) && 0 === a.length
            }
        }, yn = Yx(), Js = {
            preload: function () {
                yn.preload()
            }, addStylesheet: function (a, b) {
                return yn.addStylesheet(a, b)
            }, addScript: function (a, b) {
                return yn.addScript(a, b)
            }, waitForLoad: function () {
                return yn.waitForLoad()
            }
        }, aD = function () {
            return {
                zh_hk: "zh_tw",
                iw: "he",
                no: "nb",
                nn: "nb",
                en: "en",
                ar: "ar",
                ca: "ca",
                cs: "cs",
                da: "da",
                de: "de",
                el: "el",
                es: "es",
                fa: "fa",
                fi: "fi",
                fr: "fr",
                he: "he",
                hr: "hr",
                hu: "hu",
                it: "it",
                ja: "ja",
                kk: "kk",
                ko: "ko",
                nl: "nl",
                nb: "nb",
                pl: "pl",
                pt: "pt",
                pt_pt: "pt_pt",
                ro: "ro",
                ru: "ru",
                sl: "sl",
                sk: "sk",
                sv: "sv",
                th: "th",
                tr: "tr",
                uk: "uk",
                zh: "zh",
                zh_tw: "zh_tw"
            }
        }, bD = function (a) {
            a = a.toLowerCase().replace("-", "_");
            var b = a.indexOf(";");
            a = -1 < b ? a.substring(0, b) : a;
            a = Zh(a);
            b = a.indexOf("_");
            b = -1 < b ? a.substring(0, b) : a;
            return {full: a, languageCode: b}
        }, cD = function (a, b) {
            a = a.split(",");
            a = E(a, function (a) {
                a = bD(a);
                return b[a.full] || b[a.languageCode] || ""
            });
            return qa(a, function (a) {
                return "" !== a
            })
        }, Ks = {
            extract: bD, determine: function (a) {
                var b = aD();
                return cD(a, b)
            },
            determineFrom: cD, localeList: aD
        }, ee = function (a) {
            for (var b = [], c = function (a) {
                b.push(a)
            }, d = 0; d < a.length; d++) a[d].each(c);
            return b
        }, yc = function (a, b) {
            for (var c = 0; c < a.length; c++) {
                var d = b(a[c], c);
                if (d.isSome()) return d
            }
            return g.none()
        }, dD = function () {
            var a = bh("navigator") || {};
            return a.userLanguage || a.language || "en"
        }(), eD = g.none(), qf = {
            determine: function (a) {
                var b = void 0 !== a ? [a, dD] : [dD];
                return yc(b, Ks.determine).fold(function () {
                    console.warn("WARNING: locales not supported: " + b.join(", "));
                    return "en"
                }, ca)
            }, get: function () {
                return eD.getOrDie("locale used before it has been set")
            },
            set: function (a) {
                eD = g.from(a)
            }
        }, Q2 = {
            font: {
                arial: "Arial",
                courier: "Courier New",
                comicsans: "Comic Sans MS",
                consolas: "Consolas",
                georgia: "Georgia",
                impact: "Impact",
                tahoma: "Tahoma",
                timesnr: "Times New Roman",
                trebuchet: "Trebuchet MS",
                verdana: "Verdana"
            },
            error: {
                duplicate: {code: "That snippet code is already taken.", uuid: "That snippet uuid is already taken."},
                unknown: {uuid: "The snippet uuid cannot be found"},
                code: {duplicate: "That snippet code is already taken."}
            },
            cog: {
                login: "Log in", logout: "Log out", "not-logged-in": "Not logged in",
                user: "User: {0}"
            },
            banner: {"logged-in": "Logged in as: {0}"}
        }, fD = {}, gD = "", Ls = {}, hD = function (a) {
            return bh(a, Ls) || bh(a, fD) || bh(a, Q2)
        }, gh = {
            loadEnglish: function (a) {
                fD = a
            }, load: function (a, b) {
                gD = a;
                Ls = b;
                qf.set(a)
            }, isLoaded: function (a) {
                return gD === a && 0 < cb(Ls).length
            }, get: function (a) {
                var b = hD(a);
                if (xa(b)) return b;
                throw Error("key " + a + " does not exist");
            }, has: function (a) {
                if (!xa(a)) throw a.fold ? console.error("object details were", a.fold(ca, ca, ca)) : console.error("object key was", a), "key was an object";
                return xa(hD(a))
            }
        },
        Ms = g.none(), Ns = {
            set: function (a) {
                Ms.fold(function () {
                    Ms = g.some(a)
                }, function (b) {
                    b !== a && console.error('Only one base URL supported per page. Requested value "' + a + '", already using "' + b + '"')
                })
            }, get: function () {
                return Ms.getOrDie("Must begin loading with a base URL")
            }
        }, R2 = {
            execute: function (a) {
                if ("complete" === Hb.readyState || "interactive" === Hb.readyState) a(); else var b = K.bind(r.fromDom(Hb), "DOMContentLoaded", function () {
                    a();
                    b.unbind()
                })
            }
        }, zn = dy("width", function (a) {
            return a.dom().offsetWidth
        }), Ia = {
            set: function (a,
                           b) {
                zn.set(a, b)
            }, get: function (a) {
                return zn.get(a)
            }, getOuter: function (a) {
                return zn.getOuter(a)
            }, setMax: function (a, b) {
                b = zn.max(a, b, "margin-left border-left-width padding-left padding-right border-right-width margin-right".split(" "));
                v.set(a, "max-width", b + "px")
            }
        }, iD = function () {
            var a = r.fromTag("div");
            n.add(a, "ephox-textbox-font");
            var b = r.fromTag("span");
            n.add(b, "ephox-chameleon-icon");
            y.append(a, b);
            y.append(ja.body(), a);
            var c = Ia.get(b);
            b = v.get(b, "font-family");
            F.remove(a);
            return 0 < c && void 0 !== b && Bb(b,
                "Textbox Icons")
        }, S2 = function (a) {
            var b = 0, c = setInterval(function () {
                b += 250;
                iD() ? (clearInterval(c), a(!0)) : 2E3 < b && (clearInterval(c), a(!1))
            }, 250)
        }, T2 = {
            wait: gc(function () {
                return lf.nu(function (a) {
                    R2.execute(function () {
                        iD() ? a(!0) : S2(a)
                    })
                })
            })
        }, U2 = function (a) {
            T2.wait().get(function (b) {
                a(b ? I.value(!0) : I.error("Stylesheet loaded, but did not contain Textbox.io styles"))
            })
        }, jD = function (a, b) {
            a = a + "/i18n/tbio_" + b + ".js?" + Wf.resourceParam();
            return Js.addScript(a, function (a) {
                return a.bind(function (a) {
                    return Wf.strictMatch(a.version,
                        "Language strings").fold(function () {
                        return I.value(a.strings())
                    }, I.error)
                })
            })
        }, kD = function (a) {
            var b = "/textboxio.css?" + Wf.fullParam();
            Js.addStylesheet(a + b, U2)
        }, ak = {
            load: function (a) {
                Ns.set(a);
                a = Ns.get();
                kD(a + "/css");
                jD(a, "en").get(function (a) {
                    a.each(gh.loadEnglish)
                });
                return a
            }, devLoad: kD, setLanguage: function (a) {
                var b = qf.determine(a);
                gh.isLoaded(b) || (a = Ns.get(), jD(a, b).get(function (a) {
                    a.each(function (a) {
                        gh.load(b, a)
                    })
                }))
            }, waitForLoad: function () {
                return Js.waitForLoad()
            }, getFailures: function (a) {
                return ia(a,
                    function (a) {
                        return a.fold(function (a) {
                            return [a]
                        }, h([]))
                    })
            }
        }, T = {
            span: function (a) {
                a = r.fromTag("span", a);
                m.set(a, "role", "presentation");
                return a
            }, div: function (a) {
                a = r.fromTag("div", a);
                m.set(a, "role", "presentation");
                return a
            }, tag: function (a, b) {
                a = r.fromTag(a, b);
                m.set(a, "role", "presentation");
                return a
            }
        }, B = {resolve: Lb.create("ephox-polish").resolve}, Db = {
            any: function (a) {
                return L.first(a).isSome()
            }, ancestor: function (a, b, c) {
                return L.ancestor(a, b, c).isSome()
            }, sibling: function (a, b) {
                return L.sibling(a, b).isSome()
            },
            child: function (a, b) {
                return L.child(a, b).isSome()
            }, descendant: function (a, b) {
                return L.descendant(a, b).isSome()
            }, closest: function (a, b, c) {
                return L.closest(a, b, c).isSome()
            }
        }, Os = B.resolve("highcontrast-mode"), V2 = function (a) {
            var b = r.fromTag("div");
            n.add(b, B.resolve("highcontrast-detect"));
            y.append(a, b);
            v.reflow(b);
            (!0 === ("none" === v.get(b, "background-image") ? !0 : !1) ? n.add : n.remove)(a, Os);
            F.remove(b)
        }, W2 = function (a) {
            var b = r.fromDom(document.documentElement);
            (!0 === (m.has(b, "hc") && m.has(b, "hcx")) ? n.add : n.remove)(a,
                Os)
        }, X2 = t, lj = {
            detect: function (a) {
                var b = aa.detect();
                b.os.isWindows() && (b.browser.isIE() || b.browser.isEdge() || b.browser.isFirefox() ? V2 : b.browser.isChrome() ? W2 : X2)(a)
            }, isHighContrast: function (a) {
                return Db.ancestor(a.uiContainer(), "." + Os)
            }
        }, iy = Aa(["width", "docWidth", "height", "docHeight"], []),
        lD = ta.generate([{unchanged: ["html"]}, {changed: ["html"]}]), Lf = {
            unchanged: lD.unchanged, changed: lD.changed, cata: function (a, b, c) {
                return a.fold(b, c)
            }
        }, mD = function () {
            return {
                validate: function (a, b) {
                    return vb(a) || "events" ===
                        b && ic(a)
                }, label: "Function (or events)"
            }
        }(),
        nD = "activateInline communication connect content deactivateInline element events filter focus getContent getMode insertHtmlAtCursor isDirty isPrettyPrinting keyboard macros operations setContent setDirty smartview state ui undo".split(" "),
        Y2 = kn(nD.concat([]), mD),
        Z2 = kn(nD.concat("blur destroy fromTransfer fullscreen uploader toTransfer viewport".split(" ")), mD),
        kj = {external: Y2, internal: Z2}, $2 = {
            create: function () {
                var a = !1;
                return {
                    isBlocked: function () {
                        return a
                    },
                    block: function () {
                        a = !0
                    }, unblock: function () {
                        a = !1
                    }
                }
            }
        }, a3 = {
            create: function (a, b) {
                return {control: a, instance: b}
            }
        }, Hd = {
            tap: function (a) {
                var b = $2.create();
                return a3.create(b, function () {
                    b.isBlocked() || a.apply(null, arguments)
                })
            }
        }, oD = 0, Ha = function (a) {
            var b = (new Date).getTime(), c = Math.floor(1E9 * Math.random());
            oD++;
            return a + "_" + c + oD + String(b)
        }, pD = {
            isFunctionOrEvents: function (a) {
                var b = function (b) {
                    return !0 === ob(a, function (a) {
                        return void 0 !== b[a] && void 0 !== b[a].bind && vb(b[a].bind)
                    }) ? !0 : !1
                };
                return {
                    validate: function (a,
                                        d) {
                        return vb(a) || "events" === d && ic(a) && b(a)
                    }, label: "Function (or events)"
                }
            }
        },
        Eq = kn("events init ui check scanView situation hasDropdown hasAutocorrect handle assign lock destroy state lookup name".split(" "), pD.isFunctionOrEvents(["analytics"])),
        Jg = {
            noSituation: function () {
                return {primary: h([]), secondary: h([]), submenus: h({})}
            }, basic: function () {
                return {destroy: t, ui: g.none, state: h({}), events: Gd(["analytics"])}
            }
        }, qD = function (a, b) {
            var c = {};
            Ma(a, function (a, b) {
                var d = b.split(".");
                if (1 >= d.length) c[b] = {finalvalue: a};
                else {
                    var e = c;
                    es(b, c);
                    for (b = 0; b < d.length - 1; b++) e = e[d[b]];
                    e[d[d.length - 1]] = {finalvalue: a}
                }
            });
            var d = function (a) {
                var c = {}, e = cb(a);
                z(e, function (e) {
                    c[e] = void 0 !== a[e].finalvalue ? b(a[e].finalvalue) : h(d(a[e]))
                });
                return c
            };
            return d(c)
        }, wb = {
            ui: function (a, b) {
                a = qD(a, void 0 !== b ? b : h);
                return h(g.some(a))
            }, actions: function (a) {
                a = qD(a, ca);
                return h(a)
            }
        }, Ta = {
            basic: Jg.basic, draganddrop: function () {
                return {events: Gd(["insertAssets", "insertHtml"]), destroy: t}
            }, communication: function () {
                return {headers: h({}), destroy: t}
            }, fullscreen: function () {
                return {
                    ui: g.none,
                    actions: wb.actions({maximize: t, restore: t}),
                    select: t,
                    deselect: t,
                    destroy: t,
                    events: Gd(["analytics", "maximize", "restore"])
                }
            }, dialog: function () {
                return {destroy: t, ui: g.none, events: Gd(["analytics"]), actions: wb.actions({show: t})}
            }, spelling: function () {
                return zT()
            }, editorcontext: function () {
                return {events: Gd(["blockChanged", "enterDown", "enterUp"]), destroy: t}
            }, highlighter: function () {
                return {destroy: t, run: t}
            }, linkvalidator: function () {
                return {destroy: t, refresh: t, ignore: t, state: h({ignore: [], cache: {}})}
            }, macros: function () {
                return {
                    events: Gd(["analytics"]),
                    state: h({}), customMacros: h(Dq({})), destroy: t
                }
            }, table: function () {
                return {
                    ui: g.none,
                    state: h({}),
                    events: Gd(["analytics"]),
                    situation: Jg.noSituation,
                    handle: t,
                    assign: t,
                    destroy: t,
                    name: h("table-disabled")
                }
            }, image: function () {
                return {
                    events: Gd(["changed", "contextmenu"]),
                    situation: Jg.noSituation,
                    handle: t,
                    assign: t,
                    destroy: t,
                    name: h("image-disabled")
                }
            }, imageEdit: function () {
                var a = function (a, b) {
                    return Ga.pure(E(b, Pb(I.value, a)))
                }, b = u(a, ca);
                a = u(a, function (a) {
                    return a.asset()
                });
                return {
                    situation: Jg.noSituation,
                    handle: t,
                    assign: t,
                    ui: g.none,
                    destroy: t,
                    insertResample: h({assets: b, correlated: a, destroy: t}),
                    name: h("imageEdit-disabled")
                }
            }, mobile: function () {
                return {ui: g.none, events: Gd(["fullscreen"]), destroy: t}
            }, noAnalytics: function () {
                return {log: t, register: t}
            }, state: function (a) {
                var b = ey(a.laundry), c = fy(a.filters, t, t), d = Dq(a.macros.customs);
                return {
                    filter: h({customFilters: h(c)}),
                    macros: h({customMacros: h(d)}),
                    laundry: b,
                    getState: function (e) {
                        return ua(a, void 0 === e ? {} : e, {
                            laundry: b.state(),
                            filters: c.state(),
                            macros: {customs: d.state()}
                        })
                    }
                }
            },
            uploader: function () {
                var a = H.create({reconstitute: p([]), uploadAssets: p(["assets"])});
                return {destroy: t, events: a.registry, reconstitute: t, uploadAssets: t}
            }, undo: function () {
                return {reset: t, disable: xb, save: t}
            }
        }, Id = {
            activateInline: t,
            deactivateInline: t,
            communication: Ta.communication,
            events: function () {
                return H.create({
                    loaded: p([]),
                    focus: p([]),
                    dirty: p([]),
                    change: p([]),
                    internal: p(["command", "data"]),
                    paint: p([])
                }).registry
            },
            keyboard: yb("the keyboard feature is not implemented in this mode"),
            operations: yb("the operations feature is not implemented in this mode"),
            smartview: yb("the smartview feature is not implemented in this mode"),
            ui: yb("the ui feature is not implemented in this mode")
        }, An = dy("height", function (a) {
            var b = a.dom();
            return ja.inBody(a) ? b.getBoundingClientRect().height : b.offsetHeight
        }), sa = {
            set: function (a, b) {
                An.set(a, b)
            }, get: function (a) {
                return An.get(a)
            }, getOuter: function (a) {
                return An.getOuter(a)
            }, setMax: function (a, b) {
                b = An.max(a, b, "margin-top border-top-width padding-top padding-bottom border-bottom-width margin-bottom".split(" "));
                v.set(a, "max-height",
                    b + "px")
            }
        }, b3 = "undo insert style emphasis align listindent format tools".split(" "), gg = O("x", "y", "width", "height"),
        c3 = {
            intersect: function (a, b) {
                var c = Math.max(a.x(), b.x()), d = Math.max(a.y(), b.y()),
                    e = Math.min(a.x() + a.width(), b.x() + b.width());
                e = Math.max(0, e - c);
                a = Math.min(a.y() + a.height(), b.y() + b.height());
                return gg(c, d, e, Math.max(0, a - d))
            }
        },
        Ge = ta.generate([{unbundled: []}, {unsupported: ["message"]}, {item: ["info", "blueprint"]}, {customMenu: ["info", "groups", "blueprint"]}, {textboxMenu: ["info", "blueprint"]}, {
            palette: ["info",
                "children", "blueprint"]
        }]), rD = {
            create: function (a) {
                var b = function (a, b) {
                    return a.feature.fold(function () {
                        return void 0 !== a.unsupported ? [Ge.unsupported(a.unsupported)] : [Ge.unbundled()]
                    }, function (c) {
                        if (void 0 === c[a.command]) return console.warn("unknown command: " + a.command), [];
                        c = c[a.command]();
                        return [b(c)]
                    })
                }, c = function (a, c) {
                    return b(c, function (b) {
                        return U(["widget", "inline-widget", "split-widget"], c.type) ? Ge.item({instance: b.widget}, a[c.type]) : Ge.item(b[c.type](), a[c.type])
                    })
                }, d = {
                    dropdown: c, general: c,
                    widget: c, "split-widget": c, "inline-widget": c, palette: function (a, c) {
                        return b(c, function (b) {
                            b = b.palette();
                            var c = E(b.items, function (b) {
                                return U(["widget", "inline-widget", "split-widget"], b.type) ? Ge.item({instance: b.build}, a[b.type]) : U(["dropdown"], b.type) ? Ge.item(b.build(), a[b.type]) : Ge.item(b.spec, a[b.type])
                            });
                            return Ge.palette(b, c, a.palette)
                        })
                    }, submenu: function (b, c) {
                        var d = E(c.commands, a);
                        return [Ge.customMenu(c, d, b.menu)]
                    }, menu: function (a, c) {
                        return b(c, function (b) {
                            return Ge.textboxMenu(b[c.type](), a[c.type])
                        })
                    }
                };
                return {
                    classify: function (a, b) {
                        var c = d[b.type];
                        return void 0 !== c ? c(a, b) : []
                    }
                }
            }, cata: function (a, b, c, d, e, f, k) {
                return a.fold(b, c, d, e, f, k)
            }
        }, d3 = {
            fromConfig: function (a, b, c) {
                var d = function (a, b) {
                    a = u(e.classify, a);
                    a = ia(b.items, a);
                    return {category: b.category, books: a}
                };
                a = u(d, a);
                b = u(d, b);
                var e = rD.create(b);
                return E(c, a)
            }
        }, va = {resolve: Lb.create("ephox-chameleon").resolve}, mj = {
            show: function (a) {
                v.remove(a, "display")
            }, hide: function (a) {
                v.set(a, "display", "none")
            }, isShowing: function (a) {
                return v.getRaw(a, "display").isNone()
            },
            isHiding: function (a) {
                return v.getRaw(a, "display").is("none")
            }
        }, jy = {group: eh(fh, ["component", "isVisible", "refreshUi", "destroy"])}, Oq = {
            menu: function (a, b) {
                var c = H.create({done: p([]), abort: p(["item"])}), d = function (a) {
                    a.done.bind(function () {
                        c.trigger.done()
                    });
                    a.abort.bind(function (a) {
                        c.trigger.abort(a.item())
                    });
                    return ua(a, {done: c.registry.done, abort: c.registry.abort})
                }, e = Eb(b, function (a, b) {
                    var c = ua(b.structure(), a.structures), e = b.submenus().concat(a.submenus),
                        f = ua(b.handlers(), a.actions), k = [b.refreshMenu].concat(a.refreshMenu);
                    a = [b.destroyer].concat(a.destroyers);
                    b = d(b.events);
                    return {structures: c, submenus: e, refreshMenu: k, actions: f, destroyers: a, events: b}
                }, {structures: {}, submenus: [], actions: {}, refreshMenu: [], destroyers: [], events: {}});
                return {
                    structure: h(e.structures), init: function (a) {
                        z(e.refreshMenu, xb)
                    }, name: h(a), handlers: h(e.actions), submenus: h(e.submenus), events: e.events, destroy: function () {
                        z(e.destroyers, xb)
                    }
                }
            }, toolbar: function (a) {
                a = BT(a);
                var b = H.create({escaped: p([]), executed: p([])});
                return jy.group({
                    component: a.component,
                    isVisible: a.isVisible, refreshUi: a.refreshUi, destroy: a.destroy, events: b.registry
                })
            }
        }, sD = function (a, b) {
            n.add(a, va.resolve("user-icon"));
            v.setAll(a, {"background-image": "url(" + b + ")"})
        }, Bn = {
            setUrl: sD, findAndSetUrl: function (a, b) {
                L.descendant(a, ".ephox-pastry-icon-content").each(function (a) {
                    sD(a, b)
                })
            }
        }, Cn = function (a, b) {
            m.set(a, "aria-pressed", b ? "true" : "false")
        }, ra = {
            expanded: function (a) {
                m.set(a, "aria-expanded", "true")
            }, collapsed: function (a) {
                m.set(a, "aria-expanded", "false")
            }, checked: function (a, b) {
                m.set(a, "aria-checked",
                    String(b))
            }, setPressed: Cn, press: function (a) {
                Cn(a, !0)
            }, release: function (a) {
                Cn(a, !1)
            }, pressed: function (a) {
                Cn(a.element(), a.selected())
            }, enable: function (a) {
                m.set(a, "aria-disabled", "false")
            }, disable: function (a) {
                m.set(a, "aria-disabled", "true")
            }, tabSelected: function (a, b) {
                m.setAll(a, {"aria-selected": "true", "aria-pressed": "true"});
                z(b, function (a) {
                    m.setAll(a, {"aria-selected": "false", "aria-pressed": "false"})
                })
            }, showPanel: function (a) {
                m.set(a, "aria-selected", "true");
                m.set(a, "aria-hidden", "false")
            }, hidePanel: function (a) {
                m.set(a,
                    "aria-selected", "false");
                m.set(a, "aria-hidden", "true")
            }
        }, e3 = function (a) {
            a.enable();
            ra.enable(a.element())
        }, f3 = function (a) {
            a.disable();
            ra.disable(a.element())
        }, Lq = {
            control: function (a) {
                return {enable: u(e3, a), disable: u(f3, a)}
            }, ariaPressed: function (a) {
                return {press: u(ra.press, a.element()), release: u(ra.release, a.element())}
            }
        }, Dn = function (a) {
            var b = a.replace(/\./g, "-");
            return {
                resolve: function (a) {
                    return b + "-" + a
                }
            }
        }, nk = {resolve: Dn("ephox-echo").resolve}, g3 = nk.resolve("aria-help"), h3 = nk.resolve("aria-help-visible"),
        En = function (a) {
            m.set(a, "role", "presentation")
        }, tD = function (a, b) {
            m.setAll(a, {role: "application", "aria-label": b})
        }, uD = function (a) {
            m.set(a, "role", "button")
        }, Ps = function (a, b) {
            m.set(a, "aria-owns", b)
        }, vD = function (a, b) {
            m.set(a, "aria-controls", b)
        }, wD = function (a, b) {
            var c = Ha("ephox-aria");
            m.set(b, "id", c);
            vD(a, c)
        }, xD = function (a, b) {
            m.set(a, "aria-describedby", b)
        }, yD = function (a, b) {
            m.set(a, "aria-labelledby", b)
        }, Fn = function (a, b) {
            m.set(a, "aria-label", b)
        }, S = {
            document: function (a) {
                m.set(a, "role", "document")
            }, presentation: En,
            region: function (a) {
                m.set(a, "role", "region")
            }, controls: vD, owns: Ps, disown: function (a) {
                m.remove(a, "aria-owns")
            }, editor: function (a, b, c, d, e) {
                tD(a, c);
                d.each(function (c) {
                    var d = r.fromTag("span");
                    En(d);
                    y.append(d, r.fromText(c));
                    c = Ha("ephox-aria");
                    m.set(d, "id", c);
                    xD(b, c);
                    n.add(d, g3);
                    !0 === e && n.add(d, h3);
                    y.append(a, d)
                });
                return {
                    destroy: function () {
                        m.remove(b, "aria-describedby")
                    }
                }
            }, inline: function (a, b, c, d, e) {
                tD(a, c);
                var f = [];
                m.has(b, "id") ? Ps(a, m.get(b, "id")) : (c = Ha("ephox-aria-content"), m.set(b, "id", c), Ps(a, c), f.push(function () {
                    m.remove(b,
                        "id")
                }));
                d.each(function (a) {
                    if (m.has(b, "aria-label")) {
                        var c = m.get(b, "aria-label");
                        Fn(b, a);
                        f.push(function () {
                            Fn(b, c)
                        })
                    } else Fn(b, a), f.push(function () {
                        m.remove(b, "aria-label")
                    })
                });
                return {
                    destroy: function () {
                        z(f, xb)
                    }
                }
            }, group: function (a) {
                m.set(a, "role", "group")
            }, toolbar: function (a, b) {
                m.setAll(a, {role: "group", "aria-label": b})
            }, toolbarGroup: function (a, b) {
                m.set(a, "role", "toolbar");
                null === b || void 0 === b || "" === b || Mb(b) && 0 === b.length || m.set(a, "aria-label", b)
            }, toolbarButton: function (a, b, c, d) {
                m.setAll(a, {
                    role: "button",
                    "aria-label": b, "aria-haspopup": "" + c
                });
                d && m.set(a, "aria-pressed", "false");
                c && m.set(a, "aria-expanded", "false")
            }, textButton: function (a, b) {
                uD(a);
                En(b)
            }, menu: function (a, b) {
                m.setAll(a, {"aria-label": b, role: "menu"})
            }, menuItem: function (a, b, c) {
                b = b.map(function (a) {
                    return {"aria-label": a}
                }).getOr({});
                m.setAll(a, ua(b, {role: "menuitem", "aria-haspopup": c.getOr(!1)}))
            }, menuItemCheckbox: function (a) {
                m.setAll(a, {role: "menuitemcheckbox", "aria-checked": !1})
            }, checkbox: function (a, b) {
                m.setAll(a, {
                    role: "checkbox", "aria-label": b,
                    "aria-checked": !1
                })
            }, dialog: function (a, b) {
                m.setAll(a, {role: "dialog", "aria-label": b})
            }, buttonRole: uD, button: function (a, b) {
                m.setAll(a, {"aria-label": b, role: "button"})
            }, labelledField: function (a, b, c) {
                var d = r.fromTag("div");
                En(d);
                b += Ha("");
                var e = Ha("label");
                c = r.fromHtml("<label>" + c + "</label>");
                m.set(c, "for", b);
                m.set(c, "id", e);
                m.set(a, "id", b);
                yD(a, e);
                P.append(d, [c, a]);
                return {element: h(d), field: h(a)}
            }, multiline: function (a) {
                m.set(a, "aria-multiline", "true")
            }, textarea: function (a) {
                m.setAll(a, {
                    "aria-multiline": "true",
                    role: "textbox"
                })
            }, label: Fn, widget: function (a) {
                m.set(a, "role", "widget")
            }, option: function (a) {
                m.set(a, "role", "option")
            }, listBox: function (a) {
                m.set(a, "role", "listbox")
            }, live: function (a, b, c) {
                m.setAll(a, {"aria-live": c ? c : "polite", id: b})
            }, tabList: function (a) {
                m.set(a, "role", "tablist")
            }, tabButton: function (a, b) {
                m.setAll(a, {"aria-label": b, role: "tab"})
            }, tabPanel: function (a) {
                m.setAll(a, {role: "tabpanel"})
            }, linkElements: wD, linkTabToPanel: function (a, b) {
                wD(a, b)
            }, describedBy: xD, labelledBy: yD, required: function (a) {
                m.set(a,
                    "aria-required", "true")
            }, hidden: function (a, b) {
                b ? m.set(a, "aria-hidden", b) : m.remove(a, "aria-hidden")
            }, invalid: function (a, b) {
                !0 === b ? m.set(a, "aria-invalid", "true") : m.remove(a, "aria-invalid")
            }
        }, CT = {
            disable: function (a) {
                m.set(a, "unselectable", "on");
                v.setAll(a, {"-webkit-user-select": "none", "user-select": "none", "-ms-user-select": "none"});
                a.dom().style.setProperty("-moz-user-select", "-moz-none");
                return K.bind(a, "onselectstart", function () {
                    return !1
                })
            }
        }, lb = {resolve: Lb.create("ephox-pastry").resolve}, zD = function (a,
                                                                             b, c, d) {
            S.toolbarButton(a.element(), b, c, d);
            b = Lq.control(a);
            c = Lq.ariaPressed(a);
            return {
                enable: b.enable, disable: b.disable, press: c.press, release: c.release, destroy: function () {
                    a.destroy()
                }
            }
        }, Qs = function (a, b, c, d, e, f, k, l) {
            k = g.from(k).fold(function () {
                return l(e)
            }, function (a) {
                return a(e, b)
            });
            f = g.from(f).getOr(!1);
            a = a(b);
            c = bf([va.resolve("icon"), va.resolve(c)]);
            f = !0 === f ? [Rc(l(e)).element()] : [];
            P.append(c.element(), f);
            a.content(c);
            a.events.click.bind(function () {
                d()
            });
            m.set(a.element(), "title", k);
            a.initAria = zD;
            return a
        }, AD = function (a, b) {
            L.descendant(a, b).each(function (a) {
                S.hidden(a, "true")
            })
        }, BD = function (a, b, c, d, e, f, k, l) {
            a = Qs(a, b, c, d, e, f, k, l);
            n.add(a.element(), va.resolve("split-" + b));
            AD(a.element(), ".ephox-pastry-dropbutton-arrow");
            AD(a.element(), ".ephox-pastry-dropbutton-button");
            L.descendant(a.element(), ".ephox-pastry-dropbutton-arrow .ephox-pastry-icon-content").each(function (a) {
                n.add(a, va.resolve("icon"));
                n.add(a, va.resolve("arrow-" + b))
            });
            return a
        }, Ng = {
            aria: zD, typical: function (a, b, c, d, e, f, k) {
                return Qs(Oc,
                    a, b, c, d, e, f, k)
            }, toggle: function (a, b, c, d, e, f, k) {
                return Qs($d, a, b, c, d, e, f, k)
            }, splitToggle: function (a, b, c, d, e, f, k) {
                return BD(ET, a, b, c, d, e, f, k)
            }, split: function (a, b, c, d, e, f, k) {
                return BD(DT, a, b, c, d, e, f, k)
            }
        }, re = {resolve: Lb.create("ephox-gopher").resolve}, Rs = Ul("item"), Ss = re.resolve("disabled-item"),
        CD = "data-" + re.resolve("item-value"), Ic = {
            set: function (a, b) {
                Rs.set(a);
                m.set(a, CD, b)
            }, get: function (a) {
                return m.get(a, CD)
            }, up: Rs.up, all: Rs.all, disable: function (a) {
                n.add(a, Ss)
            }, enable: function (a) {
                n.remove(a, Ss)
            }, isEnabled: function (a) {
                return !n.has(a,
                    Ss)
            }
        }, ok = Ul("menu"), DD = "data-" + re.resolve("menu-value"), Gn = re.resolve("active-menu"), Jd = {
            set: function (a, b) {
                ok.set(a);
                m.set(a, DD, b)
            }, active: function (a) {
                return L.descendant(a, "." + Gn)
            }, inactive: function (a) {
                a = ok.all(a);
                return ka(a, function (a) {
                    return !n.has(a, Gn)
                })
            }, activate: function (a, b) {
                a = ok.all(a);
                z(a, function (a) {
                    n.remove(a, Gn)
                });
                n.add(b, Gn)
            }, up: ok.up, all: ok.all, submenu: function (a, b, c) {
                c = Ic.get(c);
                return (b.hasOwnProperty(c) ? g.from(b[c]) : g.none()).bind(function (b) {
                    return L.descendant(a, "[" + DD + '="' + b +
                        '"]')
                })
            }
        }, i3 = Ul("submenu"), j3 = Ul("main-menu"), Mf = {main: h(j3), submenu: h(i3)}, ED = function (a, b, c) {
            Ic.set(c, b);
            m.set(c, "tabindex", -1);
            return c
        }, GD = function (a, b, c) {
            return FD(a, b, c, !1)
        }, FD = function (a, b, c, d) {
            var e = r.fromTag("li", a.dom()), f = T.span();
            n.add(f, re.resolve("item-text"));
            !0 === d && n.add(f, re.resolve("item-ellipsis"));
            y.append(f, r.fromText(c));
            y.append(e, f);
            ED(a, b, e);
            return e
        }, HD = function (a) {
            a = r.fromTag("li", a.dom());
            n.add(a, re.resolve("separator"));
            return a
        }, k3 = function (a, b) {
            return "-" !== b.value() ?
                GD(a, b.value(), b.text()) : HD(a)
        }, ID = function (a, b, c) {
            var d = r.fromTag("ol", a.dom());
            Jd.set(d, b);
            a = E(c, u(k3, a));
            P.append(d, a);
            return d
        }, JD = function (a, b) {
            a = r.fromTag("div", a.dom());
            Jd.set(a, b);
            return a
        }, zb = {
            item: GD, ellipsisItem: function (a, b, c) {
                return FD(a, b, c, !0)
            }, mainmenu: function (a, b, c) {
                a = ID(a, b, c);
                Mf.main().set(a);
                return a
            }, submenu: function (a, b, c) {
                a = ID(a, b, c);
                Mf.submenu().set(a);
                return a
            }, widget: JD, widgetSubmenu: function (a, b) {
                a = JD(a, b);
                Mf.submenu().set(a);
                return a
            }, separator: HD, custom: ED, enableItem: Ic.enable,
            disableItem: Ic.disable
        }, KD = function (a, b) {
            if (void 0 === a) throw Error("Cannot intersperse undefined");
            if (1 >= a.length) return a;
            var c = [];
            c.push(a[0]);
            for (var d = 1; d < a.length; d++) c.push(b()), c.push(a[d]);
            return c
        }, l3 = {
            css: function (a) {
                var b = /^[a-zA-Z]/.test(a) ? "" : "e";
                a = a.replace(/[^\w]/gi, "-");
                return b + a
            }
        }, m3 = {
            splits: function (a, b) {
                if (0 === b.length) return [a];
                var c = hb(b, function (b, c) {
                    if (0 === c) return b;
                    var d = a.substring(b.prev, c);
                    return {prev: c, values: b.values.concat([d])}
                }, {prev: 0, values: []});
                b = b[b.length - 1];
                return b < a.length ? c.values.concat(a.substring(b)) : c.values
            }
        }, Hn = {
            cssSanitise: function (a) {
                return l3.css(a)
            }, splits: function (a, b) {
                return m3.splits(a, b)
            }
        }, n3 = function (a, b) {
            b = Qb(b);
            return Oq.menu(a, b)
        }, o3 = function (a) {
            return E(a, function (a) {
                a = E(a, function (a) {
                    return a.items()
                });
                return Qb(a)
            })
        }, LD = {
            create: function (a, b, c) {
                var d = a.name, e = a.textkey, f = a.menuTextkey, k = a.tooltip, l = a.label, q = g.from(a.icon),
                    C = h(void 0 !== a.contentFocus ? a.contentFocus : !1), w = r.fromDom(document),
                    m = xa(e) ? Hn.cssSanitise(d) : d, G = c(e);
                f =
                    c(f);
                var n = zb.mainmenu(w, m + "-menu", []), p = Ng.toggle(d, m, ca, e, l, k, c);
                q.filter(xa).each(function (a) {
                    Bn.findAndSetUrl(p.element(), a)
                });
                var u = p.initAria(p, G, !0, a.toggle);
                a = o3(b);
                var v = n3(m, b);
                b = KD(a, function () {
                    return [zb.separator(w)]
                });
                S.menu(n, f);
                P.append(n, Qb(b));
                return {
                    button: h(p),
                    contentFocus: C,
                    destroy: function () {
                        p.destroy();
                        v.destroy();
                        u.destroy()
                    },
                    element: h(n),
                    events: v.events,
                    handlers: v.handlers,
                    icon: h(q),
                    init: v.init,
                    label: h(G),
                    name: v.name,
                    structure: v.structure,
                    submenus: v.submenus,
                    textkey: h(e),
                    menuTextkey: h(f),
                    updateMenu: t,
                    enable: u.enable,
                    disable: u.disable
                }
            }
        }, p3 = function (a, b) {
            return g.some(b(a))
        }, q3 = function (a, b) {
            return g.some(b(a, []))
        }, MD = function (a, b) {
            var c = u(MD, a);
            return rD.cata(b, g.none, g.none, p3, function (b, e, f) {
                e = E(e, function (a) {
                    return ia(a.books, c)
                });
                b = LD.create(b, e, a);
                return g.some(f(b, []))
            }, q3, function (a, b, f) {
                b = ia(b, c);
                return g.some(f(a, b))
            }).toArray()
        }, r3 = {
            build: function (a, b) {
                return {
                    items: ia(a.books, function (a) {
                        return MD(b, a)
                    }), category: a.category
                }
            }
        }, s3 = {
            build: function (a, b, c) {
                var d = c.translations();
                a = d3.fromConfig(b.toolbar(), b.menu(), a);
                a = E(a, function (a) {
                    return r3.build(a, d)
                });
                return E(a, function (a) {
                    var b = Oq.toolbar(a.items);
                    a = a.category;
                    S.toolbarGroup(b.component(), d(a));
                    return b
                })
            }
        }, t3 = O("toolbar", "menu"), u3 = O("smartview", "translations"), ND = function (a) {
            return function () {
                return a.apply(null, arguments)
            }
        }, OD = {blueprints: ND(t3), env: ND(u3)}, PD = function () {
            return /(?:(?:[A-Za-z]{3,9}:(?:\/\/))(?:[-.~*+=!&;:'%@?^${}(),\w]+@)?[A-Za-z0-9-]+(?:\.[A-Za-z0-9-]+)*|(?:www\.|[-;:&=+$,.\w]+@)[A-Za-z0-9-]+(?:\.[A-Za-z0-9-]+)*)(?::[0-9]+)?(?:\/[-+~%.()\/\w]*)?(?:\?(?:[-.~*+=!&;:'%@?^${}(),\/\w]+))?(?:#(?:[-.~*+=!&;:'%@?^${}(),\/\w]+))?/g
        },
        In = {
            tokens: function (a, b) {
                return a.replace(/\{(\d+)\}/g, function (c, d, e, f) {
                    d = parseInt(d, 10);
                    if (void 0 === b[d]) throw"No value for token: " + c + " in translation: " + a;
                    return b[d]
                })
            }, link: PD, autolink: function () {
                var a = PD().source;
                return new RegExp("(" + a + ")[-.~*+=!&;:'%@?#^${}(),]*", "g")
            }
        }, Ts = ta.generate([{raw: ["text"]}, {key: ["key"]}, {pkey: ["key", "params"]}]), Us = function (a) {
            var b = gh.get(a);
            if (1 < arguments.length || /\{(\d+)\}/.test(b)) {
                for (var c = Array(arguments.length - 1), d = 1; d < arguments.length; d++) c[d - 1] = arguments[d];
                return In.tokens(b, c)
            }
            return b
        }, x = {
            get: function (a) {
                if (xa(a)) throw"string passed to I18n.get:" + a;
                return a.fold(ca, Us, Us)
            }, has: gh.has, translate: Us, raw: Ts.raw, key: function (a) {
                gh.get(a);
                return Ts.key(a)
            }, pkey: function (a, b) {
                gh.get(a);
                return Ts.pkey(a, b)
            }, cata: function (a, b, c, d) {
                return a.fold(b, c, d)
            }
        }, He = {
            dropdown: xd("enable disable select clear selectElement populate tick untick activate deactivate".split(" ")),
            menu: xd(["enable", "disable"]),
            general: xd("enable disable select deselect selected element".split(" ")),
            widget: xd("enable disable select deselect press release".split(" ")),
            palette: xd(["show", "hide"])
        }, Zl = {
            generateItem: function (a, b, c, d) {
                return c.fold(function () {
                    return zb.item(a, b.value(), d(b.textkey()))
                }, function (c) {
                    c = c(b);
                    var d = r.fromTag("li", a.dom());
                    y.append(d, c);
                    return zb.custom(a, b.value(), d)
                })
            }, generateSeparator: function (a, b, c) {
                var d = zb.separator(a);
                y.append(d, r.fromText(c(b), a.dom()));
                return d
            }
        }, v3 = function (a, b) {
            a = qa(a, function (a) {
                return a.value() === b
            });
            return g.from(a)
        }, QD = function (a) {
            a = Y.children(a,
                ".ephox-pastry-toggle-list-item-selected");
            z(a, function (a) {
                n.remove(a, "ephox-pastry-toggle-list-item-selected");
                ra.checked(a, !1)
            })
        }, Gh = {
            updateDropdown: function (a, b, c, d, e) {
                b.fold(a.clear, t, function (b) {
                    e.fold(function () {
                        (xa(b) ? v3(d, b) : g.some(b)).each(a.select)
                    }, function (c) {
                        c = c(b);
                        var d = lb.resolve("arrow-righticon");
                        n.add(c, d);
                        a.selectElement(c)
                    })
                });
                c.fold(a.disable, t, a.enable)
            }, tick: function (a, b) {
                QD(a);
                a = Y.descendants(a, ".ephox-gopher-item");
                qa(a, function (a) {
                    return m.get(a, "data-ephox-gopher-item-value") ===
                        b
                }).each(function (a) {
                    n.add(a, "ephox-pastry-toggle-list-item-selected");
                    ra.checked(a, !0)
                })
            }, untick: QD, activate: function (a) {
                n.add(a, "ephox-pastry-statebutton-selected")
            }, deactivate: function (a) {
                n.remove(a, "ephox-pastry-statebutton-selected")
            }
        }, Vs = lb.resolve("toggle-list-item-selected"), w3 = function (a) {
            zb.enableItem(a);
            ra.enable(a)
        }, x3 = function (a) {
            zb.disableItem(a);
            ra.disable(a)
        }, y3 = function (a) {
            n.remove(a, Vs);
            ra.checked(a, !1)
        }, z3 = function (a) {
            n.add(a, Vs);
            ra.checked(a, !0)
        }, Eh = {
            control: function (a) {
                return {
                    enable: u(w3,
                        a), disable: u(x3, a)
                }
            }, selected: function (a) {
                return {deselect: u(y3, a), select: u(z3, a), selected: u(n.has, a, Vs)}
            }
        }, RD = function (a) {
            var b = T.span();
            S.hidden(b, !0);
            ma.add(b, ["ephox-pastry-icon-content", "ephox-chameleon-icon"].concat([a]));
            return [b]
        }, A3 = function (a) {
            var b = T.span();
            S.hidden(b, !0);
            ma.add(b, ["ephox-pastry-icon-content", "ephox-chameleon-" + a.value]);
            Bn.setUrl(b, a.icon);
            return [b]
        }, B3 = function (a) {
            return RD(!0 === a.icon ? "ephox-chameleon-" + a.value : a.icon)
        }, oj = {
            generate: RD, generateFrom: function (a) {
                return void 0 ===
                a.icon ? [] : (xa(a.icon) ? A3 : B3)(a)
            }
        }, C3 = aa.detect().browser.isFirefox(), D3 = {position: "absolute", left: "-9999px"}, SD = function (a, b) {
            var c = r.fromTag("span", a.dom());
            S.presentation(c);
            a = r.fromText(b, a.dom());
            y.append(c, a);
            return c
        }, TD = function (a, b) {
            var c = Ha("ephox-echo-voice");
            m.set(b, "id", c);
            m.set(a, "aria-describedby", c)
        }, UD = function (a, b, c) {
            var d = A.owner(b), e = SD(d, c);
            C3 && TD(b, e);
            m.setAll(e, a(c));
            v.setAll(e, D3);
            y.append(b, e);
            setTimeout(function () {
                m.remove(e, "aria-live");
                F.remove(e)
            }, 1E3)
        }, E3 = u(UD, function (a) {
            return {
                "aria-live": "polite",
                "aria-atomic": "true", "aria-label": a
            }
        }), F3 = u(UD, h({"aria-live": "assertive", "aria-atomic": "true", role: "alert"})), ib = {
            describe: function (a, b) {
                var c = A.owner(a);
                b = SD(c, b);
                v.set(b, "display", "none");
                S.hidden(b, !0);
                TD(a, b);
                return b
            }, speak: E3, shout: F3, tokenSelector: function () {
                return 'span[id^="ephox-echo-voice"]'
            }
        }, GT = r.fromDom(document), ly = va.resolve("label-default"), Ws = r.fromDom(document),
        G3 = "data-" + re.resolve("item-value"), H3 = function (a) {
            a = zb.submenu(Ws, a + "-menu", []);
            n.remove(a, "ephox-gopher-main-menu");
            n.add(a, "ephox-gopher-submenu");
            return a
        }, I3 = function (a, b) {
            b = m.get(b, "data-ephox-gopher-menu-value");
            var c = {};
            c[a.name + "-menu-trigger"] = b;
            return c
        }, J3 = function (a, b) {
            var c = H3(b.name);
            S.menu(c, a(b.textkey, !1));
            var d = I3(b, c), e = FT(a, b), f = function (d) {
                d = ia(d, function (c) {
                    var d = E(c.items(), function (c) {
                        c = Zl.generateItem(Ws, c, b.render, a);
                        S.menuItemCheckbox(c);
                        return c
                    });
                    return c.label().fold(h(d), function (b) {
                        return [Zl.generateSeparator(Ws, b, a)].concat(d)
                    })
                });
                F.empty(c);
                P.append(c, d)
            }, k = H.create({
                done: p([]),
                abort: p(["item"])
            }), l = {};
            z(b.values, function (a) {
                l[a.value()] = function (a) {
                    a = m.get(a, G3);
                    b.action(a);
                    k.trigger.done()
                }
            });
            e.events.populate.bind(function (a) {
                f(a.items())
            });
            return {
                items: h([e.element()]), structure: h(d), submenus: h([c]), refreshMenu: function () {
                    b.updateDropdown(He.dropdown({
                        enable: e.enable,
                        disable: e.disable,
                        select: e.select,
                        clear: e.clear,
                        selectElement: e.selectElement,
                        populate: e.populate,
                        tick: u(Gh.tick, c),
                        untick: u(Gh.untick, c),
                        activate: t,
                        deactivate: t
                    }))
                }, destroyer: function () {
                    e.destroy()
                }, handlers: h(l),
                events: k.registry
            }
        }, K3 = r.fromDom(document), L3 = function (a, b) {
            a = a(b.textkey);
            var c = (!0 === b.hasDialog ? zb.ellipsisItem : zb.item)(K3, b.value, a), d = Eh.control(c),
                e = !0 === b.toggle ? Eh.selected(c) : {select: t, deselect: t, selected: h(!1)};
            !0 === b.toggle ? S.menuItemCheckbox(c) : S.menuItem(c, g.some(a), g.some(!1));
            var f = function () {
                b.updateGeneral(He.general({
                    disable: d.disable,
                    enable: d.enable,
                    select: e.select,
                    deselect: e.deselect,
                    selected: e.selected,
                    element: h(c)
                }))
            }, k = H.create({done: p([]), abort: p(["item"])});
            a = {};
            a[b.value] =
                function () {
                    k.trigger.done();
                    b.action();
                    f()
                };
            var l = oj.generateFrom(b);
            P.prepend(c, l);
            return {
                items: h([c]),
                structure: h({}),
                submenus: h([]),
                refreshMenu: f,
                handlers: h(a),
                destroyer: ca,
                events: k.registry
            }
        }, M3 = r.fromDom(document), N3 = function (a) {
            return {
                submenu: function (b) {
                    var c = b.textkey();
                    b = b.element();
                    S.menu(b, a(c));
                    n.remove(b, "ephox-gopher-main-menu");
                    n.add(b, "ephox-gopher-submenu");
                    return b
                }, item: function (b) {
                    var c = b.textkey();
                    c = a(c);
                    b = zb.item(M3, b.name() + "-menu-trigger", c);
                    n.add(b, va.resolve("menu-more"));
                    S.menuItem(b, g.some(c), g.some(!0));
                    return b
                }
            }
        }, O3 = function (a, b, c) {
            c = N3(a);
            a = c.submenu(b);
            var d = m.get(a, "data-ephox-gopher-menu-value");
            c = c.item(b);
            var e = {};
            e[b.name() + "-menu-trigger"] = d;
            d = ua(e, b.structure());
            var f = oj.generate("ephox-chameleon-" + b.name());
            P.prepend(c, f);
            b.icon().each(function (a) {
                0 < f.length && Bn.setUrl(f[0], a)
            });
            var k = Eh.control(c);
            e = void 0 !== b.destroyer ? b.destroyer : void 0 !== b.destroy ? b.destroy : t;
            return {
                items: h([c]), structure: h(d), submenus: h([a].concat(b.submenus())), refreshMenu: function () {
                    b.updateMenu({
                        enable: k.enable,
                        disable: k.disable
                    })
                }, destroyer: e, handlers: b.handlers, events: b.events
            }
        }, Xs = r.fromDom(document), VD = va.resolve("menu-widget"), P3 = function (a, b) {
            b = zb.widgetSubmenu(Xs, b);
            y.append(b, a.element());
            ma.add(a.element(), [VD, "ephox-gopher-item"]);
            return b
        }, Q3 = function (a, b, c) {
            a = a(b.textkey());
            a = zb.item(Xs, c, a);
            n.add(a, va.resolve("menu-more"));
            c = oj.generate(va.resolve(c));
            P.prepend(a, c);
            return a
        }, WD = function (a, b) {
            var c = b.instance();
            b = c.name();
            var d = b + "-submenu", e = P3(c, d), f = Q3(a, c, b);
            S.menu(e, a(c.menuTextkey()));
            S.menuItem(f, g.some(a(c.textkey())), g.some(!0));
            var k = Eh.control(f);
            a = {};
            a[b] = d;
            var l = H.create({done: Q([], c.events.done), abort: p(["item"])});
            c.events.abort.bind(function () {
                l.trigger.abort(f)
            });
            return {
                items: h([f]), structure: h(a), submenus: h([e]), refreshMenu: function () {
                    c.updateWidget(He.widget({
                        enable: k.enable,
                        disable: k.disable,
                        select: t,
                        deselect: t,
                        press: t,
                        release: t
                    }))
                }, destroyer: c.destroy, handlers: h({}), events: l.registry
            }
        }, Yl = {
            widget: WD, inline: function (a, b) {
                var c = b.instance();
                b = c.name();
                n.add(c.element(),
                    va.resolve("menu-inline-widget"));
                var d = r.fromTag("li");
                y.append(d, c.element());
                var e = zb.custom(Xs, b, d), f = Eh.control(e);
                S.menuItem(e, g.some(a(c.textkey())), g.some(!1));
                a = {};
                a[b] = function (a) {
                    var b = Z.active().filter(function (b) {
                        return wd.ancestor(b, u(N.eq, a))
                    });
                    c.element().dom().click();
                    b.each(Z.focus)
                };
                var k = H.create({done: Q([], c.events.done), abort: p(["item"])});
                c.events.abort.bind(function () {
                    k.trigger.abort(e)
                });
                return {
                    items: h([e]), structure: h({}), submenus: h([]), refreshMenu: function () {
                        c.updateInlineWidget(He.widget({
                            enable: f.enable,
                            disable: f.disable, select: t, deselect: t, press: t, release: t
                        }))
                    }, destroyer: c.destroy, handlers: h(a), events: k.registry
                }
            }, split: WD, styles: h(VD)
        }, XD = va.resolve("keyfocus"), YD = function (a, b) {
            var c = T.span();
            v.set(c, "display", "none");
            n.add(c, XD);
            y.append(a, c);
            return K.bind(c, "click", function (a) {
                b();
                a.kill()
            })
        }, Of = {
            onButton: function (a) {
                return YD(a.element(), a.click)
            }, custom: YD, trigger: function (a) {
                var b = "." + XD;
                a = Fa.is(a, b) ? g.some(a) : L.descendant(a, b);
                a.each(function (a) {
                    a.dom().click()
                });
                return a
            }
        }, rj = {
            menu: Aa(["focusActive"],
                [])
        }, ci = re.resolve("item-selected"), Ys = function (a, b) {
            n.add(b, ci)
        }, ZD = function (a, b) {
            n.remove(b, ci)
        }, Kd = {
            is: function (a) {
                return n.has(a, ci)
            }, none: function (a) {
                var b = Ic.all(a);
                z(b, function (b) {
                    ZD(a, b)
                })
            }, selectAll: function (a, b) {
                a = Ic.all(a);
                z(a, function (a) {
                    n.remove(a, ci)
                });
                z(b, function (a) {
                    n.add(a, ci)
                })
            }, select: Ys, deselect: ZD, selected: function (a) {
                return L.descendant(a, "." + ci)
            }, first: function (a) {
                var b = Ic.all(a);
                return g.from(b[0]).map(function (b) {
                    Ys(a, b);
                    return b
                })
            }, last: function (a) {
                var b = Ic.all(a);
                return g.from(b[b.length -
                1]).map(function (b) {
                    Ys(a, b);
                    return b
                })
            }
        }, R3 = function (a, b) {
            var c = Ic.all(a);
            return Va(c, function (a) {
                return N.eq(b, a)
            }).map(function (a) {
                return {index: h(a), all: h(c)}
            })
        }, S3 = function (a, b) {
            return 0 === b ? a.length - 1 : b - 1
        }, T3 = function (a, b) {
            return b === a.length - 1 ? 0 : b + 1
        }, $D = function (a, b, c) {
            return R3(a, b).map(function (d) {
                var e = c(d.all(), d.index());
                d = d.all()[e];
                Kd.deselect(a, b);
                Kd.select(a, d);
                return d
            })
        }, Jq = {
            first: function (a) {
                var b = Ic.all(a);
                return g.from(b[0]).map(function (b) {
                    Kd.select(a, b);
                    return b
                })
            }, prev: function (a,
                               b) {
                return $D(a, b, S3)
            }, next: function (a, b) {
                return $D(a, b, T3)
            }
        }, ac = function (a) {
            return function () {
                return a
            }
        }, R = {
            BACKSPACE: ac([8]),
            TAB: ac([9]),
            ENTER: ac([13]),
            SHIFT: ac([16]),
            CTRL: ac([17]),
            ALT: ac([18]),
            CAPSLOCK: ac([20]),
            ESCAPE: ac([27]),
            SPACE: ac([32]),
            PAGEUP: ac([33]),
            PAGEDOWN: ac([34]),
            END: ac([35]),
            HOME: ac([36]),
            LEFT: ac([37]),
            UP: ac([38]),
            RIGHT: ac([39]),
            DOWN: ac([40]),
            INSERT: ac([45]),
            DEL: ac([46]),
            META: ac([91, 93, 224]),
            F10: ac([121])
        }, ny = {
            isCommand: function (a, b) {
                var c = [];
                z(b, function (a) {
                    a = "string" === typeof a ? [a.toUpperCase().charCodeAt(0)] :
                        a;
                    c = c.concat(a)
                });
                b = function (a) {
                    return 0 < ka(c, function (b) {
                        return U(R[a](), b)
                    }).length
                };
                if (!!a.altKey !== b("ALT") || !!a.shiftKey !== b("SHIFT") || !!a.ctrlKey !== b("CTRL") || !!a.metaKey !== b("META")) return !1;
                b = null !== a.charCode && void 0 !== a.charCode && 0 !== a.charCode ? String.fromCharCode(a.charCode).toUpperCase().charCodeAt(0) : a.which;
                var d = R.CTRL().concat(R.ALT()).concat(R.SHIFT()).concat(R.META()), e = ka(c, function (a) {
                    return !U(d, a)
                });
                return 1 < e.length ? !1 : 0 === e.length && void 0 === a.which || e[0] === b
            }
        }, my = {
            stop: function (a) {
                a.preventDefault();
                a.stopPropagation && a.stopPropagation()
            }
        }, U3 = {
            BACKSPACE: R.BACKSPACE,
            TAB: R.TAB,
            ENTER: R.ENTER,
            CAPSLOCK: R.CAPSLOCK,
            ESCAPE: R.ESCAPE,
            SPACE: R.SPACE,
            PAGEUP: R.PAGEUP,
            PAGEDOWN: R.PAGEDOWN,
            END: R.END,
            HOME: R.HOME,
            LEFT: R.LEFT,
            UP: R.UP,
            DOWN: R.DOWN,
            RIGHT: R.RIGHT,
            INSERT: R.INSERT,
            DEL: R.DEL
        }, Kg = {
            getSpecial: function (a) {
                var b = null;
                Ma(U3, function (c, d) {
                    U(c(), a) && (b = d)
                });
                return b
            }, noModifiers: function (a) {
                return !(a.metaKey || a.altKey || a.ctrlKey)
            }, isCharCode: function (a) {
                return a.charCode === a.keyCode
            }
        }, aE = function (a, b) {
            return qa(b,
                function (b) {
                    return ny.isCommand(a, b)
                })
        }, bE = function (a) {
            return Kg.isCharCode(a) ? g.none() : g.from(Kg.getSpecial(a.keyCode))
        }, JT = {
            identify: function (a, b) {
                return {
                    fold: function (c, d, e) {
                        aE(a, b).fold(function () {
                            bE(a).fold(function () {
                                e(a.which && String.fromCharCode(a.which))
                            }, function (a) {
                                d(R[a]())
                            })
                        }, c)
                    }
                }
            }, shortcut: aE, special: bE
        }, cE = function (a) {
            return "rtl" === v.get(a, "direction") ? "rtl" : "ltr"
        }, ae = {
            onDirection: function (a, b) {
                return function (c) {
                    return "rtl" === cE(c) ? b : a
                }
            }, getDirection: cE
        }, dE = function (a, b, c, d) {
            var e =
                v.get(a, b);
            void 0 === e && (e = "");
            c = e === c ? d : c;
            e = u(v.set, a, b, e);
            a = u(v.set, a, b, c);
            return Cq(e, a, !1)
        }, sc = {
            toggler: function (a) {
                return dE(a, "visibility", "hidden", "visible")
            }, displayToggler: function (a, b) {
                return dE(a, "display", "none", b)
            }, isVisible: function (a) {
                a = a.dom();
                return !(0 >= a.offsetWidth && 0 >= a.offsetHeight)
            }
        }, Jn = ta.generate([{southeast: []}, {southwest: []}, {northeast: []}, {northwest: []}]), yd = {
            southeast: Jn.southeast,
            southwest: Jn.southwest,
            northeast: Jn.northeast,
            northwest: Jn.northwest,
            cata: function (a, b, c, d,
                            e) {
                return a.fold(b, c, d, e)
            }
        }, eE = function (a, b) {
            return a.view(b).fold(h([]), function (b) {
                var c = a.owner(b);
                c = eE(a, c);
                return [b].concat(c)
            })
        }, V3 = {
            pathTo: function (a, b) {
                a = b.owner(a);
                b = eE(b, a);
                return g.some(b)
            }
        }, W3 = {
            view: function (a) {
                return (a.dom() === document ? g.none() : g.from(a.dom().defaultView.frameElement)).map(r.fromDom)
            }, owner: function (a) {
                return A.owner(a)
            }
        }, pk = {
            find: function (a) {
                var b = r.fromDom(document), c = Za.get(b);
                return V3.pathTo(a, W3).fold(u(bb.absolute, a), function (b) {
                    var d = bb.viewport(a);
                    b = Eb(b, function (a,
                                        b) {
                        b = bb.viewport(b);
                        return {left: a.left + b.left(), top: a.top + b.top()}
                    }, {left: 0, top: 0});
                    return Ra(b.left + d.left() + c.left(), b.top + d.top() + c.top())
                })
            }
        }, Bf = {
            absolute: function (a) {
                var b = pk.find(a), c = Ia.getOuter(a);
                a = sa.getOuter(a);
                return gg(b.left(), b.top(), c, a)
            }, view: function () {
                return gg(0, 0, window.innerWidth, window.innerHeight)
            }
        }, fE = function (a, b, c) {
            var d = Ra(b, c);
            b = function () {
                var a = Za.get();
                return d.translate(-a.left(), -a.top())
            };
            return a.fold(h(d), b, b)
        }, Zs = {
            toBox: function (a, b) {
                var c = pk.find(b);
                a = fE(a, c.left(),
                    c.top());
                c = Ia.getOuter(b);
                b = sa.getOuter(b);
                return gg(a.left(), a.top(), c, b)
            }, viewport: function (a, b) {
                return b.fold(function () {
                    return a.fold(Bf.view, Bf.view, gg)
                }, function (b) {
                    return a.fold(b, b, gg)
                })
            }, translate: fE
        }, X3 = Aa("x y width height maxHeight direction classes label candidateYforTest".split(" "), []),
        Y3 = O("position", "left", "top", "right", "bottom"), hh = {decision: X3, css: Y3},
        $s = ta.generate([{none: []}, {relative: ["x", "y", "width", "height"]}, {fixed: ["x", "y", "width", "height"]}]),
        gE = function (a, b, c, d, e, f) {
            c =
                b.x() - c;
            d = b.y() - d;
            var k = b.width(), l = b.height();
            e -= c + k;
            f -= d + l;
            var h = g.some(c), C = g.some(d), w = g.some(e), m = g.some(f), G = g.none();
            return yd.cata(b.direction(), function () {
                return hh.css(a, h, C, G, G)
            }, function () {
                return hh.css(a, G, C, w, G)
            }, function () {
                return hh.css(a, h, G, G, m)
            }, function () {
                return hh.css(a, G, G, w, m)
            })
        }, Ie = {
            none: $s.none, relative: $s.relative, fixed: $s.fixed, reposition: function (a, b) {
                return a.fold(function () {
                    return hh.css("absolute", g.some(b.x()), g.some(b.y()), g.none(), g.none())
                }, function (a, d, e, f) {
                    return gE("absolute",
                        b, a, d, e, f)
                }, function (a, d, e, f) {
                    return gE("fixed", b, a, d, e, f)
                })
            }, viewport: function (a, b) {
                return Zs.viewport(a, b)
            }, toBox: function (a, b) {
                return Zs.toBox(a, b)
            }, translate: function (a, b, c) {
                return Zs.translate(a, b, c)
            }, cata: function (a, b, c, d) {
                return a.fold(b, c, d)
            }
        }, hE = O("anchorBox", "origin"), Lh = {
            box: function (a, b) {
                return hE(a, b)
            }, element: function (a, b) {
                a = Ie.toBox(b, a);
                return hE(a, b)
            }, relativeOrigin: function (a) {
                a = a.dom().getBoundingClientRect();
                return Ie.relative(a.left, a.top, a.width, a.height)
            }
        }, qk = {resolve: Lb.create("ephox-repartee").resolve},
        iE = qk.resolve("caret-top-align"), jE = qk.resolve("caret-bottom-align"), kE = qk.resolve("caret-right-align"),
        lE = qk.resolve("caret-left-align"), mE = qk.resolve("caret-middle-align"),
        bc = {east: h(lE), south: h(iE), west: h(kE), north: h(jE), middle: h(mE), all: h([iE, jE, lE, kE, mE])},
        Je = O("x", "y", "bubble", "direction", "anchors", "label"), nE = function (a, b) {
            return a.x() + a.width() - b.width() / 2
        }, oE = function (a, b) {
            return a.x() + a.width() - b.width()
        }, at = function (a, b) {
            return a.y() - b.height()
        }, bt = function (a) {
            return a.y() + a.height()
        },
        ct = function (a, b, c) {
            return Je(a.x(), bt(a), c.southeast(), yd.southeast(), [bc.south(), bc.east()], "layout-se")
        }, dt = function (a, b, c) {
            return Je(oE(a, b), bt(a), c.southwest(), yd.southwest(), [bc.south(), bc.west()], "layout-sw")
        }, et = function (a, b, c) {
            return Je(a.x(), at(a, b), c.northeast(), yd.northeast(), [bc.north(), bc.east()], "layout-ne")
        }, ft = function (a, b, c) {
            return Je(oE(a, b), at(a, b), c.northwest(), yd.northwest(), [bc.north(), bc.west()], "layout-nw")
        }, gt = function (a, b, c) {
            return Je(nE(a, b), at(a, b), c.northeast(), yd.northeast(),
                [bc.north(), bc.middle()], "layout-nm")
        }, ht = function (a, b, c) {
            return Je(nE(a, b), bt(a), c.southeast(), yd.southeast(), [bc.south(), bc.middle()], "layout-sm")
        }, Qh = {
            southeast: ct,
            northeast: et,
            southwest: dt,
            northwest: ft,
            southmiddle: ht,
            northmiddle: gt,
            all: function () {
                return [ct, dt, et, ft, ht, gt]
            },
            allRtl: function () {
                return [dt, ct, ft, et, ht, gt]
            }
        }, pE = function (a) {
            return a.x() + a.width()
        }, qE = function (a, b) {
            return a.y() - b.height() + a.height()
        }, it = function (a, b, c) {
            return Je(pE(a), a.y(), c.southeast(), yd.southeast(), [bc.south(), bc.east()],
                "link-layout-se")
        }, jt = function (a, b, c) {
            b = a.x() - b.width();
            return Je(b, a.y(), c.southwest(), yd.southwest(), [bc.south(), bc.west()], "link-layout-sw")
        }, kt = function (a, b, c) {
            return Je(pE(a), qE(a, b), c.northeast(), yd.northeast(), [bc.north(), bc.east()], "link-layout-ne")
        }, lt = function (a, b, c) {
            var d = a.x() - b.width();
            return Je(d, qE(a, b), c.northwest(), yd.northwest(), [bc.north(), bc.west()], "link-layout-nw")
        }, Z3 = {
            southeast: it, northeast: kt, southwest: jt, northwest: lt, all: function () {
                return [it, jt, kt, lt]
            }, allRtl: function () {
                return [jt,
                    it, lt, kt]
            }
        }, cf = {
            anchored: h(function (a, b) {
                sa.setMax(a, Math.floor(b));
                v.setAll(a, {"overflow-x": "hidden", "overflow-y": "auto"})
            }), expandable: h(function (a, b) {
                sa.setMax(a, Math.floor(b))
            })
        }, ih = ta.generate([{fit: ["reposition"]}, {nofit: ["reposition", "deltaW", "deltaH"]}]),
        $3 = function (a, b, c, d) {
            var e = a.x(), f = a.y(), k = a.bubble().left(), l = a.bubble().top(), g = d.x(), C = d.y(), w = d.width(),
                m = d.height();
            k = e + k;
            e = f + l;
            var G = k >= g, n = e >= C;
            f = G && n;
            l = k + b <= g + w && e + c <= C + m;
            g = G ? Math.min(b, g + w - k) : Math.abs(g - (k + b));
            w = n ? Math.min(c, C + m -
                e) : Math.abs(C - (e + c));
            b = d.width() - b;
            b = Math.min(Math.max(0, k), b);
            c = n ? e : e + (c - w);
            d = h(c + w - C);
            C = h(C + m - c);
            C = yd.cata(a.direction(), C, C, d, d);
            a = hh.decision({
                x: b,
                y: c,
                width: g,
                height: w,
                maxHeight: C,
                direction: a.direction(),
                classes: a.anchors(),
                label: a.label(),
                candidateYforTest: e
            });
            return f && l ? ih.fit(a) : ih.nofit(a, g, w)
        }, a4 = {
            attempts: function (a, b, c, d, e) {
                var f = c.width(), k = c.height(), l = function (a, l, g, h) {
                    a = a(b, c, d);
                    return $3(a, f, k, e).fold(ih.fit, function (a, b, c) {
                        return b > g || c > h ? ih.nofit(a, b, c) : ih.nofit(l, g, h)
                    })
                };
                return hb(a,
                    function (a, b) {
                        b = u(l, b);
                        return a.fold(ih.fit, b)
                    }, ih.nofit(hh.decision({
                        x: b.x(),
                        y: b.y(),
                        width: c.width(),
                        height: c.height(),
                        maxHeight: c.height(),
                        direction: yd.southeast(),
                        classes: [],
                        label: "none",
                        candidateYforTest: b.y()
                    }), -1, -1)).fold(ca, ca)
            }
        }, b4 = {
            measure: function (a) {
                var b = r.fromTag("div");
                v.setAll(b, {position: "fixed", opacity: "0", top: "0", left: "0", bottom: "0", right: "0"});
                y.prepend(a, b);
                a = bb.viewport(b);
                var c = Ia.get(b), d = sa.get(b);
                F.remove(b);
                return {top: a.top, left: a.left, width: h(c), height: h(d)}
            }
        }, Kn = {
            layout: function (a,
                              b, c, d) {
                v.remove(b, "max-height");
                b = {width: h(Ia.getOuter(b)), height: h(sa.getOuter(b))};
                return a4.attempts(d.preference(), a, b, c, d.bounds())
            }, setClasses: function (a, b) {
                ma.remove(a, bc.all());
                ma.add(a, b.classes())
            }, setHeight: function (a, b, c) {
                c.maxHeightFunction()(a, b.maxHeight())
            }, position: function (a, b, c) {
                var d = function (a) {
                    return a + "px"
                };
                c = c.origin();
                var e = h(c);
                c = c.fold(e, e, function () {
                    var b = b4.measure(a);
                    return Ie.fixed(b.left(), b.top(), b.width(), b.height())
                });
                b = Ie.reposition(c, b, a);
                v.setOptions(a, {
                    position: g.some(b.position()),
                    left: b.left().map(d), top: b.top().map(d), right: b.right().map(d), bottom: b.bottom().map(d)
                })
            }
        }, rE = Aa(["bounds", "origin", "preference", "maxHeightFunction"], []), rk = function (a, b, c) {
            return void 0 === a[b] ? c : a[b]
        }, sE = function (a, b, c, d) {
            a = Kn.layout(a, b, c, d);
            Kn.position(b, a, d);
            Kn.setClasses(b, a);
            Kn.setHeight(b, a, d)
        }, Mm = {
            simple: function (a, b, c, d, e) {
                var f = rk(e, "maxHeightFunction", cf.anchored());
                e = a.anchorBox();
                a = a.origin();
                d = rE({bounds: Ie.viewport(a, g.none()), origin: a, preference: d, maxHeightFunction: f});
                sE(e, b, c, d)
            },
            detailed: function (a, b, c, d) {
                d = void 0 !== d ? d : {};
                d = rE({
                    bounds: rk(d, "bounds", Bf.view()),
                    origin: rk(d, "origin", Ie.none()),
                    preference: rk(d, "preference", Qh.all()),
                    maxHeightFunction: rk(d, "maxHeightFunction", cf.anchored())
                });
                sE(a, b, c, d)
            }
        }, c4 = function (a, b, c, d, e, f, k) {
            return function (a) {
                var l = Ie.none();
                var h = Ie.viewport(l, g.some(b));
                var w = Ie.toBox(l, c());
                h = {bounds: h, origin: l, preference: e.isRtl() ? f.allRtl() : f.all(), maxHeightFunction: k};
                a = a.panel();
                Mm.detailed(w, a, d, h)
            }
        }, d4 = function (a, b, c, d, e, f, k) {
            return function (b) {
                var l =
                        e.isRtl() ? f.allRtl() : f.all(), g = {maxHeightFunction: k},
                    h = Lh.element(c(), Lh.relativeOrigin(a()));
                b = b.panel();
                Mm.simple(h, b, d, l, g)
            }
        }, tE = aa.detect().deviceType.isiOS() ? c4 : d4, Lg = {
            main: function (a, b, c, d, e, f) {
                a = tE(a, b, c, d, e, Qh, f);
                return {recalculate: a, isAnchored: Jb, place: a}
            }, submenu: function (a, b, c, d, e) {
                a = tE(a, b, c, Fh(3, -2), d, Z3, e);
                return {recalculate: a, isAnchored: Jb, place: a}
            }
        }, uE = function (a) {
            return function (b) {
                return b.key() === a
            }
        }, e4 = O("key", "value"), Wl = {
            put: function (a, b, c, d, e) {
                var f = void 0 !== d ? d : e4, k = void 0 !==
                e ? e : uE(b);
                a = hb(a, function (a, d) {
                    var e = k(d) ? f(b, c) : d;
                    return {updated: k(d) || a.updated, acc: a.acc.concat([e])}
                }, {updated: !1, acc: []});
                return a.updated ? a.acc : a.acc.concat([f(b, c)])
            }, get: function (a, b, c) {
                b = void 0 !== c ? c : uE(b);
                return qa(a, b)
            }
        }, PT = {
            triage: function (a) {
                a = Eb(a, function (a, c) {
                    var b = ja.inBody(c.menu());
                    return {
                        keep: b ? [c].concat(a.keep) : a.keep,
                        throwaway: !1 === b ? [c].concat(a.throwaway) : a.throwaway
                    }
                }, {throwaway: [], keep: []});
                z(a.throwaway, function (a) {
                    a.popup().destroy()
                });
                return a.keep
            }
        }, vE = function (a, b) {
            return wd.ancestor(a,
                u(N.eq, b))
        }, MT = {
            ancestor: vE, anyAncestor: function (a, b) {
                return Xa(b, function (b) {
                    return vE(a, b)
                })
            }, sibling: function (a, b) {
                return wd.sibling(a, u(N.eq, b))
            }, child: function (a, b) {
                return wd.child(a, u(N.eq, b))
            }, descendant: function (a, b) {
                return wd.descendant(a, u(N.eq, b))
            }
        }, OT = {
            create: function (a, b) {
                var c = H.create({open: p([]), close: p([]), uistale: p([])});
                if (void 0 === a) throw"uicontainer not specified";
                var d = NT({layerClass: va.resolve("layer-menus"), container: a()}), e = T.div();
                n.add(e, va.resolve("popup-container"));
                d.content(e);
                var f = !1, k = function () {
                    f && (g.off(), d.hide(), f = !1, h.control.block(), c.trigger.close())
                }, l = [e], g = oy(function (a) {
                    !1 === !f && (k(), L.ancestor(a, "." + b).fold(function () {
                        Z.focus(a)
                    }, t))
                }, function () {
                    return l
                }), h = Hd.tap(function () {
                    c.trigger.uistale()
                });
                h.control.block();
                return {
                    element: function () {
                        return e
                    }, panel: d.element, destroy: function () {
                        d.hide();
                        d.destroy();
                        g.off()
                    }, open: function () {
                        f || (h.control.unblock(), v.set(d.element(), "opacity", "0"), d.show(), v.reflow(d.element()), g.on(), f = !0, c.trigger.open(), v.set(d.element(),
                            "opacity", "1"))
                    }, close: k, closed: function () {
                        return !f
                    }, mousedown: function (a) {
                        g.mousedown(a.original())
                    }, uiStale: function () {
                        h.instance()
                    }, setContent: function (a) {
                        y.append(e, a)
                    }, setComponents: function (a) {
                        l = a.concat([e])
                    }, events: c.registry
                }
            }
        }, py = O("menu", "popup"), Xl = function (a) {
            return function (b) {
                return N.eq(b.menu(), a)
            }
        }, ST = aa.detect().deviceType.isiOS, f4 = function (a, b, c, d, e) {
            var f = RT(a, b, e.name, e.textkey, e.menuTextkey, e.render, e.layout, c, e.toggle, d);
            a = function () {
                e.updateDropdown(He.dropdown({
                    enable: f.enable,
                    disable: f.disable,
                    select: f.select,
                    clear: f.clear,
                    selectElement: f.selectElement,
                    populate: f.populate,
                    tick: f.tick,
                    untick: f.untick,
                    activate: f.activate,
                    deactivate: f.deactivate
                }))
            };
            var k = Of.onButton(f);
            f.events.select.bind(function (a) {
                e.action(a.value());
                f.close()
            });
            var l = H.create({
                select: Q(["value", "item"], f.events.select),
                itemHover: Q(["item"], f.events.itemHover),
                escaped: Q([], f.events.escaped),
                open: Q(["menu", "popup", "anchor"], f.events.open),
                close: Q([], f.events.close)
            });
            a();
            m.set(f.element(), "tabindex",
                "-1");
            return {
                dropdown: function () {
                    return {
                        events: l.registry,
                        close: f.close,
                        uiStale: f.uiStale,
                        enable: f.enable,
                        disable: f.disable,
                        list: f.list,
                        menu: f.menu,
                        recalculate: f.recalculate
                    }
                }, component: f.element, refreshUi: a, destroy: function () {
                    k.unbind();
                    f.destroy()
                }
            }
        }, g4 = function (a, b) {
            b = Ng.typical(a.value, a.value, a.action, a.textkey, a.label, a.tooltip, b);
            a.setup && a.setup(b, a);
            return b
        }, h4 = function (a, b) {
            b = Ng.toggle(a.value, a.value, a.action, a.textkey, a.label, a.tooltip, b);
            a.setup && a.setup(b, a);
            a.selected && b.select();
            return b
        }, i4 = function (a, b) {
            var c = !0 === b.hasPopup, d = (!0 === b.toggle ? h4 : g4)(b, a);
            xa(b.icon) && Bn.findAndSetUrl(d.element(), b.icon);
            var e = d.initAria(d, a(b.textkey), c, b.toggle);
            m.set(d.element(), "tabindex", "-1");
            var f = function () {
                !0 === b.toggle && ra.pressed(d)
            }, k = Of.onButton(d);
            d.events.click.bind(function () {
                f()
            });
            var l = !0 === b.toggle ? d.select : t, g = !0 === b.toggle ? d.deselect : t,
                C = !0 === b.toggle ? d.selected : h(!1);
            f();
            var w = H.create({click: Q([], d.events.click)});
            return {
                generals: function () {
                    return {
                        events: w.registry,
                        enableButton: d.enable, disableButton: d.disable
                    }
                }, component: d.element, refreshUi: function () {
                    b.updateGeneral(He.general({
                        disable: e.disable,
                        enable: e.enable,
                        select: l,
                        deselect: g,
                        selected: C,
                        element: d.element
                    }));
                    f()
                }, destroy: function () {
                    k.unbind();
                    d.destroy();
                    e.destroy()
                }
            }
        }, j4 = aa.detect().deviceType.isiOS, k4 = function (a, b, c, d, e, f) {
            var k = e.button(), l = Of.onButton(k), g = Kq(a.uiContainer, e.name, rj.menu({focusActive: !0}));
            m.set(k.element(), "tabindex", "-1");
            var h = T.div();
            n.add(h, va.resolve("menu-system-main"));
            var w =
                qj(g.sandbox, a.bounds, b, [k.element()], d), J = w.initMenu(h);
            c = Vl();
            var G = Lg.main(a.uiContainer, a.bounds, k.element, c, b.uiDirection(), cf.anchored()), r = function () {
                G.recalculate(J)
            }, t = function () {
                var a = A.children(g.sandbox());
                z(a, function (a) {
                    v.set(a, "display", "none")
                })
            }, u = function (a) {
                g.update(a.structure());
                F.empty(h);
                y.append(h, a.element());
                a = w.registerMenus(a.submenus());
                a = E(a, function (a) {
                    return a.panel()
                });
                F.empty(g.sandbox());
                P.append(g.sandbox(), [J.panel()].concat(a));
                t()
            }, x = function (a) {
                e.init(a)
            }, B =
                H.create({
                    open: p(["menu", "popup", "anchor"]),
                    close: Q([], g.events.close),
                    itemAction: Q(["value", "item"], g.events.itemAction),
                    itemHover: Q(["item"], g.events.itemHover),
                    reveal: p(["menu", "trigger", "popup", "anchor"]),
                    collapse: Q(["menu", "item"], g.events.collapse),
                    escaped: Q([], g.events.escaped)
                });
            k.events.click.bind(function () {
                return (k.selected() ? J.open : J.close)()
            });
            e.events.done.bind(function () {
                g.close()
            });
            e.events.abort.bind(function (a) {
                g.select(a.item());
                Z.focus(a.item())
            });
            J.events.uistale.bind(function () {
                g.getActiveMenu().bind(function (a) {
                    x(a)
                })
            });
            J.events.close.bind(function () {
                g.close();
                ra.collapsed(k.element())
            });
            J.events.open.bind(function () {
                var a = void 0 !== f ? f : [];
                a = [g.sandbox()].concat(a);
                u(e);
                x(e);
                v.set(J.panel(), "display", "block");
                v.set(h, "display", "block");
                g.open(a, h);
                ra.expanded(k.element())
            });
            g.events.open.bind(function () {
                B.trigger.open(e.element(), J, G);
                j4() || g.setActiveMenu(e.element())
            });
            g.events.close.bind(function () {
                w.hideAll();
                k.deselect()
            });
            g.events.itemAction.bind(function (a) {
                var b = e.handlers();
                if (void 0 !== b[a.value()]) (0, b[a.value()])(a.item())
            });
            g.events.reveal.bind(function (a) {
                ra.expanded(a.trigger());
                var b = w.expandMenu(a.menu(), a.trigger(), J);
                B.trigger.reveal(a.menu(), a.trigger(), b.popup, b.anchorage)
            });
            g.events.collapse.bind(function (a) {
                w.hideMenu(a.menu());
                a.item().each(ra.collapsed)
            });
            return {
                menus: function () {
                    return {
                        events: B.registry,
                        enable: e.enable,
                        disable: e.disable,
                        close: J.close,
                        uiStale: J.uiStale,
                        mousedown: J.mousedown,
                        contentFocus: e.contentFocus,
                        menu: J.element,
                        refreshMenus: x,
                        recalculate: r
                    }
                }, component: k.element, refreshUi: function () {
                    e.updateMenu({
                        enable: e.enable,
                        disable: e.disable
                    })
                }, destroy: function () {
                    l.unbind();
                    g.destroy();
                    e.destroy();
                    J.destroy()
                }
            }
        }, l4 = function (a, b) {
            var c = T.span();
            n.add(c, va.resolve("palette-group"));
            var d = u(ib.speak, ja.body()), e = function (a) {
                var b = mj.isShowing(c);
                mj.hide(c);
                b && a.each(d);
                return b
            }, f = He.palette({
                show: function (a) {
                    var b = mj.isHiding(c);
                    mj.show(c);
                    b && a.each(d);
                    return b
                }, hide: e
            });
            e(g.none());
            P.append(c, E(b, function (a) {
                return a.component()
            }));
            return {
                component: h(c), destroy: function () {
                    z(b, function (a) {
                        a.destroy()
                    })
                }, refreshUi: function () {
                    z(b,
                        function (a) {
                            a.refreshUi()
                        });
                    a.updatePalette(f)
                }
            }
        }, m4 = function (a, b, c, d, e) {
            var f = e.instance();
            e = r.fromDom(document);
            var k = (f.toggle ? Ng.splitToggle : Ng.split)(f.name(), f.name(), ca, f.textkey(), f.label(), f.tooltip, c),
                l = Of.custom(k.element(), function () {
                    k.open();
                    f.enter()
                });
            m.set(k.element(), "tabindex", "-1");
            var g = k.initAria(k, c(f.textkey()), !0, f.toggle);
            d = qj(a.uiContainer, a.bounds, b, [k.element()], d);
            var h = Vl(), w = zb.widget(e, f.name());
            e = Ha("menu-control");
            m.set(w, "id", e);
            S.controls(k.element(), e);
            S.owns(k.element(),
                e);
            S.menu(w, c(f.menuTextkey()));
            y.append(w, f.element());
            var J = d.initMenu(w), G = Lg.main(a.uiContainer, a.bounds, k.element, h, b.uiDirection(), cf.expandable()),
                n = function () {
                    G.recalculate(J)
                };
            J.events.open.bind(function () {
                ra.expanded(k.element());
                f.open();
                t.trigger.open(w, J, G)
            });
            J.events.close.bind(function () {
                ra.collapsed(k.element());
                f.close();
                k.close()
            });
            f.events.done.bind(function () {
                J.close();
                k.close()
            });
            f.events.abort.bind(function () {
                J.close();
                k.close();
                t.trigger.abort()
            });
            k.events.open.bind(function () {
                J.open();
                G.recalculate(J)
            });
            k.events.close.bind(function () {
                f.close();
                J.close()
            });
            k.events.click.bind(function () {
                f.action()
            });
            var t = H.create({abort: p([]), close: Q([], f.events.close), open: p(["menu", "popup", "anchor"])});
            return {
                widgets: function () {
                    return {events: t.registry, open: k.open, isOpen: k.isOpen, close: k.close, recalculate: n}
                }, component: k.element, refreshUi: function () {
                    f.updateWidget(He.widget({
                        select: k.select,
                        deselect: k.deselect,
                        enable: k.enable,
                        disable: k.disable,
                        press: g.press,
                        release: g.release
                    }))
                }, destroy: function () {
                    l.unbind();
                    g.destroy();
                    J.destroy();
                    f.destroy();
                    k.destroy()
                }
            }
        }, n4 = function (a, b, c, d, e) {
            var f = e.instance(), k = Ng.toggle(f.name(), f.name(), ca, f.textkey(), f.label(), f.tooltip, c),
                l = Of.onButton(k), g = k.initAria(k, c(f.textkey()), !0, !0);
            c = qj(a.uiContainer, a.bounds, b, [k.element()], d);
            d = Vl();
            var h = c.initMenu(f.element()),
                w = Lg.main(a.uiContainer, a.bounds, k.element, d, b.uiDirection(), cf.expandable());
            m.set(k.element(), "tabindex", "-1");
            n.add(h.element(), va.resolve("toolbar-widget"));
            var J = function () {
                w.recalculate(h)
            };
            h.events.open.bind(function () {
                ra.expanded(k.element());
                f.open();
                G.trigger.open(f.element(), h, w)
            });
            h.events.close.bind(function () {
                ra.collapsed(k.element());
                f.close()
            });
            f.events.done.bind(function () {
                h.close();
                k.deselect()
            });
            f.events.abort.bind(function () {
                h.close();
                k.deselect();
                G.trigger.abort()
            });
            k.events.click.bind(function () {
                k.selected() ? (h.open(), w.recalculate(h)) : h.close();
                ra.pressed(k)
            });
            var G = H.create({abort: p([]), open: p(["menu", "popup", "anchor"])}), r = function () {
                k.deselect();
                h.close()
            };
            return {
                widgets: function () {
                    return {events: G.registry, close: r, recalculate: J}
                },
                component: k.element, refreshUi: function () {
                    f.updateWidget(He.widget({
                        select: t,
                        deselect: t,
                        enable: g.enable,
                        disable: g.disable,
                        press: t,
                        release: t
                    }))
                }, destroy: function () {
                    l.unbind();
                    g.destroy();
                    h.destroy();
                    f.destroy();
                    k.destroy()
                }
            }
        }, o4 = function (a, b) {
            var c = b.instance(), d = Of.custom(c.element(), function () {
                c.element().dom().click()
            });
            m.remove(c.element(), "tabindex");
            n.add(c.element(), va.resolve("toolbar-inline-widget"));
            S.toolbarButton(c.element(), a(c.textkey()), !1);
            var e = H.create({
                abort: p([]), open: p(["menu",
                    "popup", "anchor"])
            });
            return {
                widgets: function () {
                    return {events: e.registry, recalculate: t, close: t}
                }, component: c.element, refreshUi: function () {
                    c.updateInlineWidget(He.widget({
                        select: t,
                        deselect: t,
                        enable: u(ra.enable, c.element()),
                        disable: u(ra.disable, c.element()),
                        press: t,
                        release: t
                    }))
                }, destroy: function () {
                    d.unbind();
                    c.destroy()
                }
            }
        }, sy = {
            menu: function (a) {
                return {
                    general: u(L3, a),
                    menu: u(O3, a),
                    dropdown: u(J3, a),
                    widget: u(Yl.widget, a),
                    "split-widget": u(Yl.split, a),
                    "inline-widget": u(Yl.inline, a),
                    palette: yb("No palettes for menus yet")
                }
            },
            toolbar: function (a, b, c, d) {
                var e = function (e) {
                    return u(e, a, b, c, d)
                };
                return {
                    menu: e(k4),
                    dropdown: e(f4),
                    widget: e(n4),
                    "split-widget": e(m4),
                    "inline-widget": u(o4, c),
                    general: u(i4, c),
                    palette: l4
                }
            }
        }, wE = ta.generate([{toolbar: []}, {menu: []}]), Mq = {
            toolbar: wE.toolbar, menu: wE.menu, cata: function (a, b, c) {
                return a.fold(b, c)
            }
        }, p4 = function (a, b, c, d) {
            a.events.escaped.bind(function (a) {
                c.focused() && Z.focus(d.component())
            });
            a.events.close.bind(function (a) {
                b.focus()
            })
        }, q4 = function (a, b, c, d) {
            a.events.open.bind(function (a) {
                Vc.register(a.popup().panel())
            })
        },
        WT = {
            init: function (a, b, c, d, e, f, k, l, g) {
                var h = a.dropdown(g), q = h.dropdown();
                a = c.toolbar;
                (aa.detect().deviceType.isTouch() ? q4 : p4)(q, e, a, h);
                var m = !1;
                q.events.open.bind(function (a) {
                    e.toReading();
                    k.show(a.popup(), a.anchor());
                    m = !0
                });
                q.events.close.bind(function () {
                    m = !1
                });
                q.events.escaped.bind(function () {
                    Z.focus(h.component())
                });
                e.events.mousedown.bind(function () {
                    m && q.close()
                });
                e.events.uiStale.bind(q.uiStale);
                c.toolbar.events.transitionend.bind(function (a) {
                    U(["top", "height"], a.property()) && q.recalculate()
                });
                return {component: h.component, refreshUi: h.refreshUi, destroy: h.destroy}
            }
        }, VT = {
            init: function (a, b, c, d, e, f, k, l, g) {
                a = a.general(g);
                b = a.generals();
                a.refreshUi();
                return {generals: b, component: a.component, refreshUi: a.refreshUi, destroy: a.destroy}
            }
        }, xE = function (a) {
            var b = g.none(), c = function () {
                b = g.none()
            };
            return {
                begin: function () {
                    b = g.from(Za.capture(a))
                }, end: function () {
                    b.each(function (a) {
                        a.restore()
                    });
                    c()
                }, destroy: c
            }
        }, Qm = {
            fromSafe: function (a) {
                return xE(a.doc())
            }, fromUnsafe: function (a) {
                a = a.doc().getOrDie();
                return xE(a)
            }
        },
        XT = {
            init: function (a, b, c, d, e, f, k, l, h) {
                var q = a.menu(h, []), w = q.menus(), m = Qm.fromUnsafe(e);
                w.events.open.bind(function (a) {
                    e.toReading();
                    w.refreshMenus(a.menu());
                    k.show(a.popup(), a.anchor())
                });
                w.events.close.bind(function () {
                    e.focus();
                    m.end()
                });
                w.events.escaped.bind(function () {
                    Z.focus(q.component())
                });
                w.events.reveal.bind(function (a) {
                    h.init(a.menu());
                    k.show(a.popup(), a.anchor())
                });
                w.events.itemAction.bind(function (a) {
                    m.end()
                });
                w.events.itemHover.bind(function (a) {
                    m.begin();
                    if (null !== document.activeElement &&
                        void 0 !== document.activeElement) {
                        var b = r.fromDom(document.activeElement), c = A.owner(a.item());
                        "input" !== D.name(b) && Vc.preserve(c, u(Z.focusInside, a.item()))
                    } else e.backupSelection(), Z.focus(a.item())
                });
                e.events.mousedown.bind(w.mousedown);
                e.events.uiStale.bind(w.uiStale);
                e.events.focus.bind(w.enable);
                var G = !e.isInline() && h.contentFocus();
                G && w.disable();
                return {
                    component: q.component, refreshUi: function () {
                        q.refreshUi();
                        var a = G ? g.none() : g.some(!0);
                        e.getSelection().or(a).fold(w.disable, w.enable)
                    }, destroy: function () {
                        m.destroy();
                        e.events.mousedown.unbind(w.mousedown);
                        e.events.uiStale.unbind(w.update);
                        q.destroy()
                    }
                }
            }
        }, mt = function (a, b, c, d, e, f, k, l, g, h, w) {
            var q = c[b]({instance: a(w.instance)});
            a = q.widgets();
            e = e.toolbar;
            a.events.open.bind(function (a) {
                k.toReading();
                g.show(a.popup(), a.anchor())
            });
            a.events.abort.bind(function () {
                Z.focus(q.component())
            });
            k.events.mousedown.bind(a.close);
            return (aa.detect().deviceType.isTouch() && "split-widget" === b ? r4 : s4)(a, k, e, q)
        }, s4 = function (a, b, c, d) {
            return d
        }, r4 = function (a, b, c, d) {
            var e = K.capture(d.component(),
                "click", function (b) {
                    b.kill();
                    n.add(d.component(), lb.resolve("statebutton-selected"));
                    a.isOpen() ? a.close() : a.open()
                });
            a.events.close.bind(function () {
                n.remove(d.component(), lb.resolve("statebutton-selected"))
            });
            return {
                widgets: d.widgets, component: d.component, refreshUi: d.refreshUi, destroy: function () {
                    e.unbind();
                    d.destroy()
                }
            }
        }, Nq = {
            widget: u(mt, ca, "widget"), inlineWidget: u(mt, function (a) {
                return function () {
                    return a(Mq.toolbar())
                }
            }, "inline-widget"), splitWidget: u(mt, ca, "split-widget")
        }, t4 = B.resolve("editor-container"),
        Mg = {editorContainer: h(t4)}, Ln = O("key", "link"), yE = O("url", "text"), zE = function (a, b, c) {
            return function (d) {
                var e = yE(b, x.translate(c));
                return Ln(x.pkey(a, d), g.some(e))
            }
        }, oc = function (a) {
            return function (b) {
                return Ln(x.pkey(a, b), g.none())
            }
        }, nt = function (a) {
            return function (b) {
                var c = a(b);
                b = yE(b[0].websiteUrl, x.translate("cloud.dashboard"));
                return Ln(c.key(), g.some(b))
            }
        }, u4 = {
            "no.api.key": nt(oc("cloud.error.apikey")),
            "domain.not.supported": nt(function (a) {
                return Ln(x.pkey("cloud.error.domain", [a[0].details.domain]),
                    g.none())
            }),
            "plan.exceeded": nt(oc("cloud.error.plan")),
            "error.code.invalid.toolbar": oc("errors.toolbar.invalid"),
            "error.code.spelling.not.found": oc("errors.spelling.missing.service"),
            "error.code.images.not.found": oc("errors.images.missing.service"),
            "safari.imagepaste": zE("errors.safari.image", "https://support.ephox.com/entries/88543243-Safari-Direct-paste-of-images-does-not-work", "errors.safari.url"),
            "webview.imagepaste": oc("errors.webview.image"),
            "flash.clipboard.no.rtf": function (a) {
                return (aa.detect().browser.isSafari() ?
                    zE("errors.safari.browser-settings", "https://support.ephox.com/entries/59328357-Safari-6-1-and-7-Flash-Sandboxing", "errors.safari.rtf") : oc("errors.images.missing.flash"))(a)
            },
            "fileupload.invalidimages": oc("errors.images.upload.invalid"),
            "error.imageupload": oc("errors.images.upload.failed"),
            "error.imageupload.generic": oc("errors.images.upload.unknown"),
            "error.imageupload.cors": oc("errors.images.upload.cors"),
            "errors.paste.word.notready": oc("errors.paste.notready"),
            "errors.paste.process.failure": oc("errors.paste.generic"),
            "flash.crashed": oc("errors.flash.crashed"),
            "errors.imageimport.failed": oc("errors.images.import.failed"),
            "errors.imageimport.unsupported": oc("errors.images.import.unsupported"),
            "errors.imageimport.invalid": oc("errors.images.import.invalid"),
            "imageedit.needsproxy": oc("errors.images.edit.needsproxy"),
            "imageedit.proxyerror": oc("errors.images.edit.proxyerror"),
            "imageedit.generic": oc("errors.images.edit.generic")
        }, v4 = {
            "errors.local.images.disallowed": "Removing pasted images from content. Local image insert has been disabled.",
            "errors.dragdrop.images.disallowed": "Blocking image drop operation. Local image insert has been disabled."
        }, AE = function (a, b) {
            a = (0, u4[a])(b);
            return {description: h(x.get(a.key())), link: h(a.link().getOr(null))}
        }, mf = {
            get: AE, getOrLog: function (a, b) {
                return g.from(v4[a]).fold(function () {
                    var c = AE(a, b);
                    return g.some(c)
                }, function (a) {
                    console.warn(a);
                    return g.none()
                })
            }
        }, w4 = function (a, b) {
            var c = function (b) {
                var c = mf.get("error.code.invalid.toolbar", [b.small()]);
                c = nj(c);
                a.displayBanner(c);
                z(b.big(), function (a) {
                    console.error(a)
                })
            };
            return b.fold(function (a) {
                c(a);
                return []
            }, ca)
        }, BE = {
            setup: function (a, b, c, d, e, f) {
                f = w4(a, f);
                var k = function (a) {
                    a = xa(a) ? x.has(a) ? x.key(a) : x.raw(a) : a;
                    return x.get(a)
                };
                n.add(a.toolbar.element(), B.resolve("layer-above-editor"));
                b = OD.blueprints(UT(e.uiContainer, a, b, c, d, e, k), TT(k));
                e = OD.env(e.uiContainer, k);
                e = s3.build(f, b, e);
                z(e, a.toolbar.add);
                a.position();
                z(e, function (a) {
                    c.events.uiStale.bind(function () {
                        a.refreshUi()
                    })
                })
            }
        }, Hh = {
            preserve: function (a, b) {
                var c = A.owner(b), d = Z.active(c).bind(function (a) {
                    var c = function (b) {
                        return N.eq(a,
                            b)
                    };
                    return c(b) ? g.some(b) : Ja.descendant(b, c)
                });
                a = a(b);
                d.each(function (a) {
                    Z.active(c).filter(function (b) {
                        return N.eq(b, a)
                    }).isNone() && Z.focus(a)
                });
                return a
            }
        }, uy = O("component", "index"), cU = {
            item: h('.ephox-chameleon-toolbar-group [tabindex="-1"]'),
            group: h(".ephox-chameleon-toolbar-group"),
            sector: h(".ephox-chameleon-toolstrip > *")
        }, CE = va.resolve("toolbar-more-closed"), DE = va.resolve("toolbar-more-open"),
        yy = va.resolve("toolbar-more-hide"), xy = va.resolve("toolbar-more-show"), Qq = function (a, b) {
            v.set(a, "height",
                b + "px");
            v.reflow(a)
        }, Pq = function (a) {
            n.remove(a, DE);
            n.add(a, CE);
            Qq(a, 0)
        }, zy = function (a) {
            n.remove(a, CE);
            n.add(a, DE);
            v.remove(a, "height")
        }, ot = O("within", "extra", "withinWidth"), EE = function (a, b, c) {
            var d = Rd.generate(a, function (a, b) {
                var d = c(a);
                return g.some({element: h(a), start: h(b), finish: h(b + d), width: h(d)})
            });
            a = ka(d, function (a) {
                return a.finish() < b
            });
            var e = Eb(a, function (a, b) {
                return a + b.width()
            }, 0);
            d = d.slice(a.length);
            return {within: h(a), extra: h(d), withinWidth: h(e)}
        }, Mn = function (a) {
            return E(a, function (a) {
                return a.element()
            })
        },
        x4 = function (a, b, c) {
            a = Mn(a.concat(b));
            return ot(a, [], c)
        }, y4 = function (a, b, c, d) {
            a = Mn(a).concat([c]);
            return ot(a, Mn(b), d)
        }, z4 = function (a, b, c) {
            return ot(Mn(a), [], c)
        }, A4 = function (a, b, c) {
            a = EE(b, a, c);
            return 0 === a.extra().length ? g.some(a) : g.none()
        }, aU = {
            partition: function (a, b, c, d) {
                var e = A4(a, b, c).getOrThunk(function () {
                    return EE(b, a - c(d), c)
                }), f = e.within(), k = e.extra();
                e = e.withinWidth();
                return 1 === k.length && k[0].width() <= c(d) ? x4(f, k, e) : 1 <= k.length ? y4(f, k, d, e) : z4(f, k, e)
            }
        }, Ba = {
            grid: Aa(["trigger"], ["isValid", "first"]),
            flow: Aa(["trigger"], ["first", "executeOnArrow"]),
            sectors: Aa(["trigger", "first"], []),
            radio: Aa(["one"], []),
            input: Aa([], ["execute"]),
            button: Aa(["execute"], ["process"]),
            dialog: Aa(["execute", "ok", "cancel"], ["index"]),
            inlineDialog: Aa(["ok", "cancel"], ["index"]),
            page: Aa(["trigger"], ["first"]),
            tabular: Aa(["trigger"], ["first", "isValid"]),
            dynamic: Aa([], ["execute"])
        }, gd = eh(fh, ["enter", "exit", "destroy"]), FE = function (a) {
            return function (b) {
                return b.raw().which === a
            }
        }, ea = {
            inSet: function (a) {
                return function (b) {
                    return U(a,
                        b.raw().which)
                }
            }, and: function (a) {
                return function (b) {
                    return ob(a, function (a) {
                        return a(b)
                    })
                }
            }, is: FE, isShift: function (a) {
                return !0 === a.raw().shiftKey
            }, basic: function (a, b) {
                return {matches: FE(a), run: b}
            }, rule: function (a, b) {
                return {matches: a, run: b}
            }
        }, pt = function (a) {
            m.has(a, "tabIndex") || m.set(a, "tabIndex", "-1")
        }, fb = {
            set: function (a) {
                pt(a);
                Z.focus(a)
            }, find: function (a) {
                return Z.search(a)
            }, isFocused: Z.hasFocus, mark: pt, markSelectors: function (a, b) {
                z(b, function (b) {
                    b = Y.descendants(a, b);
                    z(b, pt)
                })
            }
        }, Ke = {
            adjust: function (a,
                              b, c, d) {
                a += b;
                return a > d ? c : a < c ? d : a
            }, findPrev: function (a, b, c) {
                var d = kd(a.slice(0, b));
                a = kd(a.slice(b + 1));
                return qa(d.concat(a), c)
            }, findNext: function (a, b, c) {
                var d = a.slice(0, b);
                a = a.slice(b + 1);
                return qa(a.concat(d), c)
            }
        }, GE = function (a) {
            return qa(a, Nn)
        }, Nn = function (a) {
            return sc.isVisible(a.element()) && a.isEnabled() && "hidden" !== v.get(a.element(), "visibility")
        }, ya = {
            exit: function (a) {
                z(a, function (a) {
                    a.clear();
                    a.exit()
                })
            }, clear: function (a) {
                z(a, function (a) {
                    a.clear()
                })
            }, refresh: function (a) {
                z(a, function (a) {
                    a.refresh()
                })
            },
            first: GE, enterFirst: function (a, b) {
                b.index().bind(function (b) {
                    return g.from(a[b]).filter(Nn)
                }).orThunk(function () {
                    return GE(a)
                }).each(function (a) {
                    a.enter()
                })
            }, isEnabled: function (a) {
                return Xa(a, function (a) {
                    return a.isEnabled()
                })
            }, locate: function (a, b) {
                return qa(a, function (a) {
                    var c = b.target();
                    a = a.element();
                    return wd.closest(c, u(N.eq, a))
                }).getOr(void 0)
            }, next: function (a, b) {
                var c = Gc(a, b).getOr(-1);
                return Ke.findNext(a, c, Nn).getOr(b)
            }, prev: function (a, b) {
                var c = Gc(a, b).getOr(-1);
                return Ke.findPrev(a, c, Nn).getOr(b)
            },
            prevNoCycle: function (a, b) {
                b = Gc(a, b).getOr(-1);
                return 0 < b ? g.some(a[b - 1]) : g.none()
            }, nextNoCycle: function (a, b) {
                b = Gc(a, b).getOr(-1);
                return b + 1 < a.length ? g.some(a[b + 1]) : g.none()
            }, progress: function (a, b) {
                a.exit();
                b.enter()
            }, destroy: function (a) {
                z(a, function (a) {
                    a.destroy()
                })
            }
        }, B4 = Aa(["index", "focused", "group", "items"], []), C4 = Aa(["index", "sectors", "sector"], []),
        D4 = Aa(["index", "candidates"], []), jh = {
            ofFocus: function (a, b, c) {
                return fb.find(a).bind(function (a) {
                    return L.closest(a, b).bind(function (b) {
                        var d = Y.descendants(b,
                            c), e = ka(d, sc.isVisible);
                        return Va(e, u(N.eq, a)).map(function (c) {
                            return B4({index: c, focused: a, group: b, items: e})
                        })
                    })
                })
            }, ofSector: function (a, b, c) {
                var d = Y.descendants(a, b);
                return L.closest(c, b).bind(function (a) {
                    return Va(d, u(N.eq, a)).map(function (b) {
                        return C4({index: b, sectors: d, sector: a})
                    })
                })
            }, within: function (a, b, c) {
                var d = Y.descendants(a, c);
                return Va(d, u(N.eq, b)).map(function (a) {
                    return D4({index: a, candidates: d})
                })
            }
        }, HE = {
            horizontal: function (a, b, c, d) {
                return jh.within(a, c, b).bind(function (a) {
                    var b = a.index();
                    a = a.candidates();
                    b = Ke.adjust(b, d, 0, a.length - 1);
                    return g.from(a[b])
                })
            }
        }, On = {
            delegate: function (a, b, c) {
                return Pf(a, [ea.basic(R.LEFT()[0], b.west), ea.basic(R.RIGHT()[0], b.east), ea.basic(R.UP()[0], b.north), ea.basic(R.DOWN()[0], b.south), ea.rule(ea.inSet(R.SPACE().concat(R.ENTER())), function () {
                    return fb.find(a).bind(c.trigger()).map(Jb)
                })], g.none())
            }, findRecent: function (a, b, c, d) {
                return d.isValid().fold(h(c), function (a) {
                    return c.filter(a)
                }).orThunk(function () {
                    return d.first().bind(function (a) {
                        return a()
                    }).orThunk(function () {
                        return L.descendant(a,
                            b)
                    })
                })
            }
        }, E4 = O("row", "column"), fa = {
            set: function (a, b) {
                if (void 0 === b) throw Error("Value.set was undefined");
                a.dom().value = b
            }, get: function (a) {
                return a.dom().value
            }
        }, F4 = {
            move: function (a, b, c) {
                var d = O("row", "col"), e = a.length - 1, f = a[b.row()] - 1;
                e = Ke.adjust(b.row(), c.dr(), 0, e);
                a = a[e] - 1;
                f = Math.max(f, a);
                b = Math.min(a, Ke.adjust(b.col(), c.dc(), 0, f));
                return d(e, b)
            }
        }, IE = {
            single: Pf, multiple: function (a, b) {
                var c = K.bind(a, "keydown", function (a) {
                    var c = ya.locate(b, a);
                    if (ea.is(R.ESCAPE()[0])(a)) d(), a.kill(); else if (void 0 !==
                        c && null !== c && ea.is(R.TAB()[0])(a)) {
                        var e = (ea.isShift(a) ? ya.prev : ya.next)(b, c);
                        ya.progress(c, e);
                        a.kill()
                    }
                }), d = function () {
                    ya.exit(b);
                    e.trigger.exit()
                }, e = H.create({enter: p([]), exit: p([])});
                return gd({
                    enter: function () {
                        ya.first(b).each(function (a) {
                            a.enter()
                        })
                    },
                    exit: d,
                    clear: u(ya.clear, b),
                    refresh: u(ya.refresh, b),
                    isEnabled: u(ya.isEnabled, b),
                    isFocused: u(fb.isFocused, a),
                    destroy: function () {
                        ya.destroy(b);
                        c.unbind()
                    },
                    events: e.registry
                })
            }, multipleAll: function (a, b) {
                var c = K.bind(a, "keydown", function (a) {
                    var c = ya.locate(b,
                        a);
                    if (ea.is(R.ESCAPE()[0])(a)) d(), a.kill(); else if (void 0 !== c && null !== c) if (ea.is(R.UP()[0])(a)) ya.progress(c, ya.prev(b, c)), a.kill(); else if (ea.is(R.DOWN()[0])(a)) ya.progress(c, ya.next(b, c)), a.kill(); else if (ea.is(R.TAB()[0])(a)) {
                        var e = (ea.isShift(a) ? ya.prev : ya.next)(b, c);
                        ya.progress(c, e);
                        a.kill()
                    }
                }), d = function () {
                    ya.exit(b);
                    e.trigger.exit()
                }, e = H.create({enter: p([]), exit: p([])});
                return gd({
                    enter: function () {
                        ya.first(b).each(function (a) {
                            a.enter()
                        })
                    }, exit: d, clear: u(ya.clear, b), refresh: u(ya.refresh, b),
                    isEnabled: u(ya.isEnabled, b), isFocused: u(fb.isFocused, a), events: e.registry, destroy: function () {
                        ya.destroy(b);
                        c.unbind()
                    }
                })
            }, flow: function (a, b, c) {
                var d = g.none();
                fb.markSelectors(a, [b.item()]);
                var e = function (c) {
                        return fb.find(a).bind(function (d) {
                            return HE.horizontal(a, b.item(), d, c)
                        })
                    }, f = sj(a, function (a) {
                        return e(a).bind(function (a) {
                            q(a);
                            return c.executeOnArrow().fold(function () {
                                return g.some(!0)
                            }, k)
                        })
                    }), k = function () {
                        return fb.find(a).bind(c.trigger()).map(Jb)
                    }, l = Pf(a, [ea.rule(ea.inSet(R.LEFT().concat(R.UP())),
                    f.west), ea.rule(ea.inSet(R.RIGHT().concat(R.DOWN())), f.east), ea.rule(ea.inSet(R.SPACE().concat(R.ENTER())), k)], g.none()),
                    q = function (a) {
                        d = g.some(a);
                        fb.set(a)
                    };
                return gd({
                    element: l.element, destroy: l.destroy, clickFocus: function (a) {
                        Fa.is(a, b.item()) && q(a)
                    }, clear: function () {
                        d = g.none()
                    }, isFocused: l.isFocused, isEnabled: h(!0), refresh: t, enter: function () {
                        l.enter();
                        d.orThunk(function () {
                            return c.first().fold(function () {
                                return L.descendant(a, b.item())
                            }, xb)
                        }).each(q)
                    }, exit: l.exit
                })
            }, grid: function (a, b, c, d, e) {
                var f =
                    c, k = d;
                fb.markSelectors(a, [b.cell()]);
                var l = na(g.none()), h = function (a) {
                    return A.findIndex(a).map(function (a) {
                        return E4(Math.floor(a / k), a % k)
                    })
                }, C = function (c, d) {
                    return fb.find(a).bind(function (e) {
                        return h(e).bind(function (e) {
                            var l = Ke.adjust(e.row(), d, 0, f - 1), h = Ke.adjust(e.column(), c, 0, k - 1);
                            e = Y.descendants(a, b.cell());
                            var q = e.length - 1;
                            l *= k;
                            l = l + h > q ? 0 < c ? l : q : l + h;
                            return 0 <= l && l < e.length ? g.some(e[l]) : g.none()
                        })
                    })
                };
                c = sj(a, function (a, b) {
                    return C(a, b).bind(function (a) {
                        fb.set(a);
                        l.set(g.some(a));
                        return g.some(!0)
                    })
                });
                var w = On.delegate(a, c, e);
                return gd({
                    element: w.element, destroy: w.destroy, clear: function () {
                        l.set(g.none())
                    }, isFocused: w.isFocused, isEnabled: Jb, refresh: t, enter: function () {
                        w.enter();
                        l.set(On.findRecent(a, b.cell(), l.get(), e));
                        l.get().each(Z.focus)
                    }, exit: w.exit, resize: function (a, b) {
                        f = a;
                        k = b
                    }
                })
            }, sectors: function (a, b, c) {
                fb.markSelectors(a, [b.sector(), b.group(), b.item()]);
                var d = function (a) {
                        return Ja.descendant(a, function (a) {
                            return Fa.is(a, b.item()) && h(a)
                        })
                    }, e = function (a) {
                        return Ja.child(a, m)
                    }, f = function (a) {
                        a =
                            ed.children(a, m);
                        return 0 < a.length ? g.some(a[a.length - 1]) : g.none()
                    }, k = sj(a, function (c) {
                        return jh.ofFocus(a, b.group(), b.item()).bind(function (a) {
                            var b = a.items();
                            a = Ke.adjust(a.index(), c, 0, b.length - 1);
                            return g.from(b[a])
                        })
                    }), l = function (c) {
                        return jh.ofFocus(a, b.group(), b.item()).bind(function (a) {
                            return c(a.group()).bind(d)
                        })
                    }, h = function (a) {
                        return 0 < sa.get(a)
                    }, C = function (c) {
                        return jh.ofSector(a, b.sector(), c).map(function (a) {
                            return Ke.findPrev(a.sectors(), a.index(), h).getOr(a.sector())
                        })
                    }, w = function (c) {
                        return jh.ofSector(a,
                            b.sector(), c).map(function (a) {
                            return Ke.findNext(a.sectors(), a.index(), h).getOr(a.sector())
                        })
                    }, m = function (a) {
                        var c;
                        if (c = Fa.is(a, b.group())) a = Y.descendants(a, b.item()), c = Xa(a, sc.isVisible);
                        return c
                    }, G = function (a) {
                        return function () {
                            return a().map(function (a) {
                                fb.set(a);
                                n.trigger.active(a);
                                return a
                            })
                        }
                    }, n = H.create({enter: p([]), exit: p([]), active: p(["element"])}),
                    r = Pf(a, [ea.rule(ea.inSet(R.ESCAPE()), function () {
                        r.exit();
                        n.trigger.exit();
                        return g.some(!0)
                    }), ea.rule(ea.inSet(R.RIGHT().concat(R.DOWN())), G(k.east)),
                        ea.rule(ea.inSet(R.LEFT().concat(R.UP())), G(k.west)), ea.rule(ea.and([ea.isShift, ea.inSet(R.TAB())]), G(u(l, function (a) {
                            return A.prevSibling(a).filter(m).orThunk(function () {
                                return C(a).bind(f)
                            })
                        }))), ea.rule(ea.inSet(R.TAB()), G(u(l, function (a) {
                            return A.nextSibling(a).filter(m).orThunk(function () {
                                return w(a).bind(e)
                            })
                        }))), ea.rule(ea.inSet(R.SPACE().concat(R.ENTER())), function () {
                            return fb.find(a).bind(c.trigger()).map(Jb)
                        })], g.none());
                return gd({
                    element: r.element, clear: t, isFocused: r.isFocused, enter: function () {
                        r.enter();
                        n.trigger.enter();
                        c.first()().orThunk(function () {
                            return d(a)
                        }).each(function (a) {
                            fb.set(a);
                            n.trigger.active(a)
                        })
                    }, refresh: t, isEnabled: Jb, exit: r.exit, destroy: r.destroy, events: n.registry
                })
            }, radio: function (a, b, c) {
                var d = function (c) {
                        return fb.find(a).bind(function (d) {
                            return HE.horizontal(a, b.item(), d, c)
                        })
                    }, e = sj(a, function (b) {
                        return d(b).bind(function (b) {
                            fb.set(b);
                            c.one()(a, b);
                            return g.some(!0)
                        })
                    }),
                    f = Pf(a, [ea.rule(ea.inSet(R.LEFT().concat(R.UP())), e.west), ea.rule(ea.inSet(R.RIGHT().concat(R.DOWN())), e.east),
                        ea.rule(ea.inSet(R.SPACE()), u(g.some, !0))], g.none());
                return gd({
                    element: f.element, destroy: f.destroy, clear: t, refresh: function () {
                        f.isFocused() && L.descendant(a, b.selected()).each(fb.set)
                    }, isFocused: f.isFocused, isEnabled: Jb, enter: function () {
                        f.enter();
                        L.descendant(a, b.selected()).orThunk(function () {
                            return L.descendant(a, b.item())
                        }).each(function (d) {
                            Fa.is(d, b.selected()) || c.one()(a, d);
                            fb.set(d)
                        })
                    }, exit: f.exit
                })
            }, input: function (a, b) {
                var c = Pf(a, [ea.basic(R.ENTER()[0], function (c) {
                    return b.execute().map(function (b) {
                        var d =
                            {isShift: h(ea.isShift(c))}, e = fa.get(a);
                        b(e, d);
                        return !0
                    })
                })], g.none());
                return gd({
                    element: c.element,
                    destroy: c.destroy,
                    clear: c.clear,
                    isFocused: c.isFocused,
                    isEnabled: function () {
                        return !m.has(a, "disabled")
                    },
                    refresh: t,
                    enter: function () {
                        c.enter();
                        a.dom().setSelectionRange(0, fa.get(a).length)
                    },
                    exit: c.exit
                })
            }, dialog: function (a, b, c) {
                var d = c.execute(), e = Ba.button({execute: d}), f = b.slice(0).concat([Rq(c.cancel(), e), Rq(c.ok(), e)]),
                    k = K.bind(a, "keydown", function (a) {
                        var b = ya.locate(f, a);
                        if (void 0 !== b && null !== b) {
                            var e =
                                ea.isShift(a);
                            ea.is(R.TAB()[0])(a) ? (e = (e ? ya.prev : ya.next)(f, b), ya.progress(b, e), a.kill()) : ea.is(R.ESCAPE()[0])(a) ? (l(), a.kill(), d(c.cancel())) : "button" === D.name(b.element()) || e || !ea.is(R.ENTER()[0])(a) ? (b = [R.UP()[0], R.DOWN()[0]], e = ["textarea", "select", "input"], ea.inSet(b)(a) && !1 === U(e, D.name(a.target())) && a.kill()) : (d(c.ok()), a.kill())
                        }
                    }), l = function () {
                        ya.exit(f);
                        g.trigger.exit()
                    }, g = H.create({enter: p([]), exit: p([])});
                return gd({
                    enter: function () {
                        ya.enterFirst(f, c)
                    },
                    exit: l,
                    clear: u(ya.clear, f),
                    refresh: u(ya.refresh,
                        f),
                    isEnabled: u(ya.isEnabled, f),
                    isFocused: u(fb.isFocused, a),
                    events: g.registry,
                    destroy: function () {
                        ya.destroy(f);
                        k.unbind()
                    }
                })
            }, button: Rq, inlineDialog: function (a, b, c) {
                var d = c.ok(), e = c.cancel(), f = K.bind(a, "keydown", function (a) {
                    var c = ya.locate(b, a);
                    if (void 0 !== c && null !== c) {
                        var f = ea.isShift(a);
                        ea.is(R.TAB()[0])(a) ? (f = (f ? ya.prev : ya.next)(b, c), ya.progress(c, f), a.kill()) : ea.is(R.ESCAPE()[0])(a) ? (k(), a.kill(), e(a.target())) : !f && ea.is(R.ENTER()[0])(a) ? (d(a.target()), a.kill()) : (c = [R.UP()[0], R.DOWN()[0]], f = ["textarea",
                            "select", "input"], ea.inSet(c)(a) && !1 === U(f, D.name(a.target())) && a.kill())
                    }
                }), k = function () {
                    ya.exit(b);
                    l.trigger.exit()
                }, l = H.create({enter: p([]), exit: p([])});
                return gd({
                    enter: function () {
                        ya.enterFirst(b, c)
                    },
                    exit: k,
                    clear: u(ya.clear, b),
                    refresh: u(ya.refresh, b),
                    isEnabled: u(ya.isEnabled, b),
                    isFocused: u(fb.isFocused, a),
                    events: l.registry,
                    destroy: function () {
                        ya.destroy(b);
                        f.unbind()
                    }
                })
            }, tabular: function (a, b, c) {
                var d = b.row(), e = b.cell();
                fb.markSelectors(a, [d, e]);
                var f = na(g.none()), k = sj(a, function (a, b) {
                    return G(a,
                        b).bind(function (a) {
                        fb.set(a);
                        f.set(g.some(a));
                        return g.some(!0)
                    })
                }), l = O("row", "col"), h = O("dc", "dr"), C = function (a) {
                    a = Y.descendants(a, d);
                    return E(a, function (a) {
                        return Y.descendants(a, e).length
                    })
                }, w = function (b) {
                    return L.closest(b, d).bind(function (c) {
                        return jh.within(a, c, d).bind(function (a) {
                            return jh.within(c, b, e).map(function (b) {
                                return l(a.index(), b.index())
                            })
                        })
                    })
                }, m = function (b) {
                    var c = Y.descendants(a, d);
                    return g.from(c[b.row()]).bind(function (a) {
                        a = Y.descendants(a, e);
                        return g.from(a[b.col()])
                    })
                }, G = function (b,
                                 c) {
                    return fb.find(a).bind(function (d) {
                        return w(d).bind(function (d) {
                            var e = C(a);
                            d = F4.move(e, d, h(b, c));
                            return m(d)
                        })
                    })
                }, n = On.delegate(a, k, c);
                return gd({
                    element: n.element, destroy: n.destroy, clear: function () {
                        f.set(g.none())
                    }, isFocused: n.isFocused, isEnabled: Jb, refresh: t, enter: function () {
                        n.enter();
                        f.set(On.findRecent(a, b.cell(), f.get(), c));
                        f.get().each(fb.set)
                    }, exit: n.exit
                })
            }, page: function (a, b, c) {
                var d = b.stops().join(","), e = function () {
                        return c.first().bind(function (b) {
                            return L.descendant(a, b)
                        }).getOr(a)
                    },
                    f = function (a) {
                        var b = e();
                        return (Z.hasFocus(b) ? g.some : fb.find)(b).bind(function (b) {
                            var c = e();
                            if (N.eq(c, b) && 0 > a) c = g.none(); else {
                                var f = Y.descendants(c, d);
                                b = Va(f, u(N.eq, b)).getOr(-1) + a;
                                c = b >= f.length ? g.none() : 0 > b ? g.some(c) : 0 <= b && b < f.length ? g.some(f[b]) : g.none()
                            }
                            return c
                        })
                    };
                b = function (a) {
                    return f(a).bind(function (a) {
                        fb.set(a);
                        return g.some(!0)
                    })
                };
                var k = Pf(a, [ea.rule(ea.and([ea.isShift, ea.inSet(R.TAB())]), u(b, -1)), ea.rule(ea.inSet(R.TAB()), u(b, 1)), ea.rule(ea.inSet(R.SPACE().concat(R.ENTER())), function () {
                        return fb.find(a).bind(c.trigger()).map(Jb)
                    })],
                    g.none());
                return gd({
                    element: k.element,
                    destroy: k.destroy,
                    clear: t,
                    isFocused: k.isFocused,
                    isEnabled: Jb,
                    refresh: t,
                    enter: function () {
                        k.enter();
                        fb.set(e())
                    },
                    exit: k.exit
                })
            }, dynamic: function (a) {
                var b = na([]), c = function (a, c) {
                    ea.is(R.TAB()[0])(c) && (ea.isShift(c) ? ya.prevNoCycle : ya.nextNoCycle)(b.get(), a).each(function (b) {
                        ya.progress(a, b);
                        c.kill()
                    })
                }, d = K.bind(a, "keydown", function (a) {
                    var d = ya.locate(b.get(), a);
                    void 0 !== d && null !== d && c(d, a)
                }), e = H.create({enter: p([]), exit: p([])}), f = function (a) {
                    return function () {
                        return a(b.get())
                    }
                };
                return gd({
                    element: h(a),
                    enter: function () {
                        ya.first(b.get()).each(function (a) {
                            a.enter()
                        })
                    },
                    exit: function () {
                        ya.exit(b.get());
                        e.trigger.exit()
                    },
                    set: function (a) {
                        ya.destroy(b.get());
                        b.set(a)
                    },
                    clear: f(ya.clear),
                    refresh: f(ya.refresh),
                    isEnabled: f(ya.isEnabled),
                    isFocused: u(fb.isFocused, a),
                    destroy: function () {
                        ya.destroy(b.get());
                        d.unbind()
                    },
                    events: e.registry
                })
            }
        }, G4 = {
            grid: function (a, b, c, d, e) {
                fb.markSelectors(a, [b.cell()])
            }
        }, H4 = function (a, b) {
            var c = g.from(G4[b]).getOr(t);
            return function () {
                c.apply(null, arguments);
                return {
                    element: t,
                    clear: t,
                    isFocused: t,
                    isEnabled: t,
                    refresh: t,
                    enter: t,
                    exit: t,
                    events: H.create({enter: p([]), exit: p([]), active: p([])}).registry,
                    destroy: t,
                    set: t,
                    clickFocus: t,
                    resize: t
                }
            }
        }, ha = aa.detect().deviceType.isTouch() ? eb(IE, H4) : IE, df = {
            toolbar: function (a, b) {
                return bU(a, b)
            }, menu: function (a, b, c) {
                return LD.create(a, b, c)
            }, popup: function (a, b, c, d, e) {
                return qj(a, b, c, d, e)
            }, menuSystem: function (a, b, c) {
                return Kq(a, b, c)
            }
        }, be = {
            styleSpan: h("ephox-hare-style-span"),
            base: h("ephox-candy-mountain"),
            active: h("ephox-candy-mountain-active"),
            autoresize: h("ephox-candy-mountain-autoresize")
        }, JE = aa.detect(), Pn = JE.deviceType.isTouch, I4 = JE.deviceType.isAndroid, Qn = function (a, b) {
            return Zg.screen.width >= a && Zg.screen.height >= b
        }, KE = function () {
            return !Qn(620, 700) && Pn()
        }, xc = {
            isTouch: Pn, choice: function (a, b) {
                return hb(a, function (a, b) {
                    return a.orThunk(function () {
                        return b.predicate() ? g.some(b.value()) : g.none()
                    })
                }, g.none()).getOr(b)
            }, isLarge: function () {
                return Qn(620, 700)
            }, isLargeTouch: function () {
                return Qn(620, 700) && Pn()
            }, isSmallTouch: KE, isLargeDesktop: function () {
                return Qn(620,
                    700) && !Pn()
            }, isSmallAndroid: function () {
                return KE() && I4()
            }
        }, kh = aa.detect(), J4 = {
            "ephox-platform-desktop": !kh.deviceType.isTouch(),
            "ephox-platform-touch": kh.deviceType.isTouch(),
            "ephox-platform-small-touch": xc.isSmallTouch(),
            "ephox-platform-android": kh.deviceType.isAndroid(),
            "ephox-platform-ios": kh.deviceType.isiOS(),
            "ephox-platform-ie": kh.browser.isIE() || kh.browser.isEdge(),
            "ephox-platform-firefox": kh.browser.isFirefox()
        }, LE = [];
    Ma(J4, function (a, b) {
        !0 === a && LE.push(b)
    });
    var Zr = {
            addClasses: function (a) {
                ma.add(a,
                    LE)
            }
        }, ME = function (a, b) {
            var c = r.fromTag("div");
            n.add(c, B.resolve(b));
            y.append(c, a);
            return c
        }, Ky = {
            build: function (a, b, c) {
                g.from(b).filter(ck.isPrototypeOf).map(r.fromDom).each(function (b) {
                    var c = r.fromTag("div");
                    n.add(c, B.resolve("flex-row"));
                    var d = r.fromTag("div");
                    n.add(d, B.resolve("flex-column"));
                    P.append(d, A.children(a));
                    y.append(a, c);
                    y.append(c, d);
                    y.append(c, ME(b, "side-bar"))
                });
                g.from(c).filter(ck.isPrototypeOf).map(r.fromDom).each(function (b) {
                    y.append(a, ME(b, "bottom-bar"))
                })
            }
        }, K4 = xd(["compare", "extract",
            "mutate", "sink"]), L4 = xd(["element", "start", "stop", "destroy"]),
        M4 = xd(["forceDrop", "drop", "move", "delayDrop"]), sm = {mode: K4, sink: L4, api: M4},
        Cy = {resolve: Dn("ephox-dragster").resolve}, N4 = sm.mode({
            compare: function (a, b) {
                return Ra(b.left() - a.left(), b.top() - a.top())
            }, extract: function (a) {
                return g.some(Ra(a.x(), a.y()))
            }, sink: function (a, b) {
                var c = eU(b), d = K.bind(c.element(), "mousedown", a.forceDrop),
                    e = K.bind(c.element(), "mouseup", a.drop), f = K.bind(c.element(), "mousemove", a.move),
                    k = K.bind(c.element(), "mouseout", a.delayDrop);
                return sm.sink({
                    element: c.element, start: function (a) {
                        y.append(a, c.element())
                    }, stop: function () {
                        F.remove(c.element())
                    }, destroy: function () {
                        c.destroy();
                        e.unbind();
                        f.unbind();
                        k.unbind();
                        d.unbind()
                    }
                })
            }, mutate: function (a, b) {
                a.mutate(b.left(), b.top())
            }
        }), O4 = {
            setup: function (a, b, c) {
                var d = !1, e = H.create({start: p([]), stop: p([])}), f = hU(), k = function () {
                    h.stop();
                    f.isOn() && (f.off(), e.trigger.stop())
                }, l = uj(k, 200);
                f.events.move.bind(function (c) {
                    b.mutate(a, c.info())
                });
                var g = function (a) {
                    return function () {
                        var b = Array.prototype.slice.call(arguments,
                            0);
                        if (d) return a.apply(null, b)
                    }
                }, h = b.sink(sm.api({
                    forceDrop: k, drop: g(k), move: g(function (a, c) {
                        l.cancel();
                        f.onEvent(a, b)
                    }), delayDrop: g(l.throttle)
                }), c);
                return {
                    element: h.element, go: function (a) {
                        h.start(a);
                        f.on();
                        e.trigger.start()
                    }, on: function () {
                        d = !0
                    }, off: function () {
                        d = !1
                    }, destroy: function () {
                        h.destroy()
                    }, events: e.registry
                }
            }
        }, tj = {
            transform: function (a, b) {
                var c = void 0 !== b ? b : {};
                return O4.setup(a, void 0 !== c.mode ? c.mode : N4, b)
            }
        }, jU = {
            both: function (a) {
                var b = H.create({relocate: p(["x", "y", "deltaX", "deltaY"])});
                return {
                    mutate: function (c,
                                      d) {
                        var e = bb.absolute(a), f = e.left() + c;
                        e = e.top() + d;
                        b.trigger.relocate(f, e, c, d)
                    }, events: b.registry
                }
            }
        }, NE = O("hx", "hy", "position", "x", "y"), P4 = function (a, b, c, d, e, f) {
            f = b.x();
            b = b.y() - c;
            return (b >= a.y() && b <= a.y() + a.h() ? [NE(f, b, "absolute", f, b)] : []).concat([NE(e, a.y(), "fixed", e - d.left(), a.fy())])
        }, Q4 = {
            detect: function (a, b, c, d, e, f) {
                a = P4(a, b, e, f, c, d);
                return qa(a, function (a) {
                    return 10 > Math.abs(d - a.hy()) && 38 > Math.abs(c - a.hx())
                })
            }
        }, OE = {
            box: function (a) {
                var b = bb.absolute(a), c = Ia.getOuter(a);
                a = sa.getOuter(a);
                var d = b.left();
                b = b.top();
                return {x: h(d), y: h(b), width: h(c), height: h(a), right: h(d + c), bottom: h(b + a)}
            }
        }, qt = {resolve: Lb.create("ephox-ego").resolve}, Rn = function (a) {
            var b = "data-" + qt.resolve(a + "-left"), c = "data-" + qt.resolve(a + "-top"),
                d = "data-" + qt.resolve(a + "-position");
            return {
                get: function (a) {
                    var e = parseInt(m.get(a, b), 10), k = parseInt(m.get(a, c), 10);
                    a = m.get(a, d);
                    return isNaN(e) || isNaN(k) ? g.none() : g.some({left: h(e), top: h(k), position: h(a)})
                }, set: function (a, f, k, l) {
                    m.set(a, d, f);
                    m.set(a, b, k + "px");
                    m.set(a, c, l + "px")
                }, clear: function (a) {
                    m.remove(a,
                        d);
                    m.remove(a, b);
                    m.remove(a, c)
                }
            }
        }("pre-snap"), R4 = function (a, b, c, d, e, f) {
            return Rn.get(b).fold(function () {
                return a.fromLocation(b, c, d)
            }, function (c) {
                return a.fromFixed(b, c.left() + e, c.top() + f)
            })
        }, S4 = function (a, b, c, d) {
            var e = A.owner(b);
            e = Za.get(e);
            b = OE.box(b);
            c = c.loc();
            return Q4.detect(a, b, c.left(), c.top(), d, e)
        }, rt = function (a, b, c, d) {
            return {
                attrs: {"data-ephox-snap": "absolute" === b ? "true" : "false"},
                styles: {position: b, left: a.left + c + "px", top: a.top + d + "px"}
            }
        }, sk = {
            move: function (a, b, c, d, e, f) {
                var k = a.graph(), l = a.lazyTheatre(),
                    g = a.lazyHeight();
                c = R4(k, b, c, d, e, f);
                var h = c.loc(), w = c.fixed(), m = {top: 0, left: 0};
                return S4(l, a.container(), c, g).fold(function () {
                    var a = k.boundToFixed(l, b, h.left(), h.top(), w.left(), w.top(), g);
                    Rn.set(b, "fixed", a.left(), a.top());
                    return rt(m, "fixed", a.left(), a.top())
                }, function (c) {
                    var d = k.boundToFixed(l, b, h.left(), h.top(), w.left(), w.top(), g);
                    Rn.set(b, "fixed", d.left(), d.top());
                    d = "absolute" === c.position() ? k.locationToAbsolute(b, c.x(), c.y()) : Ra(c.x(), c.y());
                    a.resetOffset();
                    return rt(m, c.position(), d.left(), d.top())
                })
            },
            getSnapAttrs: rt, forget: function (a) {
                Rn.clear(a)
            }
        }, Hy = {
            none: function (a, b) {
                var c = H.create({dragend: p([]), moved: p([])});
                return {
                    blocker: yb("no blocker"), setState: t, getState: h({}), init: function (d, e) {
                        d = sk.getSnapAttrs(a.getOffset(), "absolute", d, e);
                        v.setAll(b, d.styles);
                        m.setAll(b, d.attrs);
                        c.trigger.moved()
                    }, update: t, destroy: t, events: c.registry
                }
            }, except: function (a) {
                return function (b, c) {
                    var d = iU(c, a.join(",")), e = H.create({dragend: Q([], d.events.dragend), moved: p([])});
                    d.events.relocate.bind(function (a) {
                        var d =
                            a.x(), e = a.y(), f = a.deltaX();
                        a = a.deltaY();
                        d = sk.move(b, c, d, e, f, a);
                        v.setAll(c, d.styles);
                        m.setAll(c, d.attrs)
                    });
                    d.events.dragend.bind(function () {
                        e.trigger.moved()
                    });
                    return {
                        blocker: d.blocker, setState: function (a) {
                            v.setAll(c, a.styles);
                            m.setAll(c, a.attrs)
                        }, getState: function () {
                            var a = bb.viewport(c);
                            return sk.getSnapAttrs(b.getOffset(), "absolute", a.left(), a.top())
                        }, init: function (a, d) {
                            a = sk.getSnapAttrs(b.getOffset(), "absolute", a, d);
                            v.setAll(c, a.styles);
                            m.setAll(c, a.attrs);
                            e.trigger.moved()
                        }, update: function () {
                            sk.forget(c)
                        },
                        destroy: function () {
                            d.destroy()
                        }, events: e.registry
                    }
                }
            }
        }, Dy = {
            isInside: function (a, b, c, d) {
                return !(b > a.y() + a.h() || c - d < a.y())
            }, isAllInside: function (a, b, c) {
                return b > a.y() && b < a.y() + a.h() && c > a.y() && c < a.y() + a.h()
            }
        }, Iy = {
            register: function (a, b, c, d) {
                var e = a.container(), f = c(a, b), k = d(a, b), l = kU();
                c = H.create({
                    dragend: Q([], f.events.dragend),
                    appear: Q(["element"], k.events.appear),
                    disappear: Q(["element"], k.events.disappear),
                    dock: Q([], l.events.dock),
                    undock: Q([], l.events.undock)
                });
                f.events.moved.bind(function () {
                    C();
                    h = !0
                });
                k.events.scrolled.bind(function () {
                    C()
                });
                k.events.appear.bind(function () {
                    var c = a.lazyTheatre(), d = a.graph();
                    l.update(d, c, b, a.lazyHeight, e, a.getOffset())
                });
                var h = !1, C = function () {
                    if (sc.isVisible(b)) {
                        f.update();
                        k.update();
                        var c = a.lazyTheatre(), d = bb.absolute(b);
                        c = Math.max(0, c.x() + c.w() - d.left());
                        v.set(b, "max-width", c + "px")
                    }
                };
                return {
                    blocker: f.blocker, setState: function (a) {
                        f.setState(a);
                        C();
                        h = !0
                    }, state: function () {
                        return h ? g.some(f.getState()) : g.none()
                    }, init: function (b, c, d) {
                        a.setOffset(d);
                        f.init(b, c);
                        C()
                    },
                    update: C, destroy: function () {
                        k.destroy();
                        f.destroy()
                    }, events: c.registry
                }
            }
        }, Gy = {
            transitions: function (a, b) {
                var c = a.container(), d = A.defaultView(b),
                    e = H.create({appear: p(["element"]), disappear: p(["element"]), scrolled: p([])}),
                    f = K.bind(d, "scroll", function () {
                        e.trigger.scrolled()
                    });
                return {
                    update: function () {
                        var d = a.lazyTheatre(), f = a.lazyHeight(), g = OE.box(c);
                        Dy.isInside(d, g.y(), g.bottom(), f) ? e.trigger.appear(b) : e.trigger.disappear(b)
                    }, destroy: function () {
                        f.unbind()
                    }, events: e.registry
                }
            }
        }, Ey = O("fixed", "loc"), mU =
            function (a, b, c, d) {
                b = lU(b);
                var e = {top: 0, left: 0}, f = function (a) {
                    e.top = a.top;
                    e.left = a.left
                };
                return {
                    lazyTheatre: a,
                    graph: h(b),
                    lazyHeight: c,
                    container: h(d),
                    setOffset: f,
                    resetOffset: function () {
                        f({top: -1 * c(), left: 0})
                    },
                    getOffset: function () {
                        return e
                    }
                }
            }, st = B.resolve("drag-show"), PE = B.resolve("fade-container"), qd = {
            width: function (a, b) {
                return v.getRaw(a, "max-width").fold(function () {
                    return A.owner(b).dom().defaultView.innerWidth - bb.absolute(b).left()
                }, function (a) {
                    return parseInt(a, 10)
                })
            }, updateWidth: function (a, b, c) {
                b =
                    0 === c.extra().length ? c.withinWidth() : c.withinWidth() + Ia.getOuter(b.group());
                0 < b && v.set(a, "width", b + "px")
            }, clearWidth: function (a) {
                v.remove(a, "width")
            }, offsetFrom: function (a, b, c, d) {
                b = void 0 !== d.toolbar.offset ? d.toolbar.offset : d.toolbar.sticky ? {left: 0, top: 0} : {
                    left: 0,
                    top: -1 * c
                };
                c = bb.absolute(a.element());
                a = a.isInline() ? {left: c.left(), top: c.top()} : {left: 0, top: 0};
                return {left: a.left + b.left, top: a.top + b.top}
            }, initFade: function (a) {
                n.add(a, st)
            }, fadeIn: function (a, b) {
                z(a, function (a) {
                    n.remove(a, PE)
                });
                n.add(b, st)
            },
            fadeOut: function (a, b) {
                z(a, function (a) {
                    n.add(a, PE)
                });
                n.remove(b, st)
            }
        }, qU = {
            setup: function (a, b, c, d) {
                return (!0 === c.toolbar.draggable ? nU : !0 === c.toolbar.sticky || void 0 !== c.toolbar.offset || a.isInline() ? oU : By)(a, b, c)
            }
        };
    aa.detect();
    var Jy = function (a, b) {
            a.updateUi(b);
            a = [Mg.editorContainer(), "ephox-textbox-font", B.resolve("layer-editor")];
            ma.add(b, a);
            m.set(b, "lang", qf.get());
            Zr.addClasses(b)
        }, T4 = function (a) {
            a = Bf.absolute(a);
            var b = Bf.view();
            a = c3.intersect(a, b);
            return gg(a.x(), a.y(), a.width(), a.height())
        }, $r =
            {
                build: function (a, b, c, d, e, f, k, l) {
                    var g = pU(a, b, c, f, k, l), h = d.tabbed(g);
                    h.init();
                    return {
                        element: g.element,
                        socket: g.socket,
                        viewport: g.viewport,
                        uiContainerParent: g.uiContainerParent,
                        init: function (b, d, k) {
                            d = h.config(a.isInline(), d, e, k);
                            BE.setup(g, f, a, b, c, d);
                            h.loaded()
                        },
                        connect: g.connect,
                        destroy: function () {
                            g.destroy();
                            h.destroy()
                        },
                        displayBanner: g.displayBanner,
                        hideBanner: g.hideBanner,
                        position: g.position,
                        refresh: g.refresh,
                        tabstrip: g.toolbar,
                        state: g.state,
                        dialogContainer: g.dialogContainer
                    }
                }, bounds: function () {
                    var a =
                        function (a) {
                            var b = function () {
                                return g.from(a.bounds()).filter(ck.isPrototypeOf).map(r.fromDom).map(T4).getOrThunk(Bf.view)
                            };
                            return vb(a.bounds) ? b : Bf.view
                        };
                    return aa.detect().deviceType.isTouch() ? h(Bf.view) : a
                }()
            }, DB = {
            settings: function (a) {
                return {
                    onprem: !0,
                    blocktag: {
                        styles: [{rule: "p"}, {rule: "h1"}, {rule: "h2"}, {rule: "h3"}, {rule: "h4"}, {rule: "div"}, {rule: "pre"}],
                        showDocumentStyles: !1,
                        bundled: !0
                    },
                    image: {bundled: !0},
                    imageEdit: {bundled: !0},
                    imageupload: {immediate: !1, bundled: !1},
                    content: {
                        imageExcludes: [],
                        css: a +
                            "/css",
                        tabindex: null,
                        stylesheets: [],
                        documentStyles: "",
                        prettyprint: !0,
                        showDocumentStyles: !1,
                        autoresize: !1
                    },
                    ui: {
                        layout: $r,
                        isFullScreen: !1,
                        toolbar: {draggable: !1, sticky: !1},
                        locale: {},
                        editorName: I.value("debug"),
                        bounds: null,
                        showHelpHint: !1,
                        autoresize: !1
                    },
                    shortcuts: {features: !0},
                    spelling: {bundled: !0, autocorrect: !0, scanView: !0, multilingual: !0, menu: !0},
                    specialchar: {bundled: !0},
                    fileupload: {bundled: !0, allowLocalImages: !0},
                    horizontalrule: {bundled: !0},
                    media: {bundled: !0},
                    mentions: {bundled: !1},
                    registration: {bundled: !1},
                    help: {baseUrl: a + "/html", integration: {}, bundled: !0},
                    draganddrop: {bundled: !0},
                    wordcount: {bundled: !0},
                    formatting: {bundled: !0},
                    alignindent: {bundled: !0},
                    directionality: {bundled: !0},
                    parlance: {bundled: !0, languages: "en_us en_gb es fr de pt zh".split(" ")},
                    font: {faces: [], colors: {custom: !0, buttons: []}, bundled: !0},
                    lists: {bundled: !0},
                    link: {bundled: !0},
                    linkvalidator: {bundled: !1},
                    bookmark: {bundled: !0},
                    removeformat: {bundled: !0},
                    fullscreen: {bundled: !0},
                    editorcontext: {bundled: !0},
                    macros: {allowed: g.none(), bundled: !0},
                    highlighter: {external: [], bundled: !0},
                    table: {colors: {custom: !0, buttons: []}, bundled: !0},
                    contextmenu: {bundled: !0},
                    project: {apiKey: null},
                    smartclipboard: {
                        bundled: !0,
                        copy: {},
                        paste: {
                            forceText: !1,
                            baseUrl: a + "/js",
                            swf: a + "/flash/textboxpaste.swf",
                            officeStyles: "prompt",
                            htmlStyles: "merge",
                            allowLocalImages: !0,
                            enableFlashImport: !0
                        }
                    },
                    resize: {bundled: !0},
                    platform: {
                        toolbar: {items: b3, contextual: ["table-tools", "image-tools"]},
                        allowLocalImages: !0,
                        fillscreen: !1
                    },
                    codeview: {
                        bundled: !0, showButton: !0, mode: "pencil", css: a + "/css",
                        js: a + "/js"
                    },
                    findreplace: {bundled: !0},
                    accessibility: {bundled: !0},
                    plaincodeview: {bundled: !0},
                    embed: {inlineStyles: !0, bundled: !1}
                }
            }, state: function () {
                return {
                    spelling: {words: {}, language: g.none()},
                    undo: {initial: {raw: "", marked: ""}, undo: [], redo: []},
                    profile: {spelling: !1, nativeSpelling: !0, autocorrect: !0, capitalisation: !1, linkpreviews: !1},
                    content: {raw: "", marked: ""},
                    ui: {toolbar: {drag: g.none()}},
                    macros: {customs: {}},
                    filters: {customs: []},
                    laundry: {dirty: !1},
                    linkvalidator: {ignore: [], cache: {}},
                    embed: {cache: {}}
                }
            }
        }, tt =
            O("item", "mode"), ut = function (a, b, c, d) {
            var e = void 0 !== d ? d : tk;
            return a.property().parent(b).map(function (a) {
                return tt(a, e)
            })
        }, tk = function (a, b, c, d) {
            var e = void 0 !== d ? d : di;
            return c.sibling(a, b).map(function (a) {
                return tt(a, e)
            })
        }, di = function (a, b, c, d) {
            var e = void 0 !== d ? d : di;
            a = a.property().children(b);
            return c.first(a).map(function (a) {
                return tt(a, e)
            })
        }, U4 = [{current: ut, next: tk, fallback: g.none()}, {current: tk, next: di, fallback: g.some(ut)}, {
            current: di,
            next: di,
            fallback: g.some(tk)
        }], QE = function (a, b, c, d, e) {
            e = void 0 !==
            e ? e : U4;
            return qa(e, function (a) {
                return a.current === c
            }).bind(function (c) {
                return c.current(a, b, d, c.next).orThunk(function () {
                    return c.fallback.bind(function (c) {
                        return QE(a, b, c, d)
                    })
                })
            })
        }, lh = {backtrack: ut, sidestep: tk, advance: di, go: QE}, Sn = {
            left: function () {
                return {
                    sibling: function (a, b) {
                        return a.query().prevSibling(b)
                    }, first: function (a) {
                        return 0 < a.length ? g.some(a[a.length - 1]) : g.none()
                    }
                }
            }, right: function () {
                return {
                    sibling: function (a, b) {
                        return a.query().nextSibling(b)
                    }, first: function (a) {
                        return 0 < a.length ? g.some(a[0]) :
                            g.none()
                    }
                }
            }
        }, vt = function (a, b, c, d, e, f) {
            return lh.go(a, b, d, e).bind(function (b) {
                return f(b.item()) ? g.none() : c(b.item()) ? g.some(b.item()) : vt(a, b.item(), c, b.mode(), e, f)
            })
        }, Tn = {
            left: function (a, b, c, d) {
                return vt(a, b, c, lh.sidestep, Sn.left(), d)
            }, right: function (a, b, c, d) {
                return vt(a, b, c, lh.sidestep, Sn.right(), d)
            }
        }, RE = function (a, b) {
            return 0 === a.property().children(b).length
        }, SE = function (a, b, c, d) {
            return Tn.left(a, b, c, d)
        }, TE = function (a, b, c, d) {
            return Tn.right(a, b, c, d)
        }, Ca = {
            before: function (a, b, c) {
                return SE(a, b, u(RE,
                    a), c)
            }, after: function (a, b, c) {
                return TE(a, b, u(RE, a), c)
            }, seekLeft: SE, seekRight: TE, walkers: function () {
                return {left: Sn.left, right: Sn.right}
            }, walk: function (a, b, c, d, e) {
                return lh.go(a, b, c, d, e)
            }, backtrack: lh.backtrack, sidestep: lh.sidestep, advance: lh.advance
        }, ei = nb(), wc = {
            gather: function (a, b, c) {
                return Ca.gather(ei, a, b, c)
            }, before: function (a, b) {
                return Ca.before(ei, a, b)
            }, after: function (a, b) {
                return Ca.after(ei, a, b)
            }, seekLeft: function (a, b, c) {
                return Ca.seekLeft(ei, a, b, c)
            }, seekRight: function (a, b, c) {
                return Ca.seekRight(ei,
                    a, b, c)
            }, walkers: function () {
                return Ca.walkers()
            }, walk: function (a, b, c, d) {
                return Ca.walk(ei, a, b, c, d)
            }
        }, UE = function (a) {
            return r.fromDom(a.dom().cloneNode(!0))
        }, wt = function (a, b) {
            b = r.fromTag(b);
            a = m.clone(a);
            m.setAll(b, a);
            return b
        }, Pc = {
            shallow: function (a) {
                return r.fromDom(a.dom().cloneNode(!1))
            }, shallowAs: wt, deep: UE, copy: function (a, b) {
                b = wt(a, b);
                a = A.children(UE(a));
                P.append(b, a);
                return b
            }, mutate: function (a, b) {
                b = wt(a, b);
                y.before(a, b);
                var c = A.children(a);
                P.append(b, c);
                F.remove(a);
                return b
            }
        }, Ny = {
            convertToHeading: function (a,
                                        b) {
                var c = A.owner(a);
                b = r.fromTag(b, c.dom());
                c = A.children(a);
                c = E(c, Pc.deep);
                P.append(b, c);
                c = Y.descendants(b, "b,strong");
                z(c, F.unwrap);
                y.before(a, b);
                F.remove(a);
                return I.value(b)
            }, joinLinks: function (a, b) {
                return wc.seekLeft(b, function (a) {
                    return "a" === D.name(a)
                }, a).fold(function () {
                    return I.value(b)
                }, function (a) {
                    var c = A.children(b);
                    P.append(a, c);
                    F.remove(b);
                    return I.value(a)
                })
            }
        }, VE = O("row", "y"), WE = O("col", "x"), XE = function (a) {
            return bb.absolute(a).left() + Ia.getOuter(a)
        }, YE = function (a) {
            return bb.absolute(a).left()
        },
        ZE = function (a, b) {
            return WE(a, YE(b))
        }, $E = function (a, b) {
            return WE(a, XE(b))
        }, xt = function (a) {
            return bb.absolute(a).top()
        }, yt = function (a, b, c) {
            if (0 === c.length) return [];
            var d = E(c.slice(1), function (b, c) {
                return b.map(function (b) {
                    return a(c, b)
                })
            }), e = c[c.length - 1].map(function (a) {
                return b(c.length - 1, a)
            });
            return d.concat([e])
        }, V4 = {
            delta: ca, positions: u(yt, function (a, b) {
                return VE(a, xt(b))
            }, function (a, b) {
                return VE(a, xt(b) + sa.getOuter(b))
            }), edge: xt
        }, W4 = {delta: ca, edge: YE, positions: u(yt, ZE, $E)}, X4 = {
            delta: function (a,
                             b) {
                return -a
            }, edge: XE, positions: u(yt, $E, ZE)
        }, Wj = {height: V4, rtl: X4, ltr: W4}, $l = {ltr: Wj.ltr, rtl: Wj.rtl}, aF = function (a) {
            return "img" === D.name(a) ? 1 : Ya.getOption(a).fold(function () {
                return A.children(a).length
            }, function (a) {
                return a.length
            })
        }, Y4 = function (a) {
            return Ya.getOption(a).filter(function (a) {
                return 0 !== a.trim().length || -1 < a.indexOf("\u00a0")
            }).isSome()
        }, Z4 = ["img", "br"], wa = {
            getEnd: aF, isEnd: function (a, b) {
                return aF(a) === b
            }, isStart: function (a, b) {
                return 0 === b
            }, isCursorPosition: function (a) {
                return Y4(a) || U(Z4,
                    D.name(a))
            }
        }, $4 = function (a, b) {
            var c = function (a) {
                a = A.children(a);
                for (var d = a.length - 1; 0 <= d; d--) {
                    var f = a[d];
                    if (b(f)) return g.some(f);
                    f = c(f);
                    if (f.isSome()) return f
                }
                return g.none()
            };
            return c(a)
        }, kc = {
            first: function (a) {
                return Ja.descendant(a, wa.isCursorPosition)
            }, last: function (a) {
                return $4(a, wa.isCursorPosition)
            }
        }, zt = function () {
            var a = r.fromTag("td");
            y.append(a, r.fromTag("br"));
            return a
        }, a5 = function (a, b, c) {
            var d = Pc.copy(a, b);
            Ma(c, function (a, b) {
                null === a ? m.remove(d, b) : m.set(d, b, a)
            });
            return d
        }, b5 = function (a) {
            return a
        },
        bF = function (a) {
            return function () {
                return r.fromTag("tr", a.dom())
            }
        }, c5 = function (a, b, c) {
            return kc.first(a).map(function (d) {
                var e = c.join(",");
                d = Y.ancestors(d, e, function (b) {
                    return N.eq(b, a)
                });
                return Eb(d, function (a, b) {
                    b = Pc.shallow(b);
                    m.remove(b, "contenteditable");
                    y.append(a, b);
                    return b
                }, b)
            }).getOr(b)
        }, cF = {
            cellOperations: function (a, b, c) {
                return {
                    row: bF(b), cell: function (b) {
                        var d = A.owner(b.element());
                        d = r.fromTag(D.name(b.element()), d.dom());
                        var f = c.getOr("strong em b i span font h1 h2 h3 h4 h5 h6 p div".split(" "));
                        f = 0 < f.length ? c5(b.element(), d, f) : d;
                        y.append(f, r.fromTag("br"));
                        v.copy(b.element(), d);
                        v.remove(d, "height");
                        1 !== b.colspan() && v.remove(b.element(), "width");
                        a(b.element(), d);
                        return d
                    }, replace: a5, gap: zt
                }
            }, paste: function (a) {
                return {row: bF(a), cell: zt, replace: b5, gap: zt}
            }
        }, Ac = {
            erase: function (a, b, c, d) {
                a = r.fromText("");
                y.after(b, a);
                F.remove(b);
                return g.some(Sc(a, 0, a, 0))
            }, execute: function (a, b, c, d) {
                return function (e, f, k) {
                    var l = d(), h = e.doc().getOrDie();
                    e = My(a.directionAt);
                    var C = g.some([]);
                    h = cF.cellOperations(c,
                        h, C);
                    return b(l, f, k, h, e, t, t).bind(function (a) {
                        return a.cursor().map(function (a) {
                            return Sc(a, 0, a, 0)
                        })
                    })
                }
            }
        }, Xr = {
            only: function (a) {
                var b = g.from(a.dom().documentElement).map(r.fromDom).getOr(a);
                return {parent: h(b), view: h(a), origin: h(Ra(0, 0))}
            }, detached: function (a, b) {
                var c = u(bb.absolute, b);
                return {parent: h(b), view: h(a), origin: c}
            }, body: function (a, b) {
                return {parent: h(b), view: h(a), origin: h(Ra(0, 0))}
            }
        }, dF = function (a, b, c) {
            return a.isInline() ? Xr.detached(a.element(), b.uiContainer()) : Xr.only(c)
        }, Rr = {
            get: dF, fromEngine: function (a) {
                var b =
                    a.content(), c = a.smartview();
                return b.doc().map(function (a) {
                    return dF(b, c, a)
                })
            }
        }, d5 = O("width", "height"), e5 = O("rows", "columns"), f5 = O("row", "column"), g5 = O("x", "y"),
        h5 = O("element", "rowspan", "colspan"), i5 = O("element", "rowspan", "colspan", "isNew"),
        j5 = O("element", "rowspan", "colspan", "row", "column"), k5 = O("element", "cells", "section"),
        l5 = O("element", "isNew"), m5 = O("element", "cells", "section", "isNew"), n5 = O("cells", "section"),
        o5 = O("details", "section"), p5 = O("startRow", "startCol", "finishRow", "finishCol"), Oa = {
            dimensions: d5,
            grid: e5,
            address: f5,
            coords: g5,
            extended: j5,
            detail: h5,
            detailnew: i5,
            rowdata: k5,
            elementnew: l5,
            rowdatanew: m5,
            rowcells: n5,
            rowdetails: o5,
            bounds: p5
        }, At = function (a, b, c) {
            return ia(A.children(a), function (a) {
                return Fa.is(a, b) ? c(a) ? [a] : [] : At(a, b, c)
            })
        }, uk = {
            firstLayer: function (a, b) {
                return At(a, b, h(!0))
            }, filterFirstLayer: At
        }, Bt = function (a, b, c) {
            var d = void 0 !== c ? c : h(!1);
            return d(b) ? g.none() : U(a, D.name(b)) ? g.some(b) : L.ancestor(b, a.join(","), function (a) {
                return Fa.is(a, "table") || d(a)
            })
        }, eF = function (a, b) {
            return A.parent(b).map(function (b) {
                return Y.children(b,
                    a)
            })
        }, q5 = u(eF, "th,td"), r5 = u(eF, "tr"), Ct = function (a, b) {
            return parseInt(m.get(a, b), 10)
        }, sb = {
            cell: function (a, b) {
                return Bt(["td", "th"], a, b)
            }, firstCell: function (a) {
                return L.descendant(a, "th,td")
            }, cells: function (a) {
                return uk.firstLayer(a, "th,td")
            }, neighbourCells: q5, table: function (a, b) {
                return L.closest(a, "table", b)
            }, row: function (a, b) {
                return Bt(["tr"], a, b)
            }, rows: function (a) {
                return uk.firstLayer(a, "tr")
            }, notCell: function (a, b) {
                return Bt(["caption", "tr", "tbody", "tfoot", "thead"], a, b)
            }, neighbourRows: r5, attr: Ct,
            grid: function (a, b, c) {
                b = Ct(a, b);
                a = Ct(a, c);
                return Oa.grid(b, a)
            }
        }, hg = {
            fromTable: function (a) {
                a = sb.rows(a);
                return E(a, function (a) {
                    var b = A.parent(a).map(function (a) {
                        a = D.name(a);
                        return "tfoot" === a || "thead" === a || "tbody" === a ? a : "tbody"
                    }).getOr("tbody"), d = E(sb.cells(a), function (a) {
                        var b = m.has(a, "rowspan") ? parseInt(m.get(a, "rowspan"), 10) : 1,
                            c = m.has(a, "colspan") ? parseInt(m.get(a, "colspan"), 10) : 1;
                        return Oa.detail(a, b, c)
                    });
                    return Oa.rowdata(a, d, b)
                })
            }, fromPastedRows: function (a, b) {
                return E(a, function (a) {
                    var c = E(sb.cells(a),
                        function (a) {
                            var b = m.has(a, "rowspan") ? parseInt(m.get(a, "rowspan"), 10) : 1,
                                c = m.has(a, "colspan") ? parseInt(m.get(a, "colspan"), 10) : 1;
                            return Oa.detail(a, b, c)
                        });
                    return Oa.rowdata(a, c, b.section())
                })
            }
        }, fF = function (a, b) {
            a = ia(a.all(), function (a) {
                return a.cells()
            });
            return ka(a, b)
        }, Ib = {
            generate: function (a) {
                var b = {}, c = [], d = a.length, e = 0;
                z(a, function (a, d) {
                    var f = [];
                    z(a.cells(), function (a, c) {
                        for (c = 0; void 0 !== b[d + "," + c];) c++;
                        for (var k = Oa.extended(a.element(), a.rowspan(), a.colspan(), d, c), l = 0; l < a.colspan(); l++) for (var g =
                            0; g < a.rowspan(); g++) {
                            var h = c + l;
                            b[d + g + "," + h] = k;
                            e = Math.max(e, h + 1)
                        }
                        f.push(k)
                    });
                    c.push(Oa.rowdata(a.element(), f, a.section()))
                });
                a = Oa.grid(d, e);
                return {grid: h(a), access: h(b), all: h(c)}
            }, getAt: function (a, b, c) {
                a = a.access()[b + "," + c];
                return void 0 !== a ? g.some(a) : g.none()
            }, findItem: function (a, b, c) {
                a = fF(a, function (a) {
                    return c(b, a.element())
                });
                return 0 < a.length ? g.some(a[0]) : g.none()
            }, filterItems: fF, justCells: function (a) {
                a = E(a.all(), function (a) {
                    return a.cells()
                });
                return Qb(a)
            }
        }, ke = {
            repeat: function (a, b) {
                for (var c =
                    [], d = 0; d < a; d++) c.push(b(d));
                return c
            }, range: function (a, b) {
                for (var c = []; a < b; a++) c.push(a);
                return c
            }, unique: function (a, b) {
                var c = [];
                z(a, function (d, e) {
                    e < a.length - 1 && !b(d, a[e + 1]) ? c.push(d) : e === a.length - 1 && c.push(d)
                });
                return c
            }, deduce: function (a, b) {
                if (0 > b || b >= a.length - 1) return g.none();
                var c = a[b].fold(function () {
                    var c = kd(a.slice(0, b));
                    return yc(c, function (a, b) {
                        return a.map(function (a) {
                            return {value: a, delta: b + 1}
                        })
                    })
                }, function (a) {
                    return g.some({value: a, delta: 0})
                }), d = a[b + 1].fold(function () {
                    var c = a.slice(b +
                        1);
                    return yc(c, function (a, b) {
                        return a.map(function (a) {
                            return {value: a, delta: b + 1}
                        })
                    })
                }, function (a) {
                    return g.some({value: a, delta: 1})
                });
                return c.bind(function (a) {
                    return d.map(function (b) {
                        return Math.abs(b.value - a.value) / (b.delta + a.delta)
                    })
                })
            }
        }, gF = function (a, b, c) {
            var d = a();
            return qa(d, b).orThunk(function () {
                return g.from(d[0]).orThunk(c)
            }).map(function (a) {
                return a.element()
            })
        }, Un = {
            columns: function (a) {
                var b = a.grid(), c = ke.range(0, b.columns()), d = ke.range(0, b.rows());
                return E(c, function (b) {
                    return gF(function () {
                        return ia(d,
                            function (c) {
                                return Ib.getAt(a, c, b).filter(function (a) {
                                    return a.column() === b
                                }).fold(h([]), function (a) {
                                    return [a]
                                })
                            })
                    }, function (a) {
                        return 1 === a.colspan()
                    }, function () {
                        return Ib.getAt(a, 0, b)
                    })
                })
            }, rows: function (a) {
                var b = a.grid(), c = ke.range(0, b.rows()), d = ke.range(0, b.columns());
                return E(c, function (b) {
                    return gF(function () {
                        return ia(d, function (c) {
                            return Ib.getAt(a, b, c).filter(function (a) {
                                return a.row() === b
                            }).fold(h([]), function (a) {
                                return [a]
                            })
                        })
                    }, function (a) {
                        return 1 === a.rowspan()
                    }, function () {
                        return Ib.getAt(a,
                            b, 0)
                    })
                })
            }
        }, hF = aa.detect(), fi = function (a, b, c) {
            a = v.get(a, b);
            a = parseFloat(a);
            return isNaN(a) ? c : a
        }, s5 = {
            getWidth: function (a) {
                return fi(a, "width", Ia.get(a))
            }, getHeight: function (a) {
                if (hF.browser.isIE() || hF.browser.isEdge()) {
                    var b = fi(a, "padding-top", 0), c = fi(a, "padding-bottom", 0), d = fi(a, "border-top-width", 0),
                        e = fi(a, "border-bottom-width", 0), f = a.dom().getBoundingClientRect().height;
                    a = "border-box" === v.get(a, "box-sizing") ? f : f - b - c - (d + e)
                } else a = fi(a, "height", sa.get(a));
                return a
            }
        }, iF = /(\d+(\.\d+)?)(\w|%)*/, vk = /(\d+(\.\d+)?)%/,
        Dt = /(\d+(\.\d+)?)px|em/, jF = function (a, b) {
            v.set(a, "height", b + "px")
        }, t5 = function (a) {
            return v.getRaw(a, "height").getOrThunk(function () {
                return s5.getHeight(a) + "px"
            })
        }, u5 = function (a, b, c, d) {
            var e = sb.table(a).map(function (a) {
                a = c(a);
                return Math.floor(b / 100 * a)
            }).getOr(b);
            d(a, e);
            return e
        }, Vn = function (a) {
            return v.getRaw(a, "width").fold(function () {
                return g.from(m.get(a, "width"))
            }, function (a) {
                return g.some(a)
            })
        }, pc = {
            percentageBasedSizeRegex: h(vk), pixelBasedSizeRegex: h(Dt), setPixelWidth: function (a, b) {
                v.set(a, "width",
                    b + "px")
            }, setPercentageWidth: function (a, b) {
                v.set(a, "width", b + "%")
            }, setHeight: jF, getPixelWidth: function (a, b) {
                return Vn(a).fold(function () {
                    return Ia.get(a)
                }, function (c) {
                    Dt.test(c) ? (c = Dt.exec(c), c = parseInt(c[1], 10)) : vk.test(c) ? (c = vk.exec(c), c = parseFloat(c[1]) / 100 * b.pixelWidth()) : c = Ia.get(a);
                    return c
                })
            }, getPercentageWidth: function (a, b) {
                return Vn(a).fold(function () {
                    return Ia.get(a) / b.pixelWidth() * 100
                }, function (c) {
                    vk.test(c) ? (c = vk.exec(c), c = parseFloat(c[1])) : c = Ia.get(a) / b.pixelWidth() * 100;
                    return c
                })
            }, getGenericWidth: function (a) {
                return Vn(a).bind(function (a) {
                    return iF.test(a) ?
                        (a = iF.exec(a), g.some({width: h(a[1]), unit: h(a[3])})) : g.none()
                })
            }, setGenericWidth: function (a, b, c) {
                v.set(a, "width", b + c)
            }, getHeight: function (a) {
                var b;
                if (b = t5(a)) {
                    var c = sa.get, d = parseInt(b, 10);
                    b = je(b, "%") && "table" !== D.name(a) ? u5(a, d, c, jF) : d
                } else b = sa.get(a);
                a = m.has(a, "rowspan") ? parseInt(m.get(a, "rowspan"), 10) : 1;
                return b / a
            }, getRawWidth: Vn
        }, kF = function (a, b) {
            return m.has(a, b) && 1 < parseInt(m.get(a, b), 10)
        }, Qd = {
            hasColspan: function (a) {
                return kF(a, "colspan")
            }, hasRowspan: function (a) {
                return kF(a, "rowspan")
            }, minWidth: h(10),
            minHeight: h(10), getInt: function (a, b) {
                return parseInt(v.get(a, b), 10)
            }
        }, lF = function (a, b, c) {
            return v.getRaw(a, b).fold(function () {
                return c(a) + "px"
            }, function (a) {
                return a
            })
        }, v5 = function (a) {
            return lF(a, "width", pc.getPixelWidth)
        }, w5 = function (a) {
            return lF(a, "height", pc.getHeight)
        }, Et = function (a, b, c, d, e) {
            a = Un.columns(a);
            var f = E(a, function (a) {
                return a.map(b.edge)
            });
            return E(a, function (a, b) {
                return a.filter(zf(Qd.hasColspan)).fold(function () {
                    var a = ke.deduce(f, b);
                    return d(a)
                }, function (a) {
                    return c(a, e)
                })
            })
        }, mF =
            function (a) {
                return a.map(function (a) {
                    return a + "px"
                }).getOr("")
            }, nF = function (a, b, c, d) {
            a = Un.rows(a);
            var e = E(a, function (a) {
                return a.map(b.edge)
            });
            return E(a, function (a, b) {
                return a.filter(zf(Qd.hasRowspan)).fold(function () {
                    var a = ke.deduce(e, b);
                    return d(a)
                }, function (a) {
                    return c(a)
                })
            })
        }, wk = {
            getRawWidths: function (a, b) {
                return Et(a, b, v5, mF)
            }, getPixelWidths: function (a, b, c) {
                return Et(a, b, pc.getPixelWidth, function (a) {
                    return a.getOrThunk(c.minCellWidth)
                }, c)
            }, getPercentageWidths: function (a, b, c) {
                return Et(a, b, pc.getPercentageWidth,
                    function (a) {
                        return a.fold(function () {
                            return c.minCellWidth()
                        }, function (a) {
                            return a / c.pixelWidth() * 100
                        })
                    }, c)
            }, getPixelHeights: function (a, b) {
                return nF(a, b, pc.getHeight, function (a) {
                    return a.getOrThunk(Qd.minHeight)
                })
            }, getRawHeights: function (a, b) {
                return nF(a, b, w5, mF)
            }
        }, Wn = ta.generate([{invalid: ["raw"]}, {pixels: ["value"]}, {percent: ["value"]}]), oF = function (a, b, c) {
            a = c.substring(0, c.length - a.length);
            var d = parseFloat(a);
            return a === d.toString() ? b(d) : Wn.invalid(c)
        }, mh = function (a) {
            return je(a, "%") ? oF("%", Wn.percent,
                a) : je(a, "px") ? oF("px", Wn.pixels, a) : Wn.invalid(a)
        }, x5 = function (a, b) {
            return E(a, function (a) {
                return mh(a).fold(function () {
                    return a
                }, function (a) {
                    return a / b * 100 + "%"
                }, function (a) {
                    return a + "%"
                })
            })
        }, y5 = function (a, b, c) {
            var d = c / b;
            return E(a, function (a) {
                return mh(a).fold(function () {
                    return a
                }, function (a) {
                    return a * d + "px"
                }, function (a) {
                    return a / 100 * c + "px"
                })
            })
        }, z5 = function (a, b) {
            a = a.fold(function () {
                return h("")
            }, function (a) {
                return h(a / b + "px")
            }, function (a) {
                return h(a / b + "px")
            });
            return ke.repeat(b, a)
        }, A5 = function (a,
                          b, c) {
            return a.fold(function () {
                return b
            }, function (a) {
                return y5(b, c, a)
            }, function (a) {
                return x5(b, c)
            })
        }, pF = function (a, b) {
            var c = Math.floor(a);
            return {value: c + b, remainder: a - c}
        }, B5 = function (a, b) {
            return mh(a).fold(h(a), function (a) {
                return a + b + "px"
            }, function (a) {
                return a + b + "%"
            })
        }, qF = function (a) {
            if (0 === a.length) return a;
            a = Eb(a, function (a, b) {
                var c = mh(b).fold(function () {
                    return {value: b, remainder: 0}
                }, function (a) {
                    return pF(a, "px")
                }, function (a) {
                    return pF(a, "%")
                });
                return {
                    output: [c.value].concat(a.output), remainder: a.remainder +
                        c.remainder
                }
            }, {output: [], remainder: 0});
            var b = a.output;
            return b.slice(0, b.length - 1).concat([B5(b[b.length - 1], Math.round(a.remainder))])
        }, xk = {
            validate: mh, redistribute: function (a, b, c) {
                c = mh(c);
                a = ob(a, function (a) {
                    return "0px" === a
                }) ? z5(c, a.length) : A5(c, a, b);
                return qF(a)
            }, sum: function (a, b) {
                return 0 === a.length ? b : Eb(a, function (a, b) {
                    return mh(b).fold(h(0), ca, ca) + a
                }, 0)
            }, toIntegers: qF
        }, C5 = function (a, b, c) {
            z(b, function (b) {
                var d = a.slice(b.column(), b.colspan() + b.column());
                d = xk.sum(d, Qd.minWidth());
                v.set(b.element(),
                    "width", d + c)
            })
        }, D5 = function (a, b, c, d) {
            z(c, function (b) {
                var c = a.slice(b.row(), b.rowspan() + b.row());
                c = xk.sum(c, Qd.minHeight());
                v.set(b.element(), "height", c + d)
            });
            z(b, function (b, c) {
                v.set(b.element(), "height", a[c])
            })
        }, rF = function (a) {
            return xk.validate(a).fold(h("px"), h("px"), h("%"))
        }, E5 = {
            redistribute: function (a, b, c, d) {
                var e = hg.fromTable(a), f = Ib.generate(e), k = f.all(), l = Ib.justCells(f);
                b.each(function (b) {
                    var c = rF(b), e = Ia.get(a), k = wk.getRawWidths(f, d);
                    e = xk.redistribute(k, e, b);
                    C5(e, l, c);
                    v.set(a, "width", b)
                });
                c.each(function (b) {
                    var c = rF(b), d = sa.get(a), e = wk.getRawHeights(f, Wj.height);
                    d = xk.redistribute(e, d, b);
                    D5(d, k, l, c);
                    v.set(a, "height", b)
                })
            }
        }, F5 = function (a) {
            var b = m.has(a, "colspan") ? parseInt(m.get(a, "colspan"), 10) : 1,
                c = m.has(a, "rowspan") ? parseInt(m.get(a, "rowspan"), 10) : 1;
            return {element: h(a), colspan: h(b), rowspan: h(c)}
        }, Ft = xd(["cell", "row", "replace", "gap"]), cc = {
            modification: function (a, b) {
                Ft(a);
                var c = na(g.none()), d = void 0 !== b ? b : F5, e = function (b) {
                    var e = d(b);
                    e = a.cell(e);
                    c.get().isNone() && c.set(g.some(e));
                    f = g.some({
                        item: b,
                        replacement: e
                    });
                    return e
                }, f = g.none();
                return {
                    getOrInit: function (a, b) {
                        return f.fold(function () {
                            return e(a)
                        }, function (c) {
                            return b(a, c.item) ? c.replacement : e(a)
                        })
                    }, cursor: c.get
                }
            }, transform: function (a, b) {
                return function (c) {
                    var d = na(g.none());
                    Ft(c);
                    var e = [], f = function (a, b) {
                        return qa(e, function (c) {
                            return b(c.item, a)
                        })
                    }, k = function (f) {
                        var k = c.replace(f, b, {scope: a});
                        e.push({item: f, sub: k});
                        d.get().isNone() && d.set(g.some(k));
                        return k
                    };
                    return {
                        replaceOrInit: function (a, b) {
                            return f(a, b).fold(function () {
                                    return k(a)
                                },
                                function (c) {
                                    return b(a, c.item) ? c.sub : k(a)
                                })
                        }, cursor: d.get
                    }
                }
            }, merging: function (a) {
                Ft(a);
                var b = na(g.none());
                return {
                    combine: function (c) {
                        b.get().isNone() && b.set(g.some(c));
                        return function () {
                            var b = a.cell({element: h(c), colspan: h(1), rowspan: h(1)});
                            v.remove(b, "width");
                            v.remove(c, "width");
                            return b
                        }
                    }, cursor: b.get
                }
            }
        },
        G5 = "body p div article aside figcaption figure footer header nav section ol ul table thead tfoot tbody caption tr td th h1 h2 h3 h4 h5 h6 blockquote pre address".split(" "),
        sF = function (a, b) {
            a = a.property().name(b);
            return U(G5, a)
        }, tF = function (a, b) {
            return U(["br", "img", "hr", "input"], a.property().name(b))
        }, Nc = {
            isBlock: sF, isList: function (a, b) {
                a = a.property().name(b);
                return U(["ol", "ul"], a)
            }, isFormatting: function (a, b) {
                a = a.property().name(b);
                return U("address pre p h1 h2 h3 h4 h5 h6".split(" "), a)
            }, isHeading: function (a, b) {
                a = a.property().name(b);
                return U("h1 h2 h3 h4 h5 h6".split(" "), a)
            }, isContainer: function (a, b) {
                return U("div li td th blockquote body caption".split(" "), a.property().name(b))
            }, isEmptyTag: tF, isFrame: function (a,
                                                  b) {
                return "iframe" === a.property().name(b)
            }, isInline: function (a, b) {
                return !(sF(a, b) || tF(a, b)) && "li" !== a.property().name(b)
            }
        }, ig = nb(), pa = {
            isBlock: function (a) {
                return Nc.isBlock(ig, a)
            }, isList: function (a) {
                return Nc.isList(ig, a)
            }, isFormatting: function (a) {
                return Nc.isFormatting(ig, a)
            }, isHeading: function (a) {
                return Nc.isHeading(ig, a)
            }, isContainer: function (a) {
                return Nc.isContainer(ig, a)
            }, isEmptyTag: function (a) {
                return Nc.isEmptyTag(ig, a)
            }, isFrame: function (a) {
                return Nc.isFrame(ig, a)
            }, isInline: function (a) {
                return Nc.isInline(ig,
                    a)
            }
        }, H5 = {
            merge: function (a) {
                var b = function (a) {
                    return ob(a, function (a) {
                        return "br" === D.name(a) || D.isText(a) && 0 === Ya.get(a).trim().length
                    })
                }, c = function (a) {
                    return A.nextSibling(a).map(function (a) {
                        if (pa.isBlock(a)) return !0;
                        if (pa.isEmptyTag(a)) return "img" === D.name(a) ? !1 : !0
                    }).getOr(!1)
                }, d = function (a) {
                    return kc.last(a).bind(function (b) {
                        var d = c(b);
                        return A.parent(b).map(function (c) {
                            var e;
                            (e = !0 === d) || (e = "li" === D.name(c) || Ja.ancestor(c, pa.isList).isSome());
                            return e || "br" === D.name(b) || pa.isBlock(c) && !N.eq(a, c) ?
                                [] : [r.fromTag("br")]
                        })
                    }).getOr([])
                }, e = function () {
                    var c = ia(a, function (a) {
                        var c = A.children(a);
                        return b(c) ? [] : c.concat(d(a))
                    });
                    return 0 === c.length ? [r.fromTag("br")] : c
                }();
                F.empty(a[0]);
                P.append(a[0], e)
            }
        }, uF = function (a, b) {
            return Oa.rowcells(b, a.section())
        }, vF = function (a, b) {
            return a.cells()[b]
        }, Ka = {
            addCell: function (a, b, c) {
                var d = a.cells(), e = d.slice(0, b);
                b = d.slice(b);
                c = e.concat([c]).concat(b);
                return uF(a, c)
            }, setCells: uF, mutateCell: function (a, b, c) {
                a.cells()[b] = c
            }, getCell: vF, getCellElement: function (a, b) {
                return vF(a,
                    b).element()
            }, mapCells: function (a, b) {
                var c = a.cells();
                b = E(c, b);
                return Oa.rowcells(b, a.section())
            }, cellLength: function (a) {
                return a.cells().length
            }
        }, I5 = function (a, b) {
            return E(a, function (a) {
                return Ka.getCell(a, b)
            })
        }, wF = function (a, b) {
            if (0 === a.length) return 0;
            var c = a[0];
            return Va(a, function (a) {
                return !b(c.element(), a.element())
            }).fold(function () {
                return a.length
            }, function (a) {
                return a
            })
        }, J5 = {
            subgrid: function (a, b, c, d) {
                var e = a[b].cells().slice(c);
                e = wF(e, d);
                a = I5(a, c).slice(b);
                d = wF(a, d);
                return {colspan: h(e), rowspan: h(d)}
            }
        },
        Xn = {
            toDetails: function (a, b) {
                var c = E(a, function (a, b) {
                    return E(a.cells(), function (a, b) {
                        return !1
                    })
                });
                return E(a, function (d, e) {
                    var f = ia(d.cells(), function (d, f) {
                        if (!1 === c[e][f]) {
                            for (var k = J5.subgrid(a, e, f, b), l = k.rowspan(), g = k.colspan(), h = e; h < e + l; h++) for (var m = f; m < f + g; m++) c[h][m] = !0;
                            return [Oa.detailnew(d.element(), k.rowspan(), k.colspan(), d.isNew())]
                        }
                        return []
                    });
                    return Oa.rowdetails(f, d.section())
                })
            }, toGrid: function (a, b, c) {
                for (var d = [], e = 0; e < a.grid().rows(); e++) {
                    for (var f = [], k = 0; k < a.grid().columns(); k++) {
                        var l =
                            Ib.getAt(a, e, k).map(function (a) {
                                return Oa.elementnew(a.element(), c)
                            }).getOrThunk(function () {
                                return Oa.elementnew(b.gap(), !0)
                            });
                        f.push(l)
                    }
                    f = Oa.rowcells(f, a.all()[e].section());
                    d.push(f)
                }
                return d
            }
        }, Yn = function (a, b, c, d) {
            c === d ? m.remove(a, b) : m.set(a, b, c)
        }, K5 = {
            render: function (a, b) {
                var c = [], d = [], e = function (b, e) {
                    var f = L.child(a, e).getOrThunk(function () {
                        var b = r.fromTag(e, A.owner(a).dom());
                        y.append(a, b);
                        return b
                    });
                    F.empty(f);
                    b = E(b, function (a) {
                        a.isNew() && c.push(a.element());
                        var b = a.element();
                        F.empty(b);
                        z(a.cells(),
                            function (a) {
                                a.isNew() && d.push(a.element());
                                Yn(a.element(), "colspan", a.colspan(), 1);
                                Yn(a.element(), "rowspan", a.rowspan(), 1);
                                y.append(b, a.element())
                            });
                        return b
                    });
                    P.append(f, b)
                }, f = function (b, c) {
                    0 < b.length ? e(b, c) : L.child(a, c).each(F.remove)
                }, k = [], l = [], g = [];
                z(b, function (a) {
                    switch (a.section()) {
                        case "thead":
                            k.push(a);
                            break;
                        case "tbody":
                            l.push(a);
                            break;
                        case "tfoot":
                            g.push(a)
                    }
                });
                f(k, "thead");
                f(l, "tbody");
                f(g, "tfoot");
                return {newRows: h(c), newCells: h(d)}
            }, copy: function (a) {
                return E(a, function (a) {
                    var b = Pc.shallow(a.element());
                    z(a.cells(), function (a) {
                        var c = Pc.deep(a.element());
                        Yn(c, "colspan", a.colspan(), 1);
                        Yn(c, "rowspan", a.rowspan(), 1);
                        y.append(b, c)
                    });
                    return b
                })
            }
        }, xF = {
            col: function (a, b, c, d, e) {
                var f = r.fromTag("div");
                v.setAll(f, {
                    position: "absolute",
                    left: b - d / 2 + "px",
                    top: c + "px",
                    height: e + "px",
                    width: d + "px"
                });
                m.setAll(f, {"data-column": a, role: "presentation"});
                return f
            }, row: function (a, b, c, d, e) {
                var f = r.fromTag("div");
                v.setAll(f, {
                    position: "absolute",
                    left: b + "px",
                    top: c - e / 2 + "px",
                    height: e + "px",
                    width: d + "px"
                });
                m.setAll(f, {"data-row": a, role: "presentation"});
                return f
            }
        }, vd = {resolve: Dn("ephox-snooker").resolve}, Gt = vd.resolve("resizer-bar"), yF = vd.resolve("resizer-rows"),
        zF = vd.resolve("resizer-cols"), AF = function (a) {
            a = Y.descendants(a.parent(), "." + Gt);
            z(a, F.remove)
        }, BF = function (a, b, c) {
            var d = a.origin();
            z(b, function (b, f) {
                b.each(function (b) {
                    b = c(d, b);
                    n.add(b, Gt);
                    y.append(a.parent(), b)
                })
            })
        }, L5 = function (a, b, c, d) {
            BF(a, b, function (a, b) {
                a = xF.col(b.col(), b.x() - a.left(), c.top() - a.top(), 7, d);
                n.add(a, zF);
                return a
            })
        }, M5 = function (a, b, c, d) {
            BF(a, b, function (a, b) {
                a = xF.row(b.row(),
                    c.left() - a.left(), b.y() - a.top(), d, 7);
                n.add(a, yF);
                return a
            })
        }, CF = function (a, b) {
            a = Y.descendants(a.parent(), "." + Gt);
            z(a, b)
        }, Fe = {
            refresh: function (a, b, c, d) {
                AF(a);
                var e = hg.fromTable(b);
                e = Ib.generate(e);
                var f = Un.rows(e), k = Un.columns(e);
                e = bb.absolute(b);
                c = 0 < f.length ? c.positions(f, b) : [];
                M5(a, c, e, Ia.getOuter(b));
                d = 0 < k.length ? d.positions(k, b) : [];
                L5(a, d, e, sa.getOuter(b))
            }, hide: function (a) {
                CF(a, function (a) {
                    v.set(a, "display", "none")
                })
            }, show: function (a) {
                CF(a, function (a) {
                    v.set(a, "display", "block")
                })
            }, destroy: AF,
            isRowBar: function (a) {
                return n.has(a, yF)
            }, isColBar: function (a) {
                return n.has(a, zF)
            }
        }, N5 = function (a, b) {
            var c = function (a) {
                return yc(a, function (a) {
                    return A.parent(a.element()).map(function (a) {
                        var b = A.parent(a).isNone();
                        return Oa.elementnew(a, b)
                    })
                }).getOrThunk(function () {
                    return Oa.elementnew(b.row(), !0)
                })
            };
            return E(a, function (a) {
                var b = c(a.details());
                return Oa.rowdatanew(b.element(), a.details(), a.section(), b.isNew())
            })
        }, DF = function (a, b) {
            a = Xn.toDetails(a, N.eq);
            return N5(a, b)
        }, Zn = function (a, b) {
            a = Qb(E(a.all(),
                function (a) {
                    return a.cells()
                }));
            return qa(a, function (a) {
                return N.eq(b, a.element())
            })
        }, Pa = {
            run: function (a, b, c, d, e) {
                return function (f, k, l, q, C) {
                    var w = hg.fromTable(k), m = Ib.generate(w);
                    return b(m, l).map(function (b) {
                        var c = Xn.toGrid(m, q, !1);
                        b = a(c, b, N.eq, e(q));
                        c = DF(b.grid(), q);
                        return {grid: h(c), cursor: b.cursor}
                    }).fold(function () {
                        return g.none()
                    }, function (a) {
                        var b = K5.render(k, a.grid());
                        c(k, a.grid(), C);
                        d(k);
                        Fe.refresh(f, k, Wj.height, C);
                        return g.some({cursor: a.cursor, newRows: b.newRows, newCells: b.newCells})
                    })
                }
            },
            toDetailList: DF, onCell: function (a, b) {
                return sb.cell(b.element()).bind(function (b) {
                    return Zn(a, b)
                })
            }, onCells: function (a, b) {
                b = E(b.selection(), function (b) {
                    return sb.cell(b).bind(function (b) {
                        return Zn(a, b)
                    })
                });
                b = ee(b);
                return 0 < b.length ? g.some(b) : g.none()
            }, onPaste: function (a, b) {
                return sb.cell(b.element()).bind(function (c) {
                    return Zn(a, c).map(function (a) {
                        return ua(a, {generators: b.generators, clipboard: b.clipboard})
                    })
                })
            }, onPasteRows: function (a, b) {
                var c = E(b.selection(), function (b) {
                    return sb.cell(b).bind(function (b) {
                        return Zn(a,
                            b)
                    })
                });
                c = ee(c);
                return 0 < c.length ? g.some(ua({cells: c}, {generators: b.generators, clipboard: b.clipboard})) : g.none()
            }, onMergable: function (a, b) {
                return b.mergable()
            }, onUnmergable: function (a, b) {
                return b.unmergable()
            }
        }, EF = function (a, b) {
            return E(a, function () {
                return Oa.elementnew(b.cell(), !0)
            })
        }, O5 = function (a, b, c) {
            return a.concat(ke.repeat(b, function (b) {
                return Ka.setCells(a[a.length - 1], EF(a[a.length - 1].cells(), c))
            }))
        }, P5 = function (a, b, c) {
            return E(a, function (a) {
                return Ka.setCells(a, a.cells().concat(EF(ke.range(0,
                    b), c)))
            })
        }, gi = {
            measure: function (a, b, c) {
                if (a.row() >= b.length || a.column() > Ka.cellLength(b[0])) return I.error("invalid start address out of table bounds, row: " + a.row() + ", column: " + a.column());
                b = b.slice(a.row());
                a = b[0].cells().slice(a.column());
                var d = Ka.cellLength(c[0]);
                return I.value({rowDelta: h(b.length - c.length), colDelta: h(a.length - d)})
            }, measureWidth: function (a, b) {
                a = Ka.cellLength(a[0]);
                b = Ka.cellLength(b[0]);
                return {rowDelta: h(0), colDelta: h(a - b)}
            }, tailor: function (a, b, c) {
                var d = 0 > b.colDelta() ? P5 : ca,
                    e = 0 > b.rowDelta() ? O5 : ca;
                a = d(a, Math.abs(b.colDelta()), c);
                return e(a, Math.abs(b.rowDelta()), c)
            }
        }, Q5 = function (a, b) {
            return hb(a, function (a, d) {
                return Xa(a, function (a) {
                    return b(a.element(), d.element())
                }) ? a : a.concat([d])
            }, [])
        }, $n = {
            merge: function (a, b, c, d) {
                if (0 === a.length) return a;
                for (c = b.startRow(); c <= b.finishRow(); c++) for (var e = b.startCol(); e <= b.finishCol(); e++) Ka.mutateCell(a[c], e, Oa.elementnew(d(), !1));
                return a
            }, unmerge: function (a, b, c, d) {
                for (var e = !0, f = 0; f < a.length; f++) for (var k = 0; k < Ka.cellLength(a[0]); k++) {
                    var l =
                        Ka.getCellElement(a[f], k);
                    l = c(l, b);
                    !0 === l && !1 === e ? Ka.mutateCell(a[f], k, Oa.elementnew(d(), !0)) : !0 === l && (e = !1)
                }
                return a
            }, splitRows: function (a, b, c, d) {
                if (0 < b && b < a.length) {
                    var e = a[b - 1].cells();
                    e = Q5(e, c);
                    z(e, function (e) {
                        for (var f = g.none(), l = b; l < a.length; l++) for (var h = 0; h < Ka.cellLength(a[0]); h++) {
                            var C = a[l].cells()[h];
                            c(C.element(), e.element()) && (f.isNone() && (f = g.some(d())), f.each(function (b) {
                                Ka.mutateCell(a[l], h, Oa.elementnew(b, !0))
                            }))
                        }
                    })
                }
                return a
            }
        }, Ht = {
            merge: function (a, b, c, d, e) {
                return gi.measure(a, b, c).map(function (f) {
                    f =
                        gi.tailor(b, f, d);
                    var k = a.row(), l = a.column(), g = c.length, h = Ka.cellLength(c[0]);
                    g = k + g;
                    h = l + h;
                    for (var w = k; w < g; w++) for (var m = l; m < h; m++) {
                        var n = f, p = w, r = m, t = e, v = Ka.getCell(n[p], r);
                        t = u(t, v.element());
                        v = n[p];
                        1 < n.length && 1 < Ka.cellLength(v) && (0 < r && t(Ka.getCellElement(v, r - 1)) || r < v.length - 1 && t(Ka.getCellElement(v, r + 1)) || 0 < p && t(Ka.getCellElement(n[p - 1], r)) || p < n.length - 1 && t(Ka.getCellElement(n[p + 1], r))) && $n.unmerge(f, Ka.getCellElement(f[w], m), e, d.cell);
                        n = Ka.getCellElement(c[w - k], m - l);
                        n = d.replace(n);
                        Ka.mutateCell(f[w],
                            m, Oa.elementnew(n, !0))
                    }
                    return f
                })
            }, insert: function (a, b, c, d, e) {
                $n.splitRows(b, a, e, d.cell);
                e = gi.measureWidth(c, b);
                c = gi.tailor(c, e, d);
                e = gi.measureWidth(b, c);
                b = gi.tailor(b, e, d);
                return b.slice(0, a).concat(c).concat(b.slice(a, b.length))
            }
        }, Sd = {
            insertRowAt: function (a, b, c, d, e) {
                var f = a.slice(0, b), k = a.slice(b);
                c = Ka.mapCells(a[c], function (c, f) {
                    return 0 < b && b < a.length && d(Ka.getCellElement(a[b - 1], f), Ka.getCellElement(a[b], f)) ? Ka.getCell(a[b], f) : Oa.elementnew(e(c.element(), d), !0)
                });
                return f.concat([c]).concat(k)
            },
            insertColumnAt: function (a, b, c, d, e) {
                return E(a, function (a) {
                    var f = 0 < b && b < Ka.cellLength(a) && d(Ka.getCellElement(a, b - 1), Ka.getCellElement(a, b)) ? Ka.getCell(a, b) : Oa.elementnew(e(Ka.getCellElement(a, c), d), !0);
                    return Ka.addCell(a, b, f)
                })
            }, splitCellIntoColumns: function (a, b, c, d, e) {
                var f = c + 1;
                return E(a, function (a, l) {
                    l = l === b ? Oa.elementnew(e(Ka.getCellElement(a, c), d), !0) : Ka.getCell(a, c);
                    return Ka.addCell(a, f, l)
                })
            }, splitCellIntoRows: function (a, b, c, d, e) {
                var f = b + 1, k = a.slice(0, f);
                f = a.slice(f);
                a = Ka.mapCells(a[b], function (a,
                                                b) {
                    return b === c ? Oa.elementnew(e(a.element(), d), !0) : a
                });
                return k.concat([a]).concat(f)
            }, deleteRowsAt: function (a, b, c) {
                return a.slice(0, b).concat(a.slice(c + 1))
            }, deleteColumnsAt: function (a, b, c) {
                a = E(a, function (a) {
                    var d = a.cells().slice(0, b).concat(a.cells().slice(c + 1));
                    return Oa.rowcells(d, a.section())
                });
                return ka(a, function (a) {
                    return 0 < a.cells().length
                })
            }
        }, FF = function (a, b, c, d) {
            var e = function (a) {
                return Xa(b, function (b) {
                    return c(a.element(), b.element())
                })
            };
            return E(a, function (a) {
                return Ka.mapCells(a, function (a) {
                    return e(a) ?
                        Oa.elementnew(d(a.element(), c), !0) : a
                })
            })
        }, GF = function (a, b, c, d) {
            return void 0 !== Ka.getCellElement(a[b], c) && 0 < b && d(Ka.getCellElement(a[b - 1], c), Ka.getCellElement(a[b], c))
        }, HF = function (a, b, c) {
            return 0 < b && c(Ka.getCellElement(a, b - 1), Ka.getCellElement(a, b))
        }, ao = {
            replaceColumn: function (a, b, c, d) {
                var e = ia(a, function (d, e) {
                    return GF(a, e, b, c) || HF(d, b, c) ? [] : [Ka.getCell(d, b)]
                });
                return FF(a, e, c, d)
            }, replaceRow: function (a, b, c, d) {
                var e = a[b], f = ia(e.cells(), function (d, f) {
                    return GF(a, b, f, c) || HF(e, f, c) ? [] : [d]
                });
                return FF(a,
                    f, c, d)
            }
        }, hi = {
            none: function () {
                return {
                    fold: function (a, b, c, d, e) {
                        return a()
                    }
                }
            }, only: function (a) {
                return {
                    fold: function (b, c, d, e, f) {
                        return c(a)
                    }
                }
            }, left: function (a, b) {
                return {
                    fold: function (c, d, e, f, k) {
                        return e(a, b)
                    }
                }
            }, middle: function (a, b, c) {
                return {
                    fold: function (d, e, f, k, l) {
                        return k(a, b, c)
                    }
                }
            }, right: function (a, b) {
                return {
                    fold: function (c, d, e, f, k) {
                        return k(a, b)
                    }
                }
            }
        }, R5 = function (a, b) {
            return 0 === a.length ? hi.none() : 1 === a.length ? hi.only(0) : 0 === b ? hi.left(0, 1) : b === a.length - 1 ? hi.right(b - 1, b) : 0 < b && b < a.length - 1 ? hi.middle(b -
                1, b, b + 1) : hi.none()
        }, S5 = {
            determine: function (a, b, c, d) {
                var e = a.slice(0);
                a = R5(a, b);
                var f = function (a) {
                    return E(a, h(0))
                };
                b = h(f(e));
                var k = function (a, b) {
                    if (0 <= c) {
                        var k = Math.max(d.minCellWidth(), e[b] - c);
                        return f(e.slice(0, a)).concat([c, k - e[b]]).concat(f(e.slice(b + 1)))
                    }
                    k = Math.max(d.minCellWidth(), e[a] + c);
                    var l = e[a] - k;
                    return f(e.slice(0, a)).concat([k - e[a], l]).concat(f(e.slice(b + 1)))
                };
                return a.fold(b, function (a) {
                    return d.singleColumnWidth(e[a], c)
                }, k, function (a, b, c) {
                    return k(b, c)
                }, function (a, b) {
                    if (0 <= c) return f(e.slice(0,
                        b)).concat([c]);
                    a = Math.max(d.minCellWidth(), e[b] + c);
                    return f(e.slice(0, b)).concat([a - e[b]])
                })
            }
        }, IF = function (a, b, c) {
            for (var d = 0; a < b; a++) d += void 0 !== c[a] ? c[a] : 0;
            return d
        }, bo = {
            recalculateWidth: function (a, b) {
                a = Ib.justCells(a);
                return E(a, function (a) {
                    var c = IF(a.column(), a.column() + a.colspan(), b);
                    return {element: a.element, width: h(c), colspan: a.colspan}
                })
            }, recalculateHeight: function (a, b) {
                a = Ib.justCells(a);
                return E(a, function (a) {
                    var c = IF(a.row(), a.row() + a.rowspan(), b);
                    return {element: a.element, height: h(c), rowspan: a.rowspan}
                })
            },
            matchRowHeight: function (a, b) {
                return E(a.all(), function (a, d) {
                    return {element: a.element, height: h(b[d])}
                })
            }
        }, T5 = function (a, b) {
            var c = parseFloat(a), d = Ia.get(b);
            return {
                width: h(c), pixelWidth: h(d), getWidths: wk.getPercentageWidths, getCellDelta: function (a) {
                    return a / d * 100
                }, singleColumnWidth: function (a, b) {
                    return [100 - a]
                }, minCellWidth: function () {
                    return Qd.minWidth() / d * 100
                }, setElementWidth: pc.setPercentageWidth, setTableWidth: function (a, b, d) {
                    pc.setPercentageWidth(a, c + d)
                }
            }
        }, It = function (a) {
            a = parseInt(a, 10);
            var b = ca;
            return {
                width: h(a),
                pixelWidth: h(a),
                getWidths: wk.getPixelWidths,
                getCellDelta: b,
                singleColumnWidth: function (a, b) {
                    return [Math.max(Qd.minWidth(), a + b) - a]
                },
                minCellWidth: Qd.minWidth,
                setElementWidth: pc.setPixelWidth,
                setTableWidth: function (a, b, e) {
                    b = Eb(b, function (a, b) {
                        return a + b
                    }, 0);
                    pc.setPixelWidth(a, b)
                }
            }
        }, JF = {
            getTableSize: function (a) {
                return pc.getRawWidth(a).fold(function () {
                    var b = Ia.get(a);
                    return It(b)
                }, function (b) {
                    pc.percentageBasedSizeRegex().test(b) ? (b = pc.percentageBasedSizeRegex().exec(b), b = T5(b[1], a)) :
                        pc.pixelBasedSizeRegex().test(b) ? (b = pc.pixelBasedSizeRegex().exec(b), b = It(b[1])) : (b = Ia.get(a), b = It(b));
                    return b
                })
            }
        }, U5 = function (a) {
            return Eb(a, function (a, c) {
                return a + c
            }, 0)
        }, KF = function (a) {
            a = hg.fromTable(a);
            return Ib.generate(a)
        }, Wr = {
            adjustWidth: function (a, b, c, d) {
                var e = JF.getTableSize(a);
                b = e.getCellDelta(b);
                var f = KF(a), k = e.getWidths(f, d, e);
                d = S5.determine(k, c, b, e);
                d = E(d, function (a, b) {
                    return a + k[b]
                });
                var l = bo.recalculateWidth(f, d);
                z(l, function (a) {
                    e.setElementWidth(a.element(), a.width())
                });
                c === f.grid().columns() -
                1 && e.setTableWidth(a, d, b)
            }, adjustHeight: function (a, b, c, d) {
                var e = KF(a);
                d = wk.getPixelHeights(e, d);
                d = E(d, function (a, d) {
                    return c === d ? Math.max(b + a, Qd.minHeight()) : a
                });
                var f = bo.recalculateHeight(e, d);
                e = bo.matchRowHeight(e, d);
                z(e, function (a) {
                    pc.setHeight(a.element(), a.height())
                });
                z(f, function (a) {
                    pc.setHeight(a.element(), a.height())
                });
                e = U5(d);
                pc.setHeight(a, e)
            }, adjustWidthTo: function (a, b, c) {
                var d = JF.getTableSize(a);
                b = Ib.generate(b);
                c = d.getWidths(b, c, d);
                b = bo.recalculateWidth(b, c);
                z(b, function (a) {
                    d.setElementWidth(a.element(),
                        a.width())
                });
                c = Eb(c, function (a, b) {
                    return b + a
                }, 0);
                0 < b.length && d.setElementWidth(a, c)
            }
        }, LF = function (a) {
            0 === sb.cells(a).length && F.remove(a)
        }, Cf = O("grid", "cursor"), yk = function (a, b, c) {
            return Jt(a, b, c).orThunk(function () {
                return Jt(a, 0, 0)
            })
        }, Jt = function (a, b, c) {
            return g.from(a[b]).bind(function (a) {
                return g.from(a.cells()[c]).bind(function (a) {
                    return g.from(a.element())
                })
            })
        }, nd = function (a, b, c) {
            return Cf(a, Jt(a, b, c))
        }, Kt = function (a) {
            return hb(a, function (a, c) {
                return Xa(a, function (a) {
                    return a.row() === c.row()
                }) ?
                    a : a.concat([c])
            }, []).sort(function (a, c) {
                return a.row() - c.row()
            })
        }, Lt = function (a) {
            return hb(a, function (a, c) {
                return Xa(a, function (a) {
                    return a.column() === c.column()
                }) ? a : a.concat([c])
            }, []).sort(function (a, c) {
                return a.column() - c.column()
            })
        }, MF = function (a, b, c) {
            a = hg.fromPastedRows(a, c);
            a = Ib.generate(a);
            return Xn.toGrid(a, b, !0)
        }, jg = Wr.adjustWidthTo, nc = {
            insertRowBefore: Pa.run(function (a, b, c, d) {
                var e = b.row(), f = b.row();
                a = Sd.insertRowAt(a, f, e, c, d.getOrInit);
                return nd(a, f, b.column())
            }, Pa.onCell, t, t, cc.modification),
            insertRowsBefore: Pa.run(function (a, b, c, d) {
                var e = b[0].row(), f = b[0].row(), k = Kt(b);
                a = hb(k, function (a, b) {
                    return Sd.insertRowAt(a, f, e, c, d.getOrInit)
                }, a);
                return nd(a, f, b[0].column())
            }, Pa.onCells, t, t, cc.modification), insertRowAfter: Pa.run(function (a, b, c, d) {
                var e = b.row(), f = b.row() + b.rowspan();
                a = Sd.insertRowAt(a, f, e, c, d.getOrInit);
                return nd(a, f, b.column())
            }, Pa.onCell, t, t, cc.modification), insertRowsAfter: Pa.run(function (a, b, c, d) {
                var e = Kt(b), f = e[e.length - 1].row(), k = e[e.length - 1].row() + e[e.length - 1].rowspan();
                a = hb(e, function (a, b) {
                    return Sd.insertRowAt(a, k, f, c, d.getOrInit)
                }, a);
                return nd(a, k, b[0].column())
            }, Pa.onCells, t, t, cc.modification), insertColumnBefore: Pa.run(function (a, b, c, d) {
                var e = b.column(), f = b.column();
                a = Sd.insertColumnAt(a, f, e, c, d.getOrInit);
                return nd(a, b.row(), f)
            }, Pa.onCell, jg, t, cc.modification), insertColumnsBefore: Pa.run(function (a, b, c, d) {
                var e = Lt(b), f = e[0].column(), k = e[0].column();
                a = hb(e, function (a, b) {
                    return Sd.insertColumnAt(a, k, f, c, d.getOrInit)
                }, a);
                return nd(a, b[0].row(), k)
            }, Pa.onCells, jg,
            t, cc.modification), insertColumnAfter: Pa.run(function (a, b, c, d) {
                var e = b.column(), f = b.column() + b.colspan();
                a = Sd.insertColumnAt(a, f, e, c, d.getOrInit);
                return nd(a, b.row(), f)
            }, Pa.onCell, jg, t, cc.modification), insertColumnsAfter: Pa.run(function (a, b, c, d) {
                var e = b[b.length - 1].column(), f = b[b.length - 1].column() + b[b.length - 1].colspan(), k = Lt(b);
                a = hb(k, function (a, b) {
                    return Sd.insertColumnAt(a, f, e, c, d.getOrInit)
                }, a);
                return nd(a, b[0].row(), f)
            }, Pa.onCells, jg, t, cc.modification), splitCellIntoColumns: Pa.run(function (a,
                                                                                           b, c, d) {
                a = Sd.splitCellIntoColumns(a, b.row(), b.column(), c, d.getOrInit);
                return nd(a, b.row(), b.column())
            }, Pa.onCell, jg, t, cc.modification), splitCellIntoRows: Pa.run(function (a, b, c, d) {
                a = Sd.splitCellIntoRows(a, b.row(), b.column(), c, d.getOrInit);
                return nd(a, b.row(), b.column())
            }, Pa.onCell, t, t, cc.modification), eraseColumns: Pa.run(function (a, b, c, d) {
                c = Lt(b);
                a = Sd.deleteColumnsAt(a, c[0].column(), c[c.length - 1].column());
                b = yk(a, b[0].row(), b[0].column());
                return Cf(a, b)
            }, Pa.onCells, jg, LF, cc.modification), eraseRows: Pa.run(function (a,
                                                                                 b, c, d) {
                c = Kt(b);
                a = Sd.deleteRowsAt(a, c[0].row(), c[c.length - 1].row());
                b = yk(a, b[0].row(), b[0].column());
                return Cf(a, b)
            }, Pa.onCells, t, LF, cc.modification), makeColumnHeader: Pa.run(function (a, b, c, d) {
                a = ao.replaceColumn(a, b.column(), c, d.replaceOrInit);
                return nd(a, b.row(), b.column())
            }, Pa.onCell, t, t, cc.transform("row", "th")), unmakeColumnHeader: Pa.run(function (a, b, c, d) {
                a = ao.replaceColumn(a, b.column(), c, d.replaceOrInit);
                return nd(a, b.row(), b.column())
            }, Pa.onCell, t, t, cc.transform(null, "td")), makeRowHeader: Pa.run(function (a,
                                                                                           b, c, d) {
                a = ao.replaceRow(a, b.row(), c, d.replaceOrInit);
                return nd(a, b.row(), b.column())
            }, Pa.onCell, t, t, cc.transform("col", "th")), unmakeRowHeader: Pa.run(function (a, b, c, d) {
                a = ao.replaceRow(a, b.row(), c, d.replaceOrInit);
                return nd(a, b.row(), b.column())
            }, Pa.onCell, t, t, cc.transform(null, "td")), mergeCells: Pa.run(function (a, b, c, d) {
                d = b.cells();
                H5.merge(d);
                a = $n.merge(a, b.bounds(), c, h(d[0]));
                return Cf(a, g.from(d[0]))
            }, Pa.onMergable, t, t, cc.merging), unmergeCells: Pa.run(function (a, b, c, d) {
                a = Eb(b, function (a, b) {
                    return $n.unmerge(a,
                        b, c, d.combine(b))
                }, a);
                return Cf(a, g.from(b[0]))
            }, Pa.onUnmergable, jg, t, cc.merging), pasteCells: Pa.run(function (a, b, c, d) {
                d = function (a, b) {
                    a = hg.fromTable(a);
                    a = Ib.generate(a);
                    return Xn.toGrid(a, b, !0)
                }(b.clipboard(), b.generators());
                var e = Oa.address(b.row(), b.column());
                return Ht.merge(e, a, d, b.generators(), c).fold(function () {
                    return Cf(a, g.some(b.element()))
                }, function (a) {
                    var c = yk(a, b.row(), b.column());
                    return Cf(a, c)
                })
            }, Pa.onPaste, jg, t, cc.modification), pasteRowsBefore: Pa.run(function (a, b, c, d) {
                var e = a[b.cells[0].row()];
                d = b.cells[0].row();
                e = MF(b.clipboard(), b.generators(), e);
                a = Ht.insert(d, a, e, b.generators(), c);
                b = yk(a, b.cells[0].row(), b.cells[0].column());
                return Cf(a, b)
            }, Pa.onPasteRows, t, t, cc.modification), pasteRowsAfter: Pa.run(function (a, b, c, d) {
                var e = a[b.cells[0].row()];
                d = b.cells[b.cells.length - 1].row() + b.cells[b.cells.length - 1].rowspan();
                e = MF(b.clipboard(), b.generators(), e);
                a = Ht.insert(d, a, e, b.generators(), c);
                b = yk(a, b.cells[0].row(), b.cells[0].column());
                return Cf(a, b)
            }, Pa.onPasteRows, t, t, cc.modification)
        }, Mt = function (a) {
            return function (b,
                             c) {
                return hb(a, function (a, e) {
                    return a.bind(function (a) {
                        return V5(c, function (a) {
                            return W5(e, b, c, a)
                        })
                    })
                }, I.value(c))
            }
        }, X5 = Mt([nc.makeRowHeader, nc.makeColumnHeader]), Y5 = Mt([nc.makeRowHeader]), Z5 = Mt([nc.makeColumnHeader]),
        W5 = function (a, b, c, d) {
            return Rr.fromEngine(b).bind(function (e) {
                e = h(e);
                var f = t;
                return Ac.execute(b.region(), a, f, e)(b.content(), c, {element: h(d)})
            })
        }, V5 = function (a, b) {
            return L.descendant(a, "td,th").bind(function (a) {
                return b(a)
            }).fold(function () {
                    return I.error("Could not run the operation on table")
                },
                function (b) {
                    return I.value(a)
                })
        }, Qf = {
            setCaption: function (a, b) {
                var c = L.child(a, "caption").fold(function () {
                    return r.fromTag("caption")
                }, function (a) {
                    F.empty(a);
                    return a
                });
                Ea.set(c, b);
                y.prepend(a, c)
            }, setSummary: function (a, b) {
                m.set(a, "summary", b)
            }, setDimensions: function (a, b) {
                E5.redistribute(a, b.width(), b.height(), "rtl" === m.get(a, "dir") ? $l.rtl : $l.ltr)
            }, addBothHeaders: X5, addRowHeader: Y5, addColumnHeader: Z5
        }, Nt = ta.generate([{field: ["name", "textkey", "f"]}, {select: ["name", "textkey", "values"]}, {
            toggles: ["name",
                "textkey", "options"]
        }]), $5 = O("value", "text"), a6 = O("value", "icon", "textkey"), jc = {
            field: Nt.field,
            select: Nt.select,
            toggles: Nt.toggles,
            pair: $5,
            toggle: a6,
            cata: function (a, b, c, d) {
                return a.fold(b, c, d)
            }
        }, b6 = function (a, b) {
            z(a, function (a) {
                b.get(a.severity()).fold(function () {
                    console.warn("unknown severity for accessibility rule: ", a.id(), a.severity())
                }, function (c) {
                    ma.add(a.element(), [b.violation(), c.style()]);
                    ff.add(a.element(), c.attribute(), a.id())
                })
            });
            g.from(a[0]).each(function (a) {
                var c = a.element(), e = b.currentAttr();
                a = a.severity();
                m.set(c, e, a)
            })
        }, c6 = function (a, b, c, d) {
            a = Y.descendants(a, "[" + b + "]");
            z(a, function (a) {
                m.remove(a, b)
            });
            m.set(c, b, d)
        }, d6 = function (a, b) {
            a = Y.descendants(a, "." + b.violation());
            z(a, function (a) {
                n.remove(a, b.violation());
                m.remove(a, b.currentAttr());
                z(b.all(), function (b) {
                    n.remove(a, b.style());
                    m.remove(a, b.attribute())
                })
            })
        }, NF = function (a, b, c) {
            var d = function (b) {
                return 0 === ff.read(a, b.attribute()).length
            };
            b.get(c).each(function (b) {
                d(b) && n.remove(a, b.style())
            });
            ob(b.all(), d) && n.remove(a, b.violation())
        },
        e6 = function (a, b, c, d) {
            b.get(d).each(function (d) {
                ff.remove(a, d.attribute(), c);
                ff.add(a, b.ignoreAttr(), c);
                d = b.currentAttr();
                m.remove(a, d)
            })
        }, f6 = function (a, b, c, d) {
            b.get(d).each(function (d) {
                ff.remove(a, d.attribute(), c);
                d = b.currentAttr();
                m.remove(a, d)
            })
        }, g6 = {
            manager: function (a) {
                var b = a.content();
                return {
                    start: function (b) {
                        b6(b, a)
                    }, moveTo: function (c, d) {
                        b.body().each(function (b) {
                            c6(b, a.currentAttr(), c, d)
                        })
                    }, stop: function () {
                        b.body().each(function (b) {
                            d6(b, a)
                        })
                    }, ignore: function (b, d, e) {
                        e6(b, a, d, e);
                        NF(b, a, e)
                    }, solve: function (b,
                                        d, e) {
                        f6(b, a, d, e);
                        NF(b, a, e)
                    }
                }
            }
        }, ii = function (a) {
            return function (b) {
                z(b, a)
            }
        }, h6 = ii(F.remove), i6 = ii(function (a) {
            m.set(a, "class", "")
        }), j6 = ii(function (a) {
            var b = A.children(a);
            P.before(a, b);
            F.remove(a)
        }), k6 = mb(), l6 = function (a) {
            return D.isText(a) ? (a = Vb.get(a), "" === a || a === k6) : !1
        }, m6 = ii(function (a) {
            if (D.isElement(a)) {
                var b = A.childNodesCount(a);
                b = 0 === b || 1 === b && A.child(a, 0).exists(l6)
            } else b = !1;
            b && m.hasNone(a) && F.remove(a)
        }), Na = {
            remove: h6, clearClasses: i6, removeClass: function (a) {
                return ii(function (b) {
                    n.remove(b,
                        a)
                })
            }, removeAttr: function (a) {
                return ii(function (b) {
                    m.remove(b, a)
                })
            }, unwrap: j6, removeIfEmpty: m6
        }, zk = function (a) {
            return "data-" + B.resolve(a)
        }, OF = zk("a11y-current-violation"), PF = B.resolve("a11y-violation"), QF = B.resolve("a11y-severity-info"),
        RF = B.resolve("a11y-severity-warn"), SF = B.resolve("a11y-severity-error"), co = zk("a11y-ignore"),
        TF = zk("a11y-error"), UF = zk("a11y-warning"), VF = zk("a11y-info"), Ot = Aa(["style", "attribute"], []),
        WF = Ot({style: SF, attribute: TF}), XF = Ot({style: RF, attribute: UF}), YF = Ot({style: QF, attribute: VF}),
        n6 = function (a) {
            return "error" === a ? g.some(WF) : "warning" === a ? g.some(XF) : "info" === a ? g.some(YF) : g.none()
        }, Sq = {
            configure: function (a) {
                a.addSelector(a.output(), "[" + co + "]", Na.removeAttr(co));
                z([a.output(), a.input(), a.history(), a.internal()], function (b) {
                    z([PF, QF, RF, SF], function (c) {
                        a.add(b, c, Na.removeClass(c))
                    });
                    z([OF, TF, UF, VF], function (c) {
                        a.addSelector(b, "[" + c + "]", Na.removeAttr(c))
                    })
                })
            }, ignoreAttr: h(co), manager: function (a) {
                return g6.manager({
                    content: h(a), violation: h(PF), currentAttr: h(OF), ignoreAttr: h(co), get: n6,
                    all: h([WF, XF, YF])
                })
            }
        }, ZF = B.resolve("highlight-common"), Pt = B.resolve("highlight-placeholder"), rf = {
            configure: function (a) {
                a.add(a.output(), ZF, Na.unwrap);
                a.add(a.history(), Pt, Na.unwrap);
                a.add(a.output(), Pt, Na.unwrap);
                a.add(a.output(), "ephox-custom-highlight", Na.unwrap);
                a.add(a.history(), "ephox-custom-highlight", Na.unwrap)
            }, highlightClass: h(ZF), customHighlightClass: h("ephox-custom-highlight"), placeholderClass: h(Pt)
        }, $F = function () {
            return Qt(function (a, b, c) {
                return a()
            }, "off")
        }, aG = function () {
            return Qt(function (a,
                                b, c) {
                return b()
            }, "unchanged")
        }, bG = function (a) {
            return Qt(function (b, c, d) {
                return d(a)
            }, "on")
        }, Qt = function (a, b) {
            return {
                fold: a, map: function (b) {
                    return a($F, aG, function (a) {
                        return bG(b(a))
                    })
                }, label: h(b)
            }
        }, Da = {off: $F, unchanged: aG, on: bG}, cG = O("content"), se = {
            hasSelection: function (a) {
                return a.getSelection().fold(function () {
                    return cG(Da.off())
                }, function () {
                    return cG(Da.on(!0))
                })
            }, isAnnotation: function (a) {
                return n.has(a, "ephox-cram-annotation-wrap") || n.has(a, rf.customHighlightClass())
            }, isEmptyText: function (a) {
                return D.isText(a) &&
                    0 === Ya.get(a).length
            }, isTextArea: function (a) {
                return "textarea" === D.name(a)
            }
        }, PA = {
            descend: function (a, b) {
                var c = A.children(a);
                if (0 === c.length || se.isTextArea(a)) return W.point(a, b);
                if (b < c.length && !se.isTextArea(c[b])) return W.point(c[b], 0);
                c = c[c.length - 1];
                if (se.isTextArea(c)) return W.point(a, b);
                a = D.isText(c) ? Ya.get(c).length : "img" === D.name(c) ? 1 : A.children(c).length;
                return W.point(c, a)
            }
        }, Rt = ta.generate([{before: ["element"]}, {on: ["element", "offset"]}, {after: ["element"]}]), la = {
            before: Rt.before, on: Rt.on, after: Rt.after,
            cata: function (a, b, c, d) {
                return a.fold(b, c, d)
            }, getStart: function (a) {
                return a.fold(ca, ca, ca)
            }
        },
        eo = ta.generate([{domRange: ["rng"]}, {relative: ["startSitu", "finishSitu"]}, {exact: ["start", "soffset", "finish", "foffset"]}]),
        o6 = O("start", "soffset", "finish", "foffset"), p6 = function (a) {
            return a.match({
                domRange: function (a) {
                    return r.fromDom(a.startContainer)
                }, relative: function (a, c) {
                    return la.getStart(a)
                }, exact: function (a, c, d, e) {
                    return a
                }
            })
        }, Lc = {
            domRange: eo.domRange, relative: eo.relative, exact: eo.exact, exactFromRange: function (a) {
                return eo.exact(a.start(),
                    a.soffset(), a.finish(), a.foffset())
            }, range: o6, getWin: function (a) {
                a = p6(a);
                return A.defaultView(a)
            }
        }, dG = function (a, b, c, d) {
            var e = A.owner(a).dom().createRange();
            e.setStart(a.dom(), b);
            e.setEnd(c.dom(), d);
            return e
        }, id = {
            after: function (a, b, c, d) {
                var e = dG(a, b, c, d);
                a = N.eq(a, c) && b === d;
                return e.collapsed && !a
            }, commonAncestorContainer: function (a, b, c, d) {
                a = dG(a, b, c, d);
                return r.fromDom(a.commonAncestorContainer)
            }
        }, q6 = {
            fromElements: function (a, b) {
                var c = (b || Hb).createDocumentFragment();
                z(a, function (a) {
                    c.appendChild(a.dom())
                });
                return r.fromDom(c)
            }
        }, eG = function (a, b) {
            a.selectNodeContents(b.dom())
        }, r6 = function (a, b) {
            b.fold(function (b) {
                a.setStartBefore(b.dom())
            }, function (b, d) {
                a.setStart(b.dom(), d)
            }, function (b) {
                a.setStartAfter(b.dom())
            })
        }, s6 = function (a, b) {
            b.fold(function (b) {
                a.setEndBefore(b.dom())
            }, function (b, d) {
                a.setEnd(b.dom(), d)
            }, function (b) {
                a.setEndAfter(b.dom())
            })
        }, fG = function (a) {
            a.deleteContents()
        }, gG = function (a) {
            return {
                left: h(a.left),
                top: h(a.top),
                right: h(a.right),
                bottom: h(a.bottom),
                width: h(a.width),
                height: h(a.height)
            }
        },
        tc = {
            create: function (a) {
                return a.document.createRange()
            }, replaceWith: function (a, b) {
                fG(a);
                a.insertNode(b.dom())
            }, selectNodeContents: function (a, b) {
                a = a.document.createRange();
                eG(a, b);
                return a
            }, selectNodeContentsUsing: eG, relativeToNative: function (a, b, c) {
                a = a.document.createRange();
                r6(a, b);
                s6(a, c);
                return a
            }, exactToNative: function (a, b, c, d, e) {
                a = a.document.createRange();
                a.setStart(b.dom(), c);
                a.setEnd(d.dom(), e);
                return a
            }, deleteContents: fG, cloneFragment: function (a) {
                a = a.cloneContents();
                return r.fromDom(a)
            }, getFirstRect: function (a) {
                var b =
                    a.getClientRects();
                a = 0 < b.length ? b[0] : a.getBoundingClientRect();
                return 0 < a.width || 0 < a.height ? g.some(a).map(gG) : g.none()
            }, getBounds: function (a) {
                a = a.getBoundingClientRect();
                return 0 < a.width || 0 < a.height ? g.some(a).map(gG) : g.none()
            }, isWithin: function (a, b) {
                return 1 > b.compareBoundaryPoints(a.END_TO_START, a) && -1 < b.compareBoundaryPoints(a.START_TO_END, a)
            }, toString: function (a) {
                return a.toString()
            }
        },
        Ak = ta.generate([{ltr: ["start", "soffset", "finish", "foffset"]}, {rtl: ["start", "soffset", "finish", "foffset"]}]),
        hG =
            function (a, b, c) {
                return b(r.fromDom(c.startContainer), c.startOffset, r.fromDom(c.endContainer), c.endOffset)
            }, t6 = function (a, b) {
            return b.match({
                domRange: function (a) {
                    return {ltr: h(a), rtl: g.none}
                }, relative: function (b, d) {
                    return {
                        ltr: gc(function () {
                            return tc.relativeToNative(a, b, d)
                        }), rtl: gc(function () {
                            return g.some(tc.relativeToNative(a, d, b))
                        })
                    }
                }, exact: function (b, d, e, f) {
                    return {
                        ltr: gc(function () {
                            return tc.exactToNative(a, b, d, e, f)
                        }), rtl: gc(function () {
                            return g.some(tc.exactToNative(a, e, f, b, d))
                        })
                    }
                }
            })
        }, u6 = function (a,
                          b) {
            var c = b.ltr();
            return c.collapsed ? b.rtl().filter(function (a) {
                return !1 === a.collapsed
            }).map(function (a) {
                return Ak.rtl(r.fromDom(a.endContainer), a.endOffset, r.fromDom(a.startContainer), a.startOffset)
            }).getOrThunk(function () {
                return hG(a, Ak.ltr, c)
            }) : hG(a, Ak.ltr, c)
        }, iG = function (a, b) {
            b = t6(a, b);
            return u6(a, b)
        }, Le = {
            ltr: Ak.ltr, rtl: Ak.rtl, diagnose: iG, asLtrRange: function (a, b) {
                return iG(a, b).match({
                    ltr: function (b, d, e, f) {
                        var c = a.document.createRange();
                        c.setStart(b.dom(), d);
                        c.setEnd(e.dom(), f);
                        return c
                    }, rtl: function (b,
                                      d, e, f) {
                        var c = a.document.createRange();
                        c.setStart(e.dom(), f);
                        c.setEnd(b.dom(), d);
                        return c
                    }
                })
            }
        }, St = {
            inRect: function (a, b, c) {
                return b >= a.left && b <= a.right && c >= a.top && c <= a.bottom
            }, searchForPoint: function (a, b, c, d, e) {
                if (0 === e) return 0;
                if (b === d) return e - 1;
                for (var f = 1; f < e; f++) {
                    var k = a(f), l = Math.abs(b - k.left);
                    if (c <= k.bottom) {
                        if (c < k.top || l > d) return f - 1;
                        d = l
                    }
                }
                return 0
            }
        }, v6 = function (a, b, c, d, e) {
            var f = function (c) {
                var d = a.dom().createRange();
                d.setStart(b.dom(), c);
                d.collapse(!0);
                return d
            }, k = Ya.get(b).length;
            c = St.searchForPoint(function (a) {
                    return f(a).getBoundingClientRect()
                },
                c, d, e.right, k);
            return f(c)
        }, jG = function (a, b, c, d) {
            var e = a.dom().createRange();
            e.selectNode(b.dom());
            e = e.getClientRects();
            return yc(e, function (a) {
                return St.inRect(a, c, d) ? g.some(a) : g.none()
            }).map(function (e) {
                return v6(a, b, c, d, e)
            })
        }, kG = function (a, b, c, d) {
            var e = a.dom().createRange();
            b = A.children(b);
            return yc(b, function (b) {
                e.selectNode(b.dom());
                return St.inRect(e.getBoundingClientRect(), c, d) ? (D.isText(b) ? jG : kG)(a, b, c, d) : g.none()
            })
        }, w6 = {
            locate: function (a, b, c, d) {
                var e = a.dom().createRange();
                e.selectNode(b.dom());
                e = e.getBoundingClientRect();
                c = Math.max(e.left, Math.min(e.right, c));
                d = Math.max(e.top, Math.min(e.bottom, d));
                return (D.isText(b) ? jG : kG)(a, b, c, d)
            }
        }, lG = function (a, b, c) {
            a = a.dom().createRange();
            a.selectNode(b.dom());
            a.collapse(c);
            return a
        }, x6 = function (a, b, c) {
            var d = a.dom().createRange();
            d.selectNode(b.dom());
            d = d.getBoundingClientRect();
            var e = c - d.left < d.right - c ? !0 : !1;
            return (!0 === e ? kc.first : kc.last)(b).map(function (b) {
                return lG(a, b, e)
            })
        }, y6 = function (a, b, c) {
            var d = b.dom().getBoundingClientRect();
            return g.some(lG(a,
                b, c - d.left < d.right - c ? !0 : !1))
        }, z6 = {
            search: function (a, b, c) {
                return (0 === A.children(b).length ? y6 : x6)(a, b, c)
            }
        }, A6 = function (a, b, c) {
            return g.from(a.dom().caretPositionFromPoint(b, c)).bind(function (b) {
                if (null === b.offsetNode) return g.none();
                var c = a.dom().createRange();
                c.setStart(b.offsetNode, b.offset);
                c.collapse();
                return g.some(c)
            })
        }, B6 = function (a, b, c) {
            return g.from(a.dom().caretRangeFromPoint(b, c))
        }, C6 = function (a, b, c, d) {
            var e = a.dom().createRange();
            e.selectNode(b.dom());
            e = e.getBoundingClientRect();
            return w6.locate(a,
                b, Math.max(e.left, Math.min(e.right, c)), Math.max(e.top, Math.min(e.bottom, d)))
        }, D6 = function (a, b, c) {
            return r.fromPoint(a, b, c).bind(function (d) {
                var e = function () {
                    return z6.search(a, d, b)
                };
                return 0 === A.children(d).length ? e() : C6(a, d, b, c).orThunk(e)
            })
        }, E6 = document.caretPositionFromPoint ? A6 : document.caretRangeFromPoint ? B6 : D6, F6 = {
            fromPoint: function (a, b, c) {
                a = r.fromDom(a.document);
                return E6(a, b, c).map(function (a) {
                    return Lc.range(r.fromDom(a.startContainer), a.startOffset, r.fromDom(a.endContainer), a.endOffset)
                })
            }
        },
        G6 = function (a, b, c, d) {
            var e = tc.create(a);
            a = (Fa.is(b, d) ? [b] : []).concat(Y.descendants(b, d));
            return ka(a, function (a) {
                tc.selectNodeContentsUsing(e, a);
                return tc.isWithin(c, e)
            })
        }, H6 = {
            find: function (a, b, c) {
                b = Le.asLtrRange(a, b);
                var d = r.fromDom(b.commonAncestorContainer);
                return D.isElement(d) ? G6(a, d, b, c) : []
            }
        }, Bk = function (a, b) {
            var c = D.name(a);
            return "input" === c ? la.after(a) : U(["br", "img"], c) ? 0 === b ? la.before(a) : la.after(a) : la.on(a, b)
        }, mG = function (a, b) {
            a = a.fold(la.before, Bk, la.after);
            b = b.fold(la.before, Bk, la.after);
            return Lc.relative(a, b)
        }, Tt = function (a, b, c, d) {
            a = Bk(a, b);
            c = Bk(c, d);
            return Lc.relative(a, c)
        }, Ut = {
            beforeSpecial: Bk, preprocess: function (a) {
                return a.match({
                    domRange: function (a) {
                        var b = r.fromDom(a.startContainer), d = r.fromDom(a.endContainer);
                        return Tt(b, a.startOffset, d, a.endOffset)
                    }, relative: mG, exact: Tt
                })
            }, preprocessRelative: mG, preprocessExact: Tt
        }, fo = function (a, b) {
            g.from(a.getSelection()).each(function (a) {
                a.removeAllRanges();
                a.addRange(b)
            })
        }, nG = function (a, b) {
            return Le.diagnose(a, b).match({
                ltr: function (b,
                               d, e, f) {
                    b = tc.exactToNative(a, b, d, e, f);
                    fo(a, b)
                }, rtl: function (b, d, e, f) {
                    var c = a.getSelection();
                    if (c.setBaseAndExtent) c.setBaseAndExtent(b.dom(), d, e.dom(), f); else if (c.extend) try {
                        c.collapse(b.dom(), d), c.extend(e.dom(), f)
                    } catch (l) {
                        b = tc.exactToNative(a, e, f, b, d), fo(a, b)
                    } else b = tc.exactToNative(a, e, f, b, d), fo(a, b)
                }
            })
        }, I6 = function (a) {
            var b = r.fromDom(a.anchorNode), c = r.fromDom(a.focusNode);
            id.after(b, a.anchorOffset, c, a.focusOffset) ? a = g.some(Lc.range(r.fromDom(a.anchorNode), a.anchorOffset, r.fromDom(a.focusNode),
                a.focusOffset)) : 0 < a.rangeCount ? (b = a.getRangeAt(0), a = a.getRangeAt(a.rangeCount - 1), a = g.some(Lc.range(r.fromDom(b.startContainer), b.startOffset, r.fromDom(a.endContainer), a.endOffset))) : a = g.none();
            return a
        }, oG = function (a) {
            return g.from(a.getSelection()).filter(function (a) {
                return 0 < a.rangeCount
            }).bind(I6)
        }, Wa = {
            setExact: function (a, b, c, d, e) {
                b = Ut.preprocessExact(b, c, d, e);
                nG(a, b)
            }, getExact: oG, get: function (a) {
                return oG(a).map(function (a) {
                    return Lc.exact(a.start(), a.soffset(), a.finish(), a.foffset())
                })
            }, setRelative: function (a,
                                      b, c) {
                b = Ut.preprocessRelative(b, c);
                nG(a, b)
            }, toNative: function (a) {
                var b = Lc.getWin(a).dom(), c = function (a, c, f, k) {
                    return tc.exactToNative(b, a, c, f, k)
                };
                a = Ut.preprocess(a);
                return Le.diagnose(b, a).match({ltr: c, rtl: c})
            }, setToElement: function (a, b) {
                b = tc.selectNodeContents(a, b);
                fo(a, b)
            }, clear: function (a) {
                a.getSelection().removeAllRanges()
            }, clone: function (a, b) {
                a = Le.asLtrRange(a, b);
                return tc.cloneFragment(a)
            }, replace: function (a, b, c) {
                b = Le.asLtrRange(a, b);
                a = q6.fromElements(c, a.document);
                tc.replaceWith(b, a)
            }, deleteAt: function (a,
                                   b) {
                a = Le.asLtrRange(a, b);
                tc.deleteContents(a)
            }, forElement: function (a, b) {
                a = tc.selectNodeContents(a, b);
                return Lc.range(r.fromDom(a.startContainer), a.startOffset, r.fromDom(a.endContainer), a.endOffset)
            }, getFirstRect: function (a, b) {
                a = Le.asLtrRange(a, b);
                return tc.getFirstRect(a)
            }, getBounds: function (a, b) {
                a = Le.asLtrRange(a, b);
                return tc.getBounds(a)
            }, getAtPoint: function (a, b, c) {
                return F6.fromPoint(a, b, c)
            }, findWithin: function (a, b, c) {
                return H6.find(a, b, c)
            }, getAsString: function (a, b) {
                a = Le.asLtrRange(a, b);
                return tc.toString(a)
            },
            isCollapsed: function (a, b, c, d) {
                return N.eq(a, c) && b === d
            }
        }, pG = function (a, b) {
            return ja.inBody(a) ? g.some(Math.max(0, Math.min(b, wa.getEnd(a)))) : g.none()
        }, xj = {
            findDescendants: function (a, b, c, d, e) {
                var f = A.defaultView(a);
                return pG(a, b).bind(function (b) {
                    return pG(c, d).map(function (d) {
                        d = Lc.exact(a, b, c, d);
                        return Wa.findWithin(f.dom(), d, e)
                    })
                }).getOr([])
            }, findAncestors: function (a, b, c) {
                return L.ancestor(a, c).fold(function () {
                    return L.ancestor(b, c).toArray()
                }, function (a) {
                    return L.ancestor(b, c).fold(h([a]), function (b) {
                        return N.eq(a,
                            b) ? [a] : [a, b]
                    })
                })
            }
        }, J6 = aa.detect().browser.isFirefox(), go = function (a) {
            return a.filter(function (a) {
                return "img" === D.name(a)
            })
        }, K6 = function (a) {
            var b = go(A.child(a.startContainer(), a.startOffset()));
            return go(A.nextSibling(a.startContainer())).orThunk(function () {
                return b
            }).bind(function (c) {
                return go(A.prevSibling(a.endContainer())).bind(function (d) {
                    d = N.eq(c, d);
                    var e = a.startContainer().dom().length === a.startOffset(), f = 0 === a.endOffset();
                    return d && (e || b.isSome()) && f ? g.some(c) : g.none()
                })
            })
        }, L6 = function (a) {
            var b =
                a.startContainer();
            if (!N.eq(b, a.endContainer())) return g.none();
            if ("img" === D.name(b)) return g.some(b);
            var c = Math.min(a.startOffset(), a.endOffset());
            a = Math.max(a.startOffset(), a.endOffset());
            b = go(A.child(b, c));
            return a === c || a === c + 1 ? b : J6 && a === c + 2 ? b.filter(function (a) {
                return A.nextSibling(a).filter(se.isEmptyText).isSome()
            }) : g.none()
        }, qG = O("image"), rG = function (a) {
            return a.filter(function (a) {
                return !a.collapsed()
            }).bind(function (a) {
                return L6(a).orThunk(function () {
                    return K6(a)
                })
            })
        }, sG = function (a, b) {
            return !Xa(b,
                function (b) {
                    return Fa.is(a, b)
                })
        }, vc = {
            allowedForEditing: sG, detect: function (a) {
                return rG(a).map(qG)
            }, detectForEditing: function (a, b) {
                return rG(a).filter(function (a) {
                    return sG(a, b)
                }).map(qG)
            }
        }, tG = aa.detect().browser.isFirefox(), M6 = function (a, b) {
            return vc.detect(g.some(a)).filter(function (a) {
                return N.eq(a.image(), b)
            }).isSome()
        }, uG = function (a, b) {
            var c = function () {
                a.setRelativeSelection(la.before(b), la.after(b))
            }, d = tG ? function () {
                a.getSelection().fold(c, function (c) {
                    N6(a, c, b)
                })
            } : c;
            a.focus();
            d()
        }, N6 = function (a,
                          b, c) {
            2 === Math.abs(b.startOffset() - b.endOffset()) && M6(b, c) || (b = A.nextSibling(c).filter(se.isEmptyText).getOrThunk(function () {
                var a = r.fromText("");
                y.after(c, a);
                return a
            }), a.setRelativeSelection(la.before(c), la.after(b)))
        }, ie = {
            selectionContains: function (a) {
                a = xj.findDescendants(a.startContainer(), a.startOffset(), a.endContainer(), a.endOffset(), "img");
                return 1 === a.length ? g.some(a[0]) : g.none()
            }, remove: function (a, b) {
                a.setRelativeSelection(la.before(b), la.before(b));
                F.remove(b)
            }, select: uG, reselect: tG ? uG : t
        },
        Vt = function (a, b) {
            var c = bb.absolute(a), d = sa.get(a);
            return {element: h(a), bottom: h(c.top() + d), pos: h(c), cleanup: b}
        }, O6 = function (a, b) {
            a = PA.descend(a, b);
            b = r.fromText(mb());
            var c = r.fromTag("span");
            y.append(c, b);
            y.before(a.element(), c);
            return Vt(c, function () {
                F.remove(c)
            })
        }, wG = function (a, b) {
            a.getSelection().each(function (c) {
                vG(a, function (d, e) {
                    P6(a, b, c)
                }, c)
            })
        }, P6 = function (a, b, c) {
            a.body().each(function (d) {
                a.doc().each(function (a) {
                    v.reflow(d);
                    var e = Za.get(a).top(), k = O6(c.startContainer(), c.startOffset());
                    b(a,
                        e, k);
                    k.cleanup()
                })
            })
        }, xG = function (a, b, c) {
            a.doc().each(function (a) {
                var d = Za.get(a).top();
                c(a, d, b)
            })
        }, yG = function (a, b, c) {
            var d = a.dom().defaultView.innerHeight, e = c.pos();
            c.bottom() > d + b ? (b = e.top() - d + 1.5 * sa.get(c.element()), Za.to(e.left(), b, a)) : e.top() < b && Za.to(e.left(), e.top(), a)
        }, zG = function (a, b, c, d) {
            a.body().each(function (e) {
                var f = sa.get(a.element()), k = e.dom();
                var l = Math.max(k.offsetHeight, k.scrollHeight);
                k = d.pos();
                d.bottom() > l ? v.set(e, "min-height", d.bottom() + "px") : v.remove(e, "min-height");
                k.top() <
                c ? Za.to(k.left(), k.top(), b) : k.top() > f + c && (e = k.top() - f + (d.bottom() - k.top()), Za.to(k.left(), e, b));
                e = pk.find(d.element());
                f = Za.get().top();
                k = window.innerHeight + f;
                e.top() < f ? Za.intoView(d.element(), !0) : e.top() > k && Za.intoView(d.element(), !1)
            })
        }, Q6 = function (a) {
            wG(a, yG)
        }, R6 = function (a, b) {
            xG(a, Vt(b, t), yG)
        }, S6 = function (a) {
            wG(a, u(zG, a))
        }, T6 = function (a, b) {
            xG(a, Vt(b, t), u(zG, a))
        }, vG = function (a, b, c) {
            var d = c.startContainer(), e = c.startOffset(), f = c.endContainer();
            c = c.endOffset();
            b(d, f);
            a.setSelection(d, e, f, c);
            vc.detect(a.getSelection()).each(function (b) {
                ie.select(a,
                    b.image())
            })
        }, Og = {
            cursorIntoView: function (a) {
                (a.isInline() ? Q6 : S6)(a)
            }, elementIntoView: function (a, b) {
                (a.isInline() ? R6 : T6)(a, b)
            }, preserve: function (a, b) {
                a.getSelection().each(function (c) {
                    vG(a, b, c)
                })
            }
        }, U6 = aa.detect(), Wt = function (a, b, c) {
            a = r.fromTag(a);
            c = x.translate(c);
            return AG(a, b, c)
        }, AG = function (a, b, c) {
            c = S.labelledField(a, b, c);
            n.add(c.element(), B.resolve("form-group"));
            n.add(c.element(), B.resolve(b));
            "select" === D.name(a) && (a = T.div(), n.add(a, B.resolve("select-wrap")), y.append(a, c.field()), y.append(c.element(),
                a));
            return c
        }, Wc = {
            input: function (a, b) {
                a = Wt("input", a, b);
                U6.browser.isSafari() && m.setAll(a.field(), {
                    autocomplete: "off",
                    autocorrect: "off",
                    autocapitalize: "off",
                    spellcheck: "false"
                });
                m.setAll(a.field(), {type: "text"});
                return {element: a.element, input: a.field}
            }, textarea: function (a, b) {
                a = Wt("textarea", a, b);
                S.multiline(a.field());
                return {element: a.element, textarea: a.field}
            }, common: Wt, commonWith: AG, comboBox: function (a, b, c) {
                var d = r.fromTag("input"), e = x.translate(b);
                b = T.div();
                var f = a + Ha("");
                e = r.fromHtml("<label>" +
                    e + "</label>");
                m.set(e, "for", f);
                m.set(d, "id", f);
                n.add(b, B.resolve("form-group"));
                n.add(b, B.resolve(a));
                a = T.span();
                S.hidden(a, !0);
                f = T.span();
                S.hidden(f, !0);
                ma.add(f, ["ephox-textbox-font", B.resolve("icon"), B.resolve("combo-drop-arrow-icon")]);
                n.add(a, B.resolve("combo-drop-arrow"));
                y.append(a, f);
                var k = T.div();
                n.add(k, B.resolve("label-wrap"));
                c.each(function (a) {
                    y.append(k, a)
                });
                y.append(k, e);
                c = T.div();
                n.add(c, B.resolve("combo-wrap"));
                P.append(c, [d, a]);
                m.set(d, "type", "text");
                P.append(b, [k, c]);
                return {
                    element: h(b),
                    input: h(d), dropArrow: h(a)
                }
            }
        }, BG = function (a) {
            n.add(a, B.resolve("dialog-button-default"))
        }, CG = function (a) {
            n.add(a, B.resolve("dialog-button"))
        }, Xt = function (a, b, c) {
            var d = Oc(a + b);
            n.add(d.element(), B.resolve("dialog-" + b));
            a = Rc(x.translate(c));
            d.content(a);
            m.set(d.element(), "tabindex", "-1");
            S.textButton(d.element(), a.element());
            return {
                enable: function () {
                    d.enable();
                    ra.enable(d.element())
                }, disable: function () {
                    d.disable();
                    ra.disable(d.element())
                }, element: d.element, name: d.name, destroy: d.destroy, content: d.content,
                disabled: d.disabled, click: d.click, events: d.events
            }
        }, V6 = function (a) {
            a = Xt(a, "ok", "button.ok");
            BG(a.element());
            return a
        }, W6 = function (a) {
            a = Xt(a, "cancel", "button.cancel");
            CG(a.element());
            return a
        }, td = {
            button: Xt, okCancel: function (a) {
                var b = void 0 !== a ? a + "-" : "";
                a = T.div();
                n.add(a, B.resolve(b + "dialog-controls"));
                var c = W6(b), d = V6(b);
                P.append(a, [c.element(), d.element()]);
                b = H.create({ok: Q([], d.events.click), cancel: Q([], c.events.click)});
                return {
                    element: h(a), ok: h(d), cancel: h(c), destroy: function () {
                        d.destroy();
                        c.destroy()
                    },
                    events: b.registry
                }
            }, makeNormal: CG, makeDefault: BG
        }, Yt = function (a, b) {
            a = a();
            var c = a.element();
            S.button(c, b);
            m.set(c, "tabindex", "-1");
            a.events.click.bind(function () {
                Z.focus(c)
            });
            return a
        }, DG = function (a, b) {
            var c = Yt(Oc, b);
            c.content(bf([a, B.resolve("icon")]));
            m.set(c.element(), "title", b);
            return c
        }, GU = {
            setDefaultAction: function (a) {
                td.makeDefault(a)
            }, setNormalButton: function (a) {
                td.makeNormal(a)
            }, makeTextButton: function (a, b, c) {
                b = Yt(Oc, b);
                ma.add(b.element(), a);
                b.content(Rc(c));
                return b
            }, makeIconToggle: function (a,
                                         b, c) {
                var d = Yt($d, c);
                d.content(bf([b, B.resolve("icon")]));
                n.add(d.element(), B.resolve("choice-button"));
                m.set(d.element(), "data-value", a);
                m.set(d.element(), "title", c);
                return d
            }, makeField: function (a, b, c) {
                return Wc.commonWith(a, b, c)
            }, makeIconButton: DG, makeIconStepperButton: function (a, b) {
                a = DG(a, b);
                n.add(a.element(), B.resolve("stepper-button"));
                return a
            }
        }, Zt = {
            "a11y.widget.ok.label": "button.ok",
            "a11y.widget.ok.text": "button.ok",
            "a11y.widget.ignore.label": "a11y.widget.ignore",
            "a11y.widget.ignore.text": "a11y.widget.ignore",
            "a11y.widget.repair.label": "a11y.widget.repair",
            "a11y.widget.repair.text": "a11y.widget.repair",
            "a11y.widget.repair.available": "a11y.widget.available",
            "a11y.i1.description": "a11y.image.alttext.empty",
            "a11y.i1.repair.info": "a11y.image.alttext.set",
            "a11y.i1.repair.errors.empty": "a11y.image.alttext.validation.empty",
            "a11y.i1.repair.errors.duplicate": "a11y.image.alttext.validation.filenameduplicate",
            "a11y.i2.description": "a11y.image.alttext.filenameduplicate",
            "a11y.i2.repair.info": "a11y.image.alttext.set",
            "a11y.i2.repair.errors.empty": "a11y.image.alttext.validation.empty",
            "a11y.i2.repair.errors.duplicate": "a11y.image.alttext.validation.filenameduplicate",
            "a11y.t1.description": "a11y.table.caption.empty",
            "a11y.t1.repair.info": "a11y.table.caption.set",
            "a11y.t1.repair.errors.empty": "a11y.table.caption.validation.empty",
            "a11y.t1.repair.errors.duplicate": "a11y.table.caption.validation.summaryduplicate",
            "a11y.t2.description": "a11y.table.summary.empty",
            "a11y.t2.repair.info": "a11y.table.summary.set",
            "a11y.t2.repair.errors.empty": "a11y.table.summary.validation.empty",
            "a11y.t2.repair.errors.duplicate": "a11y.table.summary.validation.captionduplicate",
            "a11y.t3.description": "a11y.table.caption.summaryduplicate",
            "a11y.t3.repair.info": "a11y.table.caption.set",
            "a11y.t3.repair.errors.empty": "a11y.table.caption.validation.empty",
            "a11y.t3.repair.errors.duplicate": "a11y.table.caption.validation.summaryduplicate",
            "a11y.t4a.description": "a11y.table.rowscells.none",
            "a11y.t4b.description": "a11y.table.headers.none",
            "a11y.t4b.repair.info": "a11y.table.headers.set",
            "a11y.t4b.repair.row": "table.row-header",
            "a11y.t4b.repair.column": "table.column-header",
            "a11y.t4b.repair.errors.none": "a11y.table.headers.validation.none",
            "a11y.t4c.description": "a11y.table.headerscope.none",
            "a11y.t4c.repair.info": "a11y.table.headerscope.set",
            "a11y.t4c.repair.scope.row": "a11y.table.headerscope.scope.row",
            "a11y.t4c.repair.scope.col": "a11y.table.headerscope.scope.col",
            "a11y.t4c.repair.scope.rowgroup": "a11y.table.headerscope.scope.rowgroup",
            "a11y.t4c.repair.scope.colgroup": "a11y.table.headerscope.scope.colgroup",
            "a11y.d1.description": "a11y.heading.paragraphmisuse",
            "a11y.d1.repair.info": "a11y.heading.set",
            "a11y.d1.repair.block.h1": "block.h1",
            "a11y.d1.repair.block.h2": "block.h2",
            "a11y.d1.repair.block.h3": "block.h3",
            "a11y.d1.repair.block.h4": "block.h4",
            "a11y.d1.repair.block.h5": "block.h5",
            "a11y.d1.repair.block.h6": "block.h6",
            "a11y.d2.description": "a11y.heading.nonsequential",
            "a11y.d3.description": "a11y.link.adjacent",
            "a11y.d4.description": "a11y.list.paragraphmisuse",
            "a11y.d5a.description": "a11y.contrast.largetext",
            "a11y.d5b.description": "a11y.contrast.smalltext"
        },
        Oy = {
            get: function (a) {
                return g.from(Zt[a])
            }, translate: function (a) {
                var b = Array.prototype.slice.call(arguments, 1);
                return x.translate.apply(void 0, [void 0 !== Zt[a] ? Zt[a] : a].concat(b))
            }
        }, IU = Aa(["rules"], []), EG = Aa(["rule", "element"], []), X6 = function (a, b) {
            return ia(b, function (b) {
                return b.check()(a) ? [EG({rule: b, element: a})] : []
            })
        }, Y6 = function (a, b) {
            return ia(b, function (b) {
                return E(b.check()(a), function (a) {
                    return EG({rule: b, element: a})
                })
            })
        }, wU = {
            audit: function (a, b) {
                var c = [], d = q1(b, function (a) {
                    return a.walkable()
                });
                b = d.pass;
                d = d.fail;
                for (var e = document.createTreeWalker(a, Kc.getOrDie("NodeFilter").SHOW_ELEMENT, null, !1); e.nextNode();) c = c.concat(X6(e.currentNode, b));
                a = Y6(a, d);
                c = c.concat(a);
                c.sort(function (a, b) {
                    a = a.element();
                    b = b.element();
                    return a === b ? 0 : om.documentPositionPreceding(a, b) ? 1 : -1
                });
                return c
            }
        }, Zc = Aa("id wcag severity desckey url walkable check".split(" "), []),
        $c = {error: h("error"), warning: h("warning"), info: h("info")}, nh = {
            match: function (a, b) {
                return a.matches ? a.matches(b) : a.webkitMatchesSelector ? a.webkitMatchesSelector(b) :
                    a.mozMatchesSelector ? a.mozMatchesSelector(b) : a.msMatchesSelector ? a.msMatchesSelector(b) : !1
            }
        }, Z6 = function (a) {
            return ob(a.childNodes, function (a) {
                return /^(b|strong)$/i.test(a.nodeName)
            })
        }, $6 = Zc({
            id: "D1",
            wcag: "1.3.1",
            severity: $c.warning(),
            desckey: "a11y.d1.description",
            url: "http://www.w3.org/TR/UNDERSTANDING-WCAG20/content-structure-separation-programmatic.html",
            walkable: !0,
            check: function (a) {
                return nh.match(a, "p") ? Z6(a) : !1
            }
        }), a7 = Zc({
            id: "D2",
            wcag: "1.3.1",
            severity: $c.error(),
            desckey: "a11y.d2.description",
            url: "http://www.w3.org/TR/UNDERSTANDING-WCAG20/content-structure-separation-programmatic.html",
            walkable: !1,
            check: function (a) {
                a = a.querySelectorAll("h1, h2, h3, h4, h5, h6");
                var b, c = [];
                z(a, function (a) {
                    var d = parseInt(a.tagName.slice(1), 10);
                    b && 1 < d - b && c.push(a);
                    b = d
                });
                return c
            }
        }), b7 = Zc({
            id: "D3",
            wcag: "2.4.4",
            severity: $c.error(),
            desckey: "a11y.d3.description",
            url: "http://www.w3.org/TR/UNDERSTANDING-WCAG20/navigation-mechanisms-refs.html",
            walkable: !1,
            check: function (a) {
                return ka(a.querySelectorAll("a + a"),
                    function (a) {
                        return a.href === a.previousSibling.href
                    })
            }
        }), FG = function (a) {
            var b = a.nodeName;
            for (a = a.nextSibling; null !== a && ("#text" === a.nodeName || "BR" === a.nodeName);) a = a.nextSibling;
            return null !== a && a.nodeName === b ? a : !1
        }, GG = {
            check: function (a, b) {
                a = a.querySelectorAll("p,h1,h2,h3,h4,h5,h6");
                for (var c = [], d = 0; d < a.length;) {
                    var e = a[d];
                    var f = b;
                    var k = FG(e);
                    for (e = f(e) ? [e] : []; !1 !== k && f(k);) e.push(k), k = FG(k);
                    f = e;
                    if (1 < f.length) {
                        c.push(f[0]);
                        f = f[f.length - 1];
                        k = -1;
                        for (e = 0; e < a.length; e++) if (a[e] === f) {
                            k = e;
                            break
                        }
                        f = k;
                        d = -1 ===
                        f ? d + 1 : f
                    } else d++
                }
                return c
            }
        }, c7 = function (a) {
            return a.textContent.match(/^\s{0,}([a-z1-9]|i+)\s{0,}[.)-]/gmi)
        }, d7 = Zc({
            id: "D4o",
            wcag: "1.3.1",
            severity: $c.error(),
            desckey: "a11y.d4.description",
            url: "http://www.w3.org/TR/UNDERSTANDING-WCAG20/content-structure-separation-programmatic.html",
            walkable: !1,
            check: function (a) {
                return GG.check(a, c7)
            }
        }), e7 = function (a) {
            return a.textContent.match(/^\s{0,}(\*|-)\s{0,}/gmi)
        }, f7 = Zc({
            id: "D4u",
            wcag: "1.3.1",
            severity: $c.error(),
            desckey: "a11y.d4.description",
            url: "http://www.w3.org/TR/UNDERSTANDING-WCAG20/content-structure-separation-programmatic.html",
            walkable: !1,
            check: function (a) {
                return GG.check(a, e7)
            }
        }), HG = O("red", "green", "blue", "alpha"), Ck = {
            rgbaColour: HG, white: function () {
                return HG(255, 255, 255, 1)
            }
        }, ji = {
            calculateContrastRatio: function (a, b) {
                return (Math.max(a, b) + .05) / (Math.min(a, b) + .05)
            }, calculateLuminance: function (a) {
                var b = function (a) {
                    return .03928 >= a ? a / 12.92 : Math.pow((a + .055) / 1.055, 2.4)
                }, c = a.red() / 255, d = a.green() / 255;
                a = a.blue() / 255;
                c = b(c);
                d = b(d);
                b = b(a);
                return .2126 * c + .7152 * d + .0722 * b
            }, composeColour: function (a, b) {
                var c = a.alpha() + b.alpha() * (1 - a.alpha()),
                    d = (a.red() * a.alpha() + b.red() * b.alpha() * (1 - a.alpha())) / c,
                    e = (a.green() * a.alpha() + b.green() * b.alpha() * (1 - a.alpha())) / c;
                a = (a.blue() * a.alpha() + b.blue() * b.alpha() * (1 - a.alpha())) / c;
                return Ck.rgbaColour(Math.ceil(d), Math.ceil(e), Math.ceil(a), c)
            }
        }, IG = {
            parseColour: function (a) {
                var b = function (a, b, c, k) {
                    a = parseInt(a, 10);
                    b = parseInt(b, 10);
                    c = parseInt(c, 10);
                    k = parseFloat(k);
                    return g.some(Ck.rgbaColour(a, b, c, k))
                };
                if ("transparent" === a) return b(0, 0, 0, 0);
                var c = a.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)/);
                if (null !== c) return b(c[1],
                    c[2], c[3], 1);
                a = a.match(/^rgba\((\d+),\s*(\d+),\s*(\d+),\s*(\d?(?:\.\d+)?)\)/);
                return null !== a ? b(a[1], a[2], a[3], a[4]) : g.none()
            }
        }, JG = function (a, b) {
            a = parseFloat(v.get(a, "opacity"));
            return 1 > a ? Ck.rgbaColour(b.red(), b.green(), b.blue(), b.alpha() * a) : b
        }, KG = {
            getBackgroundColor: function (a) {
                var b = A.owner(a), c = ja.getBody(b);
                a = [a].concat(A.parents(a, function (a) {
                    return N.eq(a, c)
                }));
                a = hb(a, function (a, b) {
                    if (1 === a.alpha()) return a;
                    var c = v.get(b, "background-color");
                    return IG.parseColour(c).bind(function (c) {
                        c = JG(b,
                            c);
                        return 0 < c.alpha() ? g.some(ji.composeColour(a, c)) : g.none()
                    }).getOr(a)
                }, Ck.rgbaColour(0, 0, 0, 0));
                return 1 > a.alpha() ? ji.composeColour(a, Ck.white()) : a
            }, getForegroundColor: function (a, b) {
                var c = v.get(a, "color");
                return IG.parseColour(c).bind(function (c) {
                    c = JG(a, c);
                    c = 1 > c.alpha() ? ji.composeColour(c, b) : c;
                    return g.some(c)
                })
            }
        }, LG = function (a) {
            var b = KG.getBackgroundColor(a);
            return KG.getForegroundColor(a, b).map(function (a) {
                var c = ji.calculateLuminance(b);
                a = ji.calculateLuminance(a);
                return ji.calculateContrastRatio(a,
                    c)
            })
        }, MG = {
            check: function (a, b) {
                return LG(a).filter(function (a) {
                    return a < b
                }).isSome()
            }, getRatio: LG
        }, g7 = function (a) {
            a = v.get(a, "font-weight");
            return "bold" === a || "bolder" === a ? !0 : /^[0-9]*$/.test(a) ? 700 <= parseInt(a, 10) : !1
        }, NG = function (a) {
            var b = v.get(a, "font-size");
            a = /.*px/.test(b);
            b = b.match(/(\d*\.?\d*)(.*)/);
            return a && null !== b ? g.some(Number(b[1])) : g.none()
        }, OG = {
            isLargeFont: function (a) {
                var b = g7(a), c = A.owner(a);
                c = ja.getBody(c);
                var d = NG(c);
                return NG(a).fold(fd, function (a) {
                    return d.fold(function () {
                        return 24 <=
                            a || b && 19 <= a
                    }, function (c) {
                        return a >= 1.5 * c || b && a >= 1.2 * c
                    })
                })
            }
        }, PG = {
            hasNonEmptyTextChild: function (a) {
                a = A.children(a);
                return 0 < ka(a, function (a) {
                    return D.isText(a) && 0 < D.value(a).trim().length
                }).length
            }
        }, h7 = Zc({
            id: "D5a",
            wcag: "1.4.3",
            severity: $c.error(),
            desckey: "a11y.d5a.description",
            url: "https://www.w3.org/TR/UNDERSTANDING-WCAG20/visual-audio-contrast-contrast.html",
            walkable: !0,
            check: function (a) {
                a = r.fromDom(a);
                return PG.hasNonEmptyTextChild(a) && OG.isLargeFont(a) && MG.check(a, 3)
            }
        }), i7 = Zc({
            id: "D5b",
            wcag: "1.4.3",
            severity: $c.error(),
            desckey: "a11y.d5b.description",
            url: "https://www.w3.org/TR/UNDERSTANDING-WCAG20/visual-audio-contrast-contrast.html",
            walkable: !0,
            check: function (a) {
                a = r.fromDom(a);
                return PG.hasNonEmptyTextChild(a) && !OG.isLargeFont(a) && MG.check(a, 4.5)
            }
        }), j7 = Zc({
            id: "I1",
            wcag: "1.1.1",
            severity: $c.error(),
            desckey: "a11y.i1.description",
            url: "http://www.w3.org/TR/UNDERSTANDING-WCAG20/text-equiv-all.html",
            walkable: !0,
            check: function (a) {
                return nh.match(a, "img") && (!1 === a.hasAttribute("alt") || "" === a.getAttribute("alt").trim())
            }
        }),
        k7 = Zc({
            id: "I2",
            wcag: "1.1.1",
            severity: $c.error(),
            desckey: "a11y.i2.description",
            url: "http://www.w3.org/TR/UNDERSTANDING-WCAG20/text-equiv-all.html",
            walkable: !0,
            check: function (a) {
                return nh.match(a, "img[alt][src]") && a.src.split("/").pop() === a.alt.split("/").pop()
            }
        }), l7 = Zc({
            id: "T1",
            wcag: "1.3.1",
            severity: $c.error(),
            desckey: "a11y.t1.description",
            url: "http://www.w3.org/TR/UNDERSTANDING-WCAG20/content-structure-separation-programmatic.html",
            walkable: !0,
            check: function (a) {
                return nh.match(a, "table") ? (a = a.querySelector("caption")) ?
                    nh.match(a, ":empty") : !0 : !1
            }
        }), m7 = Zc({
            id: "T2",
            wcag: "1.3.1",
            severity: $c.warning(),
            desckey: "a11y.t2.description",
            url: "http://www.w3.org/TR/UNDERSTANDING-WCAG20/content-structure-separation-programmatic.html",
            walkable: !0,
            check: function (a) {
                return nh.match(a, "table") && (a.querySelector("[rowspan]") || a.querySelector("[colspan]")) && !a.hasAttribute("summary")
            }
        }), n7 = Zc({
            id: "T3",
            wcag: "1.3.1",
            severity: $c.error(),
            desckey: "a11y.t3.description",
            url: "http://www.w3.org/TR/UNDERSTANDING-WCAG20/content-structure-separation-programmatic.html",
            walkable: !0,
            check: function (a) {
                return nh.match(a, "table") && a.hasAttribute("summary") && 0 < a.querySelectorAll("caption").length && a.getAttribute("summary") === a.querySelector("caption").innerHTML
            }
        }), o7 = Zc({
            id: "T4b",
            wcag: "1.3.1",
            severity: $c.error(),
            desckey: "a11y.t4b.description",
            url: "http://www.w3.org/TR/UNDERSTANDING-WCAG20/content-structure-separation-programmatic.html",
            walkable: !0,
            check: function (a) {
                return "table" === a.nodeName.toLowerCase() && 0 === a.querySelectorAll("th").length
            }
        }), p7 = Zc({
            id: "T4c",
            wcag: "1.3.1",
            severity: $c.error(),
            desckey: "a11y.t4c.description",
            url: "http://www.w3.org/TR/UNDERSTANDING-WCAG20/content-structure-separation-programmatic.html",
            walkable: !0,
            check: function (a) {
                if ("th" === a.nodeName.toLowerCase()) {
                    var b = !1 === a.hasAttribute("scope");
                    a = !1 === /row|col|rowgroup|colgroup/i.test(a.getAttribute("scope"));
                    b = b || a
                } else b = !1;
                return b
            }
        }), q7 = Zc({
            id: "T4a",
            wcag: "1.3.1",
            severity: $c.error(),
            desckey: "a11y.t4a.description",
            url: "http://www.w3.org/TR/UNDERSTANDING-WCAG20/content-structure-separation-programmatic.html",
            walkable: !0,
            check: function (a) {
                return "table" === a.nodeName.toLowerCase() ? 0 === a.querySelectorAll("tr").length || 0 === a.querySelectorAll("td").length : !1
            }
        }), QG = [$6, a7, b7, d7, f7, h7, i7, j7, k7, l7, m7, n7, p7, q7, o7], RG = {
            get: function (a) {
                return qa(QG, function (b) {
                    return b.name() === a
                })
            }, all: h(QG)
        }, HU = {
            get: function (a) {
                return RG.get(a)
            }, all: function () {
                return RG.all().slice()
            }
        }, r7 = {resolve: Lb.create("ephox-wheel").resolve}, $a = {
            resolve: function (a, b) {
                return r7.resolve(a.prefix() + "-" + b)
            }, translate: function (a, b) {
                var c = [(Gb(b,
                    a.tnames()) ? "" : a.tnames() + ".") + b].concat(Array.prototype.slice.call(arguments, 2));
                return a.translate.apply(null, c)
            }
        }, $t = function (a, b, c, d, e) {
            c = $a.translate(e, c);
            d = $a.translate(e, d);
            return a.makeTextButton(b, c, d)
        }, ef = {
            defaultActionButton: function (a, b, c, d, e) {
                b = $t(a, b, c, d, e);
                a.setDefaultAction(b.element());
                return b
            }, normalButton: function (a, b, c, d, e) {
                b = $t(a, b, c, d, e);
                a.setNormalButton(b.element());
                return b
            }, button: $t, toggleButton: function (a, b, c, d, e) {
                d = $a.translate(e, d);
                return a.makeIconToggle(b, c, d)
            }, field: function (a,
                                b, c, d, e) {
                d = $a.translate(e, d);
                return a.makeField(b, c, d)
            }, icon: function (a, b, c, d) {
                c = $a.translate(d, c);
                return a.makeIconStepperButton(b, c)
            }
        }, s7 = function (a, b, c, d, e, f) {
            var k = r.fromTag("input");
            a = ef.field(a, k, c, d, f);
            n.add(k, $a.resolve(f, "input"));
            b = [ha.input(k, Ba.input({execute: b}))];
            return {
                element: a.element, get: function () {
                    var a = {};
                    a[c] = fa.get(k);
                    return a
                }, update: function (a) {
                    a = e(a);
                    fa.set(k, a)
                }, keylayouts: h(b), destroy: t
            }
        }, t7 = function (a, b, c, d, e) {
            var f = r.fromTag("select");
            a = ef.field(a, f, b, c, e);
            d = E(d, function (a) {
                var b =
                    r.fromTag("option");
                fa.set(b, a.value());
                Ea.set(b, $a.translate(e, a.text()));
                return b
            });
            P.append(f, d);
            d = [ha.single(f, [], g.none())];
            return {
                element: a.element, get: function () {
                    var a = {};
                    a[b] = fa.get(f);
                    return a
                }, update: t, keylayouts: h(d), destroy: t
            }
        }, u7 = function (a, b, c, d, e) {
            var f = T.div();
            n.add(f, $a.resolve(e, "flow"));
            var k = E(d, function (b) {
                return ef.toggleButton(a, b.value(), b.icon(), b.textkey(), e)
            });
            d = E(k, function (a) {
                return a.element()
            });
            P.append(f, d);
            d = [ha.flow(f, {item: h(".ephox-pastry-statebutton")}, Ba.flow({
                trigger: function (a) {
                    return L.descendant(a,
                        ".ephox-pastry-button").map(function (a) {
                        a.dom().click();
                        return a
                    })
                }
            }))];
            return {
                element: ef.field(a, f, b, c, e).element, get: function () {
                    return Eb(k, function (a, b) {
                        var c = {};
                        c[m.get(b.element(), "data-value")] = b.selected();
                        return oa(a, c)
                    }, {})
                }, update: t, keylayouts: h(d), destroy: function () {
                    z(k, function (a) {
                        a.destroy()
                    })
                }
            }
        }, zU = {
            generate: function (a, b, c, d) {
                b = b.getOr([]);
                var e = ia(b, function (a) {
                        return a.fold(function (a, b, c) {
                            return [a]
                        }, function (a, b, c) {
                            return [a]
                        }, function (a, b, c) {
                            return E(c, function (a) {
                                return a.value()
                            })
                        })
                    }),
                    f = 0 < e.length ? Aa(e, []) : h({}), k = H.create({execute: p([])}), l = function () {
                        k.trigger.execute()
                    }, g = E(b, function (b) {
                        return b.fold(function (b, c, e) {
                            return s7(a, l, b, c, e, d)
                        }, function (b, c, e) {
                            return t7(a, b, c, e, d)
                        }, function (b, c, e) {
                            return u7(a, b, c, e, d)
                        })
                    });
                z(g, function (a) {
                    a.update(c)
                });
                b = E(g, function (a) {
                    return a.element()
                });
                var C = ia(g, function (a) {
                    return a.keylayouts()
                });
                return {
                    elements: h(b), get: function () {
                        var a = Eb(g, function (a, b) {
                            return oa(a, b.get())
                        }, {});
                        return f(a)
                    }, keylayouts: h(C), destroy: function () {
                        z(g, function (a) {
                            a.destroy()
                        });
                        z(C, function (a) {
                            a.destroy()
                        })
                    }, events: k.registry
                }
            }
        }, Tc = {
            title: h("widget.title"),
            running: h("widget.running"),
            previous: h("widget.previous"),
            next: h("widget.next"),
            issueCounter: h("widget.issue.counter"),
            issueHelp: h("widget.issue.help"),
            noIssue: h("widget.issue.none"),
            severity: function (a) {
                return "severity." + a
            },
            repairLabel: h("widget.repair.label"),
            repairText: h("widget.repair.text"),
            repairAvailable: h("widget.repair.available"),
            ignoreLabel: h("widget.ignore.label"),
            ignoreText: h("widget.ignore.text"),
            okLabel: h("widget.ok.label"),
            okText: h("widget.ok.text")
        }, am = function (a, b, c) {
            var d = T.div();
            n.add(d, $a.resolve(c, a));
            b.each(function (a) {
                y.append(d, r.fromText($a.translate(c, a)))
            });
            return d
        }, SG = function (a) {
            var b = na(g.none());
            return {
                clear: function () {
                    b.get().each(a);
                    b.set(g.none())
                }, isSet: function () {
                    return b.get().isSome()
                }, set: function (c) {
                    b.get().each(a);
                    b.set(g.some(c))
                }
            }
        }, hd = {
            destroyable: function () {
                return SG(function (a) {
                    a.destroy()
                })
            }, unbindable: function () {
                return SG(function (a) {
                    a.unbind()
                })
            }, api: function () {
                var a = na(g.none()), b =
                    function () {
                        a.get().each(function (a) {
                            a.destroy()
                        })
                    };
                return {
                    clear: function () {
                        b();
                        a.set(g.none())
                    }, isSet: function () {
                        return a.get().isSome()
                    }, set: function (c) {
                        b();
                        a.set(g.some(c))
                    }, run: function (b) {
                        a.get().each(b)
                    }
                }
            }, value: function () {
                var a = na(g.none());
                return {
                    clear: function () {
                        a.set(g.none())
                    }, set: function (b) {
                        a.set(g.some(b))
                    }, isSet: function () {
                        return a.get().isSome()
                    }, on: function (b) {
                        a.get().each(b)
                    }
                }
            }
        }, TG = aa.detect(), ho = TG.os.isOSX(), ad = ho ? "\u2318" : "Ctrl", io = ho ? "\u21e7" : "Shift", UG = {
            blockquote: [ad, io, "9"],
            bold: [ad, "B"],
            italic: [ad, "I"],
            underline: [ad, "U"],
            link: [ad, "K"],
            help: [ad, "?"],
            fullscreen: [ad, io, "F"],
            indent: [ad, "]"],
            outdent: [ad, "["],
            undo: [ad, "Z"],
            redo: ho ? [ad, io, "Z"] : [ad, "Y"],
            search: [ad, "F"]
        }, v7 = "fr nl sv ru de es it".split(" "), w7 = ua(UG, {indent: [ad, "M"], outdent: [ad, io, "M"]}),
        VG = function (a) {
            var b = qf.get();
            return U(v7, b) ? w7[a] : UG[a]
        }, x7 = function (a) {
            a = VG(a);
            return void 0 === a ? "" : " " + a.join("")
        }, y7 = function (a) {
            a = VG(a);
            return void 0 === a ? "" : " (" + a.join(" ") + ")"
        }, z7 = ho ? x7 : y7, qb = {
            get: function (a, b) {
                return TG.os.isiOS() ?
                    x.get(a) : x.get(a) + z7(b)
            }
        }, LU = B.resolve("inverted-dialog-widget"), WG = function (a, b, c) {
            var d = v.get(b, a);
            c = parseInt(d, 10) + 40 * c;
            (0 < c ? v.set : v.remove)(b, a, c + "px")
        }, A7 = {change: u(WG, "margin-right")}, Qy = {ltr: {change: u(WG, "margin-left")}, rtl: A7}, Pd = {
            runTransaction: function (a, b, c, d) {
                d = void 0 !== d ? d : t;
                b.save();
                a.focus();
                c = c();
                setTimeout(function () {
                    a.domChanged();
                    a.uiChanged()
                }, 0);
                d();
                b.save();
                return c
            }
        }, au = O("startContainer", "startOffset", "endContainer", "endOffset"), bu = function (a, b) {
            if (a.property().isText(b)) return W.point(b,
                a.property().getText(b).length);
            var c = a.property().children(b);
            return 0 < c.length ? bu(a, c[c.length - 1]) : W.point(b, c.length)
        }, XG = function (a, b, c) {
            var d = a.property().children(b);
            return 0 < d.length && c < d.length ? XG(a, d[c], 0) : 0 < d.length && a.property().isElement(b) && d.length === c ? bu(a, d[d.length - 1]) : W.point(b, c)
        }, cu = function (a, b, c) {
            return a.property().isText(b) && 0 === a.property().getText(b).trim().length || a.property().isComment(b) ? c(b).bind(function (b) {
                return cu(a, b, c).orThunk(function () {
                    return g.some(b)
                })
            }) : g.none()
        },
        YG = function (a, b) {
            b = cu(a, b, a.query().nextSibling).getOr(b);
            if (a.property().isText(b)) return W.point(b, 0);
            var c = a.property().children(b);
            return 0 < c.length ? YG(a, c[0]) : W.point(b, 0)
        }, ZG = function (a, b) {
            return a.property().isText(b) ? a.property().getText(b).length : a.property().children(b).length
        }, $G = function (a, b) {
            b = cu(a, b, a.query().prevSibling).getOr(b);
            if (a.property().isText(b)) return W.point(b, ZG(a, b));
            var c = a.property().children(b);
            return 0 < c.length ? $G(a, c[c.length - 1]) : W.point(b, ZG(a, b))
        }, kg = {
            toLast: bu,
            toLeaf: XG, toLower: function (a, b) {
                a = a.property().isText(b) ? a.property().getText(b).length : a.property().children(b).length;
                return W.point(b, a)
            }, freefallLtr: YG, freefallRtl: $G
        }, bd = {
            toLeaf: function (a, b, c) {
                return kg.toLeaf(a, b, c)
            }, freefallLtr: function (a, b) {
                return kg.freefallLtr(a, b)
            }, freefallRtl: function (a, b) {
                return kg.freefallRtl(a, b)
            }
        }, du = nb(), kb = {
            toLeaf: function (a, b) {
                return bd.toLeaf(du, a, b)
            }, freefallLtr: function (a) {
                return bd.freefallLtr(du, a)
            }, freefallRtl: function (a) {
                return bd.freefallRtl(du, a)
            }
        }, aH =
            function (a, b) {
                return ja.inBody(a) && 0 <= b && b < A.children(a).length
            }, jo = {
            multiple: function (a, b, c) {
                return function (d, e) {
                    d = a.getSelection();
                    var f = d.map(function (a) {
                        return {left: A.parent(a.startContainer()).getOrDie(), right: A.parent(a.endContainer()).getOrDie()}
                    }), k = Pd.runTransaction(a, b, function () {
                        return ia(e, function (a) {
                            return a.getSelection().bind(function (a) {
                                return c(a.startContainer(), a.startOffset(), a.endContainer(), a.endOffset()).map(function (a) {
                                    return a.all()
                                })
                            }).getOr([])
                        })
                    }, a.toEditing);
                    d = d.filter(function (a) {
                        return aH(a.startContainer(),
                            a.startOffset()) && aH(a.endContainer(), a.endOffset())
                    }).getOrThunk(function () {
                        var a = kb.freefallLtr(0 < k.length ? k[0] : f.getOrDie().left),
                            b = kb.freefallRtl(0 < k.length ? k[k.length - 1] : f.getOrDie().right);
                        return au(a.element(), a.offset(), b.element(), b.offset())
                    });
                    a.setSelection(d.startContainer(), d.startOffset(), d.endContainer(), d.endOffset());
                    return k
                }
            }, single: function (a, b, c, d, e) {
                return function (f, k) {
                    var g = d(a, f.startContainer(), f.startOffset()), h = d(a, f.endContainer(), f.endOffset());
                    k = Pd.runTransaction(a,
                        b, function () {
                            return c(g.element(), g.offset(), h.element(), h.offset())
                        }, a.toEditing);
                    return e(a, k, g, h, f)
                }
            }
        }, ko = {
            multiple: function (a, b, c) {
                return function (d, e) {
                    return Pd.runTransaction(a, b, function () {
                        return ia(e, function (a) {
                            return a.getSelection().bind(function (a) {
                                return c(a.startContainer(), a.startOffset(), a.endContainer(), a.endOffset()).map(function (a) {
                                    return a.all()
                                })
                            }).getOr([])
                        })
                    }, a.toEditing)
                }
            }, single: function (a, b, c, d, e) {
                return function (f, k) {
                    var g = d(a, f.startContainer(), f.startOffset()), h = d(a, f.endContainer(),
                        f.endOffset());
                    k = Pd.runTransaction(a, b, function () {
                        return c(g.element(), g.offset(), h.element(), h.offset())
                    }, a.toEditing);
                    return e(a, k, g, h, f)
                }
            }
        }, Dk = function (a, b, c, d, e) {
            return b.map(function (b) {
                a.setSelection(b.start(), b.soffset(), b.finish(), b.foffset());
                return b.all()
            }).getOr([])
        }, Ek = function (a, b, c) {
            return W.point(b, c)
        }, eu = ta.generate([{none: []}, {multiple: ["elements", "environments"]}, {single: ["selection", "environment"]}]),
        Zb = {
            cata: function (a, b, c, d) {
                return a.fold(b, c, d)
            }, none: eu.none, multiple: eu.multiple,
            single: eu.single, toSelection: function (a) {
                return a.fold(g.none, function (a, c) {
                    return g.from(c[0]).bind(function (a) {
                        return a.getSelection()
                    })
                }, g.some)
            }
        }, bH = O("left", "right"), cH = function (a, b, c) {
            var d = a.property().children(b);
            return Va(d, u(a.eq, c)).map(function (a) {
                return {before: h(d.slice(0, a)), after: h(d.slice(a + 1))}
            })
        }, Fk = {
            breakToLeft: function (a, b, c) {
                return cH(a, b, c).map(function (d) {
                    var e = a.create().clone(b);
                    a.insert().appendAll(e, d.before().concat([c]));
                    a.insert().appendAll(b, d.after());
                    a.insert().before(b,
                        e);
                    return bH(e, b)
                })
            }, breakToRight: function (a, b, c) {
                return cH(a, b, c).map(function (c) {
                    var d = a.create().clone(b);
                    a.insert().appendAll(d, c.after());
                    a.insert().after(b, d);
                    return bH(b, d)
                })
            }, breakPath: function (a, b, c, d) {
                var e = O("first", "second", "splits"), f = function (b, l, h) {
                    var k = e(b, g.none(), h);
                    return c(b) ? e(b, l, h) : a.property().parent(b).bind(function (e) {
                        return d(a, e, b).map(function (a) {
                            var b = [{first: a.left, second: a.right}], d = c(e) ? e : a.left();
                            return f(d, g.some(a.right()), h.concat(b))
                        }).getOr(k)
                    })
                };
                return f(b,
                    g.none(), [])
            }
        }, C7 = function (a, b, c, d) {
            c = b(a, c);
            return Eb(d, function (c, d) {
                d = b(a, d);
                return B7(a, c, d)
            }, c)
        }, B7 = function (a, b, c) {
            return b.bind(function (b) {
                return c.filter(u(a.eq, b))
            })
        }, D7 = {
            oneAll: function (a, b, c) {
                if (0 < c.length) {
                    var d = c[0];
                    c = c.slice(1);
                    a = C7(a, b, d, c)
                } else a = g.none();
                return a
            }
        }, E7 = function (a, b, c, d) {
            var e = a.property().children(b);
            if (a.eq(b, c[0])) return g.some([c[0]]);
            if (a.eq(b, d[0])) return g.some([d[0]]);
            var f = function (c) {
                c = kd(c);
                var d = Va(c, u(a.eq, b)).getOr(-1);
                return Va(e, u(a.eq, d < c.length - 1 ?
                    c[d + 1] : c[d]))
            };
            c = f(c);
            var k = f(d);
            return c.bind(function (a) {
                return k.map(function (b) {
                    return e.slice(Math.min(a, b), Math.max(a, b) + 1)
                })
            })
        }, dH = function (a, b, c, d) {
            var e = void 0 !== d ? d : h(!1);
            b = [b].concat(a.up().all(b));
            c = [c].concat(a.up().all(c));
            d = function (a) {
                return Va(a, e).fold(function () {
                    return a
                }, function (b) {
                    return a.slice(0, b + 1)
                })
            };
            b = d(b);
            var f = d(c);
            c = qa(b, function (b) {
                return Xa(f, u(a.eq, b))
            });
            return {firstpath: h(b), secondpath: h(f), shared: h(c)}
        }, fu = {
            subset: function (a, b, c) {
                var d = dH(a, b, c);
                return d.shared().bind(function (b) {
                    return E7(a,
                        b, d.firstpath(), d.secondpath())
                })
            }, ancestors: dH
        }, zd = {
            sharedOne: function (a, b, c) {
                return D7.oneAll(a, b, c)
            }, subset: function (a, b, c) {
                return fu.subset(a, b, c)
            }, ancestors: function (a, b, c, d) {
                return fu.ancestors(a, b, c, d)
            }, breakToLeft: function (a, b, c) {
                return Fk.breakToLeft(a, b, c)
            }, breakToRight: function (a, b, c) {
                return Fk.breakToRight(a, b, c)
            }, breakPath: function (a, b, c, d) {
                return Fk.breakPath(a, b, c, d)
            }
        }, ki = nb(), nf = {
            sharedOne: function (a, b) {
                return zd.sharedOne(ki, function (b, d) {
                    return a(d)
                }, b)
            }, subset: function (a, b) {
                return zd.subset(ki,
                    a, b)
            }, ancestors: function (a, b, c) {
                return zd.ancestors(ki, a, b, c)
            }, breakToLeft: function (a, b) {
                return zd.breakToLeft(ki, a, b)
            }, breakToRight: function (a, b) {
                return zd.breakToRight(ki, a, b)
            }, breakPath: function (a, b, c) {
                return zd.breakPath(ki, a, b, function (a, b, f) {
                    return c(b, f)
                })
            }
        }, lo = function (a, b, c, d, e) {
            return d(a).fold(function () {
                return !0
            }, function (a) {
                return N.eq(b, a) && e(b, c)
            })
        }, Qg = {
            isLeft: function (a, b) {
                return lo(a, b.startContainer(), b.startOffset(), kc.first, wa.isStart)
            }, isAtLeftEdge: function (a, b, c) {
                return lo(a,
                    b, c, kc.first, wa.isStart)
            }, isRight: function (a, b) {
                return lo(a, b.startContainer(), b.startOffset(), kc.last, wa.isEnd)
            }, isAtRightEdge: function (a, b, c) {
                return lo(a, b, c, kc.last, wa.isEnd)
            }
        }, F7 = function (a) {
            a = D.name(a);
            return "td" === a || "th" === a
        }, gu = function (a) {
            return "li" === D.name(a) || pa.isBlock(a)
        }, eH = function (a) {
            return "a" === D.name(a)
        }, fH = function (a, b, c) {
            return Ja.closest(a, b, c).filter(zf(c)).filter(zf(F7))
        }, dc = {
            stopAt: function (a) {
                return u(N.eq, a)
            }, isList: function (a) {
                a = D.name(a);
                return "ol" === a || "ul" === a
            }, isAnchor: eH,
            isHeading: function (a, b) {
                b = Mb(b) ? b : [];
                b = "h1 h2 h3 h4 h5 h6".split(" ").concat(b);
                a = D.name(a);
                return U(b, a)
            }, isCollapsed: function (a) {
                return N.eq(a.startContainer(), a.endContainer()) && a.startOffset() === a.endOffset()
            }, isRightEdge: function (a, b, c) {
                var d = O("startContainer", "startOffset");
                return Qg.isRight(a, d(b, c))
            }, isBlockOrList: gu, exitList: function (a) {
                return 0 === ed.descendants(a, function (a) {
                    return D.isText(a) && 0 < Ya.get(a).length && 0 < Zh(Ya.get(a)).length || D.isElement(a) && U("hr img input video iframe picture audio embed map object".split(" "),
                        D.name(a))
                }).length
            }, findBlock: function (a, b) {
                return Ja.closest(a, gu, b)
            }, findValidHardBreak: function (a, b) {
                return fH(a, gu, b)
            }, findAnchorBreak: function (a, b) {
                return fH(a, eH, b)
            }
        }, hu = {
            forceAddBr: function (a, b) {
                if ("br" !== D.name(a)) {
                    var c = r.fromTag("br");
                    D.isText(a) ? (y.after(a, c), N.eq(b, a) || F.remove(a)) : dc.isBlockOrList(a) ? y.append(a, c) : (b = r.fromText(mb()), y.prepend(a, b), y.after(a, c))
                }
            }, rootBr: function (a, b) {
                y.before(a, r.fromTag("br"))
            }
        }, gH = function (a, b, c) {
            var d = [];
            z(A.children(a), function (a) {
                b(a) && (d = d.concat([a]));
                d = c(a) ? d : d.concat(gH(a, b, c))
            });
            return d
        }, hH = function (a, b) {
            var c = A.children(a);
            return 0 < c.length ? (c = c[0], b(c) || "textarea" === D.name(c) ? a : hH(c, b)) : a
        }, mo = {descendants: gH, plunge: hH}, no = function (a) {
            if (!D.isText(a)) return !1;
            a = Ya.get(a).trim();
            return 0 === a.length || 0 === a.replace(mb(), "").length
        }, oo = function (a) {
            if (D.isText(a)) return no(a);
            var b = Ea.get(a);
            a = A.children(a);
            return "" === Zh(b) || ob(a, no)
        }, li = {
            vacant: function (a) {
                a = Y.descendants(a, "span,a");
                return ka(a, function (a) {
                    if ("span" === D.name(a)) {
                        var b = m.has(a,
                            "class") && 0 < m.get(a, "class").length, d = m.has(a, "id");
                        a = !b && !d && !m.has(a, "style") && oo(a)
                    } else a = oo(a);
                    return a
                })
            }, isEmpty: oo, hasCursor: function (a, b) {
                b = void 0 !== b ? b : "hr br img input textarea iframe".split(" ");
                return D.isText(a) ? !1 === no(a) : U(b, D.name(a))
            }, isVacantText: no, hasNoContent: oo
        }, iH = function (a) {
            var b = "li" === D.name(a) ? dc.isList : h(!1);
            return 0 < mo.descendants(a, li.hasCursor, b).length ? g.none() : g.some(mo.plunge(a, b))
        }, jH = function (a) {
            a = li.vacant(a);
            z(a, F.remove)
        }, kH = function (a, b) {
            a = Y.descendants(b,
                a);
            a = ka(a, li.isEmpty);
            z(a, F.remove);
            li.isEmpty(b) && F.remove(b)
        }, Df = {
            vacate: jH, emptyStyles: function (a) {
                !0 === m.has(a, "style") && 0 === m.get(a, "style").length && m.remove(a, "style")
            }, needsCursor: iH, postprocess: function (a, b, c) {
                jH(a);
                iH(a).each(function (a) {
                    hu.forceAddBr(a, b)
                })
            }, lists: u(kH, "ul,ol"), blockquotes: u(kH, "blockquote")
        }, G7 = function (a, b) {
            a = nf.breakToRight(a, b);
            a.each(function (a) {
                a = a.right();
                z(["id"], u(m.remove, a));
                Df.emptyStyles(a)
            });
            return a
        }, po = {
            breakPath: function (a, b) {
                return nf.breakPath(a, b, G7)
            }
        },
        H7 = {
            breakQuote: function (a, b) {
                var c = po.breakPath(b, dc.stopAt(a));
                return c.second().map(function (a) {
                    var d = c.first();
                    y.before(a, b);
                    z([d, a], Df.blockquotes);
                    return {start: h(la.on(b, 0)), finish: h(la.on(b, 0))}
                })
            }
        }, lH = function (a) {
            return D.isElement(a) ? a : A.parent(a).getOr(a)
        }, mH = {
            bothMatch: function (a, b, c) {
                a = lH(a);
                b = lH(b);
                return c(a) && c(b)
            }
        }, qo = {
            isRootOrCell: function (a) {
                return function (b) {
                    return a(b) || Fa.is(b, "td,th")
                }
            }, isRootOrContainer: function (a) {
                return function (b) {
                    return a(b) || pa.isContainer(b)
                }
            }
        }, nH = function (a,
                          b) {
            return 0 === a.length ? !0 : 0 === b.length ? !1 : a[0] < b[0] ? !0 : b[0] < a[0] ? !1 : nH(a.slice(1), b.slice(1))
        }, lg = {
            head: function (a) {
                return 0 < a.length ? g.some(a[0]) : g.none()
            }, tail: function (a) {
                return 0 < a.length ? g.some(a.slice(1)) : g.none()
            }, toLast: function (a) {
                return 0 < a.length ? g.some(a[a.length - 1]) : g.none()
            }, box: function (a) {
                return [a]
            }, isBefore: nH
        },
        ro = ta.generate([{quasi: ["elements"]}, {block: ["element"]}, {container: ["element", "children"]}, {fixture: ["element"]}]),
        oH = function (a) {
            return a.fold(function (a) {
                return "@q[" + E(a,
                    function (a) {
                        return a.dom().outerHTML || '"' + a.dom().nodeValue + '"'
                    }).join(",") + "]"
            }, function (a) {
                return "@" + a.dom().nodeName.toLowerCase() + "(" + a.dom().innerHTML + ")"
            }, function (a, c) {
                return "#" + a.dom().nodeName.toLowerCase() + "(" + E(c, oH).join(",") + ")"
            }, function (a) {
                return a.dom().nodeName.toLowerCase()
            })
        }, pH = function (a) {
            var b = function (a) {
                return [a]
            };
            return a.fold(ca, b, b, b)
        }, so = h(!0), mg = h(!1), Bc = {
            cata: function (a, b, c, d, e) {
                return a.fold(b, c, d, e)
            }, quasi: ro.quasi, block: ro.block, container: ro.container, fixture: ro.fixture,
            isQuasi: function (a) {
                return a.fold(so, mg, mg, mg)
            }, isFixture: function (a) {
                return a.fold(mg, mg, mg, so)
            }, isQuasiOrFixture: function (a) {
                return a.fold(so, mg, mg, so)
            }, toTarget: pH, toString: oH, toLastTarget: function (a) {
                return lg.toLast(pH(a))
            }
        }, Gk = function (a, b) {
            return {fold: a, label: h(b)}
        }, ng = {
            before: function (a) {
                return Gk(function (b, c, d, e, f) {
                    return b(a)
                }, "before")
            }, after: function (a) {
                return Gk(function (b, c, d, e, f) {
                    return c(a)
                }, "after")
            }, rest: function (a) {
                return Gk(function (b, c, d, e, f) {
                    return d(a)
                }, "rest")
            }, last: function (a) {
                return Gk(function (b,
                                    c, d, e, f) {
                    return e(a)
                }, "last")
            }, invalid: function (a, b) {
                return Gk(function (c, d, e, f, k) {
                    return k(a, b)
                }, "invalid")
            }
        }, qH = {
            subdivide: function (a, b, c) {
                var d = a.property().getText(b);
                c = ka(Hn.splits(d, c), function (a) {
                    return 0 < a.length
                });
                if (1 >= c.length) return [W.range(b, 0, d.length)];
                a.property().setText(b, c[0]);
                d = Rd.generate(c.slice(1), function (b, c) {
                    var d = a.create().text(b);
                    b = W.range(d, c, c + b.length);
                    return g.some(b)
                }, c[0].length);
                var e = E(d, function (a) {
                    return a.element()
                });
                a.insert().afterAll(b, e);
                return [W.range(b,
                    0, c[0].length)].concat(d)
            }
        }, to = function (a, b) {
            return {fold: a, label: h(b)}
        }, uo = {
            none: function () {
                return to(function (a, b, c, d) {
                    return a()
                }, "none")
            }, start: function (a) {
                return to(function (b, c, d, e) {
                    return c(a)
                }, "start")
            }, middle: function (a, b) {
                return to(function (c, d, e, f) {
                    return e(a, b)
                }, "middle")
            }, end: function (a) {
                return to(function (b, c, d, e) {
                    return e(a)
                }, "end")
            }
        }, I7 = {
            determine: function (a) {
                return a.before().fold(function () {
                    return a.after().fold(function () {
                        return uo.none()
                    }, function (a) {
                        return uo.start(a)
                    })
                }, function (b) {
                    return a.after().fold(function () {
                            return uo.end(b)
                        },
                        function (a) {
                            return uo.middle(b, a)
                        })
                })
            }
        }, J7 = {
            group: function (a, b, c) {
                b = ia(b, function (b) {
                    return fg.from(a, b, c)
                });
                b = zC.splitbyAdv(b, function (a) {
                    return mn.cata(a, function () {
                        return $h.excludeWithout(a)
                    }, function () {
                        return $h.excludeWith(a)
                    }, function () {
                        return $h.include(a)
                    })
                });
                return ka(b, function (a) {
                    return 0 < a.length
                })
            }
        }, K7 = {
            common: function (a, b, c) {
                b = [b].concat(a.up().all(b));
                var d = [c].concat(a.up().all(c));
                return qa(b, function (b) {
                    return Xa(d, function (c) {
                        return a.eq(c, b)
                    })
                })
            }
        }, NU = "table tbody thead tfoot tr ul ol".split(" "),
        L7 = {
            range: function (a, b, c, d, e) {
                return a.eq(b, d) ? [b] : K7.common(a, b, d).fold(function () {
                    return []
                }, function (f) {
                    var k = [f].concat(fg.all(a, f, h(!1)));
                    f = Va(k, u(a.eq, b));
                    var g = Va(k, u(a.eq, d));
                    f = f.bind(function (a) {
                        return g.map(function (b) {
                            return a < b ? k.slice(a + c, b + e) : k.slice(b + e, a + c)
                        })
                    }).getOr([]);
                    var q = MU(a);
                    return ka(f, q.validateText)
                })
            }
        }, rH = {
            range: function (a, b, c, d, e) {
                return L7.range(a, b, c, d, e)
            }, group: function (a, b, c) {
                return J7.group(a, b, c)
            }
        }, iu = O("before", "after"), sH = function (a, b, c) {
            a = a.property().getText(b);
            return Hn.splits(a, c)
        }, tH = function (a, b, c, d) {
            if (!a.property().isText(b) || c === d) return b;
            if (c > d) return tH(a, b, d, c);
            var e = a.property().getText(b).length;
            if (0 === c && d === e) return b;
            d = sH(a, b, [c, d]);
            a.property().setText(b, d[0]);
            d = E(d.slice(1), function (b) {
                return a.create().text(b)
            });
            e = d[0];
            a.insert().afterAll(b, d);
            return 0 === c ? b : e
        }, Hk = {
            split: function (a, b, c) {
                if (!a.property().isText(b) || 0 >= c) return iu(g.none(), g.some(b));
                if (c >= a.property().getText(b).length) return iu(g.some(b), g.none());
                c = sH(a, b, [c]);
                a.property().setText(b,
                    c[0]);
                c = a.create().text(c[1]);
                a.insert().after(b, c);
                return iu(g.some(b), g.some(c))
            }, splitByPair: tH
        }, M7 = function (a, b, c, d, e) {
            c = Hk.split(a, b, c).after().fold(function () {
                return W.delta(b, 1)
            }, function (a) {
                return W.delta(a, 0)
            });
            e = Hk.split(a, d, e).before().fold(function () {
                return W.delta(d, 0)
            }, function (a) {
                return W.delta(a, 1)
            });
            return rH.range(a, c.element(), c.deltaOffset(), e.element(), e.deltaOffset())
        }, N7 = function (a, b, c, d, e) {
            return [Hk.splitByPair(a, b, c, e)]
        }, O7 = {
            nodes: function (a, b, c, d, e) {
                return (a.eq(b, d) ? N7 : M7)(a,
                    b, c, d, e)
            }
        }, Td = {
            split: function (a, b, c) {
                return Hk.split(a, b, c)
            }, splitByPair: function (a, b, c, d) {
                return Hk.splitByPair(a, b, c, d)
            }, range: function (a, b, c, d, e) {
                return O7.nodes(a, b, c, d, e)
            }, subdivide: function (a, b, c) {
                return qH.subdivide(a, b, c)
            }, position: function (a, b) {
                return I7.determine(b)
            }
        }, P7 = function (a, b, c) {
            var d = Td.split(a, b, c);
            return Td.position(a, d).fold(function () {
                return ng.invalid(b, c)
            }, ng.before, ng.after, ng.after)
        }, Q7 = function (a, b, c) {
            var d = a.property().children(b);
            return a.property().isEmptyTag(b) ? ng.before(b) :
                c === d.length ? ng.last(b) : c < d.length ? ng.rest(d[c]) : ng.invalid(b, c)
        }, R7 = {
            atStartOf: function (a, b, c, d) {
                var e = function (b) {
                    a.insert().before(b, d)
                };
                (a.property().isText(b) ? P7 : Q7)(a, b, c).fold(e, function (b) {
                    a.insert().after(b, d)
                }, e, function (b) {
                    a.insert().append(b, d)
                }, t)
            }
        }, ju = {
            atStartOf: function (a, b, c, d) {
                R7.atStartOf(a, b, c, d)
            }
        },
        S7 = ta.generate([{none: []}, {root: ["target", "block"]}, {created: ["target", "block"]}, {actual: ["target", "block"]}]),
        og = ua(S7, {
            toString: function (a) {
                return a.fold(function () {
                        return ["block.none"]
                    },
                    function (a, c) {
                        return ["block.root", a, c]
                    }, function (a, c) {
                        return ["block.created", a, c]
                    }, function (a, c) {
                        return ["block.actual", a, c]
                    })
            }, cata: function (a, b, c, d, e) {
                return a.fold(b, c, d, e)
            }, extract: function (a) {
                var b = h([]), c = function (a, b) {
                    return [b]
                };
                return a.fold(b, b, c, c)
            }, extractEvenRoot: function (a) {
                var b = h([]), c = function (a, b) {
                    return [b]
                };
                return a.fold(b, c, c, c)
            }
        }), uH = function (a, b) {
            return function (c) {
                return a.eq(c, b) || a.property().parent(c).map(function (c) {
                    return a.eq(c, b)
                }).getOr(!1)
            }
        }, T7 = function (a, b, c) {
            return a.eq(b,
                c) ? g.none() : a.property().isBoundary(c) ? a.query().nextSibling(c) : a.property().isEmptyTag(c) ? (b = uH(a, b), b(c) ? a.query().nextSibling(c) : zd.breakPath(a, c, b, zd.breakToRight).second()) : g.none()
        }, U7 = function (a, b, c) {
            if (a.eq(b, c)) return g.none();
            if (a.property().isBoundary(c)) return a.query().prevSibling(c);
            if (a.property().isEmptyTag(c)) {
                var d = uH(a, b);
                return d(c) ? a.query().prevSibling(c) : a.query().prevSibling(c).map(function (b) {
                    return zd.breakPath(a, b, d, zd.breakToRight).first()
                })
            }
            return g.none()
        }, vH = function (a,
                          b, c, d) {
            return c(a, b, d).bind(function (c) {
                var d = a.property().children(b);
                return Va(d, function (b) {
                    return a.eq(b, c)
                })
            })
        }, ku = function (a, b) {
            return a.property().isEmptyTag(b) || a.property().isBoundary(b)
        }, lu = {
            create: function (a, b, c) {
                if (ku(a, c) || ku(a, bd.toLeaf(a, c, 0).element())) return [c];
                var d = u(ku, a), e = u(a.eq, b), f = Ca.seekLeft(a, c, d, e).bind(function (c) {
                    return vH(a, b, T7, c)
                }).getOr(0), k = a.property().children(b);
                c = Ca.seekRight(a, c, d, e).bind(function (c) {
                    return vH(a, b, U7, c)
                }).getOr(k.length - 1);
                return a.property().children(b).slice(f,
                    c + 1)
            }
        }, V7 = function (a, b, c, d) {
            return c(b) || d(b) ? g.some(b) : a.up().predicate(b, c, d)
        }, wH = function (a, b, c) {
            c = c();
            a.insert().wrap(b, c);
            return og.created(b, c)
        }, W7 = function (a, b, c, d) {
            var e = d();
            a.insert().before(c[0], e);
            z(c, function (b) {
                a.insert().append(e, b)
            });
            return og.created(b, e)
        }, X7 = function (a, b, c, d, e, f, k) {
            if (f(c)) {
                var g = a.property().children(b);
                if (d < g.length && k(g[d])) return og.actual(c, g[d])
            }
            return e(b).fold(function () {
                return og.root(c, b)
            }, function (e) {
                if (f(c)) {
                    var k = e(), g = a.property().children(b), l = g[d];
                    void 0 !== l && (e = lu.create(a, b, l, e), a.insert().appendAll(k, 0 < e.length ? e : [l]));
                    ju.atStartOf(a, b, Math.min(g.count, d), k);
                    return og.created(b, k)
                }
                a.property().isEmptyTag(c) ? e = wH(a, c, e) : (k = lu.create(a, b, c), e = 0 < k.length ? W7(a, c, k, e) : wH(a, c, e));
                return e
            })
        }, Y7 = {
            single: function (a, b, c, d, e, f) {
                return V7(a, c, b, f).fold(og.none, function (k) {
                    return f(k) ? X7(a, k, c, d, e, f, b) : og.actual(c, k)
                })
            }
        }, xH = {resolve: Lb.create("ephox-soldier").resolve}, mi = xH.resolve("quasi-block"), yH = function (a) {
            a = A.children(a);
            return 1 === a.length &&
                "br" === D.name(a[0])
        }, zH = function (a) {
            return n.has(a, mi) && !yH(a)
        }, vo = {
            condense: function (a) {
                a = ka(a, function (a, c) {
                    if (!D.isElement(a)) return !0;
                    n.has(a, mi) && yH(a) && (A.prevSibling(a).exists(zH) || A.nextSibling(a).exists(zH)) ? (F.remove(a), a = !1) : a = !0;
                    return a
                });
                return E(a, function (a) {
                    var b = D.isElement(a) ? [a].concat(Y.descendants(a, "." + mi)) : [];
                    z(b, function (a) {
                        n.remove(a, mi)
                    });
                    return a
                })
            }, register: function (a) {
                return function (b) {
                    return a(b).map(function (a) {
                        return function () {
                            var b = a();
                            n.add(b, mi);
                            return b
                        }
                    })
                }
            },
            style: h(mi)
        }, Z7 = nb(), Dj = {
            single: function (a, b, c, d, e) {
                return Y7.single(Z7, a, b, c, vo.register(d), e)
            }, isBlock: function (a) {
                return U("ol p div ul table caption td th h1 h2 h3 h4 h5 h6 body blockquote pre".split(" "), D.name(a))
            }
        }, Ik = {
            tag: function () {
                return "p"
            }, nu: function (a) {
                return u(a.create().nu, "p")
            }
        }, mu = function (a) {
            return 0 < a.length ? g.some(a[0]) : g.none()
        },
        Jk = ta.generate([{descend: ["index"]}, {leftOf: ["rindex"]}, {bounded: ["lindex", "rindex"]}, {rightOf: ["lindex"]}, {all: []}]),
        AH = {
            derive: function (a, b) {
                return a.bind(mu).fold(function () {
                    return b.bind(mu).fold(function () {
                            return Jk.all()
                        },
                        function (a) {
                            return Jk.leftOf(a)
                        })
                }, function (a) {
                    return b.bind(mu).fold(function () {
                        return Jk.rightOf(a)
                    }, function (b) {
                        return a === b ? Jk.descend(a) : Jk.bounded(a, b)
                    })
                })
            }, cata: function (a, b, c, d, e, f) {
                return a.fold(b, c, d, e, f)
            }
        }, BH = function (a, b, c) {
            return g.from(a.property().children(b)[c])
        }, $7 = function (a, b, c) {
            var d = a.property().children(c), e = BH(a, c, 0).bind(function (e) {
                return BH(a, c, d.length - 1).map(function (d) {
                    return nu(a, b, c, e, d)
                })
            }).getOr([]);
            return Bc.container(c, e)
        }, nu = function (a, b, c, d, e) {
            var f = CH(a, c, b, d);
            return Bc.toLastTarget(f).filter(function (b) {
                return !a.eq(e, b)
            }).bind(function (d) {
                return Ca.walk(a, d, Ca.sidestep, Ca.walkers().right()).bind(function (d) {
                    if (a.eq(c, d.item())) return g.none();
                    d = nu(a, b, c, d.item(), e);
                    return g.some([f].concat(d))
                })
            }).getOrThunk(function () {
                return [f]
            })
        }, CH = function (a, b, c, d) {
            if (Nc.isFormatting(a, d)) return Bc.block(d);
            if (Nc.isEmptyTag(a, d)) return Bc.fixture(d);
            if (Nc.isBlock(a, d) || Nc.isContainer(a, d)) return $7(a, c, d);
            a = lu.create(a, b, d);
            return Bc.quasi(0 < a.length ? a : [d])
        }, DH = function (a,
                          b, c) {
            return CH(a, c, b, c)
        }, ou = function (a, b, c, d, e, f, k, l) {
            c = c.map(function (c) {
                return Kk(a, b, c, k.bind(lg.tail), g.none())
            }).getOr([]);
            e = e.map(function (c) {
                return Kk(a, b, c, g.none(), l.bind(lg.tail))
            }).getOr([]);
            d = 0 === d.length ? [] : nu(a, b, f, d[0], d[d.length - 1]);
            return [Bc.container(f, c.concat(d).concat(e))]
        }, Kk = function (a, b, c, d, e) {
            var f = a.property().children(c);
            d.bind(lg.head).getOr(0);
            e.bind(lg.head).getOr(f.length - 1);
            var k = AH.derive(d, e);
            return AH.cata(k, function (c) {
                    return Kk(a, b, f[c], d.bind(lg.tail), e.bind(lg.tail))
                },
                function (k) {
                    return ou(a, b, g.none(), f.slice(0, k), g.from(f[k]), c, d, e)
                }, function (k, h) {
                    return ou(a, b, g.from(f[k]), f.slice(k + 1, h), g.from(f[h]), c, d, e)
                }, function (k) {
                    return ou(a, b, g.from(f[k]), f.slice(k + 1), g.none(), c, d, e)
                }, function () {
                    return [DH(a, b, c)]
                })
        }, EH = {
            categorise: DH, within: function (a, b, c, d, e) {
                return !0 === lg.isBefore(d, e) ? Kk(a, b, c, g.some(d), g.some(e)) : Kk(a, b, c, g.some(e), g.some(d))
            }
        }, pu = function (a, b) {
            if ("li" !== D.name(a)) return !1;
            a = hb(b, function (a, b) {
                return 1 < a.quasi || 0 < a.nonlist ? a : Bc.cata(b, function () {
                    return {
                        quasi: 1 +
                            a.quasi, nonlist: a.nonlist
                    }
                }, function () {
                    return {quasi: a.quasi, nonlist: 1 + a.nonlist}
                }, function (b) {
                    return {quasi: a.quasi, nonlist: (U(["ul", "ol"], D.name(b)) ? 0 : 1) + a.nonlist}
                }, function () {
                    return {quasi: 1 + a.quasi, nonlist: a.nonlist}
                })
            }, {quasi: 0, nonlist: 0});
            return 1 >= a.quasi && 0 === a.nonlist
        }, qu = function (a, b, c) {
            return 0 >= c.length ? !0 : U(a, D.name(b)) ? 2 < c.length ? !1 : 1 === c.length ? Bc.isQuasiOrFixture(c[0]) : Bc.isQuasiOrFixture(c[0]) && Bc.isQuasiOrFixture(c[1]) && !ob(c, Bc.isFixture) : !1
        }, Ud = {
            wrap: function (a) {
                if (0 === a.length ||
                    1 === a.length && D.isText(a[0]) && 0 === Ya.get(a[0]).trim().length) return [];
                var b = r.fromTag(Ik.tag());
                n.add(b, vo.style());
                y.before(a[0], b);
                P.append(b, a);
                return [b]
            }, handleContainer: function (a, b, c, d) {
                if (qu(a, b, c)) return [b];
                var e = pu(b, c) ? [b] : [];
                return e.concat(ia(c, function (a) {
                    return d(a, 0 < e.length)
                }))
            }, hasSimpleContent: qu, isNestedList: pu, handleRoot: function (a, b) {
                b = EH.categorise(nb(), u(N.eq, b), b, b, b);
                var c = function () {
                    return g.some(Ik.nu(nb()))
                }, d = g.none;
                return Bc.cata(b, c, d, function (b, f) {
                    return qu(a, b, f) ||
                    pu(b, f) ? d() : c()
                }, c)
            }
        }, wo = ["li", "td", "th", "caption"], FH = function (a, b) {
            return Bc.cata(a, function (a) {
                return !0 === b ? [] : Ud.wrap(a)
            }, function (a) {
                return [a]
            }, function (a, b) {
                return Ud.handleContainer(wo, a, b, FH)
            }, function (a) {
                return !0 === b ? [] : Ud.wrap([a])
            })
        }, a8 = {
            isRootContainer: qo.isRootOrContainer, extract: function (a) {
                return FH(a, !1)
            }, isCapable: function (a) {
                return Dj.isBlock(a) || U(wo, D.name(a))
            }, canUse: function (a) {
                return pa.isFormatting(a) || U(wo, D.name(a))
            }, quasi: u(Ud.handleRoot, wo), ascend: ca
        }, GH = Aa(["start", "soffset",
            "finish", "foffset", "all"], []), HH = Aa(["start", "soffset", "finish", "foffset"], []), ni = {
            block: GH, inline: HH, blockFrom: function (a) {
                return 0 < a.length ? g.some(GH({
                    start: a[0],
                    soffset: 0,
                    finish: a[a.length - 1],
                    foffset: wa.getEnd(a[a.length - 1]),
                    all: a
                })) : g.none()
            }, inlineFrom: function (a) {
                return a.map(function (a) {
                    return HH({start: a.start(), soffset: a.soffset(), finish: a.finish(), foffset: a.foffset()})
                })
            }
        }, xo = function (a) {
            return Fa.is(a, "td,th")
        }, IH = function (a) {
            return N.eq(a.startContainer(), a.endContainer()) && a.startOffset() ===
                a.endOffset()
        }, JH = function (a, b) {
            return a(b.startContainer()) ? g.some(kb.freefallLtr(b.startContainer())) : g.none()
        }, KH = function (a, b) {
            return (a(b.endContainer()) ? g.some(kb.freefallRtl(b.endContainer())) : g.none()).map(function (a) {
                return Fa.is(a.element(), "br") && !1 === IH(b) ? W.point(a.element(), 1) : a
            })
        }, Vd = {
            is: xo, isCollapsed: IH, isWholeCell: function (a) {
                return xo(a.startContainer()) && N.eq(a.startContainer(), a.endContainer()) && 0 === a.startOffset() && a.endOffset() === wa.getEnd(a.endContainer())
            }, left: u(JH, xo), leftWith: JH,
            right: u(KH, xo), rightWith: KH
        }, ru = O("startContainer", "startOffset", "endContainer", "endOffset"),
        su = O("start", "soffset", "finish", "foffset"), Ub = {
            hare: ru, fussy: su, fromHare: function (a) {
                return su(a.startContainer(), a.startOffset(), a.endContainer(), a.endOffset())
            }, fromFussy: function (a) {
                return ru(a.start(), a.soffset(), a.finish(), a.foffset())
            }, fussyFromElements: function (a) {
                if (0 === a.length) return g.none();
                var b = a[0];
                a = a[a.length - 1];
                b = A.firstChild(b).getOr(b);
                a = A.lastChild(a).getOr(a);
                return g.some(su(b, 0, a, wa.getEnd(a)))
            },
            hareFromElement: function (a) {
                return ru(a, 0, a, wa.getEnd(a))
            }
        }, LH = function (a, b) {
            return b(a) ? g.some([]) : A.parent(a).bind(function (c) {
                return A.findIndex(a).bind(function (a) {
                    return LH(c, b).map(function (b) {
                        return b.concat([a])
                    })
                })
            })
        }, MH = function (a, b) {
            return 0 === b.length ? g.some(a) : A.child(a, b[0]).bind(function (a) {
                return MH(a, b.slice(1))
            })
        }, oi = {
            path: function (a, b) {
                var c = u(N.eq, a);
                return N.eq(a, b) ? g.some([]) : LH(b, c)
            }, follow: MH
        }, NH = O("ancestor", "startPath", "finishPath"), b8 = function (a, b, c) {
            return nf.ancestors(b,
                c, a).shared().bind(function (a) {
                return oi.path(a, b).bind(function (b) {
                    return oi.path(a, c).map(function (c) {
                        return NH(a, b, c)
                    })
                })
            })
        }, OH = function (a, b, c, d) {
            var e = b.isRootContainer(a);
            c = Dj.single(b.isCapable, c, d, b.quasi, e);
            c = og.extractEvenRoot(c);
            return 1 === c.length ? g.some(c[0]).map(function (c) {
                return b.ascend(c, a)
            }) : g.none()
        }, PH = function (a, b, c, d) {
            if (!1 === b(c)) return W.point(c, d);
            d < wa.getEnd(c) || a.isCapable(c) && a.canUse(c) ? c = kb.toLeaf(c, d) : (a = r.fromTag("br"), y.append(c, a), c = W.point(a, 0));
            return c
        }, c8 = {
            branch: function (a,
                              b, c, d, e, f) {
                var k = b.isRootContainer(a), l = Ub.hare(c, d, e, f), q = h(!0 === Vd.isWholeCell(l)),
                    C = Vd.left(l).filter(q).getOrThunk(function () {
                        return PH(b, k, c, d)
                    }), w = Vd.right(l).filter(q).getOrThunk(function () {
                        return PH(b, k, e, f)
                    });
                return OH(a, b, C.element(), C.offset()).bind(function (c) {
                    return (N.eq(C.element(), w.element()) && C.offset() === w.offset() ? g.some(c) : OH(a, b, w.element(), w.offset())).bind(function (b) {
                        return N.eq(c, b) ? g.some(NH(c, [], [])) : b8(a, c, b)
                    })
                })
            }
        }, QH = function (a, b, c, d, e, f, k) {
            a = b.isRootContainer(a)(c);
            b =
                !a && ja.inBody(c) ? W.point(c, d) : a || !b.isCapable(c) || ja.inBody(c) ? ja.inBody(e.element()) && U(["td", "th"], D.name(c)) ? e : !ja.inBody(c) && ja.inBody(f.element()) && "br" == D.name(f.element()) ? f : kb.toLeaf(k, 0) : W.point(k, d);
            wa.getEnd(b.element());
            return b.offset() <= wa.getEnd(b.element()) ? g.some(b) : g.none()
        }, pi = {
            applyOn: function (a, b, c, d, e, f, k) {
                var l = id.after(c, d, e, f), h = b.isRootContainer(a)(c) ? kb.toLeaf(c, d) : W.point(c, d),
                    C = b.isRootContainer(a)(e) ? kb.toLeaf(e, f) : W.point(e, f), w = kb.toLeaf(c, d), m = kb.toLeaf(e, f),
                    n = c8.branch(a,
                        b, c, d, e, f).map(function (b) {
                        return EH.within(nb(), a, b.ancestor(), b.startPath(), b.finishPath())
                    }).getOr([]);
                n = ia(n, b.extract);
                z(n, function (a) {
                    0 === A.children(a).length && pa.isFormatting(a) && y.append(a, r.fromTag("br"))
                });
                n = vo.condense(n);
                var p = k(n);
                return 0 === p.length ? g.none() : QH(a, b, c, d, h, w, p[l ? p.length - 1 : 0]).bind(function (c) {
                    return QH(a, b, e, f, C, m, p[l ? 0 : p.length - 1]).map(function (a) {
                        return ni.block({
                            start: c.element(),
                            soffset: c.offset(),
                            finish: a.element(),
                            foffset: a.offset(),
                            all: p
                        })
                    })
                })
            }
        }, tu = function (a) {
            return function (b) {
                return a
            }
        },
        RH = {
            start: ae.onDirection("left", "right"),
            end: ae.onDirection("right", "left"),
            justify: tu("justify"),
            center: tu("center"),
            "match-parent": tu("match-parent")
        }, d8 = {
            hasAlignment: function (a, b, c) {
                D.isText(a) ? a = !1 : (b = v.get(a, b), a = (void 0 !== RH[b] ? RH[b](a) : b) === c);
                return a
            }
        }, e8 = function (a, b, c) {
            return d8.hasAlignment(c, a, b)
        }, yo = function (a, b, c) {
            var d = OU(b, c);
            return {
                run: function (a, b, c, g, h) {
                    return pi.applyOn(a, a8, b, c, g, h, function (a) {
                        var b = ob(a, d.is) ? d.remove : d.set;
                        z(a, b);
                        return a
                    })
                }, query: function (a, d) {
                    var e = u(e8,
                        b, c);
                    return mH.bothMatch(a, d, e)
                }, name: h(a)
            }
        }, f8 = yo("JustifyLeft", "text-align", "left"), g8 = yo("JustifyCenter", "text-align", "center"),
        h8 = yo("JustifyRight", "text-align", "right"), i8 = yo("JustifyFull", "text-align", "justify"),
        le = {justifyleft: h(f8), justifycentre: h(g8), justifyright: h(h8), justifyfull: h(i8)}, SH = function (a) {
            a = a.dom();
            if (af.isSupported(a)) {
                var b = a.style.marginLeft;
                return "auto" === a.style.marginRight && "auto" === b
            }
            return !1
        }, uu = {
            isCentered: SH, divine: function (a) {
                if (SH(a)) return g.some("center");
                var b =
                    v.getRaw(a, "float").getOrThunk(function () {
                        return v.get(a, "float")
                    });
                return void 0 !== b && null !== b && 0 < b.length ? g.some(b) : g.none()
            }, getRaw: function (a) {
                return v.getRaw(a, "float").getOr(null)
            }, setCentered: function (a) {
                v.setAll(a, {"margin-left": "auto", "margin-right": "auto"})
            }
        }, j8 = {
            left: {"float": "left", margin: ""},
            right: {"float": "right", margin: ""},
            none: {"float": "none", margin: ""},
            center: {"float": "", margin: "0 auto"}
        }, TH = {none: {display: ""}, left: {display: ""}, right: {display: ""}, center: {display: "block"}},
        UH = function (a,
                       b) {
            return uu.divine(a).is(b)
        }, VH = function (a, b) {
            var c = "img" === D.name(a) && void 0 !== TH[b] ? TH[b] : {};
            g.from(j8[b]).each(function (b) {
                v.setAll(a, b);
                v.setAll(a, c)
            })
        }, zo = function (a, b) {
            return {
                run: function (a) {
                    VH(a, b);
                    return g.none()
                }, query: function (a) {
                    return UH(a, b)
                }, name: h(a)
            }
        }, k8 = zo("JustifyLeft", "left"), l8 = zo("JustifyCenter", "center"), m8 = zo("JustifyRight", "right"),
        n8 = zo("FloatNone", "none"), oh = {
            floatnone: h(n8),
            floatleft: h(k8),
            floatcentre: h(l8),
            floatright: h(m8),
            queryIsFloat: UH,
            runFloat: VH
        }, WH = function (a) {
            return Bc.cata(a,
                function (a) {
                    return Ud.wrap(a)
                }, function (a) {
                    return [a]
                }, function (a, c) {
                    return ia(c, WH)
                }, function (a) {
                    return Ud.wrap([a])
                })
        }, XH = {
            isRootContainer: qo.isRootOrContainer, extract: WH, isCapable: function (a) {
                return Dj.isBlock(a) || "li" === D.name(a)
            }, canUse: function (a) {
                return pa.isFormatting(a)
            }, quasi: function (a) {
                return g.some(Ik.nu(nb()))
            }, ascend: ca
        }, vu = O("level", "content", "cruft", "list", "item"), Ao = {
            level: function (a, b) {
                return vu(a.level() + b, a.content(), a.cruft(), a.list(), a.item())
            }, list: function (a, b) {
                return vu(a.level(),
                    a.content(), a.cruft(), b, a.item())
            }
        }, YH = O("elements", "elementsTransformed"), o8 = O("original", "replaced"), ph = O("result", "items"), Bo = {
            answer: YH, write: function (a, b) {
                var c = [], d = function (b) {
                    var c = a.create().nu("p");
                    a.insert().appendAll(c, b);
                    return c
                }, e = function (a) {
                    if (0 === a.length) throw"Cannot get tail of an empty array";
                    return a.slice(1)
                }, f = function (b, c) {
                    for (var d = a.create().clone(c[0].list()), g = [], l = c[0]; 0 < c.length && c[0].level() >= b && a.property().name(l.list()) === a.property().name(c[0].list());) {
                        if (c[0].level() ===
                            b) {
                            var h = b;
                            var q = c[0];
                            var m = q;
                            var n = m.item(), p = n;
                            p = a.property().children(p);
                            z(p, a.remove().remove);
                            a.insert().appendAll(n, m.content());
                            m = n;
                            q = q.cruft();
                            for (c = e(c); 0 < c.length && c[0].level() > h;) c = f(h + 1, c), n = [c.result()].filter(u(k, ["li"])), c = c.items(), a.insert().appendAll(m, n);
                            a.insert().appendAll(m, q);
                            h = ph(m, c);
                            c = [h.result()].filter(u(k, ["li"]));
                            h = ph(c, h.items())
                        } else h = f(b + 1, c), c = [h.result()].filter(u(k, ["ul", "ol"])), q = a.create().nu("li"), a.styles().set(q, "list-style-type", "none"), a.attrs().remove(d,
                            "id"), a.insert().appendAll(q, c), h = ph([q], h.items());
                        c = h.items();
                        g = g.concat(h.result())
                    }
                    a.insert().appendAll(d, g);
                    return ph(d, c)
                }, k = function (b, c) {
                    return !(U(b, a.property().name(c)) && 0 === a.property().children(c).length)
                };
                b = function (b) {
                    for (var g = []; 0 < b.length;) {
                        var l = b[0];
                        if (0 === l.level()) {
                            var h = b[0], m = h.content();
                            m = 1 === m.length && Nc.isBlock(a, m[0]) ? m[0] : d(m);
                            c.push(o8(h.item(), m));
                            b = ph(m, e(b));
                            h = [b.result()].filter(u(k, ["p"]));
                            0 === h.length && c.pop();
                            b = b.items();
                            g = g.concat(h);
                            m = b;
                            for (b = []; 0 < m.length && 0 <
                            m[0].level();) m = f(1, m), h = [m.result()].filter(u(k, ["ul", "ol"])), m = m.items(), b = b.concat(h);
                            h = ph(b, m);
                            b = h.items();
                            g = g.concat(h.result());
                            0 < l.cruft().length && (g = g.concat([d(l.cruft())]))
                        } else b = f(1, b), l = [b.result()].filter(u(k, ["ul", "ol"])), b = b.items(), g = g.concat(l)
                    }
                    return ph(g, b)
                }(b);
                if (0 !== b.items().length) throw"Error - there should not be any remaining items to parse";
                return YH(b.result(), c)
            }
        }, ZH = function (a) {
            return hb(a, function (a, c) {
                var b = a.elements().concat(c.elements());
                a = a.elementsTransformed().concat(c.elementsTransformed());
                return Bo.answer(b, a)
            }, Bo.answer([], []))
        }, p8 = {
            combine: ZH, write: function (a, b) {
                b = hm(b, function (b) {
                    return a.property().name(b.list()) + "-" + a.styles().getRaw(b.list(), "list-style-type").getOr("default")
                });
                b = E(b, function (b) {
                    return Bo.write(a, b)
                });
                return ZH(b)
            }
        }, $H = nb(), aI = function (a) {
            return p8.write($H, a)
        }, q8 = function (a) {
            return Bo.write($H, a)
        }, bI = function (a, b, c) {
            return L.closest(a, "li", c).bind(function (a) {
                return b(a, c).map(function (b) {
                    return {item: h(a), outerlist: h(b)}
                })
            })
        }, cI = function (a, b) {
            return Va(a, function (a) {
                return N.eq(a,
                    b)
            })
        }, r8 = function (a, b, c) {
            return cI(a, b).bind(function (b) {
                return cI(a, c).map(function (c) {
                    return a.slice(Math.min(b, c), Math.max(b, c) + 1)
                })
            })
        }, qi = {
            context: function (a, b, c, d, e) {
                return bI(a, c, e).bind(function (f) {
                    return bI(b, c, e).bind(function (c) {
                        if (N.eq(f.outerlist(), c.outerlist())) {
                            if (N.eq(a, b)) var e = [f.item()]; else {
                                var k = f.outerlist();
                                e = f.item();
                                var C = c.item();
                                k = Y.descendants(k, "li");
                                e = r8(k, e, C).getOr([])
                            }
                            c = g.some({
                                outerlist: f.outerlist,
                                startItem: f.item,
                                finishItem: c.item,
                                writer: h(d),
                                selected: h(e)
                            })
                        } else c =
                            g.none();
                        return c
                    })
                })
            }, immediate: function (a, b) {
                return L.closest(a, "ul,ol", b)
            }, topmost: function (a, b) {
                var c = ed.ancestors(a, function (a) {
                    return pa.isList(a) || pa.isContainer(a)
                }, b);
                return Va(c, function (a) {
                    return !U(["li", "ol", "ul"], D.name(a))
                }).map(function (a) {
                    return 0 < a && a - 1 < c.length ? g.some(c[a - 1]) : 0 < c.length ? g.some(c[c.length - 1]) : g.none()
                }).getOrThunk(function () {
                    return 0 < c.length ? g.some(c[c.length - 1]) : g.none()
                })
            }
        }, wu = {
            context: function (a, b, c) {
                return qi.context(a, b, qi.topmost, q8, c)
            }, indent: function (a) {
                return Ao.level(a,
                    1)
            }, outdent: function (a) {
                return Ao.level(a, -1)
            }
        }, s8 = function (a, b) {
            return Xa(a, function (a) {
                return N.eq(b, a)
            })
        }, t8 = {
            operate: function (a, b, c) {
                return E(b, function (b) {
                    return s8(c, b.item()) ? a(b) : b
                })
            }
        }, dI = O("before", "on", "after"), u8 = function (a, b) {
            var c = g.from(E(b, function (b) {
                return a[b]
            })), d = a.slice(0, b[0]);
            b = a.slice(b[b.length - 1] + 1);
            return dI(d, c, b)
        }, v8 = {
            refine: function (a, b) {
                var c = E(a, function (a, c) {
                    return b(a) ? g.some(c) : g.none()
                });
                c = ee(c);
                var d = dI(a, g.none(), []);
                return 0 === c.length ? d : u8(a, c)
            }
        }, xu = function (a,
                          b) {
            var c = Y.children(a, "li,ol,ul");
            return ia(c, function (c) {
                return "li" === D.name(c) ? w8(a, c, b) : xu(c, b + 1)
            })
        }, w8 = function (a, b, c) {
            var d = x8(b), e = [vu(c, d.before(), d.after(), a, b)];
            return d.on().fold(function () {
                return e
            }, function (a) {
                a = ia(a, function (a) {
                    return xu(a, c + 1)
                });
                return e.concat(a)
            })
        }, y8 = function (a) {
            return Fa.is(a, "ol,ul")
        }, x8 = function (a) {
            a = A.children(a);
            return v8.refine(a, y8)
        }, z8 = {
            read: function (a) {
                return xu(a, 1)
            }
        }, A8 = function (a) {
            a = a.elementsTransformed();
            z(a, function (a) {
                v.transfer(a.original(), a.replaced(),
                    ["text-align"]);
                m.transfer(a.original(), a.replaced(), ["dir"])
            })
        }, eI = function (a, b) {
            return qa(b, function (b) {
                return N.eq(b.original(), a)
            }).map(function (a) {
                return a.replaced()
            }).getOr(a)
        }, fI = function (a, b, c, d, e, f) {
            if (0 === a.selected().length) return g.none();
            var k = a.writer(), l = a.outerlist();
            a = a.selected();
            var h = z8.read(l);
            f = f(a);
            f = t8.operate(f, h, a);
            k = k(f);
            A8(k);
            P.before(l, k.elements());
            F.remove(l);
            l = k.elementsTransformed();
            b = eI(b, l);
            d = eI(d, l);
            return g.some(ni.block({
                start: b, soffset: c, finish: d, foffset: e,
                all: k.elements()
            }))
        }, gI = {
            execute: function (a, b, c, d, e, f) {
                return fI(a, b, c, d, e, h(f))
            }, executeUsing: fI
        }, B8 = function (a, b, c, d, e, f, k) {
            return pi.applyOn(a, XH, b, c, d, e, function (a) {
                z(a, function (a) {
                    k.change(a, f)
                });
                return a
            })
        }, hI = function (a, b) {
            return function (c, d, e, f, k, g) {
                var l = qo.isRootOrCell(c);
                return wu.context(d, f, c).fold(function () {
                    return B8(l, d, e, f, k, a, g)
                }, function (a) {
                    return gI.execute(a, d, e, f, k, b)
                })
            }
        }, Yq = {
            indent: function (a, b, c, d, e, f) {
                return hI(1, wu.indent)(a, b, c, d, e, f)
            }, outdent: function (a, b, c, d, e, f) {
                return hI(-1,
                    wu.outdent)(a, b, c, d, e, f)
            }
        }, C8 = {
            isRootContainer: function (a) {
                return function (b) {
                    return a(b) || U(["td", "th", "caption"], D.name(b))
                }
            }, extract: function (a) {
                return Bc.cata(a, function (a) {
                    return [a]
                }, function (a) {
                    return [a]
                }, function (a, c) {
                    return U(["ol", "ul"], D.name(a)) ? [a] : ia(c, Bc.toTarget)
                }, function (a) {
                    return [a]
                })
            }, isCapable: function (a) {
                return pa.isBlock(a)
            }, canUse: h(!1), quasi: function (a) {
                return g.some(Ik.nu(nb()))
            }, ascend: ca
        }, yu = function (a) {
            return Vd.is(a) ? L.descendant(a, "blockquote") : L.closest(a, "blockquote")
        },
        iI = function (a) {
            return nf.sharedOne(yu, a)
        }, D8 = function (a, b, c, d, e) {
            return pi.applyOn(a, C8, b, c, d, e, function (a) {
                var b = r.fromTag("blockquote");
                0 < a.length && (y.before(a[0], b), P.append(b, a), b = Y.descendants(b, "blockquote"), E(b, F.unwrap));
                return a
            })
        }, zu = {
            toggle: function (a, b, c, d, e) {
                return (N.eq(b, d) ? yu(b) : iI([b, d])).fold(function () {
                    return D8(a, b, c, d, e)
                }, function (a) {
                    F.unwrap(a);
                    return g.some(ni.block({start: b, soffset: c, finish: d, foffset: e, all: []}))
                })
            }, queryPoint: yu, queryAll: iI
        }, jI = function (a, b, c, d) {
            var e = a.content(),
                f = a.undo();
            Zb.cata(a.selections().get(), t, jo.multiple(e, a.undo(), d), jo.single(e, f, d, b, c))
        }, kI = function (a) {
            return function (b) {
                var c = 0 < a ? Yq.indent : Yq.outdent, d = Tq(b.region()), e = b.content();
                jI(b, Ek, Dk, function (a, b, g, h) {
                    return c(e.isRoot, a, b, g, h, d)
                })
            }
        }, Co = function (a) {
            return function (b) {
                var c = b.content(), d = function (b, d, k, g) {
                    return a.run(c.isRoot, b, d, k, g)
                };
                Zb.cata(b.selections().get(), t, ko.multiple(c, b.undo(), d), ko.single(c, b.undo(), d, Ek, Dk))
            }
        }, Do = function (a) {
            return function (b) {
                vc.detect(b.content().getSelection()).each(function (c) {
                    Pd.runTransaction(b.content(),
                        b.undo(), function () {
                            (a.query(c.image()) ? oh.floatnone() : a).run(c.image())
                        }, b.content().toEditing)
                })
            }
        }, ce = {
            indent: kI(1),
            outdent: kI(-1),
            blockquote: function (a) {
                var b = a.content();
                jI(a, Ek, Dk, function (a, d, e, f) {
                    return zu.toggle(b.isRoot, a, d, e, f)
                })
            },
            justifyLeft: Co(le.justifyleft()),
            justifyCentre: Co(le.justifycentre()),
            justifyRight: Co(le.justifyright()),
            justifyFull: Co(le.justifyfull()),
            imageNone: Do(oh.floatnone()),
            imageLeft: Do(oh.floatleft()),
            imageCentre: Do(oh.floatcentre()),
            imageRight: Do(oh.floatright()),
            breakQuote: function (a, b, c) {
                H7.breakQuote(b, c).each(function (b) {
                    a.content().setRelativeSelection(b.start(), b.finish());
                    a.content().uiChanged()
                })
            }
        }, E8 = function (a, b) {
            return qa(a, function (a) {
                return a.value() === b
            })
        }, cm = {
            updateMenu: function (a, b, c, d, e) {
                b.fold(a.clear, t, function (b) {
                    (xa(b) ? E8(d, b) : g.some(b)).each(a.select);
                    e.each(function (c) {
                        c = c(b);
                        a.selectElement(c)
                    })
                });
                c.fold(a.disable, t, a.enable);
                b.fold(a.untick, t, function (b) {
                    b = xa(b) ? b : b.value();
                    a.tick(b)
                })
            }
        }, Au = ta.generate([{table: ["selection"]}, {list: ["selection"]}]),
        F8 = function (a, b) {
            return a.isRoot(b) || U(["table", "ul", "ol"], D.name(b))
        }, bm = {
            context: function (a) {
                return a.getSelection().bind(function (b) {
                    if (b.collapsed()) return L.closest(b.startContainer(), "td,th,li", u(F8, a)).map(function (a) {
                        return "li" === D.name(a) ? Au.list(b) : Au.table(b)
                    });
                    var c = id.commonAncestorContainer(b.startContainer(), b.startOffset(), b.endContainer(), b.endOffset());
                    return L.closest(c, "ol,ul", a.isRoot).map(function (a) {
                        return Au.list(b)
                    })
                })
            }, cata: function (a, b, c) {
                return a.fold(b, c)
            }
        }, ri = {
            attr: function (a,
                            b, c) {
                var d = u(m.set, a, b, c);
                a = u(m.remove, a, b);
                0 < c.length ? d() : a()
            }, css: function (a, b, c) {
                var d = u(v.set, a, b, c);
                a = u(v.remove, a, b);
                0 < c.length ? d() : a()
            }
        }, Bu = {resolve: Lb.create("ephox-salmon").resolve}, G8 = Bu.resolve("upload-image-in-progress"),
        H8 = "data-" + Bu.resolve("image-blob"), I8 = "data-" + Bu.resolve("image-upload"),
        uc = {uploadInProgress: h(G8), blobId: h(H8), trackedImage: h(I8)},
        lI = Aa("url alt width height isLocal align".split(" "), ["computedWidth", "computedHeight"]),
        mI = function (a, b) {
            a = m.get(a, b);
            return void 0 !==
            a ? a : ""
        }, Hm = {
            divine: function (a) {
                var b = v.getRaw(a, "width").getOr(""), c = v.getRaw(a, "height").getOr(""),
                    d = v.getRaw(a, "width").getOrThunk(function () {
                        return Ia.get(a) + "px"
                    }), e = v.getRaw(a, "height").getOrThunk(function () {
                        return sa.get(a) + "px"
                    }), f = uu.divine(a);
                return lI({
                    url: mI(a, "src"),
                    alt: mI(a, "alt"),
                    width: b,
                    height: c,
                    computedWidth: d,
                    computedHeight: e,
                    isLocal: m.has(a, uc.blobId()),
                    align: f
                })
            }, properties: lI, apply: function (a, b) {
                m.get(a, "src") === b.url() || b.isLocal() || m.set(a, "src", b.url());
                ri.attr(a, "alt", b.alt());
                ri.css(a, "width", b.width());
                ri.css(a, "height", b.height());
                b.align().each(function (b) {
                    oh.runFloat(a, b)
                })
            }
        }, J8 = {
            hasNoContent: function (a) {
                var b = A.children(a);
                return D.isElement(a) && (0 === b.length || 1 === b.length && "br" === D.name(b[0]))
            }
        }, K8 = O("alignment", "quoted"), nI = function (a) {
            return a.getSelection().fold(function () {
                return !1
            }, function (a) {
                var b = a.startContainer();
                a = a.endContainer();
                return N.eq(b, a) ? zu.queryPoint(b).isSome() : zu.queryAll([b, a]).isSome()
            })
        }, L8 = [le.justifyleft(), le.justifycentre(), le.justifyright(),
            le.justifyfull()], oI = function (a) {
            return vc.detect(a.getSelection()).fold(function () {
                return a.getSelection().bind(function (a) {
                    return qa(L8, function (b) {
                        return b.query(a.startContainer(), a.endContainer())
                    }).map(function (a) {
                        return a.name()
                    })
                }).fold(Da.off, Da.on)
            }, function (a) {
                return Hm.divine(a.image()).align().fold(Da.off, function (a) {
                    return "center" === a ? Da.on(le.justifycentre().name()) : "right" === a ? Da.on(le.justifyright().name()) : Da.on(le.justifyleft().name())
                })
            })
        }, Uq = {
            read: function (a) {
                var b = oI(a);
                a = nI(a) ?
                    Da.on({}) : Da.off();
                return K8(b, a)
            }, alignment: oI, inQuote: nI, atQuoteBreak: function (a) {
                return a.getSelection().bind(function (a) {
                    var b = a.startContainer();
                    return a.collapsed() ? L.closest(b, "blockquote").bind(function (a) {
                        return J8.hasNoContent(b) ? g.some({quote: h(a), element: h(b)}) : g.none()
                    }) : g.none()
                })
            }
        }, fm = {
            multiple: function (a, b, c) {
                return function (d, e) {
                    Pd.runTransaction(a, b, function () {
                        z(e, c)
                    }, a.toEditing)
                }
            }, single: function (a, b, c) {
                return function (d, e) {
                    Pd.runTransaction(a, b, function () {
                        c(e).each(function (b) {
                            a.setSelection(b.start(),
                                b.soffset(), b.finish(), b.foffset())
                        });
                        a.backupSelection()
                    }, a.toEditing)
                }
            }
        }, M8 = nb(), dm = {
            atStartOf: function (a, b, c) {
                ju.atStartOf(M8, a, b, c)
            }
        }, N8 = xH.resolve("style-marker"),
        Rb = {styleSpan: h(N8), overrideSpan: h("data-ephox-override"), quasiBlock: vo.style},
        Lk = ta.generate([{none: []}, {tempIn: ["selection"]}, {tempOut: ["selection"]}, {rangedIn: ["selection"]}, {rangedOut: ["selection"]}]),
        Wq = {
            detect: function (a, b) {
                return a.getSelection().fold(function () {
                    return Lk.none()
                }, function (a) {
                    var c = b(a);
                    return Wa.isCollapsed(a.startContainer(),
                        a.startOffset(), a.endContainer(), a.endOffset()) ? c ? Lk.tempIn(a) : Lk.tempOut(a) : c ? Lk.rangedIn(a) : Lk.rangedOut(a)
                })
            }
        }, pI = function (a, b) {
            return r.fromTag(a, b.dom())
        }, qI = function (a, b, c) {
            c = r.fromTag("span", c.dom());
            v.set(c, a, b);
            return c
        }, Vq = {
            nu: function (a, b, c, d) {
                return "span" === c ? qI(a, b, d) : pI(c, d)
            }, nuTag: pI, nuAttr: function (a, b, c) {
                c = r.fromTag("span", c.dom());
                m.set(c, a, b);
                return c
            }, nuStyle: qI
        }, rI = {"font-weight": {700: "bold", 400: "normal"}}, sI = function (a, b) {
            if (a === b && "" !== b && void 0 !== b) return !0;
            a = a.toLowerCase();
            b = b.toLowerCase().split(" ");
            return U(b, a)
        }, tI = function (a, b) {
            return void 0 !== rI[a] ? (a = rI[a][b], void 0 !== a ? a : b) : b
        }, uI = function (a, b) {
            a = O8(a, b);
            return tI(b, a)
        }, O8 = function (a, b) {
            return (D.isText(a) ? A.parent(a) : g.some(a)).map(function (a) {
                return v.get(a, b)
            }).getOr(void 0)
        }, vj = {
            state: function (a, b, c) {
                a = uI(a, b);
                return "text-decoration" === b ? sI(c, a) : c === a && "" !== a && void 0 !== a
            }, rawState: function (a, b, c) {
                a = tI(b, v.getRaw(a, b).getOr(void 0));
                return "text-decoration" === b ? sI(c, a) : c === a && "" !== a && void 0 !== a
            }, value: uI
        }, vI =
            {
                "text-decoration": function (a, b, c, d) {
                    var e = function (d) {
                        return Ja.closest(d, function (d) {
                            return D.isElement(d) && (U(c, D.name(d)) || v.getRaw(d, a).exists(function (a) {
                                return -1 !== a.indexOf(b)
                            }))
                        }).toArray()
                    };
                    d = e(d.startContainer()).concat(e(d.endContainer()));
                    return Xa(d, function (d) {
                        return U(c, D.name(d)) ? !0 : v.getRaw(d, a).exists(function (a) {
                            return b === a
                        })
                    })
                }
            }, P8 = {
            handle: function (a, b, c) {
                return void 0 !== vI[a] ? g.some(vI[a]) : g.none()
            }
        }, wI = function (a, b) {
            return b.getSelection().map(function (b) {
                return a(b)
            }).getOr(!1)
        },
        Cu = function (a, b, c, d) {
            var e = Vd.leftWith(pa.isBlock, d).getOrThunk(function () {
                return W.point(d.startContainer(), d.startOffset())
            }), f = Vd.rightWith(pa.isBlock, d).getOrThunk(function () {
                return W.point(d.endContainer(), d.endOffset())
            });
            return P8.handle(a, b).fold(function () {
                var c = vj.state(e.element(), a, b), d = vj.state(f.element(), a, b);
                return c || d
            }, function (d) {
                return d(a, b, c, Ub.hare(e.element(), e.offset(), f.element(), f.offset()))
            })
        }, Q8 = function (a, b, c, d) {
            return wI(u(Cu, a, b, c), d)
        }, xI = function (a, b) {
            return R8(a,
                b)
        }, S8 = function (a, b) {
            return wI(u(xI, a), b)
        }, R8 = function (a, b) {
            var c = Vd.leftWith(pa.isBlock, b).fold(b.startContainer, function (a) {
                return a.element()
            });
            b = Vd.rightWith(pa.isBlock, b).fold(b.endContainer, function (a) {
                return a.element()
            });
            c = Db.closest(c, a);
            a = Db.closest(b, a);
            return c || a
        }, yI = function (a, b) {
            return U(a, D.name(b))
        }, T8 = function (a, b) {
            var c = "[" + a + "]";
            return L.closest(b.startContainer(), c).bind(function (d) {
                return L.closest(b.endContainer(), c).bind(function (b) {
                    var c = m.get(d, a);
                    b = m.get(b, a);
                    c = c.toLowerCase();
                    b = b.toLowerCase();
                    return c === b ? g.some(c) : g.none()
                })
            })
        }, Pg = {
            queriesStyle: function (a, b, c) {
                return {queryOn: u(Cu, a, b, c), query: u(Q8, a, b, c)}
            }, queryStyleOn: Cu, queriesTag: function (a) {
                return {queryOn: u(xI, a), query: u(S8, a)}
            }, relatedStyle: function (a, b, c, d) {
                (c = yI(c, d)) || (c = "span" === D.name(d) && vj.state(d, a, b));
                return c
            }, relatedTags: yI, queryAttrSame: function (a, b) {
                return b.getSelection().bind(function (b) {
                    return T8(a, b)
                })
            }, queryAttrIs: function (a, b, c) {
                var d = b.toLowerCase(), e = function (b) {
                    return m.get(b, a).toLowerCase() ===
                        d
                };
                return L.closest(c.startContainer(), "[" + a + "]").filter(e).orThunk(function () {
                    return L.closest(c.endContainer(), "[" + a + "]").filter(e)
                }).isSome()
            }
        },
        Eo = ta.generate([{none: ["last", "mode"]}, {running: ["next", "mode"]}, {split: ["boundary", "last", "mode"]}, {finished: ["element", "mode"]}]),
        Du = O("start", "soffset", "finish", "foffset"), zI = function (a, b, c) {
            c = bd.toLeaf(a, c, 0);
            return Eu(a, c.element()) ? Fu(a, b, c.element()).map(function (a) {
                return W.point(a, 0)
            }).getOr(c) : c
        }, Mk = function (a, b) {
            return Nc.isFrame(a, b) || Nc.isBlock(a,
                b) || U(["li"], a.property().name(b))
        }, Fu = function (a, b, c) {
            return Ca.seekRight(a, c, function (b) {
                return !Eu(a, b) && !Mk(a, b)
            }, b)
        }, Eu = function (a, b) {
            return a.property().isText(b) ? a.property().parent(b).exists(function (b) {
                return U("table tbody thead tfoot tr ul ol".split(" "), a.property().name(b))
            }) : !1
        }, U8 = function (a, b, c, d, e) {
            return Ca.walk(a, d, c, Ca.walkers().right()).fold(function () {
                return Eo.none(d, Ca.sidestep)
            }, function (b) {
                return a.eq(b.item(), e) ? Eo.finished(e, b.mode()) : Mk(a, b.item()) ? Eo.split(b.item(), d,
                    b.mode()) : Eo.running(b.item(), b.mode())
            })
        }, BI = function (a, b, c, d) {
            return Fu(a, b, c).fold(function () {
                return g.none()
            }, function (e) {
                return a.eq(e, d) ? g.some(d) : AI(a, c, e) ? BI(a, b, e, d) : Mk(a, e) ? (e = zI(a, b, e), g.some(e.element())) : g.some(e)
            })
        }, AI = function (a, b, c) {
            return a.property().parent(b).exists(function (b) {
                return a.eq(b, c)
            })
        }, Gu = function (a, b, c, d, e, f) {
            return U8(a, b, c, e, f).fold(function (a, b) {
                return [{start: d, finish: a}]
            }, function (c, e) {
                return Gu(a, b, e, d, c, f)
            }, function (c, l, h) {
                var k = {start: d, finish: l};
                return (AI(a,
                    e, c) ? BI(a, b, c, f) : function () {
                    var d = zI(a, b, c);
                    return a.eq(d.element(), c) ? Ca.walk(a, c, Ca.advance, Ca.walkers().right()).map(function (a) {
                        return a.item()
                    }) : g.some(d.element())
                }()).fold(function () {
                    return [k]
                }, function (c) {
                    return a.eq(c, f) ? [k].concat({start: f, finish: f}) : [k].concat(Gu(a, b, Ca.advance, c, c, f))
                })
            }, function (a, b) {
                return [{start: d, finish: a}]
            })
        }, Hu = function (a, b, c) {
            if (Mk(a, b)) {
                var d = a.property().children(b);
                return 0 <= c && c < d.length ? Hu(a, d[c], 0) : c === d.length ? Hu(a, d[d.length - 1], 0) : b
            }
            return b
        }, CI = function (a,
                          b, c, d) {
            c = Hu(a, c, d);
            return Eu(a, c) ? Fu(a, b, c).getOr(c) : c
        }, V8 = function (a, b, c, d, e, f) {
            var k = CI(a, b, c, d), g = CI(a, b, e, f);
            b = Gu(a, b, Ca.sidestep, k, k, g);
            return E(b, function (b, k) {
                k = a.eq(b.start, c) ? d : 0;
                if (a.eq(b.finish, e)) var g = f; else g = b.finish, g = a.property().isText(g) ? a.property().getText(g).length : a.property().children(g).length;
                return Du(b.start, k, b.finish, g)
            })
        }, DI = function (a, b, c, d, e, f) {
            a.eq(c, e) ? Mk(a, c) ? (d = bd.toLeaf(a, c, d), f = bd.toLeaf(a, c, f), a = a.eq(d.element(), c) && a.eq(f.element(), c) ? [Du(d.element(), d.offset(),
                f.element(), f.offset())] : DI(a, b, d.element(), d.offset(), f.element(), f.offset())) : a = [Du(c, d, c, f)] : a = V8(a, b, c, d, e, f);
            return a
        }, W8 = {collect: DI},
        Ef = ta.generate([{leftEdge: ["element"]}, {between: ["before", "after"]}, {rightEdge: ["element"]}]),
        X8 = function (a, b, c) {
            c = Td.split(a, b, c);
            var d = function () {
                return Ef.rightEdge(b)
            };
            return Td.position(a, c).fold(d, function () {
                return Ef.leftEdge(b)
            }, Ef.between, d)
        }, EI = function (a, b, c, d) {
            if (a.property().isText(b)) return X8(a, b, c);
            if (a.property().isEmptyTag(b)) return d(b);
            a = a.property().children(b);
            b = 0 === c ? Ef.leftEdge(b) : c === a.length ? Ef.rightEdge(b) : 0 < c && c < a.length ? Ef.between(a[c - 1], a[c]) : Ef.rightEdge(b);
            return b
        }, FI = {
            toLeft: function (a, b, c, d) {
                return EI(a, c, d, Ef.leftEdge).fold(function (a) {
                    return a
                }, function (a, b) {
                    return b
                }, function (c) {
                    return Ca.after(a, c, b).getOr(c)
                })
            }, toRight: function (a, b, c, d) {
                return EI(a, c, d, Ef.rightEdge).fold(function (c) {
                    return Ca.before(a, c, b).getOr(c)
                }, function (a, b) {
                    return a
                }, function (a) {
                    return a
                })
            }
        }, Y8 = function (a, b, c, d) {
            var e = a.property().children(b);
            b = function (b) {
                return Va(e,
                    u(a.eq, b))
            };
            c = c.bind(b).getOr(0);
            d = d.bind(b).getOr(e.length - 1);
            return -1 < c && -1 < d ? g.some(e.slice(c, d + 1)) : g.none()
        }, GI = function (a, b, c, d) {
            return zd.breakPath(a, b, function (b) {
                return a.property().parent(b).fold(h(!0), u(a.eq, c))
            }, d)
        }, HI = function (a, b, c, d) {
            a.eq(b, d) ? d = g.none() : (d = GI(a, d, b, Fk.breakToRight), d = g.some(d.first()));
            if (a.eq(b, c)) c = g.none(); else {
                var e = GI(a, c, b, Fk.breakToLeft);
                0 < e.splits().length && a.insert().prepend(e.splits()[0].second(), c);
                c = g.some(e.second().getOr(c))
            }
            return Y8(a, b, c, d)
        }, Z8 = function (a,
                          b, c, d, e) {
            return fu.ancestors(a, c, d, b).shared().orThunk(function () {
                return zd.sharedOne(a, function (c, d) {
                    return b(d) ? g.some(d) : a.up().predicate(d, b)
                }, [c, d])
            }).map(e)
        }, $8 = function (a, b, c, d, e) {
            return Z8(a, b, c, d, e).bind(function (b) {
                return HI(a, b, c, d)
            })
        }, II = {
            fracture: function (a, b, c, d, e) {
                e = void 0 !== e ? e : ca;
                a.eq(c, d) ? (b = e(c), a = a.eq(b, c) ? g.some([c]) : HI(a, b, c, c)) : a = $8(a, b, c, d, e);
                return a
            }
        }, JI = function (a, b, c, d, e, f, k) {
            a.property().isText(c) && a.eq(c, e) ? (c = Td.splitByPair(a, c, d, f), a = II.fracture(a, b, c, c, k)) : (e = FI.toRight(a,
                b, e, f), c = FI.toLeft(a, b, c, d), a = II.fracture(a, b, c, e, k));
            return a
        }, KI = {
            fractures: function (a, b, c, d, e, f, k) {
                c = W8.collect(a, b, c, d, e, f);
                return ia(c, function (c, d) {
                    return JI(a, b, c.start(), c.soffset(), c.finish(), c.foffset(), k).toArray()
                })
            }, fracture: JI
        }, LI = nb(), a9 = {
            fractures: function (a, b, c, d, e, f) {
                return KI.fractures(LI, a, b, c, d, e, f)
            }, fracture: function (a, b, c, d, e, f) {
                return KI.fracture(LI, a, b, c, d, e, f)
            }
        }, qh = {
            makeTo: function (a, b, c) {
                var d = A.owner(a).dom().createRange();
                d.setStart(a.dom(), b);
                d.setEndBefore(c.dom());
                return d
            }, makeFrom: function (a, b, c) {
                var d = A.owner(b).dom().createRange();
                d.setStartAfter(a.dom());
                d.setEnd(b.dom(), c);
                return d
            }, leftEdge: function (a, b, c, d) {
                return id.after(a, b, c, d) ? W.point(c, d) : W.point(a, b)
            }, rightEdge: function (a, b, c, d) {
                return id.after(a, b, c, d) ? W.point(a, b) : W.point(c, d)
            }
        }, b9 = function (a, b) {
            b = cb(b).join(",");
            return (Fa.is(a, b) ? [a] : []).concat(Y.descendants(a, b))
        }, MI = {
            cleanse: function (a, b) {
                a = b9(a, b);
                z(a, function (a) {
                    var c = D.name(a);
                    (void 0 !== b[c] ? b[c] : t)(a)
                })
            }
        }, c9 = {
            onlyEphox: function (a) {
                var b =
                    ma.get(a);
                b = ka(b, function (a, b, e) {
                    return !Gb(a, "ephox-")
                });
                z(b, function (b) {
                    n.remove(a, b)
                })
            }
        }, Nk = function (a) {
            F.unwrap(a)
        }, NI = function (a, b) {
            v.remove(a, b);
            m.hasNone(a) && Nk(a)
        }, OI = function (a) {
            var b = {};
            z(a, function (a) {
                b[a] = rh(Nk)
            });
            return b
        }, rh = function (a) {
            return function (b) {
                m.has(b, "data-ignore") || a.apply(null, arguments)
            }
        }, Jc = {
            cssAndTag: function (a, b, c) {
                a = OI(a);
                c = function (a) {
                    NI(a, b)
                };
                return ua(a, {span: rh(c), font: rh(c)})
            }, tagList: OI, removeStyle: rh(NI), removeAttribute: rh(function (a, b) {
                m.remove(a, b);
                m.hasNone(a) &&
                Nk(a)
            }), unwrap: rh(Nk), unstyle: rh(function (a) {
                c9.onlyEphox(a);
                m.remove(a, "style");
                m.hasNone(a) && Nk(a)
            }), normal: function (a) {
                m.remove(a, "data-ignore")
            }, ignore: function (a) {
                m.set(a, "data-ignore", "true")
            }
        }, Fo = function (a, b) {
            var c = A.children(a);
            z(c, function (a) {
                Fo(a, b)
            });
            b(a)
        }, PI = function (a) {
            return D.isElement(a) && !pa.isEmptyTag(a) && !pa.isFrame(a) && 0 === Ea.get(a).replace(mb(), "").length
        }, si = {
            wipeout: Fo, onEmpty: function (a) {
                Fo(a, function (a) {
                    !D.isElement(a) || pa.isFrame(a) || pa.isEmptyTag(a) || 0 !== Ea.get(a).length ?
                        PI(a) && F.unwrap(a) : F.remove(a)
                })
            }, onQuasiEmpty: function (a) {
                Fo(a, function (a) {
                    PI(a) && F.remove(a)
                })
            }
        }, QI = function (a) {
            return A.parent(a).fold(h([]), function (a) {
                return pa.isBlock(a) ? [a] : [a].concat(QI(a))
            })
        }, d9 = function (a, b) {
            var c = [b].concat(QI(b)), d = kd(c);
            return Va(d, a).map(function (a) {
                return 0 === a ? d[0] : d[a - 1]
            }).getOr(b)
        }, e9 = function (a, b) {
            z(b, function (b) {
                MI.cleanse(b, a);
                si.onQuasiEmpty(b)
            })
        }, Xq = {
            run: function (a, b, c, d) {
                var e = Vd.left(c).getOrThunk(function () {
                    return qh.leftEdge(c.startContainer(), c.startOffset(),
                        c.endContainer(), c.endOffset())
                }), f = Vd.right(c).getOrThunk(function () {
                    return qh.rightEdge(c.startContainer(), c.startOffset(), c.endContainer(), c.endOffset())
                }), k = u(d9, d.matches);
                b = a9.fractures(b, e.element(), e.offset(), f.element(), f.offset(), k);
                b = ia(b, function (b) {
                    if (0 < b.length) {
                        var c = d.purifiers();
                        var e = (0, d.nu)(a);
                        Jc.ignore(e);
                        g.from(b[0]).bind(A.prevSibling).each(si.onQuasiEmpty);
                        g.from(b[b.length - 1]).bind(A.nextSibling).each(si.onQuasiEmpty);
                        z(b, si.onQuasiEmpty);
                        b = ka(b, ja.inBody);
                        0 < b.length ? (y.before(b[0],
                            e), P.append(e, b), e9(c, b), c = [e]) : c = []
                    } else c = [];
                    return c
                });
                z(b, Jc.normal);
                return Ub.fussyFromElements(b)
            }
        }, Iu = function (a, b) {
            return N.eq(a, b) ? [] : A.parent(a).fold(function () {
                return []
            }, function (c) {
                c = Iu(c, b);
                var d = A.findIndex(a).toArray();
                return c.concat(d)
            })
        }, f9 = function (a, b) {
            return a.slice(b + 1)
        }, g9 = function (a, b) {
            return a.slice(0, b)
        }, Ju = function (a, b, c, d) {
            if (0 === d.length) b(c); else {
                var e = d[0], f = d.slice(1);
                A.child(c, e).each(function (c) {
                    Ju(a, b, c, f)
                });
                c = A.children(c);
                e = a(c, e);
                z(e, b)
            }
        }, RI = {
            one: function (a, b) {
                a(b)
            },
            across: function (a, b, c, d) {
                c = Iu(c, b);
                d = Iu(d, b);
                b = A.children(b);
                var e = b.slice(0 < c.length ? c[0] + 1 : 0, 0 < d.length ? d[0] : b.length - 1);
                z(e, a);
                0 < c.length && Ju(f9, a, b[c[0]], c.slice(1));
                0 < d.length && Ju(g9, a, b[d[0]], d.slice(1))
            }
        }, Ok = nb(), ti = {
            split: function (a, b) {
                return Td.split(Ok, a, b)
            }, splitByPair: function (a, b, c) {
                return Td.splitByPair(Ok, a, b, c)
            }, range: function (a, b, c, d) {
                return Td.range(Ok, a, b, c, d)
            }, subdivide: function (a, b) {
                return Td.subdivide(Ok, a, b)
            }, position: function (a) {
                return Td.position(Ok, a)
            }
        }, SI = function (a, b, c) {
            var d =
                A.children(b), e = 0 === c, f = c === d.length, k = 0 < d.length;
            return void 0 !== a.empty && U(["br", "hr", "img"], D.name(b)) ? a.empty : void 0 !== a.hasPrevious && k && 0 < c && c < d.length ? a.hasPrevious : void 0 !== a.hasNext && k && c < d.length - 1 ? a.hasNext : void 0 !== a.rightEdge && k && f ? a.rightEdge : void 0 !== a.first && e ? a.first : a.otherwise
        }, h9 = function (a, b, c) {
            return SI(a.before.element, b, c)(b, c)
        }, i9 = function (a, b, c) {
            return SI(a.after.element, b, c)(b, c)
        }, TI = function (a, b, c) {
            c = ti.split(b, c);
            var d = function (a) {
                return function () {
                    var c = Array.prototype.slice.call(arguments,
                        0);
                    c = [b].concat(c);
                    return a.apply(null, c)
                }
            };
            return ti.position(c).fold(d(a.none), d(a.start), d(a.middle), d(a.end))
        }, j9 = function (a, b, c) {
            return TI(a.before.text, b, c)
        }, k9 = function (a, b, c) {
            return TI(a.after.text, b, c)
        }, Go = {
            prefix: function (a, b, c) {
                return (D.isText(b) ? j9 : h9)(a, b, c)
            }, postfix: function (a, b, c, d, e) {
                b = qh.rightEdge(b, c, d, e);
                return (D.isText(b.element()) ? k9 : i9)(a, b.element(), b.offset())
            }
        }, Ku = function (a, b) {
            return a.bind(function (a) {
                return b.map(function (b) {
                    return {left: h(a), right: h(b)}
                })
            })
        }, l9 = function (a,
                          b, c, d) {
            b = ti.splitByPair(b, c, d);
            return Ku(a.general.insertBefore(b), a.general.insertAfter(b))
        }, m9 = function (a, b, c, d) {
            c = A.child(b, c);
            var e = d < A.children(b).length ? A.child(b, d) : A.lastChild(b);
            return c.bind(function (b) {
                return e.bind(function (c) {
                    return Ku(a.general.insertBefore(b), a.general.insertAfter(c))
                })
            })
        }, WA = {
            both: function (a, b, c, d, e) {
                if (N.eq(b, d)) {
                    var f = D.isText(b) ? l9 : m9;
                    return c > e ? f(a, b, e, c) : f(a, b, c, e)
                }
                f = qh.leftEdge(b, c, d, e);
                b = Go.postfix(a, b, c, d, e);
                a = Go.prefix(a, f.element(), f.offset());
                return Ku(a,
                    b)
            }
        }, Ho = O("inside", "outside"), UI = function (a, b) {
            return A.parent(b).fold(h(!0), function (b) {
                return a(b)
            })
        }, VI = function (a, b) {
            var c = nb();
            a = [a].concat(c.up().all(a));
            var d = [b].concat(c.up().all(b));
            return qa(a, function (a) {
                return Xa(d, u(N.eq, a))
            })
        }, WI = function (a) {
            return Ho(a.second(), g.some(a.first()))
        }, XI = function (a) {
            return Ho(g.some(a.first()), a.second())
        }, YI = function (a) {
            return Ho(g.some(a), g.none())
        }, Lu = function (a, b, c) {
            c = u(UI, c);
            c = c(a) ? a : Ja.ancestor(a, c).getOr(a);
            return N.eq(a, c) ? YI(a) : ZI(a, b, c)
        }, ZI =
            function (a, b, c) {
                a = po.breakPath(a, u(N.eq, c));
                return b(a)
            }, n9 = {
            bridge: function (a, b, c) {
                var d = Lu(a, WI, c), e = Lu(b, XI, c);
                return d.inside().bind(function (a) {
                    return e.inside().bind(function (b) {
                        return VI(a, b).map(function (c) {
                            return {
                                common: h(c), left: h(a), right: h(b), wipeout: function () {
                                    d.outside().each(si.onEmpty);
                                    e.outside().each(si.onEmpty)
                                }
                            }
                        })
                    })
                })
            }, edge: Ho, isSplit: UI, getCommon: VI, onLeft: WI, onRight: XI, onInside: YI, splitFrom: Lu, breaker: ZI
        }, o9 = O("start", "soffset", "finish", "foffset"), Io = h(!1), Mu = function (a, b) {
            return pa.isBlock(b) ||
                pa.isContainer(b) || a(b)
        }, $I = function (a, b) {
            return A.parents(b, u(Mu, a))
        }, aJ = function (a, b, c) {
            return D.isElement(c) && !b(c) ? (a = $I(a, c), !Xa(a, b)) : !1
        }, bJ = function (a, b) {
            return function (c) {
                return Mu(a, c) || aJ(a, b, c)
            }
        }, p9 = function (a, b, c, d, e, f) {
            var k = Wa.isCollapsed(b, c, d, e);
            b = kb.toLeaf(b, c);
            d = kb.toLeaf(d, e);
            var g = Wh.extractTo(b.element(), b.offset(), f, Io), h = Wh.extractTo(d.element(), d.offset(), f, Io),
                m = function (b) {
                    return k || b.offset() !== wa.getEnd(b.element()) ? b : wc.after(b.element(), a).map(function (a) {
                        return W.point(a,
                            0)
                    }).getOr(b)
                }, w = function (b) {
                    return k || 0 !== b.offset() ? b : wc.before(b.element(), a).map(function (a) {
                        return W.point(a, wa.getEnd(a))
                    }).getOr(b)
                };
            return function () {
                return Wh.find(g.element(), g.offset(), Io).map(m).bind(function (a) {
                    return Wh.find(h.element(), h.offset(), Io).map(w).map(function (b) {
                        return o9(a.element(), a.offset(), b.element(), b.offset())
                    })
                })
            }
        }, q9 = {
            applyTo: function (a, b, c, d, e, f, k) {
                var g = bJ(a, k), h = p9(a, c, d, e, f, g);
                a = QU(mb(), mb());
                return WA.both(a, c, d, e, f).bind(function (a) {
                    return n9.bridge(a.left().element(),
                        a.right().element(), g).bind(function (c) {
                        b(c.common(), c.left(), c.right());
                        a.left().cleanup();
                        a.right().cleanup();
                        c.wipeout();
                        return h()
                    })
                })
            }, blockRoot: Mu, pathToTop: $I, isEnclosingInline: aJ, isStopper: bJ
        }, cJ = function (a, b, c, d) {
            var e = function (a) {
                MI.cleanse(a, b)
            };
            return q9.applyTo(a, function (a, b, c, d) {
                if (N.eq(b, c)) RI.one(e, b); else RI.across(e, a, b, c)
            }, c.startContainer(), c.startOffset(), c.endContainer(), c.endOffset(), d)
        }, de = {
            doRemoveAll: function (a, b, c) {
                return cJ(a, b, c, Jb)
            }, doRemoveUpto: cJ, allRules: {
                b: Jc.unwrap,
                strong: Jc.unwrap,
                i: Jc.unwrap,
                em: Jc.unwrap,
                u: Jc.unwrap,
                strike: Jc.unwrap,
                del: Jc.unwrap,
                s: Jc.unwrap,
                sup: Jc.unwrap,
                sub: Jc.unwrap,
                small: t,
                span: Jc.unstyle,
                font: Jc.unstyle
            }
        }, r9 = function (a, b, c) {
            return {
                groups: 0 < a.current.length ? a.groups.concat({parent: a.parent, children: a.current}) : a.groups,
                current: [c],
                parent: b
            }
        }, s9 = function (a, b, c) {
            return {groups: a.groups, current: a.current.concat([c]), parent: b}
        }, t9 = function (a, b, c) {
            return g.from(b.current[b.current.length - 1]).bind(a.query().nextSibling).bind(function (b) {
                return a.eq(b,
                    c) ? g.some(s9) : g.none()
            }).getOr(r9)
        }, u9 = {
            textnodes: function (a, b) {
                b = hb(b, function (b, d) {
                    return a.property().parent(d).fold(function () {
                        return b
                    }, function (c) {
                        return t9(a, b, d)(b, c, d)
                    })
                }, {groups: [], current: [], parent: null});
                return 0 < b.current.length ? b.groups.concat({parent: b.parent, children: b.current}) : b.groups
            }
        }, eJ = function (a, b, c, d, e, f) {
            b = Td.range(a, b, c, d, e);
            return dJ(a, b, f)
        }, dJ = function (a, b, c) {
            if (0 === b.length) return b;
            b = ka(b, function (b) {
                return a.property().isText(b) && 0 < a.property().getText(b).length
            });
            return E(b, function (b) {
                var d = c();
                a.insert().before(b, d.element());
                d.wrap(b);
                return d.element()
            })
        }, v9 = function (a, b) {
            return g.from(b[0]).map(function (c) {
                var d = kg.toLower(a, b[b.length - 1]);
                return W.points(W.point(c, 0), W.point(d.element(), d.offset()))
            })
        }, Pk = {
            wrapWith: eJ, wrapper: dJ, leaves: function (a, b, c, d, e, f) {
                b = kg.toLeaf(a, b, c);
                d = kg.toLeaf(a, d, e);
                f = eJ(a, b.element(), b.offset(), d.element(), d.offset(), f);
                return v9(a, f)
            }, reuse: function (a, b, c, d, e, f, k) {
                b = kg.toLeaf(a, b, c);
                d = kg.toLeaf(a, d, e);
                d = Td.range(a, b.element(),
                    b.offset(), d.element(), d.offset());
                d = u9.textnodes(a, d);
                var g = function (a) {
                    return a.parent
                }, h = function (b) {
                    var c = k();
                    a.insert().before(b.children[0], c.element());
                    z(b.children, c.wrap);
                    return c.element()
                };
                return E(d, function (b) {
                    return (a.property().children(b.parent).length === b.children.length && f(b.parent) ? g : h)(b)
                })
            }
        }, x9 = function (a, b, c, d, e, f) {
            a = w9(a, b, c, d, e, f);
            b = a.cursor();
            b = W.points(W.point(b.element(), b.offset()), W.point(b.element(), b.offset()));
            return g.some({range: h(b), temporary: a.temporary, wrappers: a.wrappers})
        },
        y9 = function (a, b, c, d, e) {
            d = b.dom().ownerDocument;
            var f = a.create().nu("span", d);
            d = a.create().text(mb(), d);
            a.insert().append(f, d);
            (a.property().isEmptyTag(b) ? a.property().parent(b) : g.some(b)).each(function (b) {
                ju.atStartOf(a, b, c, f)
            });
            return {cursor: h(W.point(d, 1)), wrappers: h([f]), temporary: h(!0)}
        }, w9 = function (a, b, c, d, e, f) {
            return a.property().parent(b).bind(function (d) {
                var e = W.point(b, c), k;
                if (k = fJ(a, f, d) && 1 === a.property().children(d).length) k = a.property().isText(b) && a.property().getText(b) === mb();
                return k ?
                    g.some({cursor: h(e), temporary: h(!1), wrappers: h([d])}) : g.none()
            }).getOrThunk(function () {
                return y9(a, b, c, d, e)
            })
        }, fJ = function (a, b, c) {
            return "span" === a.property().name(c) && !1 === b(c)
        }, z9 = function (a, b, c, d, e, f) {
            var k = b.dom().ownerDocument, l = Pk.reuse(a, b, c, d, e, u(fJ, a, f), function () {
                return Sy(a, a.create().nu("span", k))
            });
            return g.from(l[l.length - 1]).map(function (b) {
                var c = a.property().children(b).length;
                b = W.points(W.point(l[0], 0), W.point(b, c));
                return {wrappers: h(l), temporary: h(!1), range: h(b)}
            })
        }, A9 = {
            spans: function (a,
                             b, c, d, e, f) {
                f = void 0 !== f ? f : h(!1);
                return (a.eq(b, d) && c === e ? x9 : z9)(a, b, c, d, e, f)
            }
        }, ui = {
            nu: function (a, b) {
                return Sy(a, b)
            }, wrapWith: function (a, b, c, d, e, f) {
                return Pk.wrapWith(a, b, c, d, e, f)
            }, wrapper: function (a, b, c) {
                return Pk.wrapper(a, b, c)
            }, leaves: function (a, b, c, d, e, f) {
                return Pk.leaves(a, b, c, d, e, f)
            }, reuse: function (a, b, c, d, e, f, k) {
                return Pk.reuse(a, b, c, d, e, f, k)
            }, spans: function (a, b, c, d, e, f) {
                return A9.spans(a, b, c, d, e, f)
            }
        }, vi = nb(), wi = {
            nu: function (a) {
                return ui.nu(vi, a)
            }, wrapWith: function (a, b, c, d, e) {
                return ui.wrapWith(vi,
                    a, b, c, d, e)
            }, wrapper: function (a, b) {
                return ui.wrapper(vi, a, b)
            }, leaves: function (a, b, c, d, e) {
                return ui.leaves(vi, a, b, c, d, e)
            }, reuse: function (a, b, c, d, e, f) {
                return ui.reuse(vi, a, b, c, d, e, f)
            }, spans: function (a, b, c, d, e) {
                return ui.spans(vi, a, b, c, d, e)
            }
        }, B9 = function (a, b, c) {
            a.getSelection().each(function (d) {
                var e = Vd.left(d).getOrThunk(function () {
                    return W.point(d.startContainer(), d.startOffset())
                }), f = Vd.right(d).getOrThunk(function () {
                    return W.point(d.endContainer(), d.endOffset())
                });
                wi.spans(e.element(), e.offset(),
                    f.element(), f.offset(), c).each(function (c) {
                    var d = c.temporary() ? [Rb.styleSpan()] : [], e = c.range();
                    z(c.wrappers(), function (a) {
                        ma.add(a, d);
                        b(a)
                    });
                    c = e.begin();
                    e = e.end();
                    a.setSelection(c.element(), c.offset(), e.element(), e.offset())
                })
            })
        }, gJ = function (a, b, c, d) {
            b(a);
            B9(a, d, c)
        }, gf = {
            style: function (a, b, c, d) {
                return gJ(a, c, d, function (a) {
                    v.setAll(a, b)
                })
            }, generic: gJ
        }, hJ = em("bold", "strong", ["strong", "b"], "font-weight", "bold", "normal"),
        iJ = em("italic", "em", ["em", "i"], "font-style", "italic", "normal"), jJ = em("underline",
        "span", ["u"], "text-decoration", "underline", "none"),
        kJ = em("strikethrough", "span", ["s", "strike", "del"], "text-decoration", "line-through", "none"),
        lJ = function (a, b) {
            var c = function (a, c) {
                return Vq.nuAttr(b, a, c)
            }, d = function (a) {
                return "span" === D.name(a) && m.has(a, b)
            }, e = {
                span: function (a) {
                    Jc.removeAttribute(a, b)
                }
            }, f = function (a, c) {
                return Pg.queryAttrIs(b, a, c)
            }, k = function (a, c) {
                gf.generic(c, t, void 0, function (c) {
                    n.add(c, Rb.styleSpan());
                    m.set(c, b, a)
                });
                return g.none()
            };
            return {
                run: function (a, q, m) {
                    return Wq.detect(q, u(f,
                        m)).fold(function () {
                        return g.none()
                    }, function (a) {
                        var c = ["[", b, '="', m, '"]'].join("");
                        L.closest(a.startContainer(), c).each(F.unwrap);
                        return g.none()
                    }, function (a) {
                        return k(m, q)
                    }, function (b) {
                        return de.doRemoveAll(a, e, b)
                    }, function (b) {
                        return Xq.run(q.doc(), a, b, {nu: u(c, m), matches: d, purifiers: h(e)})
                    })
                }, queryValue: function (a) {
                    return Pg.queryAttrSame(b, a)
                }, name: h(a)
            }
        }("language", "lang"),
        mJ = Ry("superscript", "sup", ["sup", "sub"], {"font-size": "smaller", "vertical-align": "super"}),
        nJ = Ry("subscript", "sub", ["sub",
            "sup"], {"font-size": "smaller", "vertical-align": "sub"}),
        oJ = {bold: hJ, italic: iJ, underline: jJ, strikethrough: kJ, language: lJ, superscript: mJ, subscript: nJ},
        cd = {
            bold: h(hJ),
            italic: h(iJ),
            underline: h(jJ),
            strikethrough: h(kJ),
            language: h(lJ),
            superscript: h(mJ),
            subscript: h(nJ),
            search: function (a) {
                return void 0 !== oJ[a] ? g.some(oJ[a]) : g.none()
            }
        }, xi = function (a, b) {
            return a.query(b)
        }, Yg = {
            bold: u(xi, cd.bold()),
            italic: u(xi, cd.italic()),
            underline: u(xi, cd.underline()),
            strikethrough: u(xi, cd.strikethrough()),
            superscript: u(xi, cd.superscript()),
            subscript: u(xi, cd.subscript()),
            language: u(function (a, b) {
                return a.queryValue(b)
            }, cd.language())
        }, C9 = O("bold", "italic", "underline", "strikethrough", "superscript", "subscript"), yi = function (a, b) {
            return a.on(function (a) {
                return b(a) ? Da.on(!0) : Da.off()
            }).getOrThunk(Da.off)
        }, SU = {
            read: function (a) {
                return C9(yi(a, Yg.bold), yi(a, Yg.italic), yi(a, Yg.underline), yi(a, Yg.strikethrough), yi(a, Yg.superscript), yi(a, Yg.subscript))
            }
        }, Jo = O("startContainer", "startOffset", "endContainer", "endOffset"), Ko = O("item", "start", "finish",
        "text"), Lo = O("items", "abort"), pJ = function (a, b) {
            a = a.property().getText(b);
            return Ko(b, 0, a.length, a)
        }, Nu = function (a, b, c) {
            return Lo([], !0)
        }, D9 = function (a, b, c) {
            return Lo([], !1)
        }, E9 = function (a, b, c) {
            var d = a.property().getText(b);
            return c(d).fold(function () {
                return Lo([Ko(b, 0, d.length, d)], !1)
            }, function (a) {
                a = a[0] === a[1] ? [] : [Ko(b, a[0], a[1], d.substring(a[0], a[1]))];
                return Lo(a, !0)
            })
        }, Ff = {
            detail: pJ, fromItem: function (a, b) {
                return a.property().isText(b) ? pJ(a, b) : Ko(b, 0, 0, "")
            }, decide: function (a, b, c, d) {
                return (a.property().isBoundary(b) ?
                    Nu : a.property().isEmptyTag(b) ? Nu : d(a, b) ? Nu : a.property().isText(b) ? E9 : D9)(a, b, c)
            }
        }, qJ = {
            all: function (a, b) {
                for (var c = b.term(), d = [], e = c.exec(a); e;) {
                    var f = e.index + b.prefix(e);
                    e = e[0].length - b.prefix(e) - b.suffix(e);
                    d.push({start: h(f), finish: h(f + e)});
                    c.lastIndex = f + e;
                    e = c.exec(a)
                }
                return d
            }
        }, F9 = function (a) {
            a = Array.prototype.slice.call(a, 0);
            a.sort(function (a, c) {
                return a.start() < c.start() ? -1 : c.start() < a.start() ? 1 : 0
            });
            return a
        }, G9 = {
            search: function (a, b) {
                b = ia(b, function (b) {
                    var c = qJ.all(a, b.pattern());
                    return E(c,
                        function (a) {
                            return ua(b, {start: a.start, finish: a.finish})
                        })
                });
                return F9(b)
            }
        }, Mo = {
            findall: function (a, b) {
                return qJ.all(a, b)
            }, findmany: function (a, b) {
                return G9.search(a, b)
            }
        }, H9 = new RegExp(Cb.wordbreak() + "+", "g"), rJ = h(0), sJ = function (a) {
            a = Mo.findall(a, Cb.custom(Cb.wordbreak(), rJ, rJ, g.none()));
            return g.from(a[a.length - 1]).map(function (a) {
                return a.start()
            })
        }, Ou = function (a) {
            a = a.search(H9);
            return -1 < a ? g.some(a) : g.none()
        }, Qk = {
            firstWord: function (a) {
                return Ou(a).map(function (b) {
                    return a.substring(0, b + 1)
                })
            }, lastWord: function (a) {
                return sJ(a).map(function (b) {
                    return a.substring(b)
                })
            },
            leftBreak: sJ, rightBreak: Ou, hasBreak: function (a) {
                return Ou(a).isSome()
            }
        }, tJ = Ca.walkers(), uJ = tJ.left(), vJ = tJ.right(), I9 = {
            sibling: uJ.sibling, first: uJ.first, slicer: function (a) {
                return Qk.leftBreak(a).map(function (b) {
                    return [b + 1, a.length]
                })
            }
        }, J9 = {
            sibling: vJ.sibling, first: vJ.first, slicer: function (a) {
                return Qk.rightBreak(a).map(function (a) {
                    return [0, a]
                })
            }
        }, Pu = function (a, b, c, d, e) {
            b = Ca.walk(a, b, c, d).map(function (b) {
                var c = Ff.decide(a, b.item(), d.slicer, e);
                b = c.abort() ? [] : Pu(a, b.item(), b.mode(), d, e);
                return c.items().concat(b)
            }).getOr([]);
            return ka(b, function (a) {
                return 0 < a.text().trim().length
            })
        }, Rk = {
            creepLeft: function (a, b, c) {
                return Pu(a, b, Ca.sidestep, I9, c)
            }, creepRight: function (a, b, c) {
                return Pu(a, b, Ca.sidestep, J9, c)
            }, flatten: function (a, b) {
                return a.property().isText(b) ? [Ff.detail(a, b)] : E(a.down().predicate(b, a.property().isText), function (b) {
                    return Ff.detail(a, b)
                })
            }, isEmpty: function (a, b) {
                return a.property().isText(b) ? !1 : 0 === a.down().predicate(b, a.property().isText).length
            }
        }, Qu = function (a, b) {
            return a.up().closest(b, "[lang]", h(!1)).map(function (b) {
                return a.attrs().get(b,
                    "lang")
            })
        }, zi = {
            nu: function (a) {
                var b = [], c = [], d = [], e = a, f = function (a) {
                    a.each(function (a) {
                        b.push(a)
                    })
                }, k = function (a) {
                    a.each(function (a) {
                        b = b.slice(0, b.length - 1)
                    })
                }, l = function () {
                    0 < d.length && c.push({lang: h(e), details: h(d)})
                }, q = function (a) {
                    l();
                    d = [];
                    e = a
                }, m = function (c) {
                    return c.or(g.from(b[b.length - 1])).getOr(a)
                };
                return {
                    openInline: function (a, b) {
                        b = m(a);
                        b !== e && q(b);
                        f(a)
                    }, closeInline: function (a, b) {
                        k(a)
                    }, addDetail: function (a) {
                        var b = m(g.none());
                        b !== e && q(b);
                        d.push(a)
                    }, addEmpty: function (a) {
                        a = m(g.none());
                        q(a)
                    }, openBoundary: function (a,
                                               b) {
                        f(a);
                        a = m(a);
                        q(a)
                    }, closeBoundary: function (a, b) {
                        k(a);
                        a = m(a);
                        q(a)
                    }, done: function () {
                        l();
                        return c.slice(0)
                    }
                }
            }, calculate: Qu, softBounder: function (a) {
                return function (b, c) {
                    b = Qu(b, c);
                    return !a.equals(b)
                }
            }, strictBounder: function (a, b) {
                return function (c, d) {
                    c = Qu(c, d).getOr(a);
                    return b !== c
                }
            }
        }, wJ = function (a, b, c, d) {
            var e = Rk.creepLeft(a, b, d);
            d = Rk.creepRight(a, c, d);
            b = 0 < e.length ? e[e.length - 1] : Ff.fromItem(a, b);
            a = 0 < d.length ? d[d.length - 1] : Ff.fromItem(a, c);
            e = 0 === e.length && 0 === d.length;
            return {left: h(b), right: h(a), isEmpty: h(e)}
        },
        Sk = {
            byBoundary: function (a, b) {
                var c = h(!1);
                c = wJ(a, b, b, c);
                a = c.isEmpty() && Rk.isEmpty(a, b);
                return {left: c.left, right: c.right, isEmpty: h(a)}
            }, getEdges: wJ, byLanguage: function (a, b) {
                var c = zi.calculate(a, b), d = zi.softBounder(c), e = Rk.creepLeft(a, b, d);
                d = Rk.creepRight(a, b, d);
                a = a.property().isText(b) ? [Ff.detail(a, b)] : [];
                b = kd(e).concat(a).concat(d);
                return {all: h(b), left: h(e), middle: h(a), right: h(d), lang: h(c)}
            }
        }, Ru = function (a, b, c, d) {
            d = a.property().getText(b);
            var e = ka(d.substring(0, c), function (a) {
                    return a !== mb()
                }).length,
                f = ka(d.substring(c, d.length), function (a) {
                    return a === mb()
                }).length;
            a = Sk.byLanguage(a, b);
            b = 0 === e && 0 === a.left().length;
            c = c + f === d.length && 0 === a.right().length;
            return {all: a.all, leftEdge: h(b), rightEdge: h(c), text: h(d)}
        }, No = {
            before: function (a, b, c, d, e) {
                a = Ru(a, b, c, e);
                a.rightEdge() ? b = g.none() : (a = a.all(), 0 === a.length ? b = g.none() : (a = a[a.length - 1], b = g.some(Jo(b, d, a.item(), a.finish()))));
                return b
            }, after: function (a, b, c, d, e) {
                a = Ru(a, b, c, e);
                a.leftEdge() ? b = g.none() : (a = a.all(), 0 === a.length ? b = g.none() : (a = a[0], b = g.some(Jo(a.item(),
                    a.start(), b, d))));
                return b
            }, both: function (a, b, c, d, e, f) {
                return d === e ? g.none() : g.some(Jo(b, d, b, e))
            }, neither: function (a, b, c, d) {
                a = Ru(a, b, c, d);
                a.leftEdge() || a.rightEdge() ? a = g.none() : (b = a.all(), 0 === b.length ? a = g.none() : (a = b[0], b = b[b.length - 1], a = g.some(Jo(a.item(), a.start(), b.item(), b.finish()))));
                return a
            }
        }, xJ = O("before", "after"), K9 = {
            around: function (a, b) {
                var c = a.substring(0, b), d = Qk.leftBreak(c).map(function (a) {
                    return a + 1
                });
                a = a.substring(b);
                a = Qk.rightBreak(a).map(function (a) {
                    return b + a
                });
                var e = xJ(d, a), f =
                    xJ(g.some(b), g.some(b));
                return a.bind(function (a) {
                    return b === a ? g.some(f) : g.none()
                }).getOrThunk(function () {
                    return d.bind(function (a) {
                        return b === a ? g.some(f) : g.none()
                    }).getOr(e)
                })
            }
        }, L9 = {
            word: function (a, b, c, d) {
                if (!a.property().isText(b)) return g.none();
                var e = a.property().getText(b), f = K9.around(e, c);
                return f.before().fold(function () {
                    return f.after().fold(function () {
                        return No.neither(a, b, c, d)
                    }, function (e) {
                        return No.after(a, b, c, e, d)
                    })
                }, function (e) {
                    return f.after().fold(function () {
                        return No.before(a, b, c,
                            e, d)
                    }, function (f) {
                        return No.both(a, b, c, e, f, d)
                    })
                })
            }
        }, M9 = {
            word: function (a, b, c, d) {
                return L9.word(a, b, c, d)
            }
        }, N9 = nb(), O9 = {
            word: function (a, b, c) {
                return M9.word(N9, a, b, c)
            }
        }, yJ = function (a, b, c) {
            O9.word(b, c, h(!1)).each(function (b) {
                a.setSelection(b.startContainer(), b.startOffset(), b.endContainer(), b.endOffset())
            })
        }, Ad = {
            expand: function (a) {
                a.getSelection().each(function (b) {
                    Wa.isCollapsed(b.startContainer(), b.startOffset(), b.endContainer(), b.endOffset()) && yJ(a, b.startContainer(), b.startOffset())
                })
            }, expandWord: yJ
        },
        AJ = function (a, b) {
            var c = Ub.fussy(b, 0, b, A.children(b).length - 1);
            zJ(a, b, c)
        }, Su = function (a) {
            a = A.children(a);
            return 1 === a.length && D.isText(a[0]) && Ya.get(a[0]) === mb()
        }, BJ = function (a, b) {
            return L.closest(a, "." + Rb.styleSpan()).bind(function (a) {
                return L.closest(b, "." + Rb.styleSpan()).filter(function (b) {
                    return N.eq(a, b)
                })
            })
        }, zJ = function (a, b, c) {
            n.remove(b, Rb.styleSpan());
            return m.has(b, Rb.overrideSpan()) ? CJ(a, b, c) : g.some(c)
        }, CJ = function (a, b, c) {
            return P9(b).bind(function (d) {
                if (d.isStyled(b)) {
                    d = d.nu;
                    var e = A.owner(b);
                    e = d(e);
                    y.before(b, e);
                    P.append(e, A.children(b));
                    F.remove(b);
                    d = N.eq(b, c.start()) ? e : c.start();
                    e = N.eq(b, c.finish()) ? e : c.finish();
                    d = g.some(Ub.fussy(d, c.soffset(), e, c.foffset()))
                } else d = Q9(a, b, d.purifiers(), c, d.matches);
                return d
            })
        }, P9 = function (a) {
            a = m.get(a, Rb.overrideSpan());
            return cd.search(a).map(function (a) {
                return a.deferred()
            })
        }, Q9 = function (a, b, c, d, e) {
            b = A.owner(b);
            var f = Ub.fromFussy(d);
            de.doRemoveUpto(a, c, f, e);
            a = "[" + Rb.overrideSpan() + "]";
            return Fa.one(a, b).bind(function (a) {
                F.unwrap(a);
                return ja.inBody(d.start()) &&
                ja.inBody(d.finish()) ? g.some(d) : g.none()
            })
        }, pg = {
            clean: function (a, b) {
                Su(b) ? F.unwrap(b) : AJ(a, b)
            },
            cleanNonEmpty: AJ,
            isTransient: Su,
            withinTransient: BJ,
            handleOverride: CJ,
            apply: function (a, b, c, d, e) {
                var f = Ub.fussy(b, c, d, e);
                return BJ(b, d).bind(function (b) {
                    if (Su(b)) {
                        var c = A.children(b);
                        c = N.eq(b, f.start()) ? Ub.fussy(c[0], 0, c[0], wa.getEnd(c[0])) : f;
                        F.unwrap(b);
                        b = g.some(c)
                    } else b = zJ(a, b, f);
                    return b
                })
            }
        }, Oo = function (a, b) {
            return a.action().run(a.isRoot(), a.environment())
        }, qg = function (a, b) {
            var c = a.temp();
            pg.handleOverride(a.isRoot(),
                c, Ub.fussy(c, 0, c, wa.getEnd(c)));
            return g.some(b)
        }, R9 = function (a, b) {
            y.after(a.temp(), a.cursor());
            return g.some(b)
        }, DJ = function (a, b) {
            y.before(a.temp(), a.cursor());
            return g.some(b)
        }, Tu = function (a, b) {
            var c = a.original();
            dm.atStartOf(c.startContainer(), c.startOffset(), a.cursor());
            return g.some(b)
        }, EJ = function (a, b) {
            var c = a.action().deferred().isStyled(a.temp()), d = a.cursor(), e = g.some(Ub.fussy(d, 1, d, 1));
            c ? a = e : (a.environment().setSelection(d, 0, d, 0), a = Oo(a, b));
            return a
        }, S9 = function (a, b) {
            b = a.cursor();
            var c = a.action().deferred();
            de.doRemoveUpto(a.isRoot(), c.purifiers(), Ub.hare(b, 0, b, 1), c.matches);
            return g.some(Ub.fussy(b, 1, b, 1))
        }, Uu = function (a, b) {
            var c = a.cursor();
            a.environment().setSelection(c, 0, c, 1);
            Oo(a, b);
            return g.some(Ub.fussy(c, 1, c, 1))
        }, FJ = function (a, b) {
            b = a.environment();
            a = a.original();
            b.setSelection(a.startContainer(), a.startOffset(), a.endContainer(), a.endOffset());
            Ad.expand(b);
            return b.getSelection().map(Ub.fromHare)
        }, T9 = function (a, b) {
            var c = a.action().deferred();
            return de.doRemoveUpto(a.isRoot(), c.purifiers(), Ub.fromFussy(b),
                c.matches)
        }, U9 = function (a, b) {
            a.action().deferred().isStyled(a.temp()) ? a = g.some(b) : (a.environment().setSelection(b.start(), b.soffset(), b.finish(), b.foffset()), a = Oo(a, b));
            return a
        }, V9 = function (a, b) {
            a = a.temp();
            b = A.children(a);
            F.unwrap(a);
            return 0 === b.length ? g.none() : g.some(Ub.fussy(b[0], 0, b[b.length - 1], wa.getEnd(b[b.length - 1])))
        }, W9 = O("environment", "isRoot", "cursor", "temp", "action", "original"), X9 = function (a, b) {
            return kc.last(a).fold(h(!0), function (a) {
                return N.eq(a, b.startContainer()) && wa.getEnd(a) ===
                    b.startOffset()
            })
        }, Y9 = function (a, b) {
            return kc.first(a).fold(h(!0), function (a) {
                return N.eq(a, b.startContainer()) && 0 === b.startOffset()
            })
        }, Z9 = function (a, b, c, d, e) {
            var f = m.get(d, Rb.overrideSpan()), k = e.collapsed(), h = r.fromText(mb()), q = X9(d, e), C = Y9(d, e);
            f = a.name() === f;
            var w = W9(c, b, h, d, a, e);
            a = f && pg.isTransient(d) ? [V9] : k && f && q ? [R9, qg, EJ] : k && f && C ? [DJ, qg, EJ] : k && f ? [Tu, qg, S9] : k && q ? [Tu, qg, Uu] : k && C ? [DJ, qg, Uu] : k ? [Tu, qg, Uu] : f ? [qg, FJ, T9, U9] : [qg, FJ, Oo];
            return hb(a, function (a, b) {
                return a.bind(function (a) {
                    return b(w,
                        a)
                })
            }, g.some(Ub.fromHare(e)))
        }, Ai = function (a, b, c) {
            Ad.expand(c);
            var d = c.getSelection().bind(function (d) {
                return pg.withinTransient(d.startContainer(), d.endContainer()).filter(function (a) {
                    return m.has(a, Rb.overrideSpan())
                }).fold(function () {
                    return a.run(b, c)
                }, function (e) {
                    return Z9(a, b, c, e, d)
                })
            });
            return ni.inlineFrom(d)
        }, rd = {
            bold: u(Ai, cd.bold()),
            italic: u(Ai, cd.italic()),
            underline: u(Ai, cd.underline()),
            strikethrough: u(Ai, cd.strikethrough()),
            superscript: u(Ai, cd.superscript()),
            subscript: u(Ai, cd.subscript()),
            removeformat: function (a, b) {
                Ad.expand(b);
                b = b.getSelection().bind(function (b) {
                    return de.doRemoveAll(a, de.allRules, b)
                });
                return ni.inlineFrom(b)
            },
            language: u(function (a, b, c, d) {
                c.getSelection().each(function (a) {
                    pg.apply(b, a.startContainer(), a.startOffset(), a.endContainer(), a.endOffset()).each(function (a) {
                        c.setSelection(a.start(), a.soffset(), a.finish(), a.foffset())
                    })
                });
                Ad.expand(c);
                a = a.run(b, c, d);
                return ni.inlineFrom(a)
            }, cd.language()),
            cleanup: pg.clean,
            cleanupNonEmpty: pg.cleanNonEmpty,
            isTransient: pg.isTransient,
            withinTransient: pg.withinTransient
        }, Po = {
            multiple: function (a, b, c, d) {
                return function (e, f) {
                    Pd.runTransaction(a, b, function () {
                        z(f, c)
                    }, d)
                }
            }, single: function (a, b, c, d) {
                return function (e, f) {
                    Pd.runTransaction(a, b, function () {
                        c(f)
                    }, d)
                }
            }
        }, GJ = function (a, b, c) {
            c = a.create().nu(c);
            var d = a.property().children(b);
            a.insert().append(b, c);
            a.insert().appendAll(c, d);
            return c
        }, HJ = function (a, b, c) {
            c = a.create().nu(c);
            var d = a.property().children(b);
            a.attrs().copyTo(b, c);
            a.insert().before(b, c);
            a.insert().appendAll(c, d);
            a.remove().remove(b);
            return c
        }, Wy = {
            blockTransform: function (a, b, c) {
                return (Nc.isFormatting(a, b) ? HJ : GJ)(a, b, c)
            }, nest: GJ, replace: HJ
        },
        TU = {tags: h("address article aside audio blockquote canvas dd div dl fieldset figcaption figure footer form h1 h2 h3 h4 h5 h6 header hgroup hr li noscript ol output p pre section table tbody td tfoot th thead tr ul video".split(" "))},
        $9 = nb(), a$ = Ty($9), b$ = {div: !0}, IJ = {
            query: function (a, b, c) {
                return a$.query(a, b, c)
            }, apply: function (a, b, c, d, e, f) {
                return pi.applyOn(a, XH, b, c, d, e, function (b) {
                    return E(b,
                        function (b) {
                            if (!b$[f]) {
                                var c = Ub.hareFromElement(b);
                                de.doRemoveAll(a, de.allRules, c)
                            }
                            return Wy.blockTransform(nb(), b, f)
                        })
                })
            }
        }, Bi = {
            background: function (a, b, c) {
                gf.style(a, {"background-color": b}, Ad.expand, c)
            }, addClass: function (a, b, c) {
                gf.generic(a, Ad.expand, c, function (a) {
                    n.add(a, b)
                })
            }, setClass: function (a, b, c) {
                gf.generic(a, Ad.expand, c, function (a) {
                    m.set(a, "class", b)
                })
            }, foreground: function (a, b, c) {
                gf.style(a, {color: b}, Ad.expand, c)
            }, addAttribute: function (a) {
                return function (b, c, d) {
                    gf.generic(b, Ad.expand, d, function (b) {
                        m.set(b,
                            a, c)
                    })
                }
            }, face: function (a, b, c) {
                gf.style(a, {"font-family": b}, Ad.expand, c)
            }, size: function (a, b, c) {
                gf.style(a, {"font-size": b}, Ad.expand, c)
            }
        }, JJ = function (a, b, c, d, e) {
            b = function (b, d, e, f) {
                return a(c.isRoot, b, d, e, f)
            };
            var f = jo.multiple(c, d, b), k = jo.single(c, d, b, Ek, Dk);
            return Zb.cata(e.get(), g.none, function (a, b) {
                return g.some(f(a, b))
            }, function (a, b) {
                return g.some(k(a, b))
            })
        }, Ih = {
            transform: function (a, b, c, d, e) {
                return JJ(function (a, b, c, d, g) {
                    return IJ.apply(a, b, c, d, g, e)
                }, a, b, c, d)
            }, setClass: function (a, b, c, d, e, f) {
                var k =
                    function (a) {
                        L.closest(a, e).each(function (a) {
                            Pd.runTransaction(b, c, function () {
                                m.set(a, "class", f)
                            }, b.toEditing)
                        })
                    };
                Zb.cata(d.get(), t, function (a, b) {
                    z(a, k)
                }, function (a, b) {
                    k(a.startContainer())
                })
            }, inline: function (a, b, c, d, e) {
                a = function (a) {
                    Bi.setClass(a, e, se.isAnnotation)
                };
                Zb.cata(d.get(), t, Po.multiple(b, c, a, b.toEditing), Po.single(b, c, a, b.toEditing))
            }, list: function (a, b, c, d, e) {
                return JJ(a, b, c, d, e)
            }
        }, KJ = O("label", "items"), Ci = function (a, b) {
            return 0 < b.length ? [KJ(g.some(x.key(a)), b)] : []
        }, Yy = {
            groups: function (a,
                              b, c) {
                var d = a.divisions(), e = E(d.blocks().concat(d.classblocks()), a.toCandidate),
                    f = E(d.inlines(), a.toCandidate);
                a = E(d.objects(), a.toCandidate);
                a = Eb(a, function (a, d) {
                    if (Db.closest(b, d.base(), c)) {
                        var e = d.base();
                        a = U(["a"], e) ? ua(a, {link: a.link.concat([d])}) : U(["embed", "img", "object"], e) ? ua(a, {media: a.media.concat([d])}) : U(["hr"], e) ? ua(a, {line: a.line.concat([d])}) : U(["li", "ol", "ul"], e) ? ua(a, {list: a.list.concat([d])}) : U(["table", "tr", "td", "th"], e) ? ua(a, {table: a.table.concat([d])}) : a
                    }
                    return a
                }, {
                    link: [], media: [],
                    line: [], list: [], table: []
                });
                return Qb([[KJ(g.none(), e)], Ci("block.label.inline", f), Ci("block.label.link", a.link), Ci("block.label.media", a.media), Ci("block.label.line", a.line), Ci("block.label.list", a.list), Ci("block.label.table", a.table)])
            }
        }, Qo = function (a, b) {
            return {fold: b}
        }, Rf = {
            inline: function (a, b, c) {
                return Qo("inline", function (d, e, f, k) {
                    return d(a, b, c)
                })
            }, object: function (a, b, c, d) {
                return Qo("object", function (e, f, k, g) {
                    return f(a, b, c, d)
                })
            }, block: function (a, b, c) {
                return Qo("block", function (d, e, f, k) {
                    return f(a,
                        b, c)
                })
            }, classblock: function (a, b, c, d) {
                return Qo("classed block", function (e, f, k, g) {
                    return g(a, b, c, d)
                })
            }, cata: function (a, b, c, d, e) {
                return a.fold(b, c, d, e)
            }
        }, LJ = "h1 h2 h3 h4 h5 h6 div p pre".split(" "), c$ = "a embed hr img li object ol table td tr ul th".split(" "),
        d$ = function (a) {
            var b = a.match(/[\[\]* !#%=+>:~,\^\$]/), c = a.indexOf(".");
            -1 < c && null === b ? (b = a.substring(0, c), a = a.substring(c + 1), a = -1 === a.indexOf(".") ? g.some({
                tag: h(b),
                clazz: h(a)
            }) : g.none()) : a = g.none();
            return a
        }, f$ = function (a, b) {
            var c = a.tag(), d = a.clazz(),
                e = U(LJ, c), f = U(c$, c);
            return (e ? I.value(Rf.classblock) : f ? I.value(Rf.object) : I.error("Rule must have object tag or block tag.")).map(function (e) {
                var f = e$(b, a);
                return e(c, d, f, b.style)
            })
        }, g$ = function (a) {
            return a.text.getOrThunk(function () {
                return x.key("block." + a.name)
            })
        }, h$ = function (a, b) {
            return a.text.getOrThunk(function () {
                return x.pkey("tag.inline.class", [b])
            })
        }, e$ = function (a, b) {
            return a.text.getOrThunk(function () {
                var a = "block." + b.tag(), d = "tag." + b.tag();
                a = (x.has(a) ? x.translate(a) : x.has(d) ? x.translate(d) :
                    b.tag()) + " (" + b.clazz() + ")";
                return x.raw(a)
            })
        }, VU = {
            decipher: function (a) {
                return d$(a.name).fold(function () {
                    return U(LJ, a.name) ? I.value(Rf.block(a.name, g$(a), a.style)) : I.error("Invalid style name: " + a.name)
                }, function (b) {
                    return 0 < b.tag().length ? f$(b, a) : I.value(Rf.inline(b.clazz(), h$(a, b.clazz()), a.style))
                })
            }
        }, UU = function (a, b) {
            return ia(b, function (b) {
                if (Xa(ds(b.cssRules), function (a) {
                    return /ephox-candy-mountain/i.test(a.selectorText)
                })) return [];
                var c = {};
                z(ds(b.cssRules), function (b) {
                    if (b.type === CSSRule.STYLE_RULE) {
                        var d =
                            b.selectorText, e = d.match(/(.*)\[ephox-data\](.*)/i);
                        null === e ? (c.hasOwnProperty(d) || (c[d] = {}), c[d].rule = d, c[d].visibility = a) : (d = e[1] + e[2], c.hasOwnProperty(d) || (c[d] = {}), e = b.style.visibility, "hidden" === e ? c[d].visibility = !1 : "visible" === e && (c[d].visibility = !0), b = b.style.content, xf.isEmpty(b) || (c[d].text = b.replace(/["']/g, "")))
                    }
                });
                return ka(Ze(c), function (a) {
                    return a.hasOwnProperty("rule") && !1 !== a.visibility
                })
            })
        }, i$ = {
            text: function (a) {
                var b = x.get(a.textkey()), c = x.cata(a.textkey(), h(!0), h(!1), h(!1));
                a = c &&
                void 0 === b ? a.value() : b;
                return {text: h(a), unknown: h(c)}
            }
        }, Xy = {
            format: function (a) {
                var b = r.fromText(x.get(a.textkey())), c = T.div();
                n.add(c, B.resolve("format-element-" + a.tag()));
                v.setAll(c, a.styles());
                a = T.div();
                n.add(a, B.resolve("format-element-container"));
                y.append(c, b);
                y.append(a, c);
                return a
            }, face: function (a) {
                var b = i$.text(a), c = b.text();
                c = Rc(c).element();
                v.setAll(c, {"font-family": a.value()});
                a = b.unknown() ? [B.resolve("font-face-unknown")] : [];
                ma.add(c, a);
                return c
            }
        }, YU = function (a, b) {
            a = r.fromTag(a);
            S.hidden(a,
                !0);
            v.set(a, "list-style-type", b);
            b = B.resolve("list-style-content");
            for (var c = 0; 3 > c; c++) {
                var d = r.fromTag("li"), e = T.span();
                n.add(e, b);
                y.append(d, e);
                y.append(a, d)
            }
            return a
        }, XU = function (a, b) {
            b = x.translate(b);
            var c = r.fromText(b), d = T.span();
            n.add(d, B.resolve("list-style-default"));
            m.set(a, "data-" + B.resolve("list-style"), "default");
            m.set(a, "title", b);
            y.append(d, c);
            return d
        }, gm = "data-" + B.resolve("list-style"),
        j$ = ta.generate([{mine: ["element"]}, {other: ["element"]}, {paragraphs: ["elements"]}]), wj = ua(j$, {
            cata: function (a,
                            b, c, d) {
                return a.fold(b, c, d)
            }
        }), k$ = function (a, b, c) {
            var d = D.name(a);
            return v.getRaw(a, "list-style-type").fold(function () {
                return d === b && c.isNone()
            }, function (a) {
                return c.exists(function (c) {
                    return d === b && a === c
                })
            })
        }, aV = {
            categorise: function (a, b, c) {
                a = hm(a, function (a) {
                    return pa.isList(a) ? !0 : A.parent(a).map(function (a) {
                        return a.dom()
                    }).getOr(!1)
                });
                return ia(a, function (a) {
                    return ob(a, pa.isList) ? E(a, function (a) {
                        return k$(a, b, c) ? wj.mine(a) : wj.other(a)
                    }) : [wj.paragraphs(a)]
                })
            }
        }, MJ = function (a) {
            return Bc.cata(a, function (a) {
                    return Ud.wrap(a)
                },
                function (a) {
                    return [a]
                }, function (a, c) {
                    return pa.isList(a) ? [a] : ia(c, MJ)
                }, function (a) {
                    return Ud.wrap([a])
                })
        }, l$ = {
            isRootContainer: function (a) {
                return function (b) {
                    return a(b) || pa.isContainer(b) && "li" !== D.name(b)
                }
            }, extract: MJ, isCapable: pa.isBlock, canUse: h(!1), quasi: function () {
                return g.some(Ik.nu(nb()))
            }, ascend: function (a, b) {
                return L.closest(a, "ol,ul", b).getOr(a)
            }
        }, m$ = function (a, b, c) {
            var d = r.fromTag(b);
            c.each(function (a) {
                v.set(d, "list-style-type", a)
            });
            return Ao.list(a, d)
        }, sh = {
            hasSameType: function (a, b) {
                return D.name(a) ===
                    b
            }, hasSameStyle: function (a, b) {
                var c = v.getRaw(a, "list-style-type");
                return b.fold(function () {
                    return c.isNone()
                }, function (a) {
                    return c.is(a)
                })
            }, convertOr: function (a, b, c, d, e) {
                return function (f) {
                    return d(f.list(), a) && e(f.list(), b) ? c(f) : m$(f, a, b)
                }
            }, topContext: function (a, b, c) {
                return qi.context(a, b, qi.topmost, aI, c)
            }, context: function (a, b, c) {
                return qi.context(a, b, qi.immediate, aI, c)
            }, unapply: function (a) {
                return Ao.level(a, -1 * a.level())
            }
        }, Tk = nb(), n$ = Ty(Tk), o$ = function (a) {
            a = E(a, function (a) {
                return L.ancestor(a, "ul,ol")
            });
            var b = E(a, function (a) {
                return a.fold(function () {
                    return "-"
                }, function (a) {
                    return D.name(a) + "-" + v.get(a, "list-style-type")
                })
            }), c = b[0];
            return ob(b.slice(1), function (a) {
                return a === c
            }) ? a[0] : g.none()
        }, NJ = function (a, b, c) {
            var d = $U(Tk, a, c), e = function (a, b, c, e, f, g) {
                return pi.applyOn(a, l$, b, c, e, f, function (b) {
                    return d.apply(a, g, b)
                })
            }, f = function (b, d, e) {
                b = b.selected();
                return 0 < b.length && o$(b).map(function (b) {
                    return d(b, a) && e(b, c)
                }).getOr(!1)
            };
            return {
                query: function (c) {
                    return n$.queryAll(c.startContainer(), c.endContainer(),
                        ["ul", "ol"], b).exists(function (b) {
                        return b === a
                    })
                }, queryStyle: function (a) {
                    var d = c.fold(function () {
                        return ":not([style])"
                    }, function (a) {
                        return '[style*="list-style-type: ' + a + ';"]'
                    });
                    return Tk.up().closest(a.startContainer(), "ol, ul", b).exists(function (c) {
                        return Tk.up().closest(a.endContainer(), "ol, ul", b).exists(function (a) {
                            return c.dom() === a.dom() ? Tk.is(c, d) : !1
                        })
                    })
                }, apply: function (b, d, g, m, w, n, p) {
                    var k = p ? h(!0) : sh.hasSameStyle, l = function () {
                        return e(b, d, g, m, w, n)
                    }, q = function (b, e) {
                        return gI.executeUsing(b,
                            d, g, m, w, function () {
                                return sh.convertOr(a, c, e, sh.hasSameType, k)
                            })
                    }, C = function () {
                        return sh.topContext(d, m, b).fold(l, function (a) {
                            return q(a, sh.unapply)
                        })
                    };
                    return sh.context(d, m, b).fold(l, function (a) {
                        return f(a, sh.hasSameType, k) ? C() : q(a, ca)
                    })
                }
            }
        }, im = {unordered: u(NJ, "ul"), ordered: u(NJ, "ol")}, OJ = function (a, b, c, d) {
            return function (c) {
                var e = d(c.content().isRoot, g.none());
                return {
                    toggle: !0, value: a, textkey: x.key(b), icon: !0, tooltip: qb.get, updateGeneral: function (a) {
                        c.content().getSelection().each(function (b) {
                            (e.query(b) ?
                                Da.on(!0) : Da.off()).fold(a.deselect, t, a.select)
                        })
                    }, action: function () {
                        Ih.list(function (a, b, d, f, g) {
                            return e.apply(a, b, d, f, g, Tq(c.region()))
                        }, c.region(), c.content(), c.undo(), c.selections());
                        c.content().focus()
                    }
                }
            }
        }, p$ = OJ("bullist", "action.bullist", "ul", im.unordered),
        Zy = {ol: OJ("numlist", "action.numlist", "ol", im.ordered), ul: p$}, q$ = O("tag"), PJ = function (a, b) {
            return U(["label", "li", "td", "th", "normal"], b) ? Da.on(a.backup(b)) : Da.off()
        }, r$ = function (a, b, c) {
            return IJ.query(a, b.selectors(), c).fold(function () {
                return a.collapsed() ?
                    PJ(b, "normal") : Da.off()
            }, function (a) {
                return b.candidateByName(a).map(Da.on).getOrThunk(function () {
                    return PJ(b, a)
                })
            })
        }, dV = {
            read: function (a, b) {
                var c = a.getSelection().fold(function () {
                    return Da.off()
                }, function (c) {
                    return r$(c, b, a.isRoot)
                });
                return q$(c)
            }
        }, cV = aa.detect(), QJ = {resolve: Lb.create("ephox-arcade").resolve}, Vu = "data-" + QJ.resolve("no-merge"),
        Wu = "data-" + QJ.resolve("atomic"), rg = {
            doNotMerge: function (a) {
                D.isElement(a) && m.set(a, Vu, "true")
            }, shouldMerge: function (a) {
                return D.isElement(a) && !1 === m.has(a,
                    Vu)
            }, setAtomic: function (a) {
                D.isElement(a) && m.set(a, Wu, "true")
            }, isAtomic: function (a) {
                return D.isElement(a) && "true" === m.get(a, Wu)
            }, clear: function (a) {
                D.isElement(a) && z([Vu, Wu], function (b) {
                    m.remove(a, b)
                })
            }
        }, s$ = function (a) {
            var b = A.owner(a);
            a = Y.descendants(a, "td,th");
            z(a, function (a) {
                Df.needsCursor(a).each(function (c) {
                    y.append(a, r.fromTag("br", b.dom()))
                })
            })
        }, t$ = function (a) {
            Df.vacate(a);
            Df.needsCursor(a).each(function (b) {
                F.remove(a)
            })
        }, u$ = function (a) {
            ("table" === D.name(a) ? s$ : t$)(a)
        }, RJ = function (a, b) {
            a = v$(a);
            b = ka(a, b);
            z(b, u$)
        }, v$ = function (a) {
            var b = function (a) {
                return [a]
            }, c = A.prevSibling(a).map(b).getOr([]);
            b = A.nextSibling(a).map(b).getOr([]);
            return c.concat([a]).concat(b)
        }, Di = {
            purge: function (a) {
                RJ(a, pa.isBlock)
            }, purgeBy: RJ
        }, SJ = function (a) {
            Di.purgeBy(a, function (a) {
                var b = pa.isBlock(a) || "li" === D.name(a) || "ol" === D.name(a) || "ul" === D.name(a);
                if ("li" === D.name(a)) {
                    var d;
                    if (!(d = 0 === Y.descendants(a, "ul,ol").length)) {
                        d = Y.descendants(a, "ul,ol,li");
                        var e = Y.descendants(a, "*");
                        a = ed.descendants(a, D.isText);
                        d = d.length ===
                            e.length && 0 === a.length
                    }
                    a = d
                } else a = !0;
                return b && a
            })
        }, Xu = function (a) {
            var b = Y.descendants(a, "ol,ul,li");
            z([a].concat(b), SJ)
        }, TJ = function (a) {
            a = ("li" === D.name(a) ? [a] : []).concat(Y.descendants(a, "li"));
            z(a, function (a) {
                var b = A.children(a);
                Xa(b, function (a) {
                    return D.isText(a) ? 0 < Ya.get(a).length : !U(["ol", "ul"], D.name(a))
                }) || v.set(a, "list-style-type", "none")
            })
        }, Ro = function (a, b) {
            var c = r.fromText(mb());
            a(b, c);
            return g.some({
                element: h(c), cleanup: function () {
                    F.remove(c)
                }, splits: h([])
            })
        }, Ei = function (a, b) {
            return a.map(function (a) {
                return {
                    element: h(a),
                    cleanup: t, splits: h(b)
                }
            })
        }, UJ = function (a, b) {
            return Ro(y.before, a)
        }, VJ = function (a, b) {
            return Ro(y.after, a)
        }, Yu = function (a, b) {
            return Ro(y.append, a)
        }, Zu = function (a, b) {
            return Ro(y.prepend, a)
        }, WJ = function (a, b) {
            return function (c, d) {
                return a(c, d).fold(function () {
                    return b(c, d)
                }, g.some)
            }
        }, $u = function (a, b, c) {
            return Ei(g.some(b), void 0 !== b && void 0 !== c ? [{first: b.dom(), second: c.dom()}] : [])
        }, XJ = {
            before: {
                text: {
                    none: g.none, start: WJ(function (a, b) {
                        return Ei(A.prevSibling(a), [])
                    }, UJ), middle: $u, end: $u
                }, element: {
                    hasPrevious: function (a,
                                           b) {
                        return Ei(A.child(a, b - 1), [])
                    }, rightEdge: Yu, first: Zu, empty: UJ, otherwise: Zu
                }
            }, after: {
                text: {
                    none: g.none, start: $u, middle: function (a, b, c) {
                        return Ei(g.some(c), void 0 !== b && void 0 !== c ? [{first: b.dom(), second: c.dom()}] : [])
                    }, end: WJ(function (a, b) {
                        return Ei(A.nextSibling(a), [])
                    }, VJ)
                }, element: {
                    hasNext: function (a, b) {
                        return Ei(A.child(a, b + 1), [])
                    }, rightEdge: Yu, first: Zu, empty: VJ, otherwise: Yu
                }
            }
        }, So = {prefix: u(Go.prefix, XJ), postfix: u(Go.postfix, XJ)}, w$ = function (a) {
            return !wd.descendant(a, function (a) {
                return li.hasCursor(a,
                    ["hr", "img"])
            })
        }, x$ = function (a) {
            var b = a.second();
            if (dc.isHeading(b) && w$(b)) {
                var c = Pc.shallowAs(b, "p");
                y.before(b, c);
                F.remove(b);
                b = g.some(c)
            } else b = g.none();
            b = b.getOr(a.second());
            return {first: a.first, second: h(b), mark: a.mark, splits: a.splits}
        }, y$ = function (a) {
            return D.isElement(a) && pa.isInline(a) && 0 === A.children(a).length
        }, z$ = function (a) {
            var b = r.fromText(mb());
            y.append(a, b);
            return b
        }, YJ = function (a, b, c) {
            return So.prefix(b, c).bind(function (b) {
                var c = po.breakPath(b.element(), dc.stopAt(a));
                return c.second().map(function (d) {
                    return {
                        first: h(a),
                        second: h(d), mark: h(b), splits: h(c.splits().concat(b.splits()))
                    }
                })
            })
        }, Me = {
            soft: function (a, b, c) {
                var d = function (c) {
                    if (D.isText(c)) {
                        var e = Ya.get(c);
                        e = -1 === e.indexOf("\u00a0") && 0 === e.trim().length
                    } else e = !1;
                    return e ? A.nextSibling(c).forall(d) : !wa.isStart(a, b) && pa.isBlock(c)
                }, e = r.fromTag("br");
                dm.atStartOf(a, b, e);
                A.nextSibling(e).fold(function () {
                    return wa.getEnd(a) === b && dc.findBlock(a, c).bind(kc.last).fold(h(!1), function (b) {
                        var c = "br" === D.name(b) ? e : a;
                        return N.eq(c, b)
                    })
                }, d) && y.after(e, r.fromTag("br"));
                return g.some({
                    start: h(la.after(e)),
                    finish: h(la.after(e))
                })
            }, hard: function (a, b, c, d, e) {
                return YJ(a, b, c).map(x$).map(function (a) {
                    z([d.getOr(a.first()), a.second()], function (b) {
                        Df.postprocess(b, a.mark().element(), e)
                    });
                    dc.findValidHardBreak(a.second(), e).isNone() && hu.rootBr(a.second(), a.mark().element());
                    var b = mo.plunge(a.second(), h(!1));
                    b = y$(b) ? z$(b) : b;
                    a.mark().cleanup();
                    return {start: h(la.on(b, 0)), finish: h(la.on(b, 0))}
                })
            }, rupture: YJ
        }, ZJ = function (a) {
            return g.some({start: h(a), finish: h(a)})
        }, A$ = {
            doubleBr: function (a) {
                y.after(a, r.fromTag("br"));
                var b = r.fromTag("br");
                y.after(a, b);
                return ZJ(la.after(b))
            }, emptyParagraph: function (a) {
                var b = r.fromTag("p"), c = r.fromTag("br");
                y.append(b, c);
                y.after(a, b);
                return ZJ(la.on(c, 0))
            }
        }, $J = function (a) {
            return [a]
        }, B$ = {
            processes: function (a) {
                return {stopper: dc.stopAt(a), wrapper: $J, post: t}
            }
        }, D$ = function (a, b, c) {
            g.from(c[c.length - 1]).each(function (a) {
                P.append(a, C$(A.children(b)));
                F.empty(b)
            })
        }, C$ = function (a) {
            return ka(a, function (a) {
                return !(D.isElement(a) && dc.isList(a) && 0 === A.children(a).length)
            })
        }, E$ = {
            processes: function (a) {
                return {
                    stopper: dc.stopAt(a),
                    wrapper: $J, post: D$
                }
            }
        }, F$ = function (a, b) {
            F.remove(a);
            return b
        }, G$ = function (a, b) {
            var c = r.fromTag("p");
            P.append(c, b);
            y.before(a, c);
            F.remove(a);
            Df.needsCursor(c).each(function (a) {
                hu.forceAddBr(a, r.fromTag("span"))
            });
            return [c]
        }, H$ = function (a) {
            var b = A.children(a);
            b = (wd.descendant(a, pa.isFormatting) ? F$ : G$)(a, b);
            z(b, function (b) {
                D.isElement(b) && (m.transfer(a, b, ["dir"]), v.transfer(a, b, ["text-align"]))
            });
            return b
        }, I$ = {
            processes: function (a) {
                return {stopper: dc.stopAt(a), wrapper: H$, post: t}
            }
        }, J$ = {
            exit: function (a,
                            b) {
                return L.ancestor(a, "ol,ul", b).bind(function (c) {
                    var d = L.ancestor(c, "li,ol,ul", b).fold(function () {
                        return I$.processes(c)
                    }, function (a) {
                        return "li" === D.name(a) ? E$.processes(a) : B$.processes(c)
                    }), e = po.breakPath(a, d.stopper);
                    return e.second().map(function (b) {
                        var c = e.first(), f = d.wrapper(a);
                        P.before(b, f);
                        d.post(c, b, f);
                        z([c, b], Df.lists);
                        b = mo.plunge(f[0], h(!1));
                        b = h(la.on(b, 0));
                        return {start: b, finish: b}
                    })
                })
            }
        }, K$ = function (a, b, c, d) {
            return L.closest(b, "li", d).fold(function () {
                    return Me.hard(a, b, c, g.none(), d)
                },
                function (a) {
                    a = dc.exitList(a) ? J$.exit(a, d) : Me.hard(a, b, c, g.some(a), d);
                    return a
                })
        }, av = {
            hard: function (a, b, c) {
                return dc.findValidHardBreak(a, c).fold(function () {
                    return dc.findAnchorBreak(a, c).fold(function () {
                        return Me.soft(a, b, c)
                    }, function (d) {
                        return !0 === dc.isRightEdge(d, a, b) ? A$.doubleBr(d) : Me.hard(d, a, b, g.none(), c)
                    })
                }, function (d) {
                    return K$(d, a, b, c)
                })
            }, soft: Me.soft, rupture: Me.rupture
        }, bv = O("cursor", "blocks"), To = function (a, b, c, d) {
            return So.postfix(a, b, c, d).map(function (e) {
                var f = qh.leftEdge(a, b, c, d);
                qh.makeTo(f.element(),
                    f.offset(), e.element()).deleteContents();
                return {start: h(la.before(e.element())), finish: h(la.before(e.element())), mark: e.element}
            })
        }, cv = function (a, b, c, d, e) {
            return To(a, b, c, d).bind(function (a) {
                return Me.soft(a.mark(), 0, e)
            })
        }, L$ = function (a, b, c, d, e) {
            return To(a, b, c, d).bind(function (a) {
                return dc.findValidHardBreak(a.mark(), e).bind(function (b) {
                    return Me.hard(b, a.mark(), 0, g.none(), e)
                })
            })
        }, M$ = function (a, b) {
            z(a, function (a) {
                Df.postprocess(a, b)
            })
        }, dv = {
            soft: cv, hard: function (a, b, c, d, e) {
                var f = dc.findValidHardBreak(a,
                    e), k = dc.findValidHardBreak(c, e), g = f.fold(function () {
                    var f = cv(a, b, c, d, e);
                    return bv(f, [])
                }, function (f) {
                    return k.fold(function () {
                        var k = cv(a, b, c, d, e);
                        return bv(k, [f])
                    }, function (k) {
                        var g = N.eq(f, k) ? L$(a, b, c, d, e) : To(a, b, c, d);
                        return bv(g, [f, k])
                    })
                });
                return g.cursor().map(function (a) {
                    M$(g.blocks(), a.start().fold(ca, ca, ca));
                    return a
                })
            }, rupture: function (a, b, c, d, e) {
                return To(a, b, c, d).bind(function (a) {
                    return dc.findValidHardBreak(a.mark(), e).bind(function (b) {
                        return Me.rupture(b, a.mark(), 0)
                    })
                })
            }
        }, ev = {
            point: function (a,
                             b, c) {
                return av.rupture(a, b, c)
            }, range: function (a, b, c, d, e) {
                return dv.rupture(a, b, c, d, e)
            }, ruptureUntil: function (a, b, c, d, e, f) {
                var k = So.postfix(a, b, c, d);
                return function (a, b) {
                    return dc.findValidHardBreak(a, e).map(f).bind(function (c) {
                        return Me.rupture(c, a, b)
                    })
                }(a, b).bind(function (a) {
                    return k.map(function (b) {
                        var c = document.createRange();
                        c.setStartAfter(a.first().dom());
                        c.setEndBefore(b.element().dom());
                        c.deleteContents();
                        b.cleanup();
                        a.mark().cleanup();
                        return a.first()
                    })
                })
            }
        }, Uk = function (a, b, c) {
            if (0 < a.length) {
                var d =
                    a[0], e = a.slice(1);
                dm.atStartOf(b, c, d);
                P.after(d, e);
                return g.some(a[a.length - 1])
            }
            return g.none()
        }, Bd = {
            split: function (a, b, c) {
                var d = void 0 === c ? Di.purge : c;
                return ev.point(a.block(), a.element(), a.offset()).bind(function (a) {
                    var c = b.all();
                    P.before(a.second(), c);
                    a.mark().cleanup();
                    d(a.first());
                    d(a.second());
                    z([a.first(), a.second()], TJ);
                    a = kd(c);
                    return qa(a, function (a) {
                        return A.parent(a).isSome()
                    })
                })
            }, merge: function (a, b) {
                b = A.children(b.single());
                return Uk(b, a.element(), a.offset())
            }, nest: function (a, b) {
                return Uk(b.all(),
                    a.element(), a.offset())
            }, insertMany: Uk, insertChildren: function (a, b) {
                a = A.children(a);
                return Uk(a, b.element(), b.offset())
            }, fallback: function (a, b, c) {
                return Uk(c, b.startContainer(), b.startOffset())
            }
        }, aK = {
            lists: function (a) {
                return Eb(a, function (a, c) {
                    return a.bind(function (a) {
                        return L.closest(c, "ol,ul").map(function (b) {
                            return [b].concat(a)
                        })
                    })
                }, g.some([])).map(function (a) {
                    return {all: h(a)}
                })
            }, from: function (a) {
                return {all: h(a)}
            }
        }, bK = O("left", "right"), N$ = function (a) {
            return pa.isFormatting(a) || pa.isContainer(a)
        },
        cK = function (a, b, c, d) {
            return Ja.closest(c, a, b)
        }, dK = function (a) {
            return function (b, c, d) {
                return a(b, c.element(), c.offset()).bind(function (c) {
                    return a(b, d.element(), d.offset()).map(function (a) {
                        return bK(c, a)
                    })
                })
            }
        }, eK = function (a) {
            var b = dK(a);
            return function (a, d, e) {
                return b(a, d, e).filter(function (a) {
                    return N.eq(a.left(), a.right())
                })
            }
        }, ab = {
            inline: function (a, b, c) {
                return Ja.closest(b, N$, a).fold(function () {
                    return g.some(b)
                }, function (c) {
                    return a(c) ? g.some(b) : g.none()
                })
            }, formatter: u(cK, pa.isFormatting), container: function (a,
                                                                       b, c) {
                return Ja.closest(b, pa.isContainer, a).filter(zf(a))
            }, inListItem: function (a, b, c) {
                return L.closest(b, "li", a)
            }, inList: function (a, b, c) {
                return L.closest(b, "ol,ul", a)
            }, inTableCell: function (a, b, c) {
                return L.closest(b, "td,th", a)
            }, setBlock: function (a, b) {
                return oa(a, {block: h(b)})
            }, both: dK, shared: eK, sharedPredicate: function (a) {
                a = u(cK, a);
                return eK(a)
            }, entireRoot: function (a, b, c) {
                return Ja.closest(b.element(), a).filter(function (c) {
                    var d = function (a) {
                        return N.eq(a, b.element())
                    };
                    return a(b.element()) && 0 === b.offset() ||
                        D.isText(b.element()) && 0 === b.offset() && kc.first(c).map(d).getOr(!1)
                }).filter(function (b) {
                    var d = function (a) {
                        return N.eq(a, c.element())
                    };
                    return a(c.element()) && c.offset() >= A.children(b).length - 1 || D.isText(c.element()) && c.offset() >= Ya.get(c.element()).length && kc.last(b).map(d).getOr(!1)
                }).map(function (a) {
                    return bK(a, a)
                })
            }
        }, fK = function (a) {
            return function (b) {
                return (1 === b.length ? g.some(b[0]) : g.none()).filter(a).map(function (a) {
                    return {single: h(a)}
                })
            }
        }, gK = function (a) {
            return function (b) {
                return (Xa(b, a) ? g.some(b) :
                    g.none()).map(function (a) {
                    return {all: h(a)}
                })
            }
        }, ec = {
            oneOf: fK, anyOf: gK, noneOf: function (a) {
                return function (b) {
                    return (Xa(b, a) ? g.none() : g.some(b)).map(function (a) {
                        return {all: h(a)}
                    })
                }
            }, allOf: function (a) {
                return function (b) {
                    return ob(b, a) ? g.some({all: h(b)}) : g.none()
                }
            }, any: g.some, oneOfTag: function (a) {
                return fK(function (b) {
                    return D.name(b) === a
                })
            }, anyOfTag: function (a) {
                return gK(function (b) {
                    return D.name(b) === a
                })
            }, single: function (a) {
                return g.some({single: h(a)})
            }, all: function (a) {
                return g.some({all: h(a)})
            }
        }, Uo =
            function (a) {
                return 1 === a.length ? L.closest(a[0], "ol,ul").map(function (a) {
                    return {single: h(a)}
                }) : g.none()
            }, hK = function (a) {
            return Uo(a).bind(function (a) {
                a = Y.descendants(a.single(), "li");
                return 1 === a.length ? g.some({single: h(a[0])}) : g.none()
            })
        }, iK = function (a) {
            if (2 !== a.length) return g.none();
            var b = a[0], c = a[1];
            return pa.isFormatting(b) || pa.isContainer(b) || U(["ol", "ul", "li"], D.name(b)) || !U(["ol", "ul"], D.name(c)) ? g.none() : g.some({
                all: h(a),
                list: h(c),
                inline: h(b)
            })
        }, Fi = ab.formatter, jK = ab.inline, O$ = ab.container,
        kK = function (a) {
            return pa.isFormatting(a) && !1 === rg.shouldMerge(a)
        }, P$ = [jb(ab.inListItem, Uo, function (a, b) {
            b = Y.children(b.single(), "li");
            return 1 !== b.length || Db.descendant(b[0], "ol,ul") ? Bd.split(a, aK.from(b), SJ) : Bd.insertChildren(b[0], a)
        }, "List"), jb(ab.inListItem, aK.lists, function (a, b) {
            return L.ancestor(a.block(), "ol,ul", a.isRoot).bind(function (c) {
                c = ab.setBlock(a, c);
                return Bd.split(c, b, Xu)
            })
        }, "Many lists"), jb(jK, ec.anyOf(kK), Bd.nest, "Copying formatting (NO MERGE) into root"), jb(jK, ec.oneOf(pa.isFormatting),
        Bd.merge, "Copying formatting into root"), jb(Fi, ec.anyOfTag("hr"), Bd.split, "insert hr into formatter"), jb(Fi, ec.anyOf(kK), Bd.split, "Copying one formatting block (NO MERGE) into formatting"), jb(Fi, ec.oneOf(pa.isFormatting), Bd.merge, "Copying one formatting block into formatting"), jb(Fi, ec.anyOf(pa.isFormatting), Bd.split, "Copying many formatting blocks into formatting"), jb(Fi, ec.anyOfTag("table"), function (a) {
            return function (b, c) {
                var d = c.all();
                b = a(b, c);
                g.from(d[d.length - 1]).each(function (a) {
                    A.nextSibling(a).fold(function () {
                        var b =
                            r.fromTag("p");
                        y.append(b, r.fromTag("br"));
                        y.after(a, b)
                    }, t)
                });
                return b
            }
        }(Bd.split), "Copying tables into formatting"), jb(Fi, ec.anyOf(pa.isContainer), Bd.split, "Copying container blocks into formatting"), jb(O$, ec.all, Bd.nest, "Fallback pasting into container.")],
        Q$ = {
            context: function (a, b, c) {
                return b.context(a.isRoot, c.startContainer(), c.startOffset()).map(function (b) {
                    return {block: h(b), element: c.startContainer, offset: c.startOffset, isRoot: a.isRoot}
                })
            }, rules: h(P$), fallback: Bd.fallback
        }, R$ = {
            force: function (a) {
                var b =
                        id.after(a.startContainer(), a.startOffset(), a.endContainer(), a.endOffset()),
                    c = b ? W.point(a.endContainer(), a.endOffset()) : W.point(a.startContainer(), a.startOffset());
                a = b ? W.point(a.startContainer(), a.startOffset()) : W.point(a.endContainer(), a.endOffset());
                return {left: h(c), right: h(a)}
            }
        }, S$ = function (a, b) {
            var c = a.original(),
                d = So.postfix(c.left().element(), c.left().offset(), c.right().element(), c.right().offset()), e = b.all();
            return d.bind(function (b) {
                qh.makeTo(c.left().element(), c.left().offset(), b.element()).deleteContents();
                b.cleanup();
                P.append(a.left(), e);
                b = A.children(a.right());
                P.append(a.left(), b);
                F.remove(a.right());
                return g.from(e[e.length - 1])
            })
        }, lK = function (a, b) {
            if (!N.eq(a.left(), a.right())) throw"replaceContents used in the wrong context";
            a = a.left();
            F.empty(a);
            b = b.all();
            P.append(a, b);
            return kc.last(a).or(g.from(b[b.length - 1]))
        }, Cd = {
            replace: function (a, b) {
                return N.eq(a.left(), a.right()) ? (b = b.all(), a.replaceSelection(b), g.from(b[b.length - 1])) : S$(a, b)
            }, replaceContents: lK, replaceContentsWrapP: function (a, b) {
                var c = r.fromTag("p");
                P.append(c, b.all());
                return lK(a, {all: h([c])})
            }, replaceWhole: function (a, b) {
                b = b.all();
                P.after(a.left(), b);
                F.remove(a.left());
                return g.from(b[b.length - 1])
            }, merge: function (a, b) {
                b = A.children(b.single());
                a.replaceSelection(b);
                return g.from(b[b.length - 1])
            }, split: function (a, b, c) {
                var d = void 0 === c ? Di.purge : c;
                c = a.original().left();
                var e = a.original().right();
                return ev.range(c.element(), c.offset(), e.element(), e.offset(), a.isRoot).bind(function (a) {
                    var c = b.all();
                    P.before(a.second(), c);
                    a.mark().cleanup();
                    z([a.first(),
                        a.second()], d);
                    return g.from(c[c.length - 1])
                })
            }, fallback: function (a, b, c) {
                a.replaceSelection(c);
                g.from(c[0]).each(Di.purge);
                g.from(c[c.length - 1]).each(Di.purge);
                return g.from(c[c.length - 1])
            }
        }, mK = function (a, b, c, d) {
            d = void 0 !== d ? d : ca;
            var e = b.original(), f = e.left();
            e = e.right();
            return ev.ruptureUntil(f.element(), f.offset(), e.element(), e.offset(), b.isRoot, d).bind(function (b) {
                var d = a(b, c);
                T$(b);
                return d
            }, void 0 !== d ? d : ca)
        }, T$ = function (a) {
            var b = Y.ancestors(a, "ol,ul");
            0 < b.length && z([Xu, TJ], function (a) {
                a(b[b.length -
                1])
            })
        }, Vo = function (a, b, c) {
            return mK(a, b, c, ca)
        }, Vk = ab.formatter, U$ = u(Vo, function (a, b) {
            y.after(a, b.single());
            return g.some(b.single())
        }), nK = u(function (a, b, c) {
            return mK(a, b, c, function (a) {
                return A.parent(a).getOr(a)
            })
        }, function (a, b) {
            b = b.all();
            P.after(a, b);
            return g.from(b[b.length - 1])
        }), V$ = u(Vo, function (a, b) {
            b = A.children(b.single());
            P.after(a, b);
            return g.some(b[b.length - 1])
        }), W$ = u(Vo, function (a, b) {
            var c = r.fromTag("li");
            P.append(c, [b.inline(), b.list()]);
            y.after(a, c);
            return g.some(b.list())
        }), X$ = u(Vo, function (a,
                                 b) {
            var c = r.fromTag("li");
            P.append(c, [b.inline(), b.list()]);
            var d = L.ancestor(a, "ol,ul").fold(function () {
                var a = r.fromTag(D.name(b.list()));
                y.append(a, c);
                return a
            }, function () {
                return c
            });
            y.after(a, d);
            return g.some(b.list())
        }),
        Y$ = [jb(ab.sharedPredicate(rg.isAtomic), ec.all, Cd.replaceWhole, "selection: inside something atomic, so just replace the whole thing"), jb(ab.shared(ab.inListItem), hK, function (a, b) {
            return Cd.merge(a, b)
        }, "selection: same item, paste: singleton"), jb(ab.shared(ab.inListItem), Uo, function (a,
                                                                                                 b) {
            return Cd.split(a, {all: h(A.children(b.single()))}, Xu)
        }, "selection: same item, paste: single list"), jb(ab.shared(ab.inListItem), iK, X$, "selection: same item, paste: partial"), jb(ab.shared(ab.inListItem), ec.noneOf(pa.isBlock), Cd.replace, "selection: same item, paste: no blocks"), jb(ab.shared(ab.inListItem), ec.anyOf(pa.isHeading), function (a, b) {
            a = Cd.replace(a, b);
            z(b.all(), function (a) {
                Di.purgeBy(a, li.isVacantText)
            });
            return a
        }, "selection: same item, paste: heading"), jb(ab.shared(ab.inListItem), ec.all,
            nK, "selection: same item, paste: any"), jb(ab.both(ab.inListItem), hK, U$, "selection: diff items, paste: singleton"), jb(ab.both(ab.inListItem), Uo, V$, "selection: diff items, paste: single list"), jb(ab.both(ab.inListItem), iK, W$, "selection: diff items, paste: partial"), jb(ab.both(ab.inListItem), ec.all, nK, "selection: diff items, paste: any"), jb(ab.both(Vk), ec.anyOfTag("hr"), Cd.split, "selection: inside formatter, paste: split"), jb(ab.both(Vk), ec.noneOf(pa.isBlock), Cd.replace, "range no blocks"), jb(ab.both(Vk),
            ec.anyOf(function (a) {
                return pa.isFormatting(a) && !1 === rg.shouldMerge(a)
            }), Cd.split, "range 1 formatting block"), jb(ab.both(Vk), ec.oneOf(pa.isFormatting), Cd.merge, "range 1 formatting block"), jb(ab.both(Vk), ec.all, Cd.split, "range anything > formatters"), jb(ab.entireRoot, ec.noneOf(pa.isBlock), Cd.replaceContentsWrapP, "complete body, not inserting a block: wrap in P and replace the contents"), jb(ab.entireRoot, ec.all, Cd.replaceContents, "complete body: replace the contents")],
        Z$ = {
            context: function (a, b, c) {
                var d =
                    R$.force(c);
                return b.context(a.isRoot, d.left(), d.right()).map(function (b) {
                    return {
                        left: b.left,
                        right: b.right,
                        original: h(d),
                        isRoot: a.isRoot,
                        replaceSelection: a.replaceSelection
                    }
                })
            }, rules: h(Y$), fallback: Cd.fallback
        }, $$ = function (a, b, c, d, e) {
            return hb(a, function (a, k) {
                return a.orThunk(function () {
                    return d(b, k, c).bind(function (a) {
                        return k.profile(e).map(function (b) {
                            return {action: k.action, target: h(b), ctx: h(a)}
                        })
                    })
                })
            }, g.none())
        }, oK = function (a, b, c, d, e, f) {
            var k = {getSelection: a, replaceSelection: b, isRoot: c}, h = function (a,
                                                                                     b) {
                return a.fold(function () {
                    if (0 === d.length) {
                        var a = b.startContainer(), c = b.startOffset();
                        c = D.isText(a) ? Math.min(c, a.dom().length) : c;
                        return g.some(W.point(a, c))
                    }
                    return g.none()
                }, function (a) {
                    var b = wa.getEnd(a);
                    return g.some(W.point(a, b))
                })
            };
            return k.getSelection().bind(function (a) {
                var b = a.collapsed() ? Q$ : Z$, c = a.collapsed() ? e.concat(b.rules()) : f.concat(b.rules());
                c = $$(c, k, a, b.context, d).fold(function () {
                    return b.fallback(k, a, d)
                }, function (a) {
                    return a.action(a.ctx(), a.target())
                });
                return h(c, a)
            })
        }, aaa = {
            insertAtCursor: function (a,
                                      b, c, d) {
                return oK(a, b, c, d, [], [])
            }, insertAtCursorWith: oK
        }, baa = function (a) {
            return D.isElement(a) && "false" === m.get(a, "contenteditable")
        }, caa = function (a) {
            return a().map(function (a) {
                a = E([a.startContainer(), a.endContainer()], function (a) {
                    return Ja.closest(a, baa)
                });
                return ee(a)
            }).getOr([])
        }, pK = function (a, b, c) {
            z(a, b);
            b = c();
            z(a, rg.clear);
            return b
        }, daa = function (a, b) {
            return pK(a, rg.setAtomic, b)
        }, qK = function (a, b, c, d, e, f) {
            var k = caa(a);
            return daa(k, function () {
                return aaa.insertAtCursorWith(a, b, c, d, e, f)
            })
        }, rK = function (a,
                          b, c, d) {
            b = qK(a.getSelection, a.replaceSelection, a.isRoot, b, c, d);
            a.domChanged();
            a.undoChanged();
            return b
        }, sK = function (a, b) {
            return rK(a, b, [], [])
        }, sd = {
            insertAtCursorWith: rK, insertAtCursor: sK, insertAtCursorWithInstructions: function (a, b, c) {
                return pK(c, a, function () {
                    return sK(b, c)
                })
            }, insertAt: function (a, b, c) {
                c = qK(function () {
                        return g.some(b)
                    }, function (c) {
                        a.win().each(function (a) {
                            var d = Lc.relative(la.on(b.startContainer(), b.startOffset()), la.on(b.endContainer(), b.endOffset()));
                            Wa.replace(a, d, c)
                        })
                    }, a.isRoot,
                    c, [], []);
                a.domChanged();
                a.undoChanged();
                return c
            }
        }, jm = {
            generate: function (a) {
                return a + "-" + Math.floor(99999 * Math.random()).toString()
            }
        }, eaa = O("ch", "offset"), tK = function (a, b) {
            return eaa(a.charAt(b), b)
        }, Wo = {
            previous: function (a, b) {
                for (b = b.getOr(a.length) - 1; 0 <= b; b--) if (a.charAt(b) !== mb()) return g.some(tK(a, b));
                return g.none()
            }, next: function (a, b) {
                for (b = b.getOr(0) + 1; b < a.length; b++) if (a.charAt(b) !== mb()) return g.some(tK(a, b));
                return g.none()
            }, rfind: function (a, b) {
                b.lastIndex = -1;
                a = kd(a).join("");
                b = a.match(b);
                return void 0 !== b && null !== b && 0 <= b.index ? g.some(a.length - 1 - b.index) : g.none()
            }, lfind: function (a, b) {
                b.lastIndex = -1;
                a = a.match(b);
                return void 0 !== a && null !== a && 0 <= a.index ? g.some(a.index) : g.none()
            }
        }, faa = Ca.walkers().left(), gaa = Ca.walkers().right(),
        haa = ta.generate([{abort: []}, {kontinue: []}, {finish: ["info"]}]),
        fv = ta.generate([{aborted: []}, {edge: ["element"]}, {success: ["info"]}]), uK = function (a, b) {
            return Nc.isEmptyTag(a, b) || a.property().isBoundary(b)
        }, gv = function (a, b, c, d, e, f, k) {
            var h = function () {
                return k.fold(fv.aborted,
                    fv.edge)
            }, q = function (d) {
                return Ca.walk(a, b, c, f).fold(h, function (b) {
                    return gv(a, b.item(), b.mode(), g.none(), e, f, d)
                })
            };
            if (uK(a, b)) return h();
            if (a.property().isText(b)) {
                var m = a.property().getText(b);
                return e(a, haa, b, m, d).fold(h, function () {
                    return q(g.some(b))
                }, fv.success)
            }
            return q(k)
        }, iaa = function (a, b, c, d) {
            c = bd.toLeaf(a, b, c);
            return a.property().isText(b) ? g.none() : Tn.left(a, c.element(), a.property().isText, d).map(function (b) {
                return W.point(b, a.property().getText(b).length)
            })
        }, jaa = function (a, b, c, d) {
            c = bd.toLeaf(a,
                b, c);
            return a.property().isText(b) ? g.none() : Tn.right(a, c.element(), a.property().isText, d).map(function (a) {
                return W.point(a, 0)
            })
        }, vK = function (a, b, c) {
            var d = u(uK, a);
            return iaa(a, b, c, d).orThunk(function () {
                return jaa(a, b, c, d)
            }).getOr(W.point(b, c))
        }, wK = {
            repeatLeft: function (a, b, c, d) {
                b = vK(a, b, c);
                return gv(a, b.element(), Ca.sidestep, g.some(b.offset()), d, faa, g.none())
            }, repeatRight: function (a, b, c, d) {
                b = vK(a, b, c);
                return gv(a, b.element(), Ca.sidestep, g.some(b.offset()), d, gaa, g.none())
            }
        }, xK = xd(["regex", "attempt"]),
        yK = function (a, b, c, d) {
            return wK.repeatLeft(a, b, c, d)
        }, zK = function (a, b, c, d) {
            return wK.repeatRight(a, b, c, d)
        }, AK = function (a, b, c) {
            var d = h(!1);
            if (!a.property().isText(b)) return g.none();
            var e = a.property().getText(b);
            return c <= e.length ? g.some(W.point(b, c)) : Ca.seekRight(a, b, a.property().isText, d).bind(function (b) {
                return AK(a, b, c - e.length)
            })
        }, th = {
            previousChar: function (a, b) {
                return Wo.previous(a, b)
            }, nextChar: function (a, b) {
                return Wo.next(a, b)
            }, repeatLeft: yK, repeatRight: zK, expandLeft: function (a, b, c, d) {
                var e = xK(d);
                return yK(a, b, c, function (a, b, c, d, g) {
                    a = g.getOr(d.length);
                    return Wo.rfind(d.substring(0, a), e.regex()).fold(function () {
                        return b.kontinue()
                    }, function (a) {
                        return e.attempt(b, c, d, a)
                    })
                })
            }, expandRight: function (a, b, c, d) {
                var e = xK(d);
                return zK(a, b, c, function (a, b, c, d, g) {
                    var f = g.getOr(0);
                    return Wo.lfind(d.substring(f), e.regex()).fold(function () {
                        return b.kontinue()
                    }, function (a) {
                        return e.attempt(b, c, d, f + a)
                    })
                })
            }, scanRight: AK
        }, Wk = nb(), uh = {
            previousChar: function (a, b) {
                return th.previousChar(a, b)
            }, nextChar: function (a,
                                   b) {
                return th.nextChar(a, b)
            }, repeatLeft: function (a, b, c) {
                return th.repeatLeft(Wk, a, b, c)
            }, repeatRight: function (a, b, c) {
                return th.repeatRight(Wk, a, b, c)
            }, expandLeft: function (a, b, c) {
                return th.expandLeft(Wk, a, b, c)
            }, expandRight: function (a, b, c) {
                return th.expandRight(Wk, a, b, c)
            }, scanRight: function (a, b) {
                return th.scanRight(Wk, a, b)
            }
        }, Gi = O("before", "after"), jv = function (a, b, c, d, e) {
            return Xo(c).fold(function () {
                var c = BK(a, b, d);
                return Gi(c, e)
            }, function (f) {
                var k = Hi(c, f);
                return k.length > a ? Gi(d, e) : hv(b).fold(function () {
                    var b =
                        iv(a - k.length, f, e + k);
                    return Gi(d, b)
                }, function (c) {
                    var g = Hi(c, b);
                    return g.length > a - k.length ? Gi(d, e + k) : jv(a - k.length - g.length, c, f, g + d, e + k)
                })
            })
        }, CK = function (a, b, c, d) {
            return a.finish(W.point(b, d))
        }, DK = {
            regex: function () {
                return new RegExp(Cb.wordchar(), "i")
            }, attempt: CK
        }, EK = {
            regex: function () {
                return new RegExp(Cb.wordbreak(), "i")
            }, attempt: CK
        }, FK = function (a, b) {
            return a.offset() === b.offset() && N.eq(a.element(), b.element())
        }, GK = function (a) {
            return W.point(a, D.value(a).length)
        }, HK = function (a) {
            return W.point(a, 0)
        },
        kv = function (a, b, c) {
            var d = function (b) {
                b = c(b);
                return FK(a, b) ? g.none() : g.some(b)
            };
            return b(a.element(), a.offset(), DK).fold(g.none, d, function (a) {
                return b(a.element(), a.offset(), EK).fold(g.none, d, function (a) {
                    return g.some(a)
                })
            })
        }, Xo = function (a) {
            return kv(a, uh.expandRight, GK)
        }, hv = function (a) {
            return kv(a, uh.expandLeft, HK)
        }, Yo = function (a, b, c, d, e, f) {
            return a(c).fold(h(d), function (k) {
                var g = e(c, k);
                return g.length + d.length > b || 0 === g.length ? d : Yo(a, b, k, f(d, g), e, f)
            })
        }, iv = function (a, b, c) {
            return Yo(Xo, a, b, c, Hi, function (a,
                                                 b) {
                return a + b
            })
        }, BK = function (a, b, c) {
            return Yo(hv, a, b, c, function (a, b) {
                return Hi(b, a)
            }, function (a, b) {
                return b + a
            })
        }, Hi = function (a, b) {
            var c = A.defaultView(a.element()).dom();
            a = Lc.exact(a.element(), a.offset(), b.element(), b.offset());
            return Wa.getAsString(c, a)
        }, IK = {
            beforeAfter: Gi,
            anchorText: function (a, b) {
                var c = kb.freefallLtr(b);
                return Xo(c).map(function (b) {
                    var d = Hi(c, b);
                    return d + iv(a - d.length, b, "")
                }).getOr("")
            },
            flankingText: function (a, b) {
                if (0 === a) return Gi("", "");
                var c = kb.freefallLtr(b);
                b = kb.freefallRtl(b);
                return jv(a, c, b, "", "")
            },
            extendRightAndLeft: jv,
            extendWordsSearch: Yo,
            extendWordsRight: iv,
            extendWordsLeft: BK,
            wordSearch: kv,
            wordLeft: hv,
            wordRight: Xo,
            pointEq: FK,
            boundaryPointRight: GK,
            boundaryPointLeft: HK,
            textBetweenPoints: Hi,
            wordSeeker: DK,
            wordBreakSeeker: EK
        }, JK = function (a, b) {
            try {
                return a()
            } catch (c) {
                if (12 === c.code) return b();
                throw c;
            }
        }, lv = function (a) {
            return L.closest(a, "a[href]")
        }, mv = function (a, b) {
            return lv(a).bind(function (a) {
                return lv(b).filter(function (b) {
                    return N.eq(a, b)
                })
            })
        }, kaa = O("element", "innerText",
        "before", "after"), nv = function (a, b, c, d) {
            b = xf.isEmpty(b) && xf.isEmpty(c) && xf.isEmpty(d) ? "#" + m.get(a, "id") : b;
            return kaa(a, b, c, d)
        }, ov = function (a) {
            return Fa.is(a, "a[href]") ? [a] : Fa.all("a[href]", a)
        }, Ld = {
            contentLink: function (a) {
                var b = a.getSelection();
                return vc.detect(b).fold(function () {
                    return b.bind(function (a) {
                        return mv(a.startContainer(), a.endContainer())
                    })
                }, function (a) {
                    return g.some(a.image()).bind(lv)
                })
            }, sharedLink: mv, sharedLinkOrClosest: function (a, b) {
                var c = kb.toLeaf(a.startContainer(), a.startOffset());
                a = kb.toLeaf(a.endContainer(), a.endOffset());
                return mv(c.element(), a.element()).orThunk(function () {
                    return L.closest(c.element(), "a[href]", b)
                })
            }, findLinkTargets: function (a) {
                return Fa.all("h1,h2,h3,h4,h5,h6,div[id],p[id],span[id],a[id],a[name]", a)
            }, linkTargetText: function (a, b) {
                var c = Vb.get(b).length, d = Pc.deep(b);
                c = IK.anchorText(c, d);
                if (pa.isBlock(b)) return nv(b, c, "", "");
                a = IK.flankingText(Math.max(0, a - c.length), b);
                return nv(b, c, a.before(), a.after())
            }, linkTargetFastText: function (a, b) {
                var c = Vb.get(b);
                a =
                    c.length > a ? c.substr(0, a) : c;
                return nv(b, a, "", "")
            }, all: ov, many: function (a) {
                return ia(a, ov)
            }, hrefUrl: function (a, b) {
                return JK(function () {
                    return Fa.all('a[href="' + b + '"]', a)
                }, function () {
                    var c = ov(a);
                    return ka(c, function (a) {
                        return m.get(a, "href") === b
                    })
                })
            }, anchorTarget: function (a, b) {
                return JK(function () {
                    return Fa.one("#" + b + ',a[name="' + b + '"]', a)
                }, function () {
                    var c = A.owner(a).dom();
                    return g.from(c.getElementById(b)).map(r.fromDom).orThunk(function () {
                        var c = Fa.all("[name]", a);
                        return qa(c, function (a) {
                            return m.get(a,
                                "id") === b || m.get(a, "name") === b
                        })
                    })
                })
            }, getAnchorValue: function (a, b) {
                a = a.replace(/[^0-9a-zA-Z$_.+*(),-]/g, "");
                return 0 < a.length ? a : b
            }
        }, Zo = ["li"], KK = function (a, b) {
            return Bc.cata(a, function (a) {
                return !0 === b ? [] : Ud.wrap(a)
            }, function (a) {
                return [a]
            }, function (a, b) {
                return "table" === D.name(a) ? [a] : Ud.handleContainer(Zo, a, b, KK)
            }, function (a) {
                return !0 === b ? [] : Ud.wrap([a])
            })
        }, laa = {
            isRootContainer: qo.isRootOrContainer, extract: function (a) {
                return KK(a, !1)
            }, isCapable: function (a) {
                return Dj.isBlock(a) || U(Zo, D.name(a))
            }, canUse: function (a) {
                return pa.isFormatting(a) ||
                    U(Zo, D.name(a))
            }, quasi: u(Ud.handleRoot, Zo), ascend: ca
        }, maa = function (a, b) {
            return L.closest(b, '[dir="rtl"],[dir="ltr"]').filter(a).isSome()
        }, LK = function (a, b, c) {
            var d = fV(b, c), e = function (a) {
                d.set(a);
                v.reflow(a)
            }, f = function (a) {
                return ae.getDirection(a) === c
            };
            return {
                run: function (a, b, c, d, f) {
                    return pi.applyOn(a, laa, b, c, d, f, function (a) {
                        z(a, e);
                        return a
                    })
                }, query: function (a, b) {
                    return mH.bothMatch(a, b, u(maa, f))
                }, name: h(a)
            }
        }, naa = LK("DirRtl", "dir", "rtl"), oaa = LK("DirLtr", "dir", "ltr"), $o = {dirLtr: h(oaa), dirRtl: h(naa)},
        MK = function (a) {
            return function (b) {
                var c = function (c, e, f, k) {
                    return a.run(b.content().isRoot, c, e, f, k)
                };
                Zb.cata(b.selections().get(), t, ko.multiple(b.content(), b.undo(), c), ko.single(b.content(), b.undo(), c, Ek, Dk));
                setTimeout(function () {
                    b.content().uiChanged()
                }, 0)
            }
        }, az = {dirRtl: MK($o.dirRtl()), dirLtr: MK($o.dirLtr())}, paa = O("ltrdir", "rtldir"), NK = function (a, b) {
            return b.query(a.startContainer(), a.endContainer()) ? Da.on(!0) : Da.off()
        }, qaa = function (a) {
            return L.closest(a.startContainer(), "[dir]").isSome() || L.closest(a.endContainer(),
                "[dir]").isSome()
        }, $y = {
            readDir: function (a) {
                return a.getSelection().filter(qaa).map(function (a) {
                    return paa(NK(a, $o.dirLtr()), NK(a, $o.dirRtl()))
                })
            }
        }, raa = ta.generate([{blob: ["id", "imageresult", "objurl"]}, {url: ["id", "url", "raw"]}]), Qc = ua(raa, {
            cata: function (a, b, c) {
                return a.fold(b, c)
            }
        }), Uc = {
            create: bz, clone: function (a) {
                var b = bz(a.width, a.height);
                dz(b).drawImage(a, 0, 0);
                return b
            }, resize: cz, get2dContext: dz, get3dContext: function (a) {
                var b = null;
                try {
                    b = a.getContext("webgl") || a.getContext("experimental-webgl")
                } catch (c) {
                }
                b ||
                (b = null);
                return b
            }
        }, Nh = {
            getWidth: function (a) {
                return a.naturalWidth || a.width
            }, getHeight: function (a) {
                return a.naturalHeight || a.height
            }
        }, saa = function () {
            function a(a, b) {
                return function () {
                    a.apply(b, arguments)
                }
            }

            function b(a) {
                var b = this;
                null === this._state ? this._deferreds.push(a) : h(function () {
                    var c = b._state ? a.onFulfilled : a.onRejected;
                    if (null === c) (b._state ? a.resolve : a.reject)(b._value); else {
                        try {
                            var d = c(b._value)
                        } catch (X) {
                            a.reject(X);
                            return
                        }
                        a.resolve(d)
                    }
                })
            }

            function c(b) {
                try {
                    if (b === this) throw new TypeError("A promise cannot be resolved with itself.");
                    if (b && ("object" === typeof b || "function" === typeof b)) {
                        var f = b.then;
                        if ("function" === typeof f) {
                            k(a(f, b), a(c, this), a(d, this));
                            return
                        }
                    }
                    this._state = !0;
                    this._value = b;
                    e.call(this)
                } catch (G) {
                    d.call(this, G)
                }
            }

            function d(a) {
                this._state = !1;
                this._value = a;
                e.call(this)
            }

            function e() {
                for (var a = 0, c = this._deferreds.length; a < c; a++) b.call(this, this._deferreds[a]);
                this._deferreds = null
            }

            function f(a, b, c, d) {
                this.onFulfilled = "function" === typeof a ? a : null;
                this.onRejected = "function" === typeof b ? b : null;
                this.resolve = c;
                this.reject =
                    d
            }

            function k(a, b, c) {
                var d = !1;
                try {
                    a(function (a) {
                        d || (d = !0, b(a))
                    }, function (a) {
                        d || (d = !0, c(a))
                    })
                } catch (X) {
                    d || (d = !0, c(X))
                }
            }

            var g = function (b) {
                if ("object" !== typeof this) throw new TypeError("Promises must be constructed via new");
                if ("function" !== typeof b) throw new TypeError("not a function");
                this._value = this._state = null;
                this._deferreds = [];
                k(b, a(c, this), a(d, this))
            }, h = g.immediateFn || "function" === typeof setImmediate && setImmediate || function (a) {
                setTimeout(a, 1)
            }, m = Array.isArray || function (a) {
                return "[object Array]" ===
                    Object.prototype.toString.call(a)
            };
            g.prototype["catch"] = function (a) {
                return this.then(null, a)
            };
            g.prototype.then = function (a, c) {
                var d = this;
                return new g(function (e, k) {
                    b.call(d, new f(a, c, e, k))
                })
            };
            g.all = function () {
                var a = Array.prototype.slice.call(1 === arguments.length && m(arguments[0]) ? arguments[0] : arguments);
                return new g(function (b, c) {
                    function d(f, k) {
                        try {
                            if (k && ("object" === typeof k || "function" === typeof k)) {
                                var g = k.then;
                                if ("function" === typeof g) {
                                    g.call(k, function (a) {
                                        d(f, a)
                                    }, c);
                                    return
                                }
                            }
                            a[f] = k;
                            0 === --e && b(a)
                        } catch (AT) {
                            c(AT)
                        }
                    }

                    if (0 === a.length) return b([]);
                    for (var e = a.length, f = 0; f < a.length; f++) d(f, a[f])
                })
            };
            g.resolve = function (a) {
                return a && "object" === typeof a && a.constructor === g ? a : new g(function (b) {
                    b(a)
                })
            };
            g.reject = function (a) {
                return new g(function (b, c) {
                    c(a)
                })
            };
            g.race = function (a) {
                return new g(function (b, c) {
                    for (var d = 0, e = a.length; d < e; d++) a[d].then(b, c)
                })
            };
            return g
        }, Md = window.Promise ? window.Promise : saa(), km = {
            atob: function (a) {
                return Kc.getOrDie("atob")(a)
            }, requestAnimationFrame: function (a) {
                Kc.getOrDie("requestAnimationFrame")(a)
            }
        },
        jd = {
            blobToImage: gz, imageToBlob: function (a) {
                a = a.src;
                return 0 === a.indexOf("data:") ? $q(a) : hz(a)
            }, blobToArrayBuffer: function (a) {
                return new Md(function (b) {
                    var c = new Zq;
                    c.onloadend = function () {
                        b(c.result)
                    };
                    c.readAsArrayBuffer(a)
                })
            }, blobToDataUri: jz, blobToBase64: function (a) {
                return jz(a).then(function (a) {
                    return a.split(",")[1]
                })
            }, dataUriToBlobSync: iz, canvasToBlob: function (a, b, c) {
                b = b || "image/png";
                return HTMLCanvasElement.prototype.toBlob ? new Md(function (d) {
                    a.toBlob(function (a) {
                        d(a)
                    }, b, c)
                }) : $q(a.toDataURL(b,
                    c))
            }, canvasToDataURL: function (a, b, c) {
                b = b || "image/png";
                return a.then(function (a) {
                    return a.toDataURL(b, c)
                })
            }, blobToCanvas: function (a) {
                return gz(a).then(function (a) {
                    URL.revokeObjectURL(a.src);
                    var b = Uc.create(Nh.getWidth(a), Nh.getHeight(a));
                    Uc.get2dContext(b).drawImage(a, 0, 0);
                    return b
                })
            }, uriToBlob: function (a) {
                return 0 === a.indexOf("blob:") ? hz(a) : 0 === a.indexOf("data:") ? $q(a) : null
            }
        }, Nj = {
            blobToImage: function (a) {
                return jd.blobToImage(a)
            }, imageToBlob: function (a) {
                return jd.imageToBlob(a)
            }, blobToDataUri: function (a) {
                return jd.blobToDataUri(a)
            },
            blobToBase64: function (a) {
                return jd.blobToBase64(a)
            }, dataUriToBlobSync: function (a) {
                return jd.dataUriToBlobSync(a)
            }, uriToBlob: function (a) {
                return g.from(jd.uriToBlob(a))
            }
        }, xe = {
            fromBlob: kz, fromCanvas: function (a, b) {
                return jd.canvasToBlob(a, b).then(function (b) {
                    return ar(Md.resolve(a), b, a.toDataURL())
                })
            }, fromImage: function (a) {
                return jd.imageToBlob(a).then(function (a) {
                    return kz(a)
                })
            }, fromBlobAndUrlSync: function (a, b) {
                return ar(jd.blobToCanvas(a), a, b)
            }
        }, OK = function (a) {
            return a.toBlob()
        }, Yc = {
            blobToImageResult: function (a) {
                return xe.fromBlob(a)
            },
            fromBlobAndUrlSync: function (a, b) {
                return xe.fromBlobAndUrlSync(a, b)
            }, imageToImageResult: function (a) {
                return xe.fromImage(a)
            }, imageResultToBlob: function (a, b, c) {
                return void 0 === b && void 0 === c ? OK(a) : a.toAdjustedBlob(b, c)
            }, imageResultToOriginalBlob: OK, imageResultToDataURL: function (a) {
                return a.toDataURL()
            }
        }, dg = {
            createObjectURL: function (a) {
                return Kc.getOrDie("URL").createObjectURL(a)
            }, revokeObjectURL: function (a) {
                Kc.getOrDie("URL").revokeObjectURL(a)
            }
        }, Xk = aa.detect(), QK = function (a) {
            var b = dg.createObjectURL(a);
            return PK(a, b)
        }, PK = function (a, b) {
            return Ga.nu(function (c) {
                Nj.blobToDataUri(a).then(function (d) {
                    d = Yc.fromBlobAndUrlSync(a, d);
                    var e = Ha("image");
                    d = Qc.blob(e, d, b);
                    c(d)
                })
            })
        }, taa = function (a) {
            return 1 === a.length && U(a, "Files")
        }, uaa = function (a) {
            return !U(a, "text/_moz_htmlcontext")
        }, vaa = function (a) {
            return U(a, "Files")
        }, waa = function (a) {
            return !0
        }, ve = {
            multiple: function (a) {
                return 0 === a.length ? Ga.pure([]) : Ce(a, QK)
            },
            toFiles: function (a) {
                return a.raw().target.files || a.raw().dataTransfer.files
            },
            isFiles: Xk.browser.isChrome() ||
            Xk.browser.isSafari() || Xk.browser.isOpera() ? vaa : Xk.browser.isFirefox() ? uaa : Xk.browser.isIE() ? taa : waa,
            fromImages: function (a) {
                a = E(a, function (a) {
                    var b = Ha("image");
                    return Qc.url(b, m.get(a, "src"), a)
                });
                return Ga.pure(a)
            },
            single: QK,
            singleWithUrl: PK
        }, Ii = na(!1), hA = {
            register: function (a, b, c) {
                var d = H.create({
                    dragstart: p(["original"]),
                    dragend: p(["original"]),
                    dragover: p(["original"]),
                    dragleave: p(["original"]),
                    drop: p(["original"]),
                    dragndropimages: p(["original", "files"]),
                    dragndrophtml: p(["original"]),
                    dragndropinternal: p([])
                });
                b.each(function (b) {
                    var c = function (c) {
                        return function () {
                            c(a, b)
                        }
                    };
                    d.registry.dragover.bind(c(n.add));
                    d.registry.dragleave.bind(c(n.remove));
                    d.registry.drop.bind(c(n.remove))
                });
                var e = K.bind(a, "dragstart", function (a) {
                    Ii.set(!0);
                    d.trigger.dragstart(a)
                }), f = K.bind(a, "dragend", function (a) {
                    Ii.set(!1);
                    d.trigger.dragend(a)
                }), k = K.bind(a, "dragover", function (a) {
                    Ii.get() || (!0 === c ? (a.prevent(), d.trigger.dragover(a)) : a.kill())
                }), g = K.bind(a, "dragleave", function (a) {
                    Ii.get() || d.trigger.dragleave(a)
                }), h = K.bind(a, "drop",
                    function (a) {
                        if (Ii.get()) Ii.set(!1), setTimeout(function () {
                            return d.trigger.dragndropinternal()
                        }, 100); else if (d.trigger.drop(a), a.kill(), ve.isFiles(a.raw().dataTransfer.types)) {
                            var b = ve.toFiles(a);
                            d.trigger.dragndropimages(a, b)
                        } else U(a.raw().dataTransfer.types, "text/html") && d.trigger.dragndrophtml(a)
                    });
                return {
                    destroy: function () {
                        e.unbind();
                        f.unbind();
                        k.unbind();
                        g.unbind();
                        h.unbind()
                    }, events: d.registry
                }
            }
        }, iV = {
            forImages: function (a, b, c) {
                a = hA.register(a, b, c);
                var d = H.create({
                    dragstart: p(["original"]),
                    dragend: p(["original"]),
                    dragover: p(["original"]),
                    dragleave: p(["original"]),
                    drop: p(["original"]),
                    dragndropimages: p(["assets", "x", "y"]),
                    dragndrophtml: p(["html", "x", "y"]),
                    dragndropinternal: p([])
                });
                b = function (a, b) {
                    a.bind(function (a) {
                        b(a.original())
                    })
                };
                a.events.dragndropimages.bind(function (a) {
                    var b = a.original();
                    ve.multiple(a.files()).get(function (a) {
                        d.trigger.dragndropimages(a, b.x(), b.y())
                    })
                });
                a.events.dragndrophtml.bind(function (a) {
                    a = a.original();
                    var b = a.raw().dataTransfer.getData("text/html");
                    d.trigger.dragndrophtml(b, a.x(),
                        a.y())
                });
                a.events.dragndropinternal.bind(function () {
                    d.trigger.dragndropinternal()
                });
                b(a.events.dragstart, d.trigger.dragstart);
                b(a.events.dragend, d.trigger.dragend);
                b(a.events.dragover, d.trigger.dragover);
                b(a.events.dragleave, d.trigger.dragleave);
                b(a.events.drop, d.trigger.drop);
                return {destroy: a.destroy, events: d.registry}
            }
        }, xaa = {
            recompose: function (a) {
                var b = "";
                "" !== a.protocol && (b += a.protocol, b += ":");
                "" !== a.authority && (b = b + "//" + a.authority);
                b += a.path;
                "" !== a.query && (b = b + "?" + a.query);
                "" !== a.anchor && (b =
                    b + "#" + a.anchor);
                return b
            }
        }, yaa = {
            strictMode: !1,
            key: "source protocol authority userInfo user password host port relative path directory file query anchor".split(" "),
            q: {name: "queryKey", parser: /(?:^|&)([^&=]*)=?([^&]*)/g},
            parser: {
                strict: /^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@\/]*)(?::([^:@\/]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,
                loose: /^(?:(?![^:@\/]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@\/]*)(?::([^:@\/]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/
            }
        },
        zaa = function (a, b) {
            a = b.parser[b.strictMode ? "strict" : "loose"].exec(a);
            for (var c = {}, d = 14; d--;) c[b.key[d]] = a[d] || "";
            c[b.q.name] = {};
            c[b.key[12]].replace(b.q.parser, function (a, d, k) {
                d && (c[b.q.name][d] = k)
            });
            return c
        }, Sh = {
            parse: function (a, b) {
                b = ua(yaa, b);
                return zaa(a, b)
            }
        }, ap = {
            remove: function (a) {
                for (var b = ""; "" !== a;) if (Gb(a, "../")) a = hk(a, "../"); else if (Gb(a, "./")) a = hk(a, "./"); else if (Gb(a, "/./")) a = "/" + hk(a, "/./"); else if ("/." === a) a = "/"; else if (Gb(a, "/../")) a = "/" + hk(a, "/../"), b = ik(b, b.substring(b.lastIndexOf("/")));
                else if ("/.." === a) a = "/", b = ik(b, b.substring(b.lastIndexOf("/"))); else if ("." === a || ".." === a) a = ""; else {
                    var c = a.match(/(^\/?.*?)(\/|$)/)[1];
                    a = hk(a, c);
                    b += c
                }
                return b
            }
        }, Aaa = {
            merge: function (a, b, c) {
                if ("" !== c && "" === a) return "/" + b;
                c = a.substring(a.lastIndexOf("/") + 1);
                return ik(a, c) + b
            }
        }, Baa = {
            transform: function (a, b) {
                var c = {strictMode: !0}, d = Sh.parse(a, c);
                b = Sh.parse(b, c);
                c = {};
                "" !== b.protocol ? (c.protocol = b.protocol, c.authority = b.authority, c.path = ap.remove(b.path), c.query = b.query) : ("" !== b.authority ? (c.authority = b.authority,
                    c.path = ap.remove(b.path), c.query = b.query) : ("" === b.path ? (c.path = d.path, c.query = "" !== b.query ? b.query : d.query) : (Gb(b.path, "/") ? c.path = ap.remove(b.path) : (c.path = Aaa.merge(d.path, b.path, a.authority), c.path = ap.remove(c.path)), c.query = b.query), c.authority = d.authority), c.protocol = d.protocol);
                c.anchor = b.anchor;
                return c
            }
        }, Cr = {
            resolve: function (a, b) {
                a = Baa.transform(a, b);
                return xaa.recompose(a)
            }
        }, RK = aa.detect(), SK = RK.browser, Caa = !(SK.isEdge() && 16 > SK.version.major || RK.deviceType.isiOS()),
        TK = function (a, b) {
            var c =
                function (b, c, f) {
                    var d = m.get(b, c);
                    Bb(d, "://") || (m.set(b, f, d), m.set(b, c, Cr.resolve(a.baseURI(), d)))
                };
            z(b, function (a) {
                "a" === D.name(a) && m.has(a, "href") ? c(a, "href", "data-ephox-href") : "img" === D.name(a) && m.has(a, "src") && c(a, "src", "data-ephox-src")
            })
        }, UK = function (a, b, c) {
            v.setAll(b, {position: "absolute", top: "-1000px"});
            y.append(a.body(), b);
            var d = a.getSelection();
            Wa.setToElement(a.win(), b);
            setTimeout(function () {
                F.remove(b);
                d.each(function (b) {
                    a.setSelection(b.startContainer(), b.startOffset(), b.endContainer(),
                        b.endOffset())
                });
                setTimeout(c, 0)
            }, 0)
        }, Daa = function (a, b) {
            return function (b, d, e, f) {
                var c = b.raw();
                if (!xa(c.type) || "copy" !== c.type.toLowerCase() && "cut" !== c.type.toLowerCase()) throw"Can only set the clipboard with a cut or copy event";
                c = c.clipboardData;
                var g = r.fromTag("div", a.doc().dom());
                Ea.set(g, e());
                var h = Fa.all("a,img", g);
                TK(a, h);
                g = Ea.get(g);
                if (Caa && void 0 !== c && vb(c.setData)) try {
                    c.setData("text/plain", d());
                    c.setData("text/html", g);
                    var m = !0
                } catch (w) {
                    m = !1
                } else m = !1;
                m ? (b.kill(), setTimeout(f, 0)) : UK(a,
                    e, f)
            }
        }, Eaa = xd("doc win body baseURI getSelection setSelection".split(" ")), lz = {
            register: function (a) {
                Eaa(a);
                return {setClipboard: Daa(a, UK)}
            }, textMime: h("text/plain"), htmlMime: h("text/html"), processLinksAndImages: TK
        }, Faa = Pb(Ga.pure, I.value), Gaa = Pb(Ga.pure, I.error), hf = {
            pure: Faa, failed: Gaa, foldSync: function (a, b, c) {
                return a.map(function (a) {
                    return a.fold(b, c)
                })
            }, bindSync: function (a, b) {
                return a.map(function (a) {
                    return a.bind(b)
                })
            }, bindAsync: function (a, b) {
                return a.bind(function (a) {
                    return a.bind(b)
                })
            }, mapSync: function (a,
                                  b) {
                return a.map(function (a) {
                    return a.map(b)
                })
            }, handle: function (a, b, c) {
                return a.get(function (a) {
                    return a.fold(b, c)
                })
            }
        }, yj = {
            now: function () {
                return (new Date).getTime()
            }
        },
        Ne = ta.generate([{strict: []}, {defaultedThunk: ["fallbackThunk"]}, {asOption: []}, {asDefaultedOptionThunk: ["fallbackThunk"]}, {mergeWithThunk: ["baseThunk"]}]),
        sg = Ne.strict, Yk = Ne.asOption, Haa = Ne.defaultedThunk, Iaa = Ne.mergeWithThunk;
    ta.generate([{bothErrors: ["error1", "error2"]}, {firstError: ["error1", "value2"]}, {secondError: ["value1", "error2"]},
        {bothValues: ["value1", "value2"]}]);
    var VK = function (a) {
            var b = [], c = [];
            z(a, function (a) {
                a.fold(function (a) {
                    b.push(a)
                }, function (a) {
                    c.push(a)
                })
            });
            return {errors: b, values: c}
        }, WK = function (a) {
            return Pb(I.error, Qb)(a)
        }, pv = {
            consolidateObj: function (a, b) {
                a = VK(a);
                return 0 < a.errors.length ? WK(a.errors) : I.value(oa.apply(void 0, [b].concat(a.values)))
            }, consolidateArr: function (a) {
                a = VK(a);
                return 0 < a.errors.length ? WK(a.errors) : I.value(a.values)
            }
        }, TY = function (a, b) {
            var c = {};
            z(a, function (a) {
                c[a[b]] = a
            });
            return c
        }, Jaa = function (a,
                           b) {
            var c = {};
            Ma(a, function (a, e) {
                U(b, e) || (c[e] = a)
            });
            return c
        }, Kj = function (a) {
            return function (b) {
                return b.hasOwnProperty(a) ? g.from(b[a]) : g.none()
            }
        }, XK = function (a, b) {
            return function (c) {
                return Kj(a)(c).getOr(b)
            }
        }, zc = function (a, b) {
            return Kj(b)(a)
        }, ye = function (a, b) {
            return a.hasOwnProperty(b) && void 0 !== a[b] && null !== a[b]
        }, fc = function (a, b) {
            var c = {};
            c[a] = b;
            return c
        }, pb = function (a) {
            var b = {};
            z(a, function (a) {
                b[a.key] = a.value
            });
            return b
        }, YK = function (a, b) {
            return zc(a, b)
        }, qv = function (a, b) {
            return fc(a, b)
        }, rv = function (a,
                          b) {
            return pv.consolidateObj(a, b)
        },
        Zk = ta.generate([{setOf: ["validator", "valueType"]}, {arrOf: ["valueType"]}, {objOf: ["fields"]}, {itemOf: ["validator"]}, {choiceOf: ["key", "branches"]}, {thunk: ["description"]}, {func: ["args", "outputSchema"]}]),
        ZK = ta.generate([{field: ["name", "presence", "type"]}, {state: ["name"]}]), Nb = {
            parse: function (a) {
                return Kc.getOrDie("JSON").parse(a)
            }, stringify: function (a, b, c) {
                return Kc.getOrDie("JSON").stringify(a, b, c)
            }
        }, sv = function (a) {
            return ic(a) && 100 < cb(a).length ? " removed due to size" :
                Nb.stringify(a, null, 2)
        }, Kaa = function (a) {
            a = 10 < a.length ? a.slice(0, 10).concat([{
                path: [], getErrorInfo: function () {
                    return "... (only showing first ten failures)"
                }
            }]) : a;
            return E(a, function (a) {
                return "Failed path: (" + a.path.join(" > ") + ")\n" + a.getErrorInfo()
            })
        }, $k = function (a, b) {
            return I.error([{path: a, getErrorInfo: b}])
        }, Laa = function (a, b, c) {
            return $k(a, function () {
                return 'Could not find valid *strict* value for "' + b + '" in ' + sv(c)
            })
        }, Maa = function (a, b) {
            return $k(a, function () {
                return 'Choice schema did not contain choice key: "' +
                    b + '"'
            })
        }, Naa = function (a, b, c) {
            return $k(a, function () {
                return 'The chosen schema: "' + c + '" did not exist in branches: ' + sv(b)
            })
        }, Oaa = function (a, b) {
            return $k(a, function () {
                return "There are unsupported fields: [" + b.join(", ") + "] specified"
            })
        }, Paa = function (a, b) {
            return $k(a, function () {
                return b
            })
        }, tv = ta.generate([{field: ["key", "okey", "presence", "prop"]}, {state: ["okey", "instantiator"]}]),
        Qaa = function (a, b, c) {
            return zc(b, c).fold(function () {
                return Laa(a, c, b)
            }, I.value)
        }, $K = function (a, b, c) {
            b = zc(a, b).fold(function () {
                    return c(a)
                },
                ca);
            return I.value(b)
        }, Raa = function (a, b, c) {
            b = zc(a, b).map(function (b) {
                return !0 === b ? c(a) : b
            });
            return I.value(b)
        }, Saa = function (a, b, c, d) {
            return c.fold(function (c, f, k, l) {
                var e = function (b) {
                    return l.extract(a.concat([c]), d, b).map(function (a) {
                        return fc(f, d(a))
                    })
                }, m = function (b) {
                    return b.fold(function () {
                        var a = fc(f, d(g.none()));
                        return I.value(a)
                    }, function (b) {
                        return l.extract(a.concat([c]), d, b).map(function (a) {
                            return fc(f, d(g.some(a)))
                        })
                    })
                };
                return function () {
                    return k.fold(function () {
                            return Qaa(a, b, c).bind(e)
                        },
                        function (a) {
                            return $K(b, c, a).bind(e)
                        }, function () {
                            return I.value(zc(b, c)).bind(m)
                        }, function (a) {
                            return Raa(b, c, a).bind(m)
                        }, function (a) {
                            var d = a(b);
                            return $K(b, c, h({})).map(function (a) {
                                return oa(d, a)
                            }).bind(e)
                        })
                }()
            }, function (a, c) {
                c = c(b);
                return I.value(fc(a, d(c)))
            })
        }, Taa = function (a, b, c, d) {
            c = E(c, function (c) {
                return Saa(a, b, c, d)
            });
            return pv.consolidateObj(c, {})
        }, Ji = function (a) {
            return {
                extract: function (b, c, d) {
                    return a(d, c).fold(function (a) {
                        return Paa(b, a)
                    }, I.value)
                }, toString: function () {
                    return "val"
                }, toDsl: function () {
                    return Zk.itemOf(a)
                }
            }
        },
        Uaa = function (a) {
            var b = cb(a);
            return ka(b, function (b) {
                return ye(a, b)
            })
        }, od = function (a) {
            var b = Cc(a), c = Eb(a, function (a, b) {
                return b.fold(function (b) {
                    return oa(a, fc(b, !0))
                }, h(a))
            }, {});
            return {
                extract: function (a, e, f) {
                    var d = $m(f) ? [] : Uaa(f);
                    d = ka(d, function (a) {
                        return !ye(c, a)
                    });
                    return 0 === d.length ? b.extract(a, e, f) : Oaa(a, d)
                }, toString: b.toString, toDsl: b.toDsl
            }
        }, Cc = function (a) {
            return {
                extract: function (b, c, d) {
                    return Taa(b, d, a, c)
                }, toString: function () {
                    return "obj{\n" + E(a, function (a) {
                        return a.fold(function (a, b, e, f) {
                            return a +
                                " -> " + f.toString()
                        }, function (a, b) {
                            return "state(" + a + ")"
                        })
                    }).join("\n") + "}"
                }, toDsl: function () {
                    return Zk.objOf(E(a, function (a) {
                        return a.fold(function (a, b, e, f) {
                            return ZK.field(a, e, f)
                        }, function (a, b) {
                            return ZK.state(a)
                        })
                    }))
                }
            }
        }, aL = function (a) {
            return {
                extract: function (b, c, d) {
                    d = E(d, function (d, f) {
                        return a.extract(b.concat(["[" + f + "]"]), c, d)
                    });
                    return pv.consolidateArr(d)
                }, toString: function () {
                    return "array(" + a.toString() + ")"
                }, toDsl: function () {
                    return Zk.arrOf(a)
                }
            }
        }, uv = h(Ji(I.value)), Vaa = Pb(aL, Cc), al = tv.state, Dc =
            tv.field, Waa = function (a, b, c, d, e) {
            return zc(d, e).fold(function () {
                return Naa(a, d, e)
            }, function (d) {
                return Cc(d).extract(a.concat(["branch: " + e]), b, c)
            })
        }, bL = function (a, b) {
            return {
                extract: function (c, d, e) {
                    return zc(e, a).fold(function () {
                        return Maa(c, a)
                    }, function (a) {
                        return Waa(c, d, e, b, a)
                    })
                }, toString: function () {
                    return "chooseOn(" + a + "). Possible values: " + cb(b)
                }, toDsl: function () {
                    return Zk.choiceOf(a, b)
                }
            }
        }, Xaa = Ji(I.value), cL = function (a) {
            return Ji(function (b) {
                return a(b)
            })
        }, dL = function (a, b, c, d) {
            return b.extract([a],
                c, d).fold(function (a) {
                return I.error({input: d, errors: a})
            }, I.value)
        }, tg = function (a, b, c) {
            return dL(a, b, h, c)
        }, Ki = function (a) {
            return a.fold(function (a) {
                throw Error(bp(a));
            }, ca)
        }, Oe = function (a, b, c) {
            return Ki(dL(a, b, ca, c))
        }, bp = function (a) {
            return "Errors: \n" + Kaa(a.errors) + "\n\nInput object: " + sv(a.input)
        }, eL = function (a, b) {
            return bL(a, b)
        }, cp = h(Xaa), fL = function (a, b) {
            return Ji(function (c) {
                var d = typeof c;
                return a(c) ? I.value(c) : I.error("Expected type: " + b + " but got: " + d)
            })
        }, Yaa = fL(xa, "string"), gL = fL(vb, "function"),
        dp = ta.generate([{get: []}, {post: []}, {put: []}, {del: []}]),
        ep = {get: dp.get, post: dp.post, put: dp.put, del: dp.del}, Zaa = {
            generate: function (a, b, c, d) {
                a = a.bind(function (a) {
                    return a.match({
                        file: function () {
                            return g.none()
                        }, form: function () {
                            return g.some("application/x-www-form-urlencoded; charset=UTF-8")
                        }, json: function () {
                            return g.some("application/json")
                        }, plain: function () {
                            return g.some("text/plain")
                        }, html: function () {
                            return g.some("text/html")
                        }
                    })
                });
                c = c.match({none: g.none, xhr: h(g.some(!0))});
                var e = b.match({
                    json: g.none,
                    blob: h(g.some("blob")),
                    xml: h(g.some("document")),
                    html: h(g.some("document")),
                    text: h(g.some("text"))
                });
                b = b.match({
                    json: h("application/json, text/javascript"),
                    blob: h("application/octet-stream"),
                    text: h("text/plain"),
                    html: h("text/html"),
                    xml: h("application/xml, text/xml")
                }) + ", */*; q=0.01";
                return {contentType: h(a), credentials: h(c), responseType: h(e), accept: h(b), headers: h(d)}
            }
        }, $aa = {
            mutate: function (a, b) {
                b.contentType().each(function (b) {
                    a.setRequestHeader("Content-Type", b)
                });
                var c = b.accept();
                a.setRequestHeader("Accept",
                    c);
                b.credentials().each(function (b) {
                    a.withCredentials = b
                });
                b.responseType().each(function (b) {
                    a.responseType = b
                });
                b = b.headers();
                Ma(b, function (b, c) {
                    xa(c) || xa(b) ? a.setRequestHeader(c, b) : console.error("Request header data was not a string: ", c, " -> ", b)
                })
            }
        }, hL = {
            parse: function (a) {
                try {
                    var b = Nb.parse(a);
                    return I.value(b)
                } catch (c) {
                    return I.error("Response was not JSON")
                }
            }
        }, iL = Aa(["message", "status", "responseText"], []), jL = {
            handle: function (a, b, c) {
                var d = function () {
                    return Ga.pure(c.response)
                };
                return b.match({
                    json: function () {
                        return hL.parse(c.response).fold(d,
                            Ga.pure)
                    }, blob: function () {
                        return g.from(c.response).map(jV).getOr(Ga.pure("no response content"))
                    }, text: d, html: d, xml: d
                }).map(function (b) {
                    return iL({
                        message: 0 === c.status ? "Unknown HTTP error (possible cross-domain request)" : 'Could not load url "' + a + '": ' + c.statusText,
                        status: c.status,
                        responseText: b
                    })
                })
            }, nu: iL
        }, aba = Object.assign || function (a) {
            for (var b, c = 1, d = arguments.length; c < d; c++) {
                b = arguments[c];
                for (var e in b) Object.prototype.hasOwnProperty.call(b, e) && (a[e] = b[e])
            }
            return a
        }, Pe = function (a) {
            return aba({},
                a, {
                    bindFuture: function (b) {
                        return Pe(a.bind(function (c) {
                            return c.fold(function () {
                                return a
                            }, function (a) {
                                return b(a)
                            })
                        }))
                    }, bindResult: function (b) {
                        return Pe(a.map(function (a) {
                            return a.bind(b)
                        }))
                    }, mapResult: function (b) {
                        return Pe(a.map(function (a) {
                            return a.map(b)
                        }))
                    }, foldResult: function (b, c) {
                        return a.map(function (a) {
                            return a.fold(b, c)
                        })
                    }, withTimeout: function (b, c) {
                        return Pe(Ga.nu(function (d) {
                            var e = !1, f = window.setTimeout(function () {
                                e = !0;
                                d(I.error(c()))
                            }, b);
                            a.get(function (a) {
                                e || (window.clearTimeout(f), d(a))
                            })
                        }))
                    }
                })
        },
        kL = function (a) {
            return Pe(Ga.nu(a))
        }, lL = function (a) {
            return Pe(Ga.pure(I.value(a)))
        }, bl = {
            nu: kL, wrap: Pe, pure: lL, value: lL, error: function (a) {
                return Pe(Ga.pure(I.error(a)))
            }, fromResult: function (a) {
                return Pe(Ga.pure(a))
            }, fromFuture: function (a) {
                return Pe(a.map(I.value))
            }, fromPromise: function (a) {
                return kL(function (b) {
                    a.then(function (a) {
                        b(I.value(a))
                    }, function (a) {
                        b(I.error(a))
                    })
                })
            }
        }, bba = {
            validate: function (a, b) {
                var c = function () {
                    return bl.pure(b.response)
                };
                return a.match({
                    json: function () {
                        return hL.parse(b.response).fold(function (a) {
                            return bl.error(jL.nu({
                                message: a,
                                status: b.status, responseText: b.responseText
                            }))
                        }, bl.pure)
                    }, blob: c, text: c, html: c, xml: function (a, b) {
                        return function () {
                            return b().bindResult(function (b) {
                                return null === b ? I.error(a) : I.value(b)
                            })
                        }
                    }("Invalid XML document", c)
                })
            }
        }, fp = function (a, b, c, d, e, f) {
            var k = void 0 !== f ? f : {};
            return bl.nu(function (f) {
                var g = b.match({get: h("get"), put: h("put"), post: h("post"), del: h("delete")}),
                    l = new (Kc.getOrDie("XMLHttpRequest"));
                l.open(g, a, !0);
                g = Zaa.generate(c, d, e, k);
                $aa.mutate(l, g);
                var m = function () {
                    jL.handle(a, d, l).get(function (a) {
                        f(I.error(a))
                    })
                };
                l.onload = function () {
                    0 !== l.status || Gb(a, "file:") ? 100 > l.status || 400 <= l.status ? m() : bba.validate(d, l).get(f) : m()
                };
                l.onerror = m;
                c.fold(function () {
                    l.send()
                }, function (a) {
                    a = a.match({file: ca, form: ca, json: Nb.stringify, plain: ca, html: ca});
                    l.send(a)
                })
            }).toLazy()
        }, Ae = {
            get: function (a, b, c, d) {
                var e = ep.get();
                return fp(a, e, g.none(), b, c, d)
            }, post: function (a, b, c, d, e) {
                var f = ep.post();
                return fp(a, f, g.some(b), c, d, e)
            }, put: function (a, b, c, d, e) {
                var f = ep.put();
                return fp(a, f, g.some(b), c, d, e)
            }, del: function (a, b, c, d) {
                var e = ep.del();
                return fp(a, e, g.none(), b, c, d)
            }
        }, cl = ta.generate([{file: ["data"]}, {form: ["data"]}, {json: ["data"]}, {plain: ["data"]}, {html: ["data"]}]),
        AB = {file: cl.file, form: cl.form, json: cl.json, plain: cl.plain, html: cl.html},
        mL = ta.generate([{none: []}, {xhr: []}]), he = {none: mL.none, xhr: mL.xhr},
        dl = ta.generate([{json: []}, {blob: []}, {text: []}, {html: []}, {xml: []}]), Be = {
            json: dl.json,
            blob: dl.blob,
            text: dl.text,
            html: dl.html,
            xml: dl.xml,
            cata: function (a, b, c, d, e, f) {
                return a.match({json: b, blob: c, text: d, html: e, xml: f})
            }
        }, nL = function (a, b) {
            var c =
                -1 === a.indexOf("?") ? "?" : "&";
            return b ? a + c + "apiKey=" + encodeURIComponent(b) : a
        }, oL = function (a) {
            return a.hasOwnProperty("tiny-api-key") ? a["tiny-api-key"] : a.hasOwnProperty("tinymce-api-key") ? a["tinymce-api-key"] : a["textbox-api-key"]
        }, pL = function (a) {
            return a.fold(function (a) {
                var b = a.responseText();
                a = ic(b) ? b : a.message();
                return I.error(a)
            }, I.value)
        }, mm = {
            get: function (a, b, c, d) {
                var e = oL(d);
                return {
                    execute: function (f) {
                        f = Oe(a + ".ajax.service.get", b, f);
                        f = eb(f, function (a) {
                            return $m(a) ? String(a) : a
                        });
                        f = nL(yB(c, f), e);
                        return Ae.get(f, Be.json(), he.xhr(), d).map(pL)
                    }
                }
            }, post: function (a, b, c, d) {
                var e = oL(d);
                return {
                    execute: function (f) {
                        f = Oe(a + ".ajax.service.post", b, f);
                        return Ae.post(nL(c, e), AB.json(f), Be.json(), he.xhr(), d).map(pL)
                    }
                }
            }
        }, cba = {
            partition: function (a, b, c, d, e) {
                return !0 === e ? {known: {}, unknown: c} : hb(c, function (c, e) {
                    var f = d(e);
                    return a(b, f).fold(function () {
                        return {known: c.known, unknown: c.unknown.concat([e])}
                    }, function (a) {
                        a = fc(f, a);
                        return {known: ua(c.known, a), unknown: c.unknown}
                    })
                }, {known: {}, unknown: []})
            }
        }, dba = function (a,
                           b, c, d, e, f, k) {
            a = a(d, k);
            return hf.mapSync(a, function (a) {
                a = e(a);
                Ma(a, function (a, c) {
                    b.set(c, a, f)
                });
                return oa(c, a)
            })
        }, nm = {
            single: function (a, b, c, d, e) {
                return (!0 === e ? g.none() : b.get(d, c)).fold(function () {
                    return a(c, e).map(function (a) {
                        return a.map(function (a) {
                            b.set(c, a, d);
                            return a
                        })
                    })
                }, function (a) {
                    return hf.pure(a)
                })
            }, multiple: function (a, b, c, d, e, f, k) {
                c = cba.partition(b.get, f, c, e, k);
                return 0 === c.unknown.length ? hf.pure(c.known) : dba(a, b, c.known, c.unknown, d, f, k)
            }
        }, za = function (a) {
            return Dc(a, a, sg(), uv())
        }, gp = function (a,
                          b) {
            return Dc(a, a, sg(), b)
        }, eba = function (a, b) {
            return Dc(a, a, Yk(), Ji(function (c) {
                return I.error("The field: " + a + " is forbidden. " + b)
            }))
        }, el = function (a, b) {
            return Dc(a, a, sg(), Cc(b))
        }, Dd = function (a) {
            return Dc(a, a, Yk(), uv())
        }, qL = function (a, b) {
            return Dc(a, a, Yk(), b)
        }, fl = function (a, b) {
            return Dc(a, a, Yk(), Cc(b))
        }, da = function (a, b) {
            return Dc(a, a, Ne.defaultedThunk(h(b)), uv())
        }, fba = function (a, b, c) {
            return Dc(a, a, Ne.defaultedThunk(h(b)), Cc(c))
        }, ug = function (a, b) {
            return al(a, b)
        }, hp = function (a) {
            return "[" + a.join(", ") +
                "]"
        }, rL = ["iframely", "oembed", "fallback"], ip = function (a, b, c) {
            return Xa(b, function (b) {
                return U(a, b)
            }) ? I.error("Embed response source: " + hp(a) + " contains more than one of " + hp(rL)) : I.value(c)
        }, gba = {
            iframely: h("iframely"), oembed: h("oembed"), fallback: h("fallback"), identify: function (a) {
                return U(a, "iframely") ? ip(a, ["oembed", "fallback", "wikipedia"], "iframely") : U(a, "oembed") ? ip(a, ["iframely", "fallback", "wikipedia"], "oembed") : U(a, "fallback") ? ip(a, ["iframely", "oembed", "wikipedia"], "fallback") : U(a, "wikipedia") ?
                    ip(a, ["iframely", "oembed", "fallback"], "wikipedia") : I.error("Embed response source: " + hp(a) + " did not contain any of: " + hp(rL))
            }
        }, hba = Cc([za("url"), za("maxWidth"), da("fresh", !1)]), iba = Cc([za("status_code"), za("sub_code"), za("msg")]),
        jba = Cc([za("html"), el("rels", [Dc("source", "source", sg(), cL(function (a) {
            return Mb(a) ? gba.identify(a) : I.error("Sources was not an array: " + a)
        }))])]), br = {requestOne: h(hba), responseFailed: h(iba), responseSucceeded: h(jba)}, mz = {
            failed: function (a) {
                return tg("EmbedResponse.failure",
                    br.responseFailed(), a).fold(function (a) {
                    return I.error({code: h(600), subcode: h(0), msg: h(bp(a))})
                }, function (a) {
                    return I.error({code: a.status_code, subcode: a.sub_code, msg: a.msg})
                })
            }, success: function (a) {
                return tg("EmbedResponse.success", br.responseSucceeded(), a).fold(function (a) {
                    return I.error({code: h(601), subcode: h(0), msg: h(bp(a))})
                }, function (a) {
                    return I.value({recommended: h({html: a.html, source: a.rels().source})})
                })
            }
        }, Gf = B.resolve("embed-checking"), cr = {
            configure: function (a) {
                a.add(a.input(), Gf, Na.removeClass(Gf));
                a.add(a.output(), Gf, Na.removeClass(Gf));
                a.add(a.history(), Gf, Na.removeClass(Gf));
                a.add(a.internal(), Gf, Na.removeClass(Gf))
            }, embedChecking: h(Gf)
        }, vv = function () {
            return x.translate("link.anchor.top")
        }, wv = function () {
            return x.translate("link.anchor.bottom")
        }, sL = function () {
            var a = {};
            a[vv().toLowerCase()] = "top";
            a[wv().toLowerCase()] = "bottom";
            return a
        }, rb = {
            bookmarkDataAttr: h("data-textbox-bookmark"),
            bookmarkAnchorDataAttr: h("data-textbox-bookmark-anchor"),
            bookmarkBookmarkDataAttr: h("data-textbox-user-bookmark"),
            topAnchorUrl: vv,
            bottomAnchorUrl: wv,
            top: h("top"),
            bottom: h("bottom"),
            reservedUrls: sL,
            isReservedUrl: function (a) {
                return sL().hasOwnProperty(a.toLowerCase())
            },
            getReservedUrl: function (a) {
                var b = {};
                b.top = vv();
                b.bottom = wv();
                return b[a.toLowerCase()]
            }
        }, kba = {
            setCss: function (a, b, c) {
                a.dom().styleSheet ? a.dom().styleSheet.cssText = b : y.append(a, c)
            }
        }, lba = {
            escape: function (a) {
                return a.replace(/[-[\]{}()*+?.,\\^$|#\s]/g, "\\$&")
            }
        }, tL = function (a, b, c) {
            b = new RegExp("url\\(\\s*['\"]?" + lba.escape(b) + "(.*?)['\"]?\\s*\\)", "g");
            return a.replace(b, 'url("' + c + '$1")')
        }, mba = {
            replace: tL, replaceMany: function (a, b) {
                var c = a;
                Ma(b, function (a, b) {
                    console.log("rm css", c);
                    c = tL(c, b, a)
                });
                return c
            }
        }, uL = {
            stylesheets: function (a) {
                a = a.dom().styleSheets;
                return Array.prototype.slice.call(a)
            }, inject: function (a, b, c) {
                var d = r.fromTag("style", c.dom());
                m.set(d, "type", "text/css");
                a = void 0 === b ? a : mba.replaceMany(a, b);
                kba.setCss(d, a, r.fromText(a, c.dom()));
                c = L.descendant(c, "head").getOrDie();
                y.append(c, d)
            }
        }, nba = O("selector", "style", "raw"), xv = function (a) {
            return ia(a.cssRules,
                function (a) {
                    if (a.type === CSSRule.IMPORT_RULE) return xv(a.styleSheet);
                    if (a.type === CSSRule.STYLE_RULE) {
                        var b = a.selectorText, d = a.style.cssText;
                        if (void 0 === d) throw"WARNING: Browser does not support cssText property";
                        return [nba(b, d, a.style)]
                    }
                    return []
                })
        }, vL = {
            extract: xv, extractAll: function (a) {
                return ia(a, xv)
            }
        }, wL = {}, xL = {exports: wL};
    (function (a, b, c, d) {
        (function (d) {
            "object" === typeof b && "undefined" !== typeof c ? c.exports = d() : "function" === typeof a && a.amd ? a([], d) : ("undefined" !== typeof window ? window : "undefined" !==
            typeof global ? global : "undefined" !== typeof self ? self : this).EphoxContactWrapper = d()
        })(function () {
            return function () {
                function a(b, c, e) {
                    function f(g, h) {
                        if (!c[g]) {
                            if (!b[g]) {
                                var l = "function" == typeof d && d;
                                if (!h && l) return l(g, !0);
                                if (k) return k(g, !0);
                                h = Error("Cannot find module '" + g + "'");
                                throw h.code = "MODULE_NOT_FOUND", h;
                            }
                            h = c[g] = {exports: {}};
                            b[g][0].call(h.exports, function (a) {
                                return f(b[g][1][a] || a)
                            }, h, h.exports, a, b, c, e)
                        }
                        return c[g].exports
                    }

                    for (var k = "function" == typeof d && d, g = 0; g < e.length; g++) f(e[g]);
                    return f
                }

                return a
            }()({
                1: [function (a, b, c) {
                    a = function () {
                        var a = function (a) {
                            var b = a, c = {a: 0, b: 0, c: 0}, d = [];
                            var e = function (e, f) {
                                var k;
                                if (e.test(b)) {
                                    e = b.match(e);
                                    var g = 0;
                                    for (k = e.length; g < k; g += 1) {
                                        c[f] += 1;
                                        var h = e[g];
                                        var l = b.indexOf(h);
                                        var q = h.length;
                                        d.push({selector: a.substr(l, q), type: f, index: l, length: q});
                                        b = b.replace(h, Array(q + 1).join(" "))
                                    }
                                }
                            };
                            (function () {
                                var a = function (a) {
                                    var c;
                                    if (a.test(b)) {
                                        a = b.match(a);
                                        var d = 0;
                                        for (c = a.length; d < c; d += 1) {
                                            var e = a[d];
                                            b = b.replace(e, Array(e.length + 1).join("A"))
                                        }
                                    }
                                };
                                a(/\\[0-9A-Fa-f]{6}\s?/g);
                                a(/\\[0-9A-Fa-f]{1,5}\s/g);
                                a(/\\./g)
                            })();
                            (function () {
                                var a = /:not\(([^\)]*)\)/g;
                                a.test(b) && (b = b.replace(a, "     $1 "))
                            })();
                            (function () {
                                var a = /{[^]*/gm, c;
                                if (a.test(b)) {
                                    a = b.match(a);
                                    var d = 0;
                                    for (c = a.length; d < c; d += 1) {
                                        var e = a[d];
                                        b = b.replace(e, Array(e.length + 1).join(" "))
                                    }
                                }
                            })();
                            e(/(\[[^\]]+\])/g, "b");
                            e(/(#[^#\s\+>~\.\[:]+)/g, "a");
                            e(/(\.[^\s\+>~\.\[:]+)/g, "b");
                            e(/(::[^\s\+>~\.\[:]+|:first-line|:first-letter|:before|:after)/gi, "c");
                            e(/(:[\w-]+\([^\)]*\))/gi, "b");
                            e(/(:[^\s\+>~\.\[:]+)/g, "b");
                            b = b.replace(/[\*\s\+>~]/g,
                                " ");
                            b = b.replace(/[#\.]/g, " ");
                            e(/([^\s\+>~\.\[:]+)/g, "c");
                            d.sort(function (a, b) {
                                return a.index - b.index
                            });
                            return {
                                selector: a,
                                specificity: "0," + c.a.toString() + "," + c.b.toString() + "," + c.c.toString(),
                                specificityArray: [0, c.a, c.b, c.c],
                                parts: d
                            }
                        };
                        return {
                            calculate: function (b) {
                                var c, d = [];
                                b = b.split(",");
                                var e = 0;
                                for (c = b.length; e < c; e += 1) {
                                    var f = b[e];
                                    0 < f.length && d.push(a(f))
                                }
                                return d
                            }, compare: function (b, c) {
                                var d;
                                if ("string" === typeof b) {
                                    if (-1 !== b.indexOf(",")) throw"Invalid CSS selector";
                                    b = a(b).specificityArray
                                } else if (Array.isArray(b)) {
                                    if (4 !==
                                        b.filter(function (a) {
                                            return "number" === typeof a
                                        }).length) throw"Invalid specificity array";
                                } else throw"Invalid CSS selector or specificity array";
                                if ("string" === typeof c) {
                                    if (-1 !== c.indexOf(",")) throw"Invalid CSS selector";
                                    c = a(c).specificityArray
                                } else if (Array.isArray(c)) {
                                    if (4 !== c.filter(function (a) {
                                        return "number" === typeof a
                                    }).length) throw"Invalid specificity array";
                                } else throw"Invalid CSS selector or specificity array";
                                for (d = 0; 4 > d; d += 1) {
                                    if (b[d] < c[d]) return -1;
                                    if (b[d] > c[d]) return 1
                                }
                                return 0
                            }
                        }
                    }();
                    "undefined" !==
                    typeof c && (c.calculate = a.calculate, c.compare = a.compare)
                }, {}], 2: [function (a, b, c) {
                    a = a("specificity");
                    b.exports = {boltExport: a}
                }, {specificity: 1}]
            }, {}, [2])(2)
        })
    })(void 0, wL, xL, void 0);
    var oba = xL.exports.boltExport, yL = O("selector", "raw"), pba = function (a, b) {
            var c = {};
            z(a, function (d) {
                if (void 0 !== a[d]) {
                    var e = b.dom().style;
                    U(e, d) || (c[d] = a[d])
                }
            });
            return c
        }, qba = function (a, b) {
            b = ia(b, function (b) {
                var c = Y.descendants(a, b.selector());
                z(c, function (a) {
                    var c = pba(b.raw(), a);
                    v.setAll(a, c)
                });
                return c
            });
            z(b, function (a) {
                m.remove(a,
                    "class")
            })
        }, zL = function (a, b) {
            var c = function (a) {
                return -1 !== a.selector().indexOf(",")
            }, d = ia(ka(a, c), function (a) {
                var b = a.selector().split(",");
                return E(b, function (b) {
                    b = b.trim();
                    return yL(b, a.raw())
                })
            });
            a = ka(a, function (a) {
                return !c(a)
            }).concat(d);
            a.sort(function (a, b) {
                return oba.compare(a.selector(), b.selector())
            }).reverse();
            qba(b, a)
        }, AL = {
            inlineStyles: function (a, b, c) {
                a = uL.stylesheets(a);
                a = vL.extractAll(a).map(function (a) {
                    var b = a.selector();
                    b = c.hasOwnProperty(b) ? c[b] : b;
                    return yL(b, a.raw())
                });
                zL(a, b)
            }, inlinePrefixedStyles: function (a,
                                               b, c) {
                a = uL.stylesheets(a);
                a = vL.extractAll(a);
                a = ka(a, function (a) {
                    return Gb(a.selector(), c)
                });
                zL(a, b)
            }
        }, nz = {
            inlineStyles: function (a, b, c) {
                AL.inlineStyles(a, b, c)
            }, inlinePrefixedStyles: function (a, b, c) {
                AL.inlinePrefixedStyles(a, b, c)
            }
        }, mV = function (a) {
            a = qe.fromHtml(a);
            if (1 === a.length) return a[0];
            var b = r.fromTag("div");
            P.append(b, a);
            return b
        }, tm = {
            handle: function (a, b) {
                return K.bind(a, "click", b)
            }
        }, rba = {
            editor: function (a, b) {
                b = u(x.translate, b ? "aria.label.fullscreen" : "aria.label.editor");
                return a.fold(ca, b)
            }
        }, sba =
            function (a, b) {
                var c = Or(b, 500);
                return function () {
                    Vh(c)
                }
            }, tba = function (a, b) {
            var c = new window.MutationObserver(b);
            c.observe(A.owner(a).dom(), {attributes: !0, subtree: !0, childList: !0, attributeFilter: ["style", "class"]});
            return function () {
                c.disconnect()
            }
        }, uba = void 0 !== window.MutationObserver && null !== window.MutationObserver ? tba : sba, zz = {
            onShow: function (a, b) {
                if (sc.isVisible(a)) return km.requestAnimationFrame(b), t;
                var c = jf(function () {
                    sc.isVisible(a) && (d(), km.requestAnimationFrame(b))
                }, 100), d = uba(a, c.throttle);
                return d
            }
        }, gl = [], yv = function (a) {
            return Va(gl, function (b) {
                return N.eq(b.element, a)
            }).getOr(-1)
        }, zv = {
            begin: function (a, b) {
                -1 === yv(a) && (b = b(), gl.push({element: a, unbind: b}))
            }, query: function (a) {
                a = yv(a);
                return -1 === a ? g.none() : g.some(gl[a])
            }, end: function (a) {
                a = yv(a);
                if (-1 !== a) {
                    var b = gl[a];
                    gl.splice(a, 1);
                    b.unbind()
                }
            }
        }, vba = function (a) {
            return {element: a, handlers: [], lastWidth: Ia.get(a), lastHeight: sa.get(a)}
        }, Hf = [], BL = function (a) {
            return Va(Hf, function (b) {
                return N.eq(b.element, a)
            }).getOr(-1)
        }, CL = function (a) {
            var b =
                Ia.get(a.element), c = sa.get(a.element);
            if (b !== a.lastWidth || c !== a.lastHeight) a.lastWidth = b, a.lastHeight = c, z(a.handlers, xb)
        }, DL = function (a) {
            var b = a.element;
            sc.isVisible(b) ? CL(a) : zv.begin(b, function () {
                return zz.onShow(b, function () {
                    zv.end(b);
                    CL(a)
                })
            })
        }, Av = !1, wba = function () {
            Av = !1;
            z(Hf, DL)
        }, xba = function () {
            Av || (Av = !0, km.requestAnimationFrame(wba))
        }, jp = g.none(), yba = function () {
            jp.each(function (a) {
                a.unbind();
                jp = g.none()
            })
        }, pz = {
            bind: function (a, b) {
                var c = qa(Hf, function (b) {
                    return N.eq(b.element, a)
                }).getOr(void 0);
                void 0 === c && (c = vba(a), Hf.push(c));
                c.handlers.push(b);
                jp.isNone() && (jp = g.some(K.bind(r.fromDom(Zg), "resize", xba)));
                Kf(function () {
                    -1 !== BL(c.element) && DL(c)
                }, 100)
            }, unbind: function (a, b) {
                zv.end(a);
                a = BL(a);
                -1 !== a && (b = Gc(Hf[a].handlers, b), b.isNone() || (Hf[a].handlers.splice(b.getOr(0), 1), 0 === Hf[a].handlers.length && Hf.splice(a, 1), 0 === Hf.length && yba()))
            }
        }, qz = aa.detect(), zba = h(!1), pm = aa.detect(), EL = pm.browser.isIE() || pm.browser.isEdge() ? 2 : 5,
        sz = ta.generate([{above: ["element"]}, {below: ["element"]}]), FL = function (a,
                                                                                       b, c) {
            return function (b) {
                b = Wa.forElement(a, b);
                b = Lc.exactFromRange(b);
                return Wa.getBounds(a, b).fold(zba, c)
            }
        }, oV = function (a, b) {
            return FL(a, b, function (a) {
                return b > a.top() + a.height() - EL
            })
        }, pV = function (a, b) {
            return FL(a, b, function (a) {
                return b < a.top() + EL
            })
        }, $b = {
            clearAll: function (a) {
                Wa.clear(a)
            }, get: function (a) {
                return Wa.getExact(a).map(function (a) {
                    return Sc(a.start(), a.soffset(), a.finish(), a.foffset())
                })
            }, set: function (a, b) {
                Wa.setExact(a, b.startContainer(), b.startOffset(), b.endContainer(), b.endOffset())
            },
            setExact: function (a, b, c, d, e) {
                Wa.setExact(a, b, c, d, e)
            }, setRelative: function (a, b, c) {
                Wa.setRelative(a, b, c)
            }, replace: function (a, b) {
                Wa.get(a).each(function (c) {
                    Wa.replace(a, c, b)
                })
            }
        }, qV = function (a, b) {
            var c = u(N.eq, ja.body()), d = b.join(", ");
            return yc(a, function (a) {
                return Ja.ancestor(a, function (a) {
                    return Fa.is(a, d)
                }, c)
            }).isSome()
        }, Aba = function (a, b) {
            return {
                toEditor: a, toOld: u(Z.focus, b), isSet: function () {
                    return Z.active().exists(function (a) {
                        return N.eq(a, b)
                    })
                }
            }
        }, GL = function (a, b, c, d) {
            d = d.dom().activeElement;
            return a() ?
                {toEditor: b, toOld: t, isSet: h(!0)} : void 0 === d || null === d ? {
                    toEditor: c,
                    toOld: t,
                    isSet: h(!1)
                } : Aba(c, r.fromDom(d))
        }, dr = {
            build: GL, toEditor: function (a, b, c, d) {
                GL(a, b, c, d).toEditor()
            }
        }, Bba = function (a) {
            return Db.closest(a.startContainer(), '[contenteditable="false"]') && Db.closest(a.endContainer(), '[contenteditable="false"]')
        }, vz = {
            focus: function (a, b, c) {
                b = b().filter(Bba);
                b.each(function (b) {
                    L.closest(b.endContainer(), '[contenteditable="false"]').each(function (b) {
                        $b.setRelative(a.win(), la.after(b), la.after(b))
                    })
                });
                a.focus();
                b.each(function (a) {
                    c(a.startContainer(), a.startOffset(), a.endContainer(), a.endOffset())
                })
            }
        }, tV = aa.detect(), Cba = O("doc", "href"), vV = function () {
            var a = [], b = function (a, b) {
                return function (c) {
                    return N.eq(a, c.doc()) && b === c.href()
                }
            };
            return {
                addLinkIfMissing: function (c, d) {
                    Xa(a, b(c, d)) || (a.push(Cba(c, d)), pC.addStylesheet(d, c))
                }
            }
        }(), wz = function () {
            console.log("The previous selection could not be restored. Defaulting to the current selection.")
        }, Bv = aa.detect(), Dba = Bv.deviceType.isiOS() ? CV : Bv.deviceType.isAndroid() ?
        AV : BV, FV = {
            get: function (a) {
                return Dba(a, Bv)
            }
        }, Eba = function (a) {
            a = a.dom();
            try {
                var b = a.contentWindow ? a.contentWindow.document : a.contentDocument;
                return void 0 !== b && null !== b ? g.some(r.fromDom(b)) : g.none()
            } catch (c) {
                return console.log("Error reading iframe: ", a), console.log("Error was: " + c), g.none()
            }
        }, xz = {
            doc: function (a) {
                return Eba(a).fold(function () {
                    return a
                }, function (a) {
                    return a
                })
            }
        }, EV = aa.detect(), HV = {resolve: Lb.create("ephox-hare").resolve}, yz = {
            write: function (a, b) {
                if (!ja.inBody(a)) throw"Internal error: attempted to write to an iframe that is not in the DOM";
                a = xz.doc(a).dom();
                a.open("text/html", "replace");
                a.writeln(b);
                a.close()
            }
        }, IV = function (a) {
            var b = a.base.fold(h(""), function (a) {
                return '<base href="' + a + '" />'
            }), c = a.editorStyles.concat(a.stylesheets), d = E(c, function (a) {
                return '<link rel="stylesheet" type="text/css" href="' + a + '" onload="styleLoaded()" onerror="styleLoaded()" />'
            });
            a = 0 === a.documentStyles.length ? "" : '<style type="text/css">' + a.documentStyles + "</style>";
            return "<!doctype html>\n<html>\n  <head>\n    " + b + '\n    <script type="text/javascript">\n      var stillToLoad = ' +
                c.length + ";\n      function styleLoaded() {\n        stillToLoad--;\n      }\n    \x3c/script>\n    " + d.join("") + "\n    " + a + '\n  </head>\n  <body contenteditable="true" spellcheck="false"></body>\n</html>'
        }, HL = function (a) {
            var b = g.none(), c = Hd.tap(function (a, b, c) {
                n.trigger.nodeChanged(a, b, c)
            });
            a.loaded(function (a) {
                var d = function () {
                    try {
                        return null !== a.win().window && void 0 !== a.win().window
                    } catch (X) {
                        return !1
                    }
                };
                if (d()) {
                    b = g.some(a);
                    if (aa.detect().browser.isFirefox()) {
                        try {
                            a.execCommand("enableObjectResizing",
                                !1, !1)
                        } catch (X) {
                        }
                        try {
                            a.execCommand("enableInlineTableEditing", !1, !1)
                        } catch (X) {
                        }
                    }
                    a.events.nodeChanged.bind(function (a) {
                        c.instance(a.node(), a.offset(), a.prev())
                    });
                    a.events.loiter.bind(function (a) {
                        n.trigger.loiter(a.node(), a.offset())
                    });
                    a.events.uiStale.bind(function () {
                        n.trigger.uiStale()
                    });
                    a.events.domChanged.bind(function () {
                        n.trigger.domChanged()
                    });
                    a.events.interaction.bind(function () {
                        n.trigger.interaction()
                    });
                    a.events.keyup.bind(function (a) {
                        n.trigger.keyup(a.original())
                    });
                    a.events.keydown.bind(function (a) {
                        n.trigger.keydown(a.original())
                    });
                    a.events.keypress.bind(function (a) {
                        n.trigger.keypress(a.original())
                    });
                    a.events.mousedown.bind(function (a) {
                        n.trigger.mousedown(a.original())
                    });
                    a.events.mouseup.bind(function (a) {
                        n.trigger.mouseup(a.original())
                    });
                    a.events.contextmenu.bind(function (a) {
                        n.trigger.contextmenu(a.original())
                    });
                    a.events.cut.bind(function (a) {
                        n.trigger.cut(a.original())
                    });
                    a.events.copy.bind(function (a) {
                        n.trigger.copy(a.original())
                    });
                    a.events.paste.bind(function (a) {
                        n.trigger.paste(a.original())
                    });
                    a.events.focus.bind(function (a) {
                        n.trigger.focus(a.original())
                    });
                    a.events.focusOut.bind(function (a) {
                        n.trigger.focusOut(a.original())
                    });
                    a.events.dblclick.bind(function (a) {
                        n.trigger.dblclick(a.original())
                    });
                    a.events.selectionchange.bind(function (a) {
                        n.trigger.selectionchange(a.original())
                    });
                    a.futures.stylesheetLoad.get(function (a) {
                        a.each(function (a) {
                            n.trigger.stylesheetLoad(a)
                        })
                    });
                    a.events.paint.bind(function () {
                        n.trigger.paint()
                    });
                    a.resetContent(f);
                    d() && (n.trigger.ready(a), n.trigger.loaded(), a.uiChanged())
                } else a.destroy()
            });
            var d = function () {
                    return b.map(function (a) {
                        return a.win()
                    })
                },
                e = function () {
                    return b.map(function (a) {
                        return a.doc()
                    })
                }, f = a.initial(), k = function () {
                    b.each(function (a) {
                        a.focus()
                    })
                }, l = function () {
                    return b.bind(function (a) {
                        return a.getSelection()
                    })
                }, q = function (a, c, d, e) {
                    b.each(function (b) {
                        b.setSelection(a, c, d, e)
                    })
                }, m = function (a, c) {
                    b.each(function (b) {
                        b.setRelativeSelection(a, c)
                    })
                }, w = function () {
                    var a = arguments;
                    b.each(function (b) {
                        b.execCommand.apply(null, a)
                    })
                }, n = H.create({
                    nodeChanged: p(["node", "offset", "prev"]),
                    loiter: p(["node", "offset"]),
                    uiStale: p([]),
                    domChanged: p([]),
                    interaction: p([]),
                    keydown: p(["original"]),
                    keyup: p(["original"]),
                    keypress: p(["original"]),
                    mousedown: p(["original"]),
                    mouseup: p(["original"]),
                    contextmenu: p(["original"]),
                    cut: p(["original"]),
                    copy: p(["original"]),
                    paste: p(["original"]),
                    focus: p(["original"]),
                    focusOut: p(["original"]),
                    dblclick: p(["original"]),
                    selectionchange: p(["original"]),
                    paint: p([]),
                    ready: p(["api"]),
                    loaded: p([]),
                    stylesheetLoad: p(["sheets"])
                });
            return {
                element: a.element, tabindex: a.tabindex, onCanvas: a.onCanvas, win: d, doc: e, body: function () {
                    return b.map(function (a) {
                        return a.body()
                    })
                },
                getContent: function () {
                    return b.fold(function () {
                        return f
                    }, function (a) {
                        return a.getContent()
                    })
                }, setContent: function (a) {
                    b.fold(function () {
                        f = a
                    }, function (b) {
                        b.setContent(a)
                    })
                }, resetContent: function (a) {
                    b.fold(function () {
                        f = a
                    }, function (b) {
                        b.resetContent(a)
                    })
                }, blur: function () {
                    b.each(function (a) {
                        a.blur()
                    })
                }, focus: k, uiChanged: function () {
                    b.each(function (a) {
                        a.uiChanged()
                    })
                }, domChanged: function () {
                    b.each(function (a) {
                        a.domChanged()
                    })
                }, clearSelection: function () {
                    b.each(function (a) {
                        a.clearSelection()
                    })
                }, getSelection: l,
                setSelection: q, setRelativeSelection: m, backupSelection: function () {
                    b.each(function (a) {
                        a.backupSelection()
                    })
                }, replaceSelection: function (a) {
                    b.each(function (b) {
                        b.replaceSelection(a)
                    })
                }, execCommand: w, lockdown: function (a) {
                    var b = c.control.isBlocked();
                    c.control.block();
                    a();
                    b || c.control.unblock()
                }, destroy: function () {
                    a.destroy();
                    b = g.none()
                }, events: n.registry, background: function () {
                    b.each(function (a) {
                        a.background()
                    })
                }, foreground: function () {
                    b.each(function (a) {
                        a.foreground()
                    })
                }, on: function (a) {
                    return d().bind(function (b) {
                        return e().map(function (c) {
                            return a({
                                win: h(b),
                                doc: h(c),
                                execCommand: w,
                                getSelection: l,
                                setSelection: q,
                                setRelativeSelection: m,
                                focus: k
                            })
                        })
                    })
                }, translateScreen: function (a, c) {
                    return b.fold(function () {
                        return Ra(a, c)
                    }, function (b) {
                        return b.translateScreen(a, c)
                    })
                }, translateLocation: function (a, c) {
                    return b.fold(function () {
                        return Ra(a, c)
                    }, function (b) {
                        return b.translateLocation(a, c)
                    })
                }, placeholder: a.placeholder, isInline: a.isInline
            }
        }, IL = {
            frame: function (a, b) {
                a = JV(a, b);
                return HL(a)
            }, detached: function (a, b, c) {
                a = uV(a, b, c);
                return HL(a)
            }
        }, Cv = ay(D.isComment, "comment"),
        Dv = {
            get: function (a) {
                return Cv.get(a)
            }, getOption: function (a) {
                return Cv.getOption(a)
            }, set: function (a, b) {
                Cv.set(a, b)
            }
        }, Uj = {
            intraFlag: h({
                findClipboardTags: function (a) {
                    a = ee(E(a, function (a) {
                        if (D.isComment(a)) {
                            var b = Dv.get(a);
                            if (Bb(b, "x-textbox/html")) return g.some(a)
                        }
                        return g.none()
                    }));
                    return 0 === a.length ? g.none() : g.some(a)
                }
            }), injectEphemera: function (a) {
                return gc(function () {
                    return "\x3c!-- x-textbox/html --\x3e" + a()
                })
            }, ignoreSelectors: h([".ephox-sloth-bin"])
        }, JL = function (a, b) {
            return {editable: h(a), connect: b}
        },
        Fba = function (a, b) {
            var c = IL.frame(b, Uj.ignoreSelectors());
            c.events.ready.bind(function (b) {
                b = b.api().body();
                a.updateUi(b)
            });
            return JL(c, function (a) {
                y.append(a, c.element())
            })
        }, Gba = function (a, b) {
            0 !== b.stylesheets.length && console.log("You have attempted to declare the following stylesheets for use in textbox.io: [" + b.stylesheets.join(", ") + "]. User stylesheets are not used in inline editing mode and have been ignored.");
            0 !== b.documentStyles.length && console.log('You have attempted to declare the following document styles for use in textbox.io: "' +
                b.documentStyles + '". Document styles are not used in inline editing mode and have been ignored.');
            b.base.fold(t, function (a) {
                console.log('You have attempted to declare the following content base URL for use in textbox.io: "' + a + '". Content base URL is not used in inline editing mode and has been ignored.')
            });
            var c = IL.detached(b.inline, b.editorStyles, Uj.ignoreSelectors());
            return JL(c, function (a) {
                y.append(a, c.placeholder());
                a = L.ancestor(a, ".ephox-polish-editor-container").getOr(a);
                v.set(c.placeholder(),
                    "display", "none");
                ma.add(a, [B.resolve("inline-editor-container"), B.resolve("layer-editor")])
            })
        }, Hba = {
            build: function (a, b) {
                return (void 0 !== b.inline ? Gba : Fba)(a, b)
            }
        }, Iba = aa.detect().browser.isFirefox(), Jba = function (a) {
            z(a, function (a) {
                A.nextSibling(a).isNone() && y.after(a, r.fromText(mb()))
            })
        }, Kba = {
            configure: function (a) {
                Iba && a.addSelector(a.input(), "a", Jba)
            }
        }, kp = B.resolve("content-eph-wrapper"), lp = B.resolve("content-eph-extra"),
        mp = B.resolve("content-eph-general"), Lba = function (a) {
            z(a, function (a) {
                n.remove(a,
                    Rb.styleSpan());
                m.remove(a, Rb.overrideSpan());
                m.hasNone(a) ? F.unwrap(a) : rd.isTransient(a) && F.remove(a)
            })
        }, KL = function (a) {
            z(a, function (a) {
                n.remove(a, Rb.quasiBlock())
            })
        }, LL = function (a) {
            z(a, function (a) {
                var b = m.get(a, "style");
                m.set(a, "style", b.replace(/"/g, "'"))
            })
        }, Mba = function (a) {
            return wa.isCursorPosition(a) || pa.isBlock(a) || wa.isCursorPosition(kb.freefallLtr(a).element())
        }, ML = function (a) {
            z(a, function (a) {
                if (0 === ka(A.children(a), Mba).length) {
                    var b = r.fromTag("br");
                    y.append(a, b)
                }
            })
        }, np = {
            configure: function (a) {
                a.add(a.internal(),
                    kp, Na.unwrap);
                a.add(a.internal(), lp, Na.remove);
                a.add(a.internal(), mp, Na.remove);
                a.add(a.internal(), Rb.quasiBlock(), KL);
                a.add(a.output(), kp, Na.unwrap);
                a.add(a.output(), lp, Na.remove);
                a.add(a.output(), mp, Na.remove);
                a.add(a.output(), Rb.styleSpan(), Lba);
                a.add(a.output(), Rb.quasiBlock(), KL);
                a.addExcludedContext(["." + kp, "." + lp, "." + mp, "." + Rb.styleSpan()]);
                a.addSelector(a.input(), "[style]", LL);
                a.addSelector(a.input(), "td,th,p", ML);
                a.addSelector(a.paste(), "[style]", LL);
                a.addSelector(a.paste(), "td,th,p", ML);
                a.addSelector(a.output(), "strong,b,em,i,u,s,strike,del,sup,sub", Na.removeIfEmpty);
                Kba.configure(a)
            }, markerWrapper: h(kp), markerExtra: h(lp), markerGeneral: h(mp)
        }, vg = {resolve: Lb.create("ephox-cereal").resolve}, Ev = vg.resolve("start-cursor"),
        Fv = vg.resolve("finish-cursor"), Gv = "data-" + vg.resolve("start-offset"),
        Hv = "data-" + vg.resolve("finish-offset"), NL = function (a) {
            m.remove(a, Gv);
            m.remove(a, Hv);
            ma.remove(a, [Ev, Fv]);
            "" === m.get(a, "class") && m.remove(a, "class")
        }, OL = function (a, b) {
            a = m.get(a, b);
            return parseInt(a,
                10)
        }, Li = {
            setInfo: function (a, b, c, d) {
                z([a, b], NL);
                n.add(a, Ev);
                n.add(b, Fv);
                m.set(a, Gv, c);
                m.set(b, Hv, d)
            }, clearInfo: NL, findStart: function (a) {
                return L.descendant(a, "." + Ev).map(function (a) {
                    return {token: h(a), offset: h(OL(a, Gv))}
                })
            }, findFinish: function (a) {
                return L.descendant(a, "." + Fv).map(function (a) {
                    return {token: h(a), offset: h(OL(a, Hv))}
                })
            }
        }, PL = O("token", "remove", "extra"), QL = {
            use: function (a, b) {
                return PL(b, t, [])
            }, extract: function (a) {
                return {remove: u(Li.clearInfo, a), element: h(a)}
            }
        }, RL = vg.resolve("pre-cursor-token"),
        SL = vg.resolve("post-cursor-token"), TL = vg.resolve("first-cursor-token"), Iv = function () {
            var a = r.fromTag("span");
            v.set(a, "display", "none");
            return a
        }, Jv = function (a) {
            var b = u(F.remove, a);
            return PL(a, b, [a])
        }, Nba = function (a) {
            return n.has(a, RL) ? A.nextSibling(a) : n.has(a, SL) ? A.prevSibling(a) : n.has(a, TL) ? A.parent(a) : g.none()
        }, vh = {
            pre: function (a, b) {
                a = Iv();
                y.before(b, a);
                n.add(a, RL);
                return Jv(a)
            }, post: function (a, b) {
                a = Iv();
                y.after(b, a);
                n.add(a, SL);
                return Jv(a)
            }, first: function (a, b) {
                b = Iv();
                y.prepend(a, b);
                n.add(b, TL);
                return Jv(b)
            }, extract: function (a) {
                return Nba(a).map(function (b) {
                    return {remove: u(F.remove, a), element: h(b)}
                })
            }
        }, Oba = O("element", "offset"), Pba = O("startContainer", "startOffset", "endContainer", "endOffset"),
        Qba = {point: Oba, range: Pba}, Kv = vg.resolve("text-node-wrapper"), UL = function (a) {
            return n.has(a, Kv)
        }, wg = {
            create: function () {
                var a = r.fromTag("span");
                n.add(a, Kv);
                return a
            }, findIn: function (a) {
                return Y.children(a, "." + Kv)
            }, isWrap: UL, inWrap: function (a) {
                return A.parent(a).fold(h(!1), function (a) {
                    return UL(a)
                })
            }, child: function (a) {
                return A.child(a,
                    0).fold(function () {
                    var b = r.fromText("");
                    y.append(a, b);
                    return b
                }, ca)
            }
        }, Rba = function (a) {
            a = wg.findIn(a);
            z(a, function (a) {
                0 === A.children(a).length && y.before(a, r.fromText(""));
                F.unwrap(a)
            })
        }, Sba = function (a) {
            A.parent(a).each(F.unwrap)
        }, VL = function (a) {
            (wg.inWrap(a) ? Sba : Rba)(a)
        }, Lv = function (a, b, c, d) {
            return N.eq(a, b) ? vh.first(a, b) : D.isElement(b) && !d(b) ? QL.use(a, b) : c(a, b)
        }, Mv = {
            extractFrom: function (a, b) {
                a.remove();
                b.remove();
                var c = function (a) {
                    var b = wg.isWrap(a) ? F.unwrap : VL, c = wg.isWrap(a) ? wg.child(a) : a;
                    return {
                        target: h(c),
                        unwrap: u(b, a)
                    }
                }, d = c(a.element()), e = c(b.element()), f = Qba.range(d.target(), a.offset(), e.target(), b.offset());
                return {
                    remove: function () {
                        d.unwrap();
                        e.unwrap()
                    }, getSelection: function () {
                        return f
                    }
                }
            }, same: function (a, b, c, d, e) {
                a = Lv(a, b, vh.pre, e);
                Li.setInfo(a.token(), a.token(), c, d);
                return [a]
            }, diff: function (a, b, c, d, e, f) {
                var k = id.after(b, c, d, e), g = k ? vh.pre : vh.post;
                b = Lv(a, b, k ? vh.post : vh.pre, f);
                a = Lv(a, d, g, f);
                Li.setInfo(b.token(), a.token(), c, e);
                return [b, a]
            }
        }, Tba = function (a) {
            return A.parent(a).fold(h(!1), function (a) {
                return wg.isWrap(a)
            })
        },
        Uba = function (a) {
            return Eb(a, function (a, c) {
                if (D.isText(c) && !Tba(c)) {
                    var b = wg.create();
                    y.wrap(c, b);
                    return [b].concat(a)
                }
                return a
            }, [])
        }, Vba = function (a) {
            var b = A.children(a);
            b = 0 < b.length ? b : [a];
            return wg.isWrap(a) ? [] : Uba(b)
        }, Wba = function (a) {
            a.remove()
        }, WL = {
            combine: function (a, b) {
                var c = ia(a, Vba), d = ia(b, function (a) {
                    return a.extra()
                });
                return {
                    extra: h(d), wrappers: h(c), remove: function () {
                        z(b, function (a) {
                            Li.clearInfo(a.token())
                        });
                        z(a, VL);
                        z(b, Wba)
                    }
                }
            }
        }, Xba = function (a, b, c, d, e, f) {
            var k = [b, d];
            a = Mv.diff(a, b, c, d, e, f);
            return WL.combine(k,
                a)
        }, Yba = function (a, b, c, d, e, f) {
            d = [b];
            a = Mv.same(a, b, c, e, f);
            return WL.combine(d, a)
        }, XL = function (a, b) {
            return b(a).map(function (a) {
                var b = vh.extract(a.token()).getOrThunk(function () {
                    return QL.extract(a.token())
                });
                return {remove: b.remove, offset: a.offset, element: b.element}
            })
        }, Zba = function (a) {
            return XL(a, Li.findStart).bind(function (b) {
                return XL(a, Li.findFinish).map(function (a) {
                    return {startMarker: h(b), finishMarker: h(a)}
                })
            })
        }, YL = {
            insertAt: function (a, b, c, d, e, f) {
                return (N.eq(b, d) ? Yba : Xba)(a, b, c, d, e, f)
            }, extract: function (a) {
                return Zba(a).map(function (a) {
                    return Mv.extractFrom(a.startMarker(),
                        a.finishMarker())
                })
            }
        }, ZL = {
            insert: function (a, b, c) {
                a = YL.insertAt(a, b.startContainer(), b.startOffset(), b.endContainer(), b.endOffset(), c);
                return {extra: a.extra, wrappers: a.wrappers, remove: a.remove}
            }, extract: function (a) {
                return YL.extract(a).map(function (a) {
                    return {remove: a.remove, getSelection: a.getSelection}
                })
            }
        }, $L = function (a, b) {
            z(a, function (a) {
                n.add(a, b)
            })
        }, $ba = function (a) {
            var b = function () {
                return A.parent(a).map(function (a) {
                    return "false" === m.get(a, "contenteditable")
                }).getOr(!1)
            };
            return "false" === m.get(a,
                "contenteditable") || b()
        }, op = {
            extract: function (a) {
                return ZL.extract(a)
            }, getSelection: function (a) {
                var b = a.getSelection();
                a = b.startContainer();
                var c = b.startOffset(), d = b.endContainer();
                b = b.endOffset();
                var e = wa.getEnd(a), f = wa.getEnd(d);
                return 0 <= c && c <= e && 0 <= b && b <= f ? {
                    start: h(la.on(a, c)),
                    finish: h(la.on(d, b))
                } : {start: h(la.before(a)), finish: h(la.before(a))}
            }, remove: function (a) {
                a.remove()
            }, serialise: function (a, b) {
                return oi.path(a, b.startContainer()).bind(function (c) {
                    return oi.path(a, b.endContainer()).bind(function (d) {
                        var e =
                            Pc.deep(a);
                        return oi.follow(e, c).bind(function (a) {
                            return oi.follow(e, d).map(function (c) {
                                c = {
                                    startContainer: h(a),
                                    startOffset: h(b.startOffset()),
                                    endContainer: h(c),
                                    endOffset: h(b.endOffset())
                                };
                                c = ZL.insert(e, c, $ba);
                                $L(c.wrappers(), np.markerWrapper());
                                $L(c.extra(), np.markerExtra());
                                return qn.writeChildren(e)
                            })
                        })
                    })
                })
            }
        }, pp = O("word", "left", "right"), aM = ["'", "\u2018", "\u2019"], aca = ia(aM, function (a) {
            return E(["twas"], function (b) {
                return a + b
            })
        }), bca = function (a) {
            var b = a.word();
            return pp(b.substring(1), g.some(b.charAt(0)),
                a.right())
        }, qp = function (a) {
            return U(aM, a)
        }, cca = function (a) {
            var b = a.word(), c = Xa(aca, function (a) {
                return -1 < b.indexOf(a)
            }) ? 2 : 1, d = b.substring(0, c);
            return ob(d, qp) && !qp(b.charAt(c)) ? bca(a) : a
        }, bM = function (a) {
            var b = a.word();
            2 <= b.length && qp(b.charAt(b.length - 1)) && !qp(b.charAt(b.length - 2)) && (b = a.word(), a = pp(b.substring(0, b.length - 1), a.left(), g.some(b.charAt(b.length - 1))));
            return cca(a)
        }, dca = {
            scope: bM, text: function (a) {
                a = pp(a, g.none(), g.none());
                return bM(a).word()
            }
        }, cM = {
            words: function (a) {
                var b = Cb.unsafetoken(Cb.wordchar() +
                    "+");
                b = Mo.findall(a, b);
                var c = a.length;
                return E(b, function (b) {
                    var d = b.start(), f = b.finish();
                    b = a.substring(d, f);
                    d = 0 < d ? g.some(a.charAt(d - 1)) : g.none();
                    f = f < c ? g.some(a.charAt(f)) : g.none();
                    b = pp(b, d, f);
                    return dca.scope(b)
                })
            }
        }, dM = {
            identify: function (a) {
                return cM.words(a)
            }, isWord: function (a, b) {
                return !Qk.hasBreak(b)
            }
        }, eca = nb(), fca = {
            identify: function (a) {
                return dM.identify(a)
            }, isWord: function (a) {
                return dM.isWord(eca, a)
            }
        }, gca = aa.detect(), eM = function (a, b) {
            return D.isText(a) ? g.some(W.point(a, b)) : 0 === A.children(a).length ?
                g.none() : A.child(a, b).bind(function (a) {
                    return eM(a, 0)
                })
        }, hca = function (a, b, c) {
            a.on(function (a) {
                Ad.expandWord(a, b, c)
            })
        }, ica = function (a, b) {
            a = a.dom().createRange();
            a.setStart(b.startContainer().dom(), b.startOffset());
            a.setEnd(b.endContainer().dom(), b.endOffset());
            return fca.isWord(a.cloneContents().textContent)
        }, fM = {
            correct: function (a) {
                a.getSelection().each(function (b) {
                    a.doc().each(function (c) {
                        ica(c, b) && eM(b.startContainer(), b.startOffset()).each(function (c) {
                            (!b.collapsed() || a.isInline() && gca.browser.isIE()) &&
                            hca(a, c.element(), c.offset())
                        })
                    })
                })
            }, expand: function (a) {
                a.on(Ad.expand);
                a.backupSelection()
            }
        }, gM = function (a, b) {
            return a.bind(function (a) {
                return a.fold(function () {
                    return Ga.pure(a)
                }, function (a) {
                    return b(a)
                })
            })
        }, hM = function (a) {
            return Ga.pure(I.value(a))
        }, iM = function (a) {
            return Ga.nu(function (b) {
                a.then(function (a) {
                    b(I.value(a))
                }, function (a) {
                    b(I.error(a))
                })
            })
        }, jM = function (a) {
            return a.map(I.value)
        }, Ua = {
            fromPromise: iM, error: function (a) {
                return Ga.pure(I.error(a))
            }, map: function (a, b) {
                return a.map(function (a) {
                    return a.map(b)
                })
            },
            bind: gM, pure: hM, fromChain: function (a) {
                return function (b) {
                    return hb(a, function (a, b) {
                        return gM(a, function (a) {
                            return b(a)
                        })
                    }, hM(b))
                }
            }, fromFuture: jM, pToFR: function (a) {
                return Pb(iM, a)
            }, fToFR: function (a) {
                return Pb(jM, a)
            }, effect: function (a) {
                return function (b) {
                    b.each(function () {
                        a()
                    });
                    return b
                }
            }
        }, jca = function (a) {
            return Ga.nu(function (b) {
                if (!0 === a.dom().complete) b(I.value(a)); else {
                    var c = fr();
                    kM(c, b);
                    c.monitor(a)
                }
            })
        }, kM = function (a, b) {
            a.events.success.bind(function (a) {
                b(I.value(a.image()))
            });
            a.events.fail.bind(function (a) {
                b(I.error("Unable to download image " +
                    a.url()))
            })
        }, rp = {
            load: function (a) {
                return Ga.nu(function (b) {
                    var c = fr();
                    kM(c, b);
                    c.go(a)
                })
            }, loadIfNeeded: function (a) {
                return !0 === a.dom().complete || void 0 === m.get(a, "src") ? Ua.pure(a) : jca(a)
            }
        }, Mi = {
            text: function (a) {
                a = A.children(a);
                return rn.toText(a)
            }, html: function (a, b) {
                var c = r.fromTag("div");
                y.append(c, a);
                return Xj.output(b, c)
            }, fragment: function (a, b) {
                if (b.collapsed()) return g.none();
                b = Lc.exact(b.startContainer(), b.startOffset(), b.endContainer(), b.endOffset());
                a = Wa.clone(a, b);
                return g.some(a)
            }
        }, lM = aa.detect(),
        kca = function (a, b, c, d, e) {
            np.configure(a);
            var f = g.none(), k = {
                inline: c.inline,
                base: g.from(c.base),
                editorStyles: [c.css + "/content.css"],
                stylesheets: c.stylesheets,
                documentStyles: c.documentStyles,
                needStyles: c.showDocumentStyles,
                autoresize: c.autoresize
            };
            d = Hba.build(d, k);
            var l = d.editable();
            null !== c.tabindex && l.tabindex(c.tabindex);
            void 0 !== e.raw && l.setContent(e.raw);
            l.events.ready.bind(function () {
                if (void 0 !== e.raw) {
                    var a = l.getContent();
                    e.raw === a && e.marked !== e.raw && C(e.marked, !1)
                }
                a = l.body().getOrDie();
                f = g.some(K.bind(a,
                    "dblclick", function (a) {
                        fM.correct(l)
                    }))
            });
            l.events.ready.bind(function (a) {
                Zr.addClasses(a.api().body())
            });
            var q = function () {
                return l.getSelection().bind(function (a) {
                    var b = l.body().getOrDie("content should not return a selection if body is not yet available");
                    return op.serialise(b, a)
                }).getOr(l.getContent())
            }, C = function (a, b) {
                l.body().each(function (c) {
                    l.setContent(a);
                    op.extract(c).fold(function () {
                        var a = kb.freefallLtr(c);
                        l.setSelection(a.element(), a.offset(), a.element(), a.offset())
                    }, function (a) {
                        var b =
                            op.getSelection(a);
                        op.remove(a);
                        l.setRelativeSelection(b.start(), b.finish())
                    });
                    if (!lM.deviceType.isiOS()) {
                        var d = Y.descendants(c, "img");
                        b ? Ce(d, rp.loadIfNeeded).get(function () {
                            x()
                        }) : x()
                    }
                })
            }, w = H.create({
                nodeChanged: p(["node", "offset", "prev"]),
                undoChanged: p([]),
                loiter: Q(["node", "offset"], l.events.loiter),
                uiStale: Q([], l.events.uiStale),
                domChanged: Q([], l.events.domChanged),
                interaction: Q([], l.events.interaction),
                keydown: Q(["original"], l.events.keydown),
                keyup: Q(["original"], l.events.keyup),
                keypress: Q(["original"],
                    l.events.keypress),
                mousedown: Q(["original"], l.events.mousedown),
                mouseup: Q(["original"], l.events.mouseup),
                contextmenu: Q(["original"], l.events.contextmenu),
                copy: Q(["original"], l.events.copy),
                paste: Q(["original"], l.events.paste),
                focus: Q(["original"], l.events.focus),
                focusOut: Q(["original"], l.events.focusOut),
                dblclick: Q(["original"], l.events.dblclick),
                selectionchange: Q(["original"], l.events.selectionchange),
                paint: Q([], l.events.paint),
                ready: Q(["api"], l.events.ready),
                loaded: Q([], l.events.loaded),
                stylesheetLoad: Q(["sheets"],
                    l.events.stylesheetLoad),
                background: p([]),
                foreground: p([]),
                scrollToCursor: p([]),
                scrollToElement: p(["element"]),
                toEditing: p([]),
                toReading: p([])
            });
            l.events.nodeChanged.bind(function (a) {
                w.trigger.nodeChanged(a.node(), a.offset(), a.prev());
                a.prev().fold(v, function (b) {
                    Ja.ancestor(b, pa.isBlock).each(function (b) {
                        Ja.ancestor(a.node(), pa.isBlock).each(function (a) {
                            N.eq(a, b) || v()
                        })
                    })
                })
            });
            var t = Hd.tap(function () {
                w.trigger.undoChanged()
            }), v = function () {
                t.instance()
            }, z = function (a) {
                t.instance();
                var b = t.control.isBlocked();
                t.control.block();
                a = a();
                b || t.control.unblock();
                t.instance();
                return a
            }, x = function () {
                w.trigger.scrollToCursor()
            }, B = Hd.tap(function () {
                l.focus()
            });
            k = function (a) {
                return function () {
                    var b = arguments;
                    A.parent(l.element()).fold(function () {
                        a.apply(null, b)
                    }, function (c) {
                        var d = c.dom().scrollTop;
                        a.apply(null, b);
                        c.dom().scrollTop = d
                    })
                }
            }(l.execCommand);
            var E = function (a) {
                return D.isText(a) && (lM.browser.isSafari() || 0 === Ya.get(a).length) || D.isElement(a) && !pa.isEmptyTag(a) && !pa.isBlock(a)
            }, I = function (a) {
                var b = r.fromText(mb());
                y.after(a, b);
                return b
            }, L = function (a, b) {
                var c = A.children(a);
                if (b >= c.length) return W.point(a, b);
                var d = c[b];
                return D.isElement(d) && !pa.isEmptyTag(d) ? L(c[b], 0) : W.point(a, b)
            }, M = function (a) {
                a = E(a) ? I(a) : a;
                l.setRelativeSelection(la.after(a), la.after(a));
                l.getSelection().each(function (a) {
                    a = L(a.startContainer(), a.startOffset());
                    l.setSelection(a.element(), a.offset(), a.element(), a.offset())
                })
            }, O = function () {
                return P.getSelection().bind(function (a) {
                    return P.win().bind(function (b) {
                        return Mi.fragment(b, a)
                    })
                })
            }, P =
                {
                    onCanvas: l.onCanvas,
                    element: l.element,
                    isInline: l.isInline,
                    win: l.win,
                    doc: l.doc,
                    body: l.body,
                    getContent: l.getContent,
                    setContent: l.setContent,
                    resetContent: l.resetContent,
                    focus: function () {
                        B.instance()
                    },
                    blur: l.blur,
                    uiChanged: l.uiChanged,
                    domChanged: l.domChanged,
                    undoChanged: v,
                    clearSelection: l.clearSelection,
                    getSelection: l.getSelection,
                    getSelectionStart: function () {
                        return l.getSelection().map(function (a) {
                            return a.startContainer()
                        })
                    },
                    setSelection: l.setSelection,
                    setRelativeSelection: l.setRelativeSelection,
                    backupSelection: l.backupSelection,
                    replaceSelection: l.replaceSelection,
                    replaceElement: function (a, b) {
                        var c = P.getSelection().filter(function (b) {
                            var c = u(N.eq, a);
                            return Ja.closest(b.startContainer(), c) || Ja.closest(b.endContainer(), c)
                        }).isSome();
                        y.before(a, b);
                        F.remove(a);
                        c && M(b);
                        P.domChanged();
                        v()
                    },
                    findTagAtCursor: function (b) {
                        var c = function (b, c, d) {
                            b = A.child(b, c).getOr(b);
                            return Ja.closest(b, function (b) {
                                return Fa.is(b, d) && a.includeContext(b)
                            })
                        };
                        return P.getSelection().bind(function (a) {
                            return c(a.startContainer(), a.startOffset(), b).orThunk(function () {
                                return c(a.endContainer(),
                                    a.endOffset(), b)
                            })
                        })
                    },
                    getFilteredAttributes: function (b) {
                        b = Pc.shallow(b);
                        var c = r.fromTag("div");
                        y.append(c, b);
                        a.filterDom(a.output(), c);
                        return m.clone(b)
                    },
                    execCommand: k,
                    insertHtmlAtCursor: function (a) {
                        var c = qe.fromHtml(a);
                        z(function () {
                            sd.insertAtCursorWithInstructions(rg.doNotMerge, P, c).each(function (a) {
                                if (0 === c.length) l.setSelection(a.element(), a.offset(), a.element(), a.offset()); else {
                                    var d = a.element();
                                    A.parent(d).each(function (a) {
                                        M(d);
                                        b.input(c)
                                    })
                                }
                            })
                        })
                    },
                    on: l.on,
                    destroy: function () {
                        f.each(function (a) {
                            a.unbind()
                        });
                        l.destroy()
                    },
                    events: w.registry,
                    state: function () {
                        return {raw: l.getContent(), marked: q()}
                    },
                    serialize: q,
                    deserialize: function (a) {
                        C(a, !0)
                    },
                    background: function () {
                        l.background();
                        w.trigger.background()
                    },
                    foreground: function () {
                        l.foreground();
                        w.trigger.foreground()
                    },
                    isRoot: function (a) {
                        return l.body().fold(h(!1), function (b) {
                            return N.eq(b, a)
                        })
                    },
                    selectWord: function () {
                        fM.expand(l)
                    },
                    cursor: function () {
                        return KV(l)
                    },
                    activate: function () {
                        B.control.unblock()
                    },
                    deactivate: function () {
                        B.control.block()
                    },
                    cursorIntoView: x,
                    elementIntoView: function (a) {
                        w.trigger.scrollToElement(a)
                    },
                    placeholder: l.placeholder,
                    connect: d.connect,
                    translateScreen: l.translateScreen,
                    translateLocation: l.translateLocation,
                    runOrOnLoaded: function (a) {
                        l.body().fold(function () {
                            l.events.ready.bind(function (b) {
                                a(b.api().body())
                            })
                        }, function (b) {
                            a(b)
                        })
                    },
                    getSelectedText: function () {
                        return O().map(Mi.text)
                    },
                    getSelectedHtml: function () {
                        return O().map(function (b) {
                            return Mi.html(b, a)
                        })
                    },
                    getFilteredContents: function (b) {
                        return Xj.output(a, b)
                    },
                    toEditing: function () {
                        w.trigger.toEditing()
                    },
                    toReading: function () {
                        w.trigger.toReading()
                    },
                    undoOperation: z,
                    markAsEphemeral: function (a) {
                        n.add(a, np.markerGeneral())
                    },
                    hideInlineSelection: function () {
                        l.isInline() && (l.backupSelection(), l.clearSelection())
                    },
                    imageExcludes: c.imageExcludes
                };
            return P
        }, lca = {
            get: h({
                onShortcut: function (a, b) {
                    a.bind(b)
                }
            })
        }, mM = "data-" + B.resolve("context-type"), gr = {
            nu: function (a, b, c) {
                a = zb.item(a, c.value(), c.text());
                m.set(a, mM, b);
                m.setAll(a, c.attrs());
                return a
            }, type: function (a) {
                return m.get(a, mM)
            }
        }, MV = {
            derive: function (a, b, c) {
                b = E(b, function (b) {
                    var d = c[b], f = d.primary(), k = d.submenus();
                    return E(f, function (c) {
                        var d = gr.nu(a, b, c),
                            e = k.hasOwnProperty(c.value()) && void 0 !== k[c.value()] ? [va.resolve("menu-more")] : [],
                            f = void 0 !== k[c.value()];
                        S.menuItem(d, g.some(c.text()), g.some(f));
                        ma.add(d, e);
                        return d
                    })
                });
                b = ka(b, function (a) {
                    return 0 < a.length
                });
                return Qb(KD(b, function () {
                    return [zb.separator(a)]
                }))
            }
        }, NV = {
            derive: function (a, b, c) {
                return ia(b, function (b) {
                    var d = c[b].secondary();
                    return E(d, function (c) {
                        var d = zb.submenu(a, c.value(), []);
                        S.menu(d, x.get(c.textkey()));
                        c = E(c.items(), function (c) {
                            var d = gr.nu(a,
                                b, c);
                            S.menuItem(d, g.some(c.text()), g.none());
                            return d
                        });
                        P.append(d, c);
                        return d
                    })
                })
            }
        }, nM = {
            mainmenu: function (a, b, c, d, e, f) {
                return Lg.main(a, b, c, d, e, f)
            }, submenu: function (a, b, c, d, e) {
                return Lg.submenu(a, b, c, d, e)
            }
        }, Pm = {
            makeshift: function (a, b, c, d, e, f, k, g, q) {
                return {
                    recalculate: t, isAnchored: h(!1), place: function (h) {
                        var l = b.uiOrigin(), m = a.isInline() ? Ra(c, d) : Ie.translate(l, c, d),
                            C = gg(m.left(), m.top(), e, f);
                        m = k.isRtl() ? Qh.allRtl() : Qh.all();
                        l = Lh.box(C, l);
                        h = h.panel();
                        Mm.simple(l, h, g, m, void 0 === q ? {} : q)
                    }
                }
            }, mainmenu: function (a,
                                   b, c, d) {
                return nM.mainmenu(a.uiContainer, a.bounds, b, c, d)
            }, submenu: function (a, b, c) {
                return nM.submenu(a.uiContainer, a.bounds, b, c)
            }
        }, oM = O("target", "x", "y"), pM = aa.detect().browser, PV = function (a, b, c, d, e, f) {
            c = b.doc().getOrDie();
            var k = LV(c), l = Ra(0, 0);
            c = lca.get();
            var q = Qm.fromUnsafe(b), m = df.menuSystem(e.uiContainer, h("context"), rj.menu({focusActive: !0})),
                w = df.popup(m.sandbox, e.bounds, a, [], Mg.editorContainer());
            f = T.div();
            var n = w.initMenu(f), p = function (a) {
                k.update(a.target());
                var b = y(), c = [m.sandbox()];
                if (0 <
                    b.all.length) {
                    var d = a.x(), e = a.y();
                    l = Ra(d, e);
                    n.setContent(b.main);
                    u(n);
                    n.open();
                    m.open(c, b.main);
                    return g.some(a)
                }
                return g.none()
            }, r = function (a) {
                return b.getSelection().bind(function (a) {
                    return function () {
                        return ie.selectionContains(a).fold(function () {
                            return D.isText(a.startContainer()) ? A.parent(a.startContainer()) : g.some(a.startContainer())
                        }, function (a) {
                            return g.some(a)
                        })
                    }().map(function (a) {
                        var c = bb.viewport(a);
                        c = b.translateScreen(c.left(), c.top());
                        return oM(a, c.left(), c.top())
                    })
                })
            }, t = function (a) {
                var c =
                    a.original();
                c = pM.isIE() && 10 >= pM.version.major ? Ra(c.raw().clientX, c.raw().clientY) : Ra(c.x(), c.y());
                c = b.translateScreen(c.left(), c.top());
                return oM(a.original().target(), c.left(), c.top())
            }, u = function (c) {
                var d = Fh(14, 10);
                d = Pm.makeshift(b, e, l.left(), l.top(), 0, 0, a.uiDirection(), d);
                e.show(c, d)
            }, x = function () {
                n.close();
                var a = y();
                z(a.all, function (a) {
                    v.set(a, "display", "none")
                });
                q.end()
            };
            n.events.close.bind(function () {
                m.close()
            });
            var y = function () {
                var a = k.all();
                return {all: a, main: a[0], submenus: a.slice(1)}
            };
            b.events.contextmenu.bind(function (a) {
                var b =
                    t(a);
                p(b).orThunk(function () {
                    return r().bind(p)
                }).each(function (b) {
                    a.original().raw().preventDefault()
                })
            });
            c.onShortcut(d.events.context, function () {
                r().each(p)
            });
            m.events.open.bind(function () {
                var a = k.structure(), b = y();
                m.update(a);
                w.registerMenus(b.submenus);
                u(n);
                m.setActiveMenu(b.main)
            });
            m.events.itemAction.bind(function (a) {
                k.handle(a.item())
            });
            m.events.itemHover.bind(function (a) {
                q.begin()
            });
            m.events.reveal.bind(function (a) {
                ra.expanded(a.trigger());
                w.expandMenu(a.menu(), a.trigger(), n);
                u(n)
            });
            m.events.collapse.bind(function (a) {
                w.hideMenu(a.menu());
                a.item().each(ra.collapsed)
            });
            m.events.itemAction.bind(x);
            m.events.escaped.bind(function () {
                x();
                b.focus()
            });
            b.events.mousedown.bind(x);
            return {
                register: k.register, destroy: function () {
                    n.destroy();
                    m.destroy()
                }
            }
        }, Nv = {resolve: Dn("ephox-darwin").resolve}, qM = Nv.resolve("selected"), mca = "." + qM,
        rM = Nv.resolve("first-selected"), nca = "." + rM, sM = Nv.resolve("last-selected"), oca = "." + sM, te = {
            selected: h(qM),
            selectedSelector: h(mca),
            firstSelected: h(rM),
            firstSelectedSelector: h(nca),
            lastSelected: h(sM),
            lastSelectedSelector: h(oca)
        },
        RV = function (a) {
            F.empty(a);
            y.append(a, r.fromTag("br"))
        }, pca = aa.detect().browser, sp = function (a) {
            var b = r.fromHtml("<p><br></p>");
            y.append(a, b);
            return g.some(b)
        }, qca = function (a) {
            var b = A.children(a);
            return 0 === b.length ? sp(a) : 1 === b.length && "br" === D.name(b[0]) || 1 === b.length && D.isText(b[0]) && "" === D.value(b[0]) ? (F.empty(a), sp(a)) : g.none()
        }, rca = function (a) {
            return 1 === a.dom().childNodes.length ? A.firstChild(a).fold(h(!1), function (a) {
                return "br" === D.name(a) && m.has(a, "_moz_editor_bogus_node")
            }) : !1
        }, sca = function (a) {
            return qca(a).orThunk(function () {
                if (pca.isFirefox() &&
                    rca(a)) {
                    F.empty(a);
                    var b = sp(a)
                } else b = g.none();
                return b
            })
        }, UV = {
            listen: function (a) {
                a.events.nodeChanged.bind(function (b) {
                    var c = b.node();
                    a.body().each(function (b) {
                        var d = A.children(b);
                        (a.isRoot(c) || 1 === d.length) && sca(b).each(function (b) {
                            a.setSelection(b, 0, b, 0)
                        })
                    })
                })
            }
        }, Az = {
            onNodeChange: function (a, b) {
                a.events.nodeChanged.bind(function (c) {
                    c.prev().each(function (c) {
                        rd.withinTransient(c, c).each(function (c) {
                            b.atomic(function () {
                                rd.cleanup(a.isRoot, c)
                            })
                        })
                    })
                });
                return {destroy: t}
            }, preLinebreak: function (a) {
                a.getSelection().each(function (b) {
                    A.parent(b.startContainer()).each(function (b) {
                        rd.withinTransient(b,
                            b).each(function (b) {
                            rd.cleanupNonEmpty(a.isRoot, b)
                        })
                    })
                })
            }
        }, xg = function (a, b) {
            b = b.original();
            b = b.raw().which || b.raw().keycode;
            return U(a, b)
        }, tca = u(xg, R.ENTER()), uca = u(xg, R.SPACE()), vca = u(xg, R.BACKSPACE()), wca = u(xg, R.DEL()),
        xca = u(xg, R.LEFT().concat(R.UP())), yca = u(xg, R.RIGHT().concat(R.DOWN())), zca = u(xg, R.TAB()),
        Aca = u(xg, R.ESCAPE()), fe = {
            isEnter: tca,
            isSpace: uca,
            isBackspace: vca,
            isDel: wca,
            isTab: zca,
            isLeftOrUp: xca,
            isRightOrDown: yca,
            isEscape: Aca
        }, tM = function (a, b, c, d) {
            return dc.isCollapsed(a) ? b(a.startContainer(),
                a.startOffset(), d) : c(a.startContainer(), a.startOffset(), a.endContainer(), a.endOffset(), d)
        }, Bz = {
            soft: function (a, b) {
                return tM(a, av.soft, dv.soft, b)
            }, hard: function (a, b) {
                return tM(a, av.hard, dv.hard, b)
            }
        }, uM = function (a, b) {
            z(b, function (b) {
                var c = b.find(a);
                b.cleaner(c, a)
            })
        }, qm = {
            filterHtml: function (a, b) {
                var c = r.fromTag("div");
                c.dom().innerHTML = a;
                uM(c, b);
                return qn.writeChildren(c)
            }, filterDom: uM
        }, vM = function (a, b) {
            var c = W.point(a, b);
            return D.isText(a) ? uh.scanRight(a, b).getOr(c) : c
        }, Ez = {
            handle: function (a) {
                var b =
                    vM(a.startContainer(), a.startOffset());
                a = vM(a.endContainer(), a.endOffset());
                return Sc(b.element(), b.offset(), a.element(), a.offset())
            }
        },
        wh = ta.generate([{onText: ["element", "offset"]}, {firstText: ["parent", "child", "offset"]}, {beforeText: ["parent", "child", "offset"]}, {afterText: ["parent", "child", " offset"]}, {lastText: ["parent", "child", "offset"]}, {onElement: ["element", "offset"]}]),
        wM = {
            detect: function (a, b) {
                if (D.isText(a)) return wh.onText(a, b);
                var c = A.children(a);
                return 0 === c.length ? wh.onElement(a, b) : 0 ===
                b && D.isText(c[0]) ? (0, wh.firstText)(a, c[0], 0) : b === c.length && D.isText(c[c.length - 1]) ? (b = c[b - 1], (0, wh.lastText)(a, b, wa.getEnd(b))) : b < c.length && D.isText(c[b]) ? (0, wh.beforeText)(a, c[b], 0) : 0 < b && D.isText(c[b - 1]) ? (b = c[b], (0, wh.afterText)(a, b, wa.getEnd(b))) : wh.onElement(a, b)
            }, cata: function (a, b, c, d, e, f, k) {
                return a.fold(b, c, d, e, f, k)
            }
        }, xh = O("startContainer", "startOffset", "endContainer", "endOffset"),
        xM = {resolve: Lb.create("ephox-newt").resolve}.resolve("cursor-marker"), hl = {
            generator: function (a) {
                var b = null;
                return {
                    getOrInit: function () {
                        if (null ===
                            b) {
                            var c = r.fromTag("span", a.dom());
                            n.add(c, xM);
                            v.set(c, "display", "none")
                        } else c = b;
                        return b = c
                    }
                }
            }, isCursor: function (a) {
                return n.has(a, xM)
            }
        }, yM = function (a, b) {
            return {
                element: h(b), backup: ca, restore: function () {
                    var b = xh(a, 0, a, 0);
                    return g.some(b)
                }
            }
        }, zM = function (a) {
            a = A.children(a);
            return ka(a, zf(hl.isCursor))
        }, Bca = function (a, b) {
            return {
                element: h(b), backup: ca, restore: function () {
                    var b = zM(a).length;
                    b = xh(a, b, a, b);
                    return g.some(b)
                }
            }
        }, Cca = function (a) {
            return A.parent(a).bind(function (b) {
                var c = zM(b);
                return Va(c, function (b) {
                    return N.eq(a,
                        b)
                }).map(function (a) {
                    return xh(b, a, b, a)
                })
            })
        }, Dca = function (a, b) {
            return {
                backup: function () {
                    y.before(a, b)
                }, restore: function () {
                    var a = A.nextSibling(b);
                    F.remove(b);
                    return a.map(function (a) {
                        return Cca(a).getOrThunk(function () {
                            return xh(a, 0, a, 0)
                        })
                    })
                }, element: h(b)
            }
        }, Eca = {
            place: function (a, b, c) {
                var d = A.children(a);
                return 0 === d.length ? yM(a, c) : d.length === b ? Bca(a, c) : 0 === b ? yM(a, c) : b > d.length ? Cz(c) : Dca(d[b], c)
            }
        }, AM = function (a, b) {
            return b().fold(function () {
                return hl.generator(a).getOrInit()
            }, function (a) {
                return a.element()
            })
        },
        tp = function (a) {
            a = a();
            a.backup();
            return g.some(a)
        }, BM = function (a, b) {
            var c = a.or(b), d = b.or(a);
            return c.bind(function (a) {
                return d.map(function (b) {
                    return xh(a.startContainer(), a.startOffset(), b.startContainer(), b.startOffset())
                })
            })
        }, Fca = function (a, b, c) {
            var d = g.none(), e = g.none();
            return {
                backup: function () {
                    e = tp(b);
                    d = tp(c)
                }, restore: function () {
                    return d.bind(function (a) {
                        return e.bind(function (b) {
                            var c = a.restore();
                            b = b.restore();
                            return BM(c, b)
                        })
                    })
                }, element: u(AM, a, function () {
                    return e
                })
            }
        }, Gca = function (a, b, c) {
            var d =
                g.none(), e = g.none();
            return {
                backup: function () {
                    d = tp(c);
                    e = tp(b)
                }, restore: function () {
                    return e.bind(function (a) {
                        return d.bind(function (b) {
                            var c = a.restore();
                            b = b.restore();
                            return BM(b, c)
                        })
                    })
                }, element: u(AM, a, function () {
                    return d
                })
            }
        }, Hca = function (a, b, c) {
            return {
                backup: function () {
                    y.before(b, c)
                }, restore: function () {
                    var b = wc.after(c, a).map(function (a) {
                        return xh(a, 0, a, 0)
                    });
                    F.remove(c);
                    return b
                }, element: h(c)
            }
        }, CM = function (a, b, c) {
            return {
                backup: function () {
                    y.after(b, c)
                }, restore: function () {
                    var b = wc.before(c, a).map(function (a) {
                        var b =
                            wa.getEnd(a);
                        return xh(a, b, a, b)
                    });
                    F.remove(c);
                    return b
                }, element: h(c)
            }
        }, DM = {
            place: function (a, b, c, d) {
                b = ti.split(b, c);
                return ti.position(b).fold(function () {
                    return Cz(d)
                }, function (b) {
                    return Hca(a, b, d)
                }, function (b, c) {
                    return CM(a, b, d)
                }, function (b) {
                    return CM(a, b, d)
                })
            }
        }, Ov = O("result", "cursor"), Ica = function (a, b, c) {
            var d = function (b, d, k) {
                return DM.place(a, d, k, c)
            };
            return wM.cata(b, function (b, d) {
                return DM.place(a, b, d, c)
            }, d, d, d, d, function (a, b) {
                return Eca.place(a, b, c)
            })
        }, Pv = function (a, b, c, d) {
            d = d.getOrInit();
            b = wM.detect(b,
                c);
            return Ica(a, b, d)
        }, EM = function (a, b) {
            a.backup();
            b = b(a.element());
            return Ov(b, a.restore())
        }, up = {
            inspect: Pv, runOnRange: function (a, b, c, d, e, f) {
                var k = A.owner(b), g = (id.after(b, c, d, e) ? Gca : Fca)(k, function () {
                    return Pv(a, d, e, hl.generator(k))
                }, function () {
                    return Pv(a, b, c, hl.generator(k))
                });
                return EM(g, f)
            }, runOnCursor: EM
        }, Jca = function (a, b, c, d, e, f) {
            return up.runOnRange(a, b, e > c ? c : e, b, e > c ? e : c, f)
        }, Kca = up.runOnRange, FM = {
            point: function (a, b, c, d) {
                var e = A.owner(b);
                e = hl.generator(e);
                a = up.inspect(a, b, c, e);
                return up.runOnCursor(a,
                    d)
            }, range: function (a, b, c) {
                return (N.eq(b.startContainer(), b.endContainer()) ? Jca : Kca)(a, b.startContainer(), b.startOffset(), b.endContainer(), b.endOffset(), c)
            }
        }, Lca = function (a, b) {
            return function (a, d) {
                a = d(b);
                return Ov(a, g.none())
            }
        }, Mca = function (a, b) {
            return function (c, d) {
                return FM.point(a, b.startContainer(), b.startOffset(), GM(c, d))
            }
        }, Nca = function (a, b) {
            return function (c, d) {
                return FM.range(a, b, GM(c, d))
            }
        }, GM = function (a, b) {
            return function (c) {
                n.add(c, a);
                return b(c)
            }
        }, Dz = {
            diagnose: function (a, b) {
                var c = b.startContainer(),
                    d = b.endContainer(), e = A.owner(c);
                return ja.inBody(c) && ja.inBody(d) && Z.active(e).forall(ja.inBody) ? b.collapsed() ? Mca(a, b) : Nca(a, b) : Lca(a, b.startContainer())
            }
        }, Qv = {
            fold: function (a, b) {
                return Eb(a, function (a, d) {
                    return a.bind(function (a) {
                        return b(d).map(function (b) {
                            return [b].concat(a)
                        })
                    })
                }, I.value([]))
            }
        }, HM = function (a, b, c) {
            ic(a) && b.hasOwnProperty(a.label) && c(b[a.label]);
            return a
        }, IM = {
            mapGroup: function (a, b) {
                return HM(a, b, function (b) {
                    return a.label = b
                })
            }, mapMenu: function (a, b) {
                return HM(a, b, function (b) {
                    b.hasOwnProperty("label") &&
                    (a.label = b.label);
                    b.hasOwnProperty("menuLabel") && (a.menuLabel = b.menuLabel)
                })
            }
        }, Oca = function (a, b, c) {
            b = b.groups();
            return b.hasOwnProperty(a) ? I.value(b[a]) : kf("Unknown group: " + a, ["No binding for group: " + a + ". Known groups: " + cb(b)])
        }, Pca = function (a, b, c) {
            a = IM.mapGroup(a, c.groupMappings());
            a = Mb(a) ? {label: "", items: a} : a;
            return I.value(a)
        }, Qca = function (a, b, c, d, e, f) {
            return Qv.fold(b, function (a) {
                return e.item(a, c, d, e, f)
            }).map(function (b) {
                return {category: a, items: b}
            })
        }, Rca = function (a, b, c, d, e) {
            b = b.commands();
            return b.hasOwnProperty(a) ? I.value(b[a]) : kf("Unknown command: " + a, ["No binding for command: " + a + ". Known commands: " + cb(b)])
        }, Tca = function (a, b, c, d, e) {
            return (void 0 === a.items ? Sca : d.menu)(a, b, c, d, e)
        }, Sca = function (a, b, c, d, e) {
            return void 0 === c ? kf("You need a custom action factory to use this", []) : c(a)
        }, Uca = function (a) {
            return ob(a, Mb) ? I.value(a) : Xa(a, Mb) ? kf("Menu items must be a single array or an array where every element is an array", ["Menu items must be a single array or an array where every element is an array.",
                "Contents of menu: " + Nb.stringify(a)]) : I.value([a])
        }, JM = eb({
            group: function (a, b, c, d, e) {
                return (xa(a) ? Oca : Pca)(a, b, e).bind(function (a) {
                    return Qca(a.label, a.items, b, c, d, e)
                })
            }, item: function (a, b, c, d, e) {
                return (xa(a) ? Rca : Tca)(a, b, c, d, e)
            }, menu: function (a, b, c, d, e) {
                if (void 0 === a.label || void 0 === a.items || 0 === a.items.length) return kf("Invalid toolbar configuration for menu", ["Invalid menu. Must be an object containing label and items.", "Contents of menu: " + Nb.stringify(a)]);
                var f = IM.mapMenu(a, e.menuMappings()),
                    k = f.menuLabel ? f.menuLabel : f.label;
                return Uca(f.items).bind(function (a) {
                    return Qv.fold(a, function (a) {
                        return d.group(a, b, c, d, e)
                    })
                }).map(function (b) {
                    return {
                        name: a.id,
                        textkey: a.label,
                        menuTextkey: k,
                        type: "submenu",
                        contentFocus: !1,
                        enabled: !0,
                        icon: a.icon,
                        commands: b
                    }
                })
            }
        }, function (a, b) {
            return function () {
                if (5 !== arguments.length) throw"Incorrect usage of builder [" + b + "]. Only given: " + arguments.length;
                return a.apply(null, arguments)
            }
        }), Vca = function (a) {
            if (void 0 === a.items) return kf("Invalid group, no items specified",
                ["Invalid group, no items specified: " + a.label]);
            var b = a.items;
            return Mb(b) ? (a = ia(b, function (a, b) {
                return xa(a) || Mb(a) || void 0 !== a.label && Mb(a.items) ? [] : ["Invalid group at index: " + b + ". Must be either a string, an array or an object containing label and items. Was: " + Nb.stringify(a)]
            }), 0 === a.length ? I.value(b) : kf("Invalid toolbar configuration for groups", a)) : kf("Invalid toolbar, items is not an array", ["Invalid toolbar, items is not an array: " + Nb.stringify(a)])
        }, KM = {
            build: function (a, b, c, d) {
                return Vca(a).bind(function (a) {
                    return Qv.fold(a,
                        function (a) {
                            return JM.group(a, b, c, JM, d)
                        })
                })
            }
        }, LM = function () {
            return xc.isSmallTouch()
        }, MM = function (a, b) {
            return {feature: a.feature, command: a.command, type: "pre_flatmenu", items: b}
        }, ir = {
            shouldFlatten: LM, never: h("never_flatten"), streamline: function (a) {
                var b = function (a) {
                    return ia(a, function (a) {
                        return "never_flatten" === a.flatten ? [a] : "submenu" === a.type ? ia(a.commands, function (a) {
                            return b(a.items)
                        }) : "pre_flatmenu" === a.type ? E(a.items, function (b) {
                            return {feature: a.feature, type: "general", command: b}
                        }) : [a]
                    })
                };
                return E(a,
                    function (a) {
                        var c = b(a.items);
                        return {category: a.category, items: c}
                    })
            }, setup: function (a, b) {
                b = MM(a, b);
                return xc.choice([{predicate: LM, value: h(b)}], a)
            }, make: MM
        }, zj = function (a, b) {
            return {predicate: a, value: h(b)}
        }, NM = function () {
            return {
                make: function (a) {
                    var b = function (b) {
                        return kf(x.translate("errors.toolbar.missing.custom.string", b), ['The required property "' + b + '" for a custom command must be a string. It was: ' + Nb.stringify(a[b]), "Properties specified in custom command: " + cb(a).join(", "), "Definition specified for custom command: " +
                        Nb.stringify(a)])
                    };
                    if (!xa(a.id)) return b("id");
                    if (!xa(a.text)) return b("text");
                    b = {};
                    b[a.id] = h({
                        general: function () {
                            return {
                                toggle: !1,
                                value: Hn.cssSanitise(a.id),
                                textkey: x.raw(a.text),
                                action: a.action,
                                updateGeneral: ca,
                                icon: void 0 !== a.icon ? a.icon : !1
                            }
                        }
                    });
                    return I.value({feature: g.some(b), command: a.id, type: "general"})
                }
            }
        }(), Wca = function (a, b) {
            return a.bind(function (a) {
                return b.map(function (b) {
                    return a.concat(b)
                })
            })
        }, OM = {
            groupMappings: h({
                "group.undo": "category.undo",
                "group.insert": "category.insert",
                "group.style": "category.style",
                "group.language": "category.language",
                "group.emphasis": "category.emphasis",
                "group.align": "category.align",
                "group.listindent": "category.listindent",
                "group.format": "category.format",
                "group.tools": "category.tools",
                "group.table": "category.table",
                "group.image": "category.image"
            }),
            menuMappings: h({
                "menu.insert": {label: "insert.menu-button", menuLabel: "insert.menu"},
                "menu.font": {label: "font.menu-button", menuLabel: "font.menu"}
            })
        }, Aj = {
            config: function (a, b, c) {
                return function (d, e, f, k) {
                    d = gW(d, e, f, k, c);
                    d = oa(d, b);
                    k =
                        {
                            "table-tools": {feature: k.table().ui(), command: "cell", type: "palette"},
                            "image-tools": {feature: k.imageEdit().ui(), command: "edit", type: "palette"},
                            "crop-tools": {feature: k.imageEdit().ui(), command: "crop", type: "palette"}
                        };
                    d = {forItems: h({commands: h(d), groups: Gz}), forContextual: h({commands: h(k), groups: Gz})};
                    k = KM.build({items: a.items}, d.forItems(), NM.make, OM);
                    d = KM.build({items: a.contextual}, d.forContextual(), NM.make, OM);
                    e = aa.detect().deviceType.isTouch() ? ir.streamline : ca;
                    return Wca(k, d).map(e)
                }
            }
        }, Xca = function (a) {
            return function (a) {
                setTimeout(function () {
                        a()
                    },
                    0)
            }
        }, Yca = {
            resume: function (a) {
                a.focus();
                var b = r.fromDom(a.document.body);
                (Z.active().exists(function (a) {
                    return U(["input", "textarea"], D.name(a))
                }) ? Xca(b) : xb)(function () {
                    Z.active().each(Z.blur);
                    Z.focus(b)
                })
            }
        }, vp = {
            safeParse: function (a, b) {
                a = parseInt(m.get(a, b), 10);
                return isNaN(a) ? 0 : a
            }
        }, Zca = function (a) {
            return {left: a.left, top: a.top, width: 2, height: a.height}
        }, $ca = function (a) {
            if (a.collapsed) {
                var b = r.fromDom(a.startContainer);
                return A.parent(b).bind(function (c) {
                    c = Lc.exact(b, a.startOffset, c, wa.getEnd(c));
                    return Wa.getFirstRect(a.startContainer.ownerDocument.defaultView,
                        c).map(function (a) {
                        return eb(a, xb)
                    }).map(Zca).map(IB)
                }).getOr([])
            }
            return a.getClientRects()
        }, lr = {
            getRectangles: function (a) {
                a = a.getSelection();
                return void 0 !== a && 0 < a.rangeCount ? $ca(a.getRangeAt(0)) : []
            }
        }, ue = {resolve: Lb.create("ephox-nomad").resolve}, Rv = "data-" + ue.resolve("last-outer-height"),
        ada = function (a) {
            return {top: h(a.top), bottom: h(a.top + a.height)}
        }, bda = function (a) {
            a = lr.getRectangles(a);
            return 0 < a.length ? g.some(a[0]).map(ada) : g.none()
        }, cda = function (a) {
            a = vp.safeParse(a, Rv);
            var b = window.innerHeight;
            return a > b ? g.some(a - b) : g.none()
        }, kW = {
            setup: function (a, b) {
                var c = r.fromDom(b.document.body), d = K.bind(r.fromDom(a), "resize", function () {
                    cda(c).each(function (a) {
                        bda(b).each(function (c) {
                            c = c.top() > b.innerHeight || c.bottom() > b.innerHeight ? Math.min(a, c.bottom() - b.innerHeight + 50) : 0;
                            0 !== c && b.scrollTo(b.pageXOffset, b.pageYOffset + c)
                        })
                    });
                    m.set(c, Rv, window.innerHeight)
                });
                m.set(c, Rv, window.innerHeight);
                return {
                    toEditing: function () {
                        Yca.resume(b)
                    }, destroy: function () {
                        d.unbind()
                    }
                }
            }
        }, PM = function (a) {
            var b = new (Kc.getOrDie("Event"))("Event");
            b.initEvent(a, !0, !0);
            return b
        }, Hz = {
            event: function (a, b) {
                b = PM(b);
                a.target().dom().dispatchEvent(b)
            }, target: function (a, b) {
                b = PM(b);
                a.dom().dispatchEvent(b)
            }
        }, QM = function () {
            var a = window.matchMedia("(orientation: portrait)").matches;
            return {isPortrait: h(a)}
        }, Jh = {
            get: QM, onChange: function () {
                var a = H.create({ready: p(["orientation"]), change: p(["orientation"])}), b = r.fromDom(window), c = null,
                    d = K.bind(b, "orientationchange", function () {
                        clearInterval(c);
                        var b = QM();
                        a.trigger.change(b);
                        e(function () {
                            a.trigger.ready(b)
                        })
                    }),
                    e = function (a) {
                        clearInterval(c);
                        var b = window.innerHeight, d = 0;
                        c = setInterval(function () {
                            b !== window.innerHeight ? (clearInterval(c), a(g.some(window.innerHeight))) : 20 < d && (clearInterval(c), a(g.none()));
                            d++
                        }, 50)
                    };
                return {
                    onAdjustment: e, events: a.registry, destroy: function () {
                        d.unbind()
                    }
                }
            }
        }, Jz = {
            tag: function () {
                var a = L.first("head").getOrDie(), b = L.first('meta[name="viewport"]').getOrThunk(function () {
                    var b = r.fromTag("meta");
                    m.set(b, "name", "viewport");
                    y.append(a, b);
                    return b
                }), c = m.get(b, "content");
                return {
                    maximize: function () {
                        m.set(b,
                            "content", "width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0")
                    }, restore: function () {
                        void 0 !== c && null !== c && 0 < c.length ? m.set(b, "content", c) : m.remove(b, "content")
                    }
                }
            }
        }, RM = function (a, b) {
            a = Ia.get(a);
            return Math.floor(b / 100 * a)
        }, SM = function (a, b) {
            return L.ancestor(b, "td,th").fold(function () {
                return RM(a, 98)
            }, function (a) {
                return RM(a, 94)
            })
        }, dda = function (a, b, c) {
            var d = b.dom().width;
            a = SM(a, b);
            return Math.max(0, Math.min(a, d + c))
        }, eda = function (a, b, c) {
            return b.dom().height + c
        }, jr = {
            compare: function (a,
                               b) {
                var c = b.deltaX() - a.deltaX(), d = b.deltaY() - a.deltaY();
                a = b.deltaDistance() - a.deltaDistance();
                return {deltaX: h(c), deltaY: h(d), deltaDistance: h(a)}
            }, extract: function (a) {
                var b = a.raw().touches;
                if (2 > b.length) return g.none();
                a = Math.abs(b[0].clientX - b[1].clientX);
                b = Math.abs(b[0].clientY - b[1].clientY);
                var c = Math.sqrt(Math.pow(a, 2) + Math.pow(b, 2));
                return g.some({deltaX: h(a), deltaY: h(b), deltaDistance: h(c)})
            }, resize: function (a, b, c) {
                var d = v.getRaw(b, "height"), e = v.getRaw(b, "width"), f = 0 < c.deltaDistance() ? 1 : -1, k = f *
                    Math.abs(c.deltaX()), g = f * Math.abs(c.deltaY());
                c = dda(a, b, k);
                f = eda(a, b, g);
                k = Math.abs(k) > Math.abs(g);
                v.setAll(b, {
                    height: k ? "auto" : f + "px",
                    width: k ? c + "px" : "auto",
                    transform: "translate3d(0, 0, 0)"
                });
                Ia.get(b) > SM(a, b) && (d.each(function (a) {
                    v.set(b, "height", a)
                }), e.each(function (a) {
                    v.set(b, "width", a)
                }))
            }
        }, jW = 6 <= aa.detect().os.version.major, fda = function (a) {
            return a.body().map(function (a) {
                a = v.get(a, "background-color");
                return void 0 !== a && "" !== a ? "background-color:" + a + "!important" : "background-color:rgb(255,255,255)!important;"
            }).getOr("background-color:rgb(255,255,255)!important;")
        },
        Mz = {
            clobberStyles: function (a, b) {
                var c = function (a) {
                    return function (b) {
                        var c = m.get(b, "style");
                        c = void 0 === c ? "no-styles" : c.trim();
                        c !== a && (m.set(b, "data-ephox-mobile-fullscreen-style", c), m.set(b, "style", a))
                    }
                };
                a = Y.ancestors(a, "*");
                var d = ia(a, function (a) {
                    return Y.siblings(a, "*")
                });
                b = fda(b);
                z(d, c("display:none!important;"));
                z(a, c("position:absolute!important;top:0!important;left:0!important;margin:0!important;padding:0!important;width:100%!important;height:100%!important;overflow:visible!important;" + b))
            },
            restoreStyles: function () {
                var a = Y.all("[data-ephox-mobile-fullscreen-style]");
                z(a, function (a) {
                    var b = m.get(a, "data-ephox-mobile-fullscreen-style");
                    "no-styles" !== b ? m.set(a, "style", b) : m.remove(a, "style");
                    m.remove(a, "data-ephox-mobile-fullscreen-style")
                })
            }
        }, TM = {
            input: function (a, b) {
                var c = r.fromTag("input");
                v.setAll(c, {opacity: "0", position: "absolute", top: "-1000px", left: "-1000px"});
                y.append(a, c);
                Z.focus(c);
                b(c);
                F.remove(c)
            }
        }, rr = {
            refreshInput: function (a) {
                var b = a.dom().selectionStart, c = a.dom().selectionEnd,
                    d = a.dom().selectionDirection;
                setTimeout(function () {
                    a.dom().setSelectionRange(b, c, d);
                    Z.focus(a)
                }, 50)
            }, refresh: function (a) {
                var b = a.getSelection();
                if (0 < b.rangeCount) {
                    var c = b.getRangeAt(0);
                    a = a.document.createRange();
                    a.setStart(c.startContainer, c.startOffset);
                    a.setEnd(c.endContainer, c.endOffset);
                    b.removeAllRanges();
                    b.addRange(a)
                }
            }
        }, kr = {
            resume: function (a, b) {
                Z.active().each(function (a) {
                    N.eq(a, b) || Z.blur(a)
                });
                a.focus();
                Z.focus(r.fromDom(a.document.body));
                rr.refresh(a)
            }
        }, uW = {
            stubborn: function (a, b, c, d, e) {
                var f =
                    rm(e), k = function () {
                    kr.resume(a, c)
                }, g = K.bind(b, "keydown", function (a) {
                    U(["input", "textarea"], D.name(a.target())) || (f.closeMenus(void 0), k())
                });
                return {
                    toReading: function () {
                        TM.input(ja.body(), Z.blur)
                    }, toEditing: k, onToolbarTouch: function (a) {
                    }, destroy: function () {
                        g.unbind()
                    }
                }
            }, timid: function (a, b, c, d, e) {
                return {
                    toReading: function () {
                        Z.blur(c)
                    }, toEditing: function () {
                        kr.resume(a, c)
                    }, onToolbarTouch: function () {
                        Z.blur(c)
                    }, destroy: t
                }
            }
        }, gda = {
            touch: function (a) {
                var b = H.create({touchstart: p(["raw"]), touchend: p(["raw"])}),
                    c = !1, d = g.none(), e = K.capture(a, "touchstart", function (e) {
                        c = !0;
                        d = g.some(K.capture(a, "touchend", function (a) {
                            c = !1;
                            b.trigger.touchend(a.raw());
                            f()
                        }));
                        b.trigger.touchstart(e.raw())
                    }), f = function () {
                        d.each(function (a) {
                            a.unbind()
                        })
                    };
                return {
                    isTouching: function () {
                        return c
                    }, events: b.registry, destroy: function () {
                        e.unbind();
                        f()
                    }
                }
            }
        }, hda = function (a) {
            a = A.documentElement(a);
            var b = ue.resolve("unfocused-selection");
            return L.descendant(a, "." + b).map(function (a) {
                return bb.absolute(a).top
            })
        }, Sv = {
            toFake: function (a, b, c) {
                var d =
                    c.isActive, e = !1;
                return {
                    on: function () {
                        d() || (e = !1, c.update(), b.save(), Wa.clear(a))
                    }, off: function () {
                        d() && !e && (c.clear(), b.restore())
                    }, fakeOut: function () {
                        e = !0;
                        TM.input(ja.body(), b.restore)
                    }
                }
            }, inView: function (a, b, c) {
                return function () {
                    return hda(b).map(function (b) {
                        var c = a.dom().scrollTop;
                        return 0 < b() - c
                    })
                }
            }, onScroll: function (a, b, c, d) {
                var e = function () {
                    a() || f()
                }, f = function () {
                    d.events.touchend.unbind(e);
                    d.isTouching() ? d.events.touchend.bind(e) : (c().getOr(!0) ? b.off : b.fakeOut)()
                };
                return {
                    start: function () {
                        d.events.touchend.unbind(e);
                        b.on()
                    }, stop: f, destroy: function () {
                        d.events.touchend.unbind(e)
                    }
                }
            }
        }, UM = function (a, b) {
            return yc([{width: 320, height: 480, keyboard: {portrait: 300, landscape: 240}}, {
                width: 320,
                height: 568,
                keyboard: {portrait: 300, landscape: 240}
            }, {width: 375, height: 667, keyboard: {portrait: 305, landscape: 240}}, {
                width: 414,
                height: 736,
                keyboard: {portrait: 320, landscape: 240}
            }, {width: 768, height: 1024, keyboard: {portrait: 320, landscape: 400}}, {
                width: 1024,
                height: 1366,
                keyboard: {portrait: 380, landscape: 460}
            }], function (c) {
                return a <= c.width && b <= c.height ?
                    g.some(c.keyboard) : g.none()
            }).getOr({portrait: b / 5, landscape: a / 4})
        }(window.screen.width, window.screen.height), VM = function (a) {
            a = sa.get(a);
            var b = Jh.get().isPortrait(), c = b ? UM.portrait : UM.landscape;
            return a - ((b ? window.screen.height : window.screen.width) - window.innerHeight > c ? 0 : c)
        }, Tv = {
            getGreenzone: VM, updatePadding: function (a, b) {
                var c = VM(b);
                b = sa.get(b) - c;
                v.set(a, "padding-bottom", b + "px")
            }
        }, WM = ta.generate([{fixed: ["element", "offsetY"]}, {scroller: ["element", "offsetY"]}]),
        yg = "data-" + ue.resolve("position-y-fixed"),
        Uv = "data-" + ue.resolve("scrolling"), XM = "data-" + ue.resolve("last-window-height"), YM = function (a) {
            return vp.safeParse(a, yg)
        }, ida = function (a) {
            var b = YM(a);
            return ("true" === m.get(a, Uv) ? WM.scroller : WM.fixed)(a, b)
        }, jda = function (a) {
            var b = m.get(a, "style");
            v.setAll(a, {position: "absolute", top: "0px"});
            m.set(a, yg, "0px");
            return {
                restore: function () {
                    m.set(a, "style", b || "");
                    m.remove(a, yg)
                }
            }
        }, kda = function (a, b, c) {
            var d = m.get(c, "style");
            Vc.register(c);
            v.setAll(c, {position: "absolute", height: b + "px", width: "100%", top: a + "px"});
            m.set(c, yg, a + "px");
            m.set(c, Uv, "true");
            return {
                restore: function () {
                    Vc.deregister(c);
                    m.set(c, "style", d || "");
                    m.remove(c, yg);
                    m.remove(c, Uv)
                }
            }
        }, ZM = function (a, b) {
            var c = window.innerHeight;
            m.set(a, XM, c + "px");
            return c - b
        }, Vv = {
            findFixtures: function (a) {
                a = Y.descendants(a, "[" + yg + "]");
                return E(a, ida)
            }, takeover: function (a, b, c) {
                var d = jda(c), e = sa.get(c), f = ZM(a, e), k = kda(e, f, a);
                e = function () {
                    var b = window.innerHeight, c = vp.safeParse(a, XM);
                    return b > c
                };
                var g = function () {
                    var d = sa.get(c), e = ZM(a, d);
                    m.set(a, yg, d + "px");
                    v.set(a, "height",
                        e + "px");
                    Tv.updatePadding(b, a)
                };
                Tv.updatePadding(b, a);
                return {
                    setViewportOffset: function (b) {
                        m.set(a, yg, b + "px");
                        g()
                    }, isExpanding: e, isShrinking: zf(e), refresh: g, restore: function () {
                        d.restore();
                        k.restore()
                    }
                }
            }, getYFixedData: YM
        }, lda = function (a, b, c) {
            return Math.abs(a - b) <= c ? g.none() : a < b ? g.some(a + c) : g.some(a - c)
        }, wp = function () {
            var a = null;
            return {
                animate: function (b, c, d, e, f, k) {
                    clearInterval(a);
                    var g = function (b) {
                        clearInterval(a);
                        f(b)
                    };
                    a = setInterval(function () {
                        var k = b();
                        lda(k, c, d).fold(function () {
                            clearInterval(a);
                            f(c)
                        }, function (d) {
                            e(d, g);
                            var h = b();
                            if (h !== d || Math.abs(h - c) > Math.abs(k - c)) clearInterval(a), f(c)
                        })
                    }, k)
                }
            }
        }(), xp = "data-" + ue.resolve("last-scroll-top"), $M = function (a) {
            return v.getRaw(a, "top").map(function (a) {
                return parseInt(a, 10)
            }).getOr(0)
        }, aN = function (a) {
            return parseInt(a.dom().scrollTop, 10)
        }, bN = function (a, b) {
            b = b + Vv.getYFixedData(a) + "px";
            v.set(a, "top", b)
        }, il = {
            moveScrollAndTop: function (a, b, c) {
                return Ga.nu(function (d) {
                    var e = u(aN, a);
                    wp.animate(e, b, 15, function (b) {
                        a.dom().scrollTop = b;
                        v.set(a, "top", $M(a) +
                            15 + "px")
                    }, function (e) {
                        a.dom().scrollTop = b;
                        v.set(a, "top", c + "px");
                        d(b)
                    }, 10)
                })
            }, moveOnlyScroll: function (a, b) {
                return Ga.nu(function (c) {
                    var d = u(aN, a);
                    m.set(a, xp, d());
                    var e = Math.abs(b - d());
                    wp.animate(d, b, Math.ceil(e / 10), function (b, c) {
                        vp.safeParse(a, xp) !== a.dom().scrollTop ? c(a.dom().scrollTop) : (a.dom().scrollTop = b, m.set(a, xp, b))
                    }, function (d) {
                        a.dom().scrollTop = b;
                        m.set(a, xp, b);
                        c(b)
                    }, 10)
                })
            }, moveOnlyTop: function (a, b) {
                return Ga.nu(function (c) {
                    var d = u($M, a), e = function (b) {
                        v.set(a, "top", b + "px")
                    }, f = Math.abs(b - d());
                    wp.animate(d, b, Math.ceil(f / 10), e, function (a) {
                        e(b);
                        c(b)
                    }, 10)
                })
            }, moveWindowScroll: function (a, b, c) {
                return Ga.nu(function (d) {
                    var e = function (c) {
                        bN(a, c);
                        bN(b, c);
                        window.scrollTo(0, c)
                    };
                    wp.animate(function () {
                        return window.pageYOffset
                    }, c, 15, e, function (a) {
                        e(a);
                        d(a)
                    }, 10)
                })
            }
        }, mda = {
            scrollIntoView: function (a, b, c, d) {
                var e = Tv.getGreenzone(b);
                a = u(rr.refresh, a);
                c > e || d > e ? il.moveOnlyScroll(b, b.dom().scrollTop - e + d).get(a) : 0 > c && il.moveOnlyScroll(b, b.dom().scrollTop + c).get(a)
            }
        }, nda = function (a, b) {
            return a.fold(function (a,
                                    d) {
                v.set(a, "top", b + d + "px");
                return Ga.pure(d)
            }, function (a, d) {
                var c = b + d;
                d = v.getRaw(a, "top").getOr(d);
                d = c - parseInt(d, 10);
                d = a.dom().scrollTop + d;
                return il.moveScrollAndTop(a, d, c)
            })
        }, cN = {
            updatePositions: function (a, b) {
                a = Vv.findFixtures(a);
                a = E(a, function (a) {
                    return nda(a, b)
                });
                return Rl(a, Ga.nu)
            }
        }, oda = function (a, b, c, d, e, f) {
            var k = qW(function (c) {
                return il.moveWindowScroll(a, b, c)
            }), l = function () {
                var a = lr.getRectangles(f);
                return g.from(a[0]).bind(function (a) {
                    var c = a.top - b.dom().scrollTop;
                    return c > window.innerHeight +
                    5 || -5 > c ? g.some({top: h(c), bottom: h(c + a.height)}) : g.none()
                })
            }, q = jf(function () {
                k.idle(function () {
                    cN.updatePositions(c, d.pageYOffset).get(function (a) {
                        l().each(function (a) {
                            b.dom().scrollTop = b.dom().scrollTop + a.top()
                        });
                        k.start(0);
                        e.refresh()
                    })
                })
            }, 1E3), m = K.bind(r.fromDom(d), "scroll", function () {
                0 > d.pageYOffset || q.throttle()
            });
            cN.updatePositions(c, d.pageYOffset).get(ca);
            return {unbind: m.unbind}
        }, tW = {
            setup: function (a) {
                var b = a.cWin(), c = a.ceBody(), d = a.socket(), e = a.toolstrip(), f = a.toolbar(),
                    k = a.contentElement(),
                    g = a.cursor(), h = a.keyboardType();
                a = a.isScrolling();
                var m = Vv.takeover(d, c, e), w = h(b, ja.body(), k, e, f), n = Jh.onChange();
                n.events.ready.bind(m.refresh);
                n.onAdjustment(function () {
                    m.refresh()
                });
                var p = K.bind(r.fromDom(window), "resize", function () {
                    m.isExpanding() && m.refresh()
                }), u = oda(e, d, ja.body(), window, m, b), x = pW(b, k), y = function () {
                    x.clear()
                };
                e = Sv.toFake(b, g, x);
                c = Sv.inView(d, c, f);
                var z = gda.touch(r.fromDom(b)), A = Sv.onScroll(a, e, c, z);
                return {
                    toEditing: function () {
                        w.toEditing();
                        y()
                    }, toReading: function () {
                        w.toReading()
                    },
                    onToolbarTouch: function (a) {
                        w.onToolbarTouch(a)
                    }, refreshSelection: function () {
                        x.isActive() && x.update()
                    }, clearSelection: y, highlightSelection: function () {
                        x.update()
                    }, scrollIntoView: function (a, c) {
                        mda.scrollIntoView(b, d, a, c)
                    }, updateToolbarPadding: t, setViewportOffset: function (a) {
                        m.setViewportOffset(a);
                        il.moveOnlyTop(d, a).get(ca)
                    }, syncHeight: function () {
                        v.set(k, "height", k.dom().contentWindow.document.body.scrollHeight + "px")
                    }, selectionScrollStarted: function () {
                        A.start()
                    }, selectionScrollStopped: function () {
                        A.stop()
                    },
                    destroy: function () {
                        m.restore();
                        n.destroy();
                        u.unbind();
                        p.unbind();
                        w.destroy();
                        A.destroy();
                        z.destroy();
                        x.destroy()
                    }
                }
            }
        }, dN = "data-" + ue.resolve("horizontal-scroll"), pda = function (a) {
            var b;
            (b = 0 < a.dom().scrollTop) || (a.dom().scrollTop = 1, b = 0 !== a.dom().scrollTop, a.dom().scrollTop = 0);
            return b
        }, qda = function (a) {
            var b;
            (b = 0 < a.dom().scrollLeft) || (a.dom().scrollLeft = 1, b = 0 !== a.dom().scrollLeft, a.dom().scrollLeft = 0);
            return b
        }, eN = {
            markAsHorizontal: function (a) {
                m.set(a, dN, "true")
            }, hasScroll: function (a) {
                return "true" === m.get(a,
                    dN) ? qda : pda
            }
        }, rda = function (a) {
            var b = a.dom().scrollTop, c = a.dom().scrollHeight;
            a = a.dom().offsetHeight;
            return 0 >= b ? g.some(1) : b + a >= c ? g.some(c - a - 1) : g.none()
        }, fN = function (a) {
            rda(a).each(function (b) {
                a.dom().scrollTop = b
            })
        }, Wv = function (a, b) {
            return K.bind(a, "touchstart", function (a) {
                b(a.target()).each(fN)
            })
        }, Oz = {
            fixEdges: fN, exclusive: function (a, b) {
                return K.bind(a, "touchmove", function (a) {
                    L.closest(a.target(), b).filter(eN.hasScroll).fold(function () {
                        a.raw().preventDefault()
                    }, t)
                })
            }, link: function (a, b) {
                return Wv(a,
                    h(b))
            }, ancestor: function (a, b) {
                return Wv(a, function (a) {
                    return L.closest(a, b)
                })
            }, indirect: Wv, markAsHorizontal: function (a) {
                eN.markAsHorizontal(a)
            }
        }, gN = function (a) {
            return r.fromText(mb(), a.dom())
        }, hN = {
            runAndRemove: function (a, b) {
                var c = A.owner(a), d = r.fromTag("span", c.dom());
                y.append(d, gN(c));
                y.prepend(a, d);
                a = b(d);
                F.remove(d);
                return a
            }, enrichAndRemove: function (a, b) {
                var c = gN(A.owner(a));
                y.append(a, c);
                a = b(a);
                F.remove(c);
                return a
            }
        }, yp = O("left", "top", "width", "height", "direction", "absolute"), iN = function (a) {
            return {
                position: h(pk.find(a)),
                width: h(Ia.getOuter(a)), height: h(sa.getOuter(a))
            }
        }, sda = function (a) {
            var b = v.get(a, "display");
            return {
                backup: function () {
                    v.set(a, "display", "inline-block")
                }, restore: function () {
                    v.set(a, "display", b)
                }
            }
        }, tda = {backup: t, restore: t}, uda = function (a) {
            return D.isElement(a.startContainer()) ? g.some(a.startContainer()) : D.isElement(a.endContainer()) ? g.some(a.endContainer()) : A.parent(a.startContainer()).filter(D.isElement).orThunk(function () {
                return A.parent(a.endContainer()).filter(D.isElement)
            })
        }, vda = function (a, b) {
            return uda(b).fold(function () {
                return yp(0,
                    0, 0, a.uiDirection(), Ra(0, 0))
            }, function (b) {
                var c = pk.find(b), e = Ia.get(b), f = sa.get(b), k = bb.absolute(b);
                return yp(c.left(), c.top(), e, f, a.directionAt(b), k)
            })
        }, wda = function (a, b, c, d) {
            return Dz.diagnose(a, c)(d, function (a) {
                var d = sc.isVisible(a) || "br" === D.name(a) ? tda : sda(a);
                d.backup();
                if (ja.inBody(a)) {
                    var e = hN.enrichAndRemove(a, iN);
                    var g = e.position();
                    var h = e.width();
                    e = e.height();
                    var m = b.directionAt(a);
                    a = bb.absolute(a);
                    g = yp(g.left(), g.top(), h, e, m, a)
                } else g = vda(b, c);
                d.restore();
                return g
            })
        }, xda = function (a, b, c,
                           d) {
            var e = c.startContainer(), f = c.startOffset();
            if ("body" === D.name(e) && 0 === f) {
                var k = c.startContainer();
                a = parseInt(v.get(k, "padding-top"), 10);
                d = parseInt(v.get(k, "padding-left"), 10);
                var h = hN.runAndRemove(k, iN);
                e = h.position();
                f = h.width();
                h = h.height();
                b = b.directionAt(k);
                k = bb.absolute(k);
                c = Ov(yp(e.left() + d, e.top() + a, f, h, b, k), g.some(c))
            } else c = wda(a, b, c, d);
            return c
        }, jN = function (a, b, c, d, e) {
            b.focus();
            a = xda(b.isRoot, a, c, e);
            a.cursor().each(function (a) {
                b.setSelection(a.startContainer(), a.startOffset(), a.endContainer(),
                    a.endOffset())
            });
            a = a.result();
            d(a)
        }, Nz = {
            insertAt: jN, insertAtCursor: function (a, b, c, d) {
                b.getSelection().each(function (e) {
                    jN(a, b, e, c, d)
                })
            }
        }, Qz = aa.detect(), kN = function () {
            try {
                var a = Xf.localStorage;
                a.setItem("__storage_test__", "__storage_test__");
                a.removeItem("__storage_test__");
                return g.some(a)
            } catch (b) {
                return g.none()
            }
        }().fold(function () {
            var a = {};
            return {
                getItem: function (b) {
                    return a[b]
                }, setItem: function (b, c) {
                    a[b] = c
                }
            }
        }, function (a) {
            return {
                getItem: function (b) {
                    return a.getItem("ephox.textboxio." + b)
                }, setItem: function (b,
                                      c) {
                    a.setItem("ephox.textboxio." + b, c)
                }
            }
        }), lN = function (a, b) {
            return g.from(kN.getItem(a)).map(Nb.parse).getOr(b)
        }, mN = function (a) {
            return lN(a, {})
        }, nN = function (a, b) {
            b = Nb.stringify(b);
            kN.setItem(a, b)
        }, um = {
            read: mN, readOr: lN, write: nN, access: function (a) {
                return {read: u(mN, a), write: u(nN, a)}
            }
        }, oN = function (a, b, c) {
            b.body().each(function (d) {
                c.save();
                var e = r.fromHtml(mb());
                a(d, e);
                b.setSelection(e, 0, e, 0)
            })
        }, Rz = {
            upOrLeft: function (a, b, c) {
                a.setRelativeSelection(la.before(c), la.before(c));
                a.getSelection().fold(function () {
                    oN(y.prepend,
                        a, b)
                }, t)
            }, right: function (a, b, c) {
                a.setRelativeSelection(la.after(c), la.after(c));
                a.getSelection().fold(function () {
                    oN(y.append, a, b)
                }, t)
            }
        }, Cj = {
            left: function (a, b, c) {
                return a(b) && wa.isStart(b, c) ? g.none() : wa.isStart(b, c) ? wc.before(b, a).filter(function (a) {
                    return !Db.ancestor(a, "head")
                }) : a(b) && 0 < c ? A.child(b, c - 1) : g.none()
            }, right: function (a, b, c) {
                return a(b) && wa.isEnd(b, c) ? g.none() : wa.isEnd(b, c) ? wc.after(b, a).filter(function (b) {
                    return a(b) || Db.ancestor(b, "body")
                }) : a(b) && c < wa.getEnd(b) ? A.child(b, c + 1) : g.none()
            },
            isFirstInContent: function (a, b) {
                return a.body().map(function (a) {
                    a = A.children(a);
                    return N.eq(a[0], b)
                }).getOr(!1)
            }, isLastInContent: function (a, b) {
                return a.body().map(function (a) {
                    a = A.children(a);
                    return 0 < a.length && N.eq(a[a.length - 1], b)
                }).getOr(!1)
            }
        }, yda = function (a, b) {
            return a.getSelection().bind(function (c) {
                return c.collapsed() ? b(a.isRoot, c.startContainer(), c.startOffset()) : g.none()
            })
        }, zda = function (a, b) {
            return Eb(a, function (a, d) {
                return d(b).or(a)
            }, g.none())
        }, mr = {
            get: function (a, b, c) {
                return yda(a, c).bind(function (a) {
                    return zda(b,
                        a)
                })
            }
        }, Ni = {response: O("selection", "kill")}, Oi = function (a) {
            return function (b) {
                return b === a
            }
        }, Ada = Oi(38), Bda = Oi(40), Nd = {
            ltr: {isBackward: Oi(37), isForward: Oi(39)},
            rtl: {isBackward: Oi(39), isForward: Oi(37)},
            isUp: Ada,
            isDown: Bda,
            isNavigation: function (a) {
                return 37 <= a && 40 >= a
            }
        }, Kh = {
            convertToRange: function (a, b) {
                a = Le.asLtrRange(a, b);
                return {
                    start: h(r.fromDom(a.startContainer)),
                    soffset: h(a.startOffset),
                    finish: h(r.fromDom(a.endContainer)),
                    foffset: h(a.endOffset)
                }
            }, makeSitus: function (a, b, c, d) {
                return {
                    start: h(la.on(a,
                        b)), finish: h(la.on(c, d))
                }
            }
        }, pN = function (a, b) {
            return b.column() >= a.startCol() && b.column() + b.colspan() - 1 <= a.finishCol() && b.row() >= a.startRow() && b.row() + b.rowspan() - 1 <= a.finishRow()
        }, qN = {
            inSelection: function (a, b) {
                var c = b.column(), d = b.column() + b.colspan() - 1, e = b.row();
                b = b.row() + b.rowspan() - 1;
                return c <= a.finishCol() && d >= a.startCol() && e <= a.finishRow() && b >= a.startRow()
            }, isWithin: pN, isRectangular: function (a, b) {
                for (var c = !0, d = u(pN, b), e = b.startRow(); e <= b.finishRow(); e++) for (var f = b.startCol(); f <= b.finishCol(); f++) c =
                    c && Ib.getAt(a, e, f).exists(d);
                return c ? g.some(b) : g.none()
            }
        }, rN = function (a, b, c) {
            b = Ib.findItem(a, b, N.eq);
            var d = Ib.findItem(a, c, N.eq);
            return b.bind(function (a) {
                return d.map(function (b) {
                    return Oa.bounds(Math.min(a.row(), b.row()), Math.min(a.column(), b.column()), Math.max(a.row() + a.rowspan() - 1, b.row() + b.rowspan() - 1), Math.max(a.column() + a.colspan() - 1, b.column() + b.colspan() - 1))
                })
            })
        }, sN = {
            getAnyBox: rN, getBox: function (a, b, c) {
                return rN(a, b, c).bind(function (b) {
                    return qN.isRectangular(a, b)
                })
            }
        }, jl = {
            moveBy: function (a,
                              b, c, d) {
                return Ib.findItem(a, b, N.eq).bind(function (b) {
                    var e = 0 < c ? b.row() + b.rowspan() - 1 : b.row();
                    b = 0 < d ? b.column() + b.colspan() - 1 : b.column();
                    return Ib.getAt(a, e + c, b + d).map(function (a) {
                        return a.element()
                    })
                })
            }, intercepts: function (a, b, c) {
                return sN.getAnyBox(a, b, c).map(function (b) {
                    b = Ib.filterItems(a, u(qN.inSelection, b));
                    return E(b, function (a) {
                        return a.element()
                    })
                })
            }, parentCell: function (a, b) {
                return Ib.findItem(a, b, function (a, b) {
                    return N.contains(b, a)
                }).bind(function (a) {
                    return a.element()
                })
            }
        }, zp = function (a) {
            a =
                hg.fromTable(a);
            return Ib.generate(a)
        }, Pi = {
            moveBy: function (a, b, c) {
                return sb.table(a).bind(function (d) {
                    d = zp(d);
                    return jl.moveBy(d, a, b, c)
                })
            }, intercepts: function (a, b, c) {
                a = zp(a);
                return jl.intercepts(a, b, c)
            }, nestedIntercepts: function (a, b, c, d, e) {
                var f = zp(a);
                b = N.eq(a, c) ? b : jl.parentCell(f, b);
                a = N.eq(a, e) ? d : jl.parentCell(f, d);
                return jl.intercepts(f, b, a)
            }, getBox: function (a, b, c) {
                a = zp(a);
                return sN.getBox(a, b, c)
            }
        }, Xv = function (a, b) {
            return L.ancestor(a, "table")
        }, kl = Aa(["boxes", "start", "finish"], []), tN = function (a,
                                                                     b, c) {
            var d = function (a) {
                return function (b) {
                    return c(b) || N.eq(b, a)
                }
            };
            return N.eq(a, b) ? g.some(kl({boxes: g.some([a]), start: a, finish: b})) : Xv(a, c).bind(function (e) {
                return Xv(b, c).bind(function (f) {
                    if (N.eq(e, f)) return g.some(kl({boxes: Pi.intercepts(e, a, b), start: a, finish: b}));
                    if (N.contains(e, f)) {
                        var k = Y.ancestors(b, "td,th", d(e));
                        k = 0 < k.length ? k[k.length - 1] : b;
                        return g.some(kl({boxes: Pi.nestedIntercepts(e, a, e, b, f), start: a, finish: k}))
                    }
                    return N.contains(f, e) ? (k = Y.ancestors(a, "td,th", d(f)), k = 0 < k.length ? k[k.length -
                    1] : a, g.some(kl({
                        boxes: Pi.nestedIntercepts(f, a, e, b, f),
                        start: a,
                        finish: k
                    }))) : nf.ancestors(a, b).shared().bind(function (k) {
                        return L.closest(k, "table", c).bind(function (c) {
                            var k = Y.ancestors(b, "td,th", d(c));
                            k = 0 < k.length ? k[k.length - 1] : b;
                            var h = Y.ancestors(a, "td,th", d(c));
                            h = 0 < h.length ? h[h.length - 1] : a;
                            return g.some(kl({boxes: Pi.nestedIntercepts(c, a, e, b, f), start: h, finish: k}))
                        })
                    })
                })
            })
        }, Cda = function (a, b) {
            return qa(a, function (a) {
                return Fa.is(a, b)
            })
        }, Dda = function (a, b) {
            return L.ancestor(a, "table").bind(function (c) {
                return L.descendant(c,
                    b).bind(function (b) {
                    return tN(b, a).bind(function (a) {
                        return a.boxes().map(function (b) {
                            return {boxes: h(b), start: h(a.start()), finish: h(a.finish())}
                        })
                    })
                })
            })
        }, Sf = {
            identify: tN, retrieve: function (a, b) {
                a = Y.descendants(a, b);
                return 0 < a.length ? g.some(a) : g.none()
            }, shiftSelection: function (a, b, c, d, e) {
                return Cda(a, e).bind(function (a) {
                    return Pi.moveBy(a, b, c).bind(function (a) {
                        return Dda(a, d)
                    })
                })
            }, getEdges: function (a, b, c) {
                return L.descendant(a, b).bind(function (b) {
                    return L.descendant(a, c).bind(function (a) {
                        return nf.sharedOne(Xv,
                            [b, a]).map(function (c) {
                            return {first: h(b), last: h(a), table: h(c)}
                        })
                    })
                })
            }
        }, uN = function (a, b, c, d, e) {
            return N.eq(c, d) ? g.none() : Sf.identify(c, d, b).bind(function (b) {
                var d = b.boxes().getOr([]);
                return 0 < d.length ? (e(a, d, b.start(), b.finish()), g.some(Ni.response(g.some(Kh.makeSitus(c, 0, c, wa.getEnd(c))), !0))) : g.none()
            })
        }, Yv = {
            sync: function (a, b, c, d, e, f, k) {
                return N.eq(c, e) && d === f ? g.none() : L.closest(c, "td,th", b).bind(function (c) {
                    return L.closest(e, "td,th", b).bind(function (d) {
                        return uN(a, b, c, d, k)
                    })
                })
            }, detect: uN, update: function (a,
                                             b, c, d, e) {
                return Sf.shiftSelection(d, a, b, e.firstSelectedSelector(), e.lastSelectedSelector()).map(function (a) {
                    e.clear(c);
                    e.selectRange(c, a.boxes(), a.start(), a.finish());
                    return a.boxes()
                })
            }
        }, Qi = Aa(["left", "top", "right", "bottom"], []), Ed = {
            nu: Qi, moveUp: function (a, b) {
                return Qi({left: a.left(), top: a.top() - b, right: a.right(), bottom: a.bottom() - b})
            }, moveDown: function (a, b) {
                return Qi({left: a.left(), top: a.top() + b, right: a.right(), bottom: a.bottom() + b})
            }, moveBottomTo: function (a, b) {
                var c = a.bottom() - a.top();
                return Qi({
                    left: a.left(),
                    top: b - c, right: a.right(), bottom: b
                })
            }, moveTopTo: function (a, b) {
                var c = a.bottom() - a.top();
                return Qi({left: a.left(), top: b, right: a.right(), bottom: b + c})
            }, getTop: function (a) {
                return a.top()
            }, getBottom: function (a) {
                return a.bottom()
            }, translate: function (a, b, c) {
                return Qi({left: a.left() + b, top: a.top() + c, right: a.right() + b, bottom: a.bottom() + c})
            }, toString: function (a) {
                return "(" + a.left() + ", " + a.top() + ") -> (" + a.right() + ", " + a.bottom() + ")"
            }
        }, Ap = function (a) {
            return Ed.nu({left: a.left, top: a.top, right: a.right, bottom: a.bottom})
        },
        Bp = {
            getBoxAt: function (a, b, c) {
                return D.isElement(b) ? g.some(a.getRect(b)).map(Ap) : D.isText(b) ? (a = 0 <= c && c < wa.getEnd(b) ? a.getRangedRect(b, c, b, c + 1) : 0 < c ? a.getRangedRect(b, c - 1, b, c) : g.none(), a.map(Ap)) : g.none()
            }, getEntireBox: function (a, b) {
                return D.isElement(b) ? g.some(a.getRect(b)).map(Ap) : D.isText(b) ? a.getRangedRect(b, 0, b, wa.getEnd(b)).map(Ap) : g.none()
            }
        }, Qe = ta.generate([{none: []}, {retry: ["caret"]}]), vN = function (a, b, c) {
            return Ja.closest(b, pa.isBlock).fold(h(!1), function (b) {
                return Bp.getEntireBox(a, b).exists(function (a) {
                    return c.left() <
                        a.left() || 1 > Math.abs(a.right() - c.left()) || c.left() > a.right()
                })
            })
        }, Eda = {
            point: Ed.getBottom, adjuster: function (a, b, c, d, e) {
                var f = Ed.moveDown(e, 5);
                return 1 > Math.abs(c.bottom() - d.bottom()) ? Qe.retry(f) : c.top() > e.bottom() ? Qe.retry(f) : c.top() === e.bottom() ? Qe.retry(Ed.moveDown(e, 1)) : vN(a, b, e) ? Qe.retry(Ed.translate(f, 5, 0)) : Qe.none()
            }, move: Ed.moveDown, gather: wc.after
        }, Fda = function (a, b, c) {
            return a.elementFromPoint(b, c).filter(function (a) {
                return "table" === D.name(a)
            }).isSome()
        }, Gda = function (a, b, c, d, e) {
            return Zv(a,
                b, c, b.move(d, 5), e)
        }, Zv = function (a, b, c, d, e) {
            return 0 === e ? g.some(d) : Fda(a, d.left(), b.point(d)) ? Gda(a, b, c, d, e - 1) : a.situsFromPoint(d.left(), b.point(d)).bind(function (f) {
                return f.start().fold(g.none, function (f, h) {
                    return Bp.getEntireBox(a, f, h).bind(function (k) {
                        return b.adjuster(a, f, k, c, d).fold(g.none, function (d) {
                            return Zv(a, b, c, d, e - 1)
                        })
                    }).orThunk(function () {
                        return g.some(d)
                    })
                }, g.none)
            })
        }, Hda = function (a, b, c) {
            return a.point(b) > c.getInnerHeight() ? g.some(a.point(b) - c.getInnerHeight()) : 0 > a.point(b) ? g.some(-a.point(b)) :
                g.none()
        }, wN = function (a, b, c) {
            var d = a.move(c, 5), e = Zv(b, a, c, d, 100).getOr(d);
            return Hda(a, e, b).fold(function () {
                return b.situsFromPoint(e.left(), a.point(e))
            }, function (c) {
                b.scrollBy(0, c);
                return b.situsFromPoint(e.left(), a.point(e) - c)
            })
        }, ll = {
            tryUp: u(wN, {
                point: Ed.getTop, adjuster: function (a, b, c, d, e) {
                    var f = Ed.moveUp(e, 5);
                    return 1 > Math.abs(c.top() - d.top()) ? Qe.retry(f) : c.bottom() < e.top() ? Qe.retry(f) : c.bottom() === e.top() ? Qe.retry(Ed.moveUp(e, 1)) : vN(a, b, e) ? Qe.retry(Ed.translate(f, 5, 0)) : Qe.none()
                }, move: Ed.moveUp,
                gather: wc.before
            }), tryDown: u(wN, Eda), ieTryUp: function (a, b) {
                return a.situsFromPoint(b.left(), b.top() - 5)
            }, ieTryDown: function (a, b) {
                return a.situsFromPoint(b.left(), b.bottom() + 5)
            }, getJumpSize: h(5)
        }, Cp = ta.generate([{none: ["message"]}, {success: []}, {failedUp: ["cell"]}, {failedDown: ["cell"]}]),
        Ida = function (a) {
            return L.closest(a, "tr")
        }, Ri = {
            verify: function (a, b, c, d, e, f, k) {
                return L.closest(d, "td,th", k).bind(function (c) {
                    return L.closest(b, "td,th", k).map(function (b) {
                        return N.eq(c, b) ? N.eq(d, c) && wa.getEnd(c) === e ?
                            f(b) : Cp.none("in same cell") : nf.sharedOne(Ida, [c, b]).fold(function () {
                            var d = a.getRect(b), e = a.getRect(c);
                            return e.right > d.left && e.left < d.right ? Cp.success() : f(b)
                        }, function (a) {
                            return f(b)
                        })
                    })
                }).getOr(Cp.none("default"))
            }, cata: function (a, b, c, d, e) {
                return a.fold(b, c, d, e)
            }, adt: Cp
        }, Jda = O("ancestor", "descendants", "element", "index"), xN = O("parent", "children", "element", "index"),
        Dp = function (a, b) {
            return Va(a, u(N.eq, b))
        }, Kda = {
            childOf: function (a, b) {
                return Ja.closest(a, function (a) {
                    return A.parent(a).exists(function (a) {
                        return N.eq(a,
                            b)
                    })
                })
            }, indexOf: Dp, indexInParent: function (a) {
                return A.parent(a).bind(function (b) {
                    var c = A.children(b);
                    return Dp(c, a).map(function (d) {
                        return xN(b, c, a, d)
                    })
                })
            }, selectorsInParent: function (a, b) {
                return A.parent(a).bind(function (c) {
                    var d = Y.children(c, b);
                    return Dp(d, a).map(function (b) {
                        return xN(c, d, a, b)
                    })
                })
            }, descendantsInAncestor: function (a, b, c) {
                return L.closest(a, b).bind(function (b) {
                    var d = Y.descendants(b, c);
                    return Dp(d, a).map(function (c) {
                        return Jda(b, d, a, c)
                    })
                })
            }
        }, $v = function (a) {
            return "br" === D.name(a)
        }, aw =
            function (a, b, c) {
                return b(a, c).bind(function (a) {
                    return D.isText(a) && 0 === Ya.get(a).trim().length ? aw(a, b, c) : g.some(a)
                })
            }, Lda = function (a, b, c) {
            return c.traverse(b).orThunk(function () {
                return aw(b, c.gather, a)
            }).map(c.relative)
        }, Mda = function (a, b) {
            return A.child(a, b).filter($v).orThunk(function () {
                return A.child(a, b - 1).filter($v)
            })
        }, Nda = function (a, b, c, d) {
            return Mda(b, c).bind(function (b) {
                return d.traverse(b).fold(function () {
                    return aw(b, d.gather, a).map(d.relative)
                }, function (a) {
                    return Kda.indexInParent(a).map(function (a) {
                        return la.on(a.parent(),
                            a.index())
                    })
                })
            })
        }, yN = {
            tryBr: function (a, b, c, d) {
                return ($v(b) ? Lda(a, b, d) : Nda(a, b, c, d)).map(function (a) {
                    return {start: h(a), finish: h(a)}
                })
            }, process: function (a) {
                return Ri.cata(a, function (a) {
                    return g.none()
                }, function () {
                    return g.none()
                }, function (a) {
                    return g.some(W.point(a, 0))
                }, function (a) {
                    return g.some(W.point(a, wa.getEnd(a)))
                })
            }
        }, ml = aa.detect(), Oda = function (a, b, c) {
            return a.getSelection().bind(function (d) {
                return yN.tryBr(b, d.finish(), d.foffset(), c).fold(function () {
                        return g.some(W.point(d.finish(), d.foffset()))
                    },
                    function (e) {
                        e = a.fromSitus(e);
                        e = Ri.verify(a, d.finish(), d.foffset(), e.finish(), e.foffset(), c.failure, b);
                        return yN.process(e)
                    })
            })
        }, bw = function (a, b, c, d, e, f) {
            return 0 === f ? g.none() : Pda(a, b, c, d, e).bind(function (k) {
                var h = a.fromSitus(k);
                h = Ri.verify(a, c, d, h.finish(), h.foffset(), e.failure, b);
                return Ri.cata(h, function () {
                    return g.none()
                }, function () {
                    return g.some(k)
                }, function (k) {
                    return N.eq(c, k) && 0 === d ? zN(a, c, d, Ed.moveUp, e) : bw(a, b, k, 0, e, f - 1)
                }, function (k) {
                    return N.eq(c, k) && d === wa.getEnd(k) ? zN(a, c, d, Ed.moveDown,
                        e) : bw(a, b, k, wa.getEnd(k), e, f - 1)
                })
            })
        }, zN = function (a, b, c, d, e) {
            return Bp.getBoxAt(a, b, c).bind(function (b) {
                return AN(a, e, d(b, ll.getJumpSize()))
            })
        }, AN = function (a, b, c) {
            return ml.browser.isChrome() || ml.browser.isSafari() || ml.browser.isFirefox() || ml.browser.isEdge() ? b.otherRetry(a, c) : ml.browser.isIE() ? b.ieRetry(a, c) : g.none()
        }, Pda = function (a, b, c, d, e) {
            return Bp.getBoxAt(a, c, d).bind(function (b) {
                return AN(a, e, b)
            })
        }, Qda = {
            handle: function (a, b, c) {
                return Oda(a, b, c).bind(function (d) {
                    return bw(a, b, d.element(), d.offset(),
                        c, 20).map(a.fromSitus)
                })
            }
        }, Rda = aa.detect(), Sda = function (a, b) {
            return wd.ancestor(a, function (a) {
                return A.parent(a).exists(function (a) {
                    return N.eq(a, b)
                })
            })
        }, BN = function (a, b, c, d, e) {
            return L.closest(d, "td,th", b).bind(function (d) {
                return L.closest(d, "table", b).bind(function (f) {
                    return Sda(e, f) ? Qda.handle(a, b, c).bind(function (a) {
                        return L.closest(a.finish(), "td,th", b).map(function (b) {
                            return {start: h(d), finish: h(b), range: h(a)}
                        })
                    }) : g.none()
                })
            })
        }, CN = function (a, b, c, d, e, f) {
            return Rda.browser.isIE() ? g.none() : f(d,
                b).orThunk(function () {
                return BN(a, b, c, d, e).map(function (a) {
                    a = a.range();
                    return Ni.response(g.some(Kh.makeSitus(a.start(), a.soffset(), a.finish(), a.foffset())), !0)
                })
            })
        }, DN = function (a, b, c, d, e, f, k) {
            return BN(a, c, d, e, f).bind(function (a) {
                return Yv.detect(b, c, a.start(), a.finish(), k)
            })
        }, Tda = function (a, b) {
            return L.closest(a, "tr", b).bind(function (a) {
                return L.closest(a, "table", b).bind(function (c) {
                    var d = Y.descendants(c, "tr");
                    return N.eq(a, d[0]) ? wc.seekLeft(c, function (a) {
                        return kc.last(a).isSome()
                    }, b).map(function (a) {
                        var b =
                            wa.getEnd(a);
                        return Ni.response(g.some(Kh.makeSitus(a, b, a, b)), !0)
                    }) : g.none()
                })
            })
        }, Uda = function (a, b) {
            return L.closest(a, "tr", b).bind(function (a) {
                return L.closest(a, "table", b).bind(function (c) {
                    var d = Y.descendants(c, "tr");
                    return N.eq(a, d[d.length - 1]) ? wc.seekRight(c, function (a) {
                        return kc.first(a).isSome()
                    }, b).map(function (a) {
                        return Ni.response(g.some(Kh.makeSitus(a, 0, a, 0)), !0)
                    }) : g.none()
                })
            })
        }, Tz = function (a, b) {
            return L.closest(a, "td,th", b)
        }, EN = {
            traverse: A.nextSibling, gather: wc.after, relative: la.before,
            otherRetry: ll.tryDown, ieRetry: ll.ieTryDown, failure: Ri.adt.failedDown
        }, FN = {
            traverse: A.prevSibling,
            gather: wc.before,
            relative: la.before,
            otherRetry: ll.tryUp,
            ieRetry: ll.ieTryUp,
            failure: Ri.adt.failedUp
        }, Si = O("rows", "cols"), Wz = {
            mouse: function (a, b, c, d) {
                a = Sz(a);
                b = BW(a, b, c, d);
                return {mousedown: b.mousedown, mouseover: b.mouseover, mouseup: b.mouseup}
            }, keyboard: function (a, b, c, d) {
                var e = Sz(a), f = function () {
                    d.clear(b);
                    return g.none()
                };
                return {
                    keydown: function (a, h, q, m, w, n) {
                        var k = a.raw().which, l = !0 === a.raw().shiftKey;
                        return Sf.retrieve(b,
                            d.selectedSelector()).fold(function () {
                            return Nd.isDown(k) && l ? u(DN, e, b, c, EN, m, h, d.selectRange) : Nd.isUp(k) && l ? u(DN, e, b, c, FN, m, h, d.selectRange) : Nd.isDown(k) ? u(CN, e, c, EN, m, h, Uda) : Nd.isUp(k) ? u(CN, e, c, FN, m, h, Tda) : g.none
                        }, function (a) {
                            var c = function (c) {
                                return function () {
                                    return yc(c, function (c) {
                                        return Yv.update(c.rows(), c.cols(), b, a, d)
                                    }).fold(function () {
                                        return Sf.getEdges(b, d.firstSelectedSelector(), d.lastSelectedSelector()).map(function (a) {
                                            var c = Nd.isDown(k) || n.isForward(k) ? la.after : la.before;
                                            e.setRelativeSelection(la.on(a.first(),
                                                0), c(a.table()));
                                            d.clear(b);
                                            return Ni.response(g.none(), !0)
                                        })
                                    }, function (a) {
                                        return g.some(Ni.response(g.none(), !0))
                                    })
                                }
                            };
                            return Nd.isDown(k) && l ? c([Si(1, 0)]) : Nd.isUp(k) && l ? c([Si(-1, 0)]) : n.isBackward(k) && l ? c([Si(0, -1), Si(-1, 0)]) : n.isForward(k) && l ? c([Si(0, 1), Si(1, 0)]) : Nd.isNavigation(k) && !1 === l ? f : g.none
                        })()
                    }, keyup: function (a, e, f, h, m) {
                        return Sf.retrieve(b, d.selectedSelector()).fold(function () {
                            var k = a.raw().which;
                            return !0 === a.raw().shiftKey === !1 ? g.none() : Nd.isNavigation(k) ? Yv.sync(b, c, e, f, h, m, d.selectRange) :
                                g.none()
                        }, g.none)
                    }
                }
            }
        }, Uz = {
            byClass: function (a) {
                var b = yf.addClass(a.selected()),
                    c = yf.removeClasses([a.selected(), a.lastSelected(), a.firstSelected()]), d = function (b) {
                        b = Y.descendants(b, a.selectedSelector());
                        z(b, c)
                    };
                return {
                    clear: d,
                    selectRange: function (c, f, k, g) {
                        d(c);
                        z(f, b);
                        n.add(k, a.firstSelected());
                        n.add(g, a.lastSelected())
                    },
                    selectedSelector: a.selectedSelector,
                    firstSelectedSelector: a.firstSelectedSelector,
                    lastSelectedSelector: a.lastSelectedSelector
                }
            }, byAttr: function (a) {
                var b = function (b) {
                    m.remove(b, a.selected());
                    m.remove(b, a.firstSelected());
                    m.remove(b, a.lastSelected())
                }, c = function (b) {
                    m.set(b, a.selected(), "1")
                }, d = function (c) {
                    c = Y.descendants(c, a.selectedSelector());
                    z(c, b)
                };
                return {
                    clear: d,
                    selectRange: function (b, f, k, g) {
                        d(b);
                        z(f, c);
                        m.set(k, a.firstSelected(), "1");
                        m.set(g, a.lastSelected(), "1")
                    },
                    selectedSelector: a.selectedSelector,
                    firstSelectedSelector: a.firstSelectedSelector,
                    lastSelectedSelector: a.lastSelectedSelector
                }
            }
        }, Xz = {
            retrieve: function (a, b) {
                return Sf.retrieve(a, b)
            }, retrieveBox: function (a, b, c) {
                return Sf.getEdges(a,
                    b, c).bind(function (b) {
                    var c = function (b) {
                            return N.eq(a, b)
                        }, d = L.ancestor(b.first(), "thead,tfoot,tbody,table", c),
                        k = L.ancestor(b.last(), "thead,tfoot,tbody,table", c);
                    return d.bind(function (a) {
                        return k.bind(function (c) {
                            return N.eq(a, c) ? Pi.getBox(b.table(), b.first(), b.last()) : g.none()
                        })
                    })
                })
            }
        }, EW = {
            configure: function (a) {
                z([a.output(), a.internal()], function (b) {
                    var c = [te.lastSelected(), te.firstSelected(), te.selected()], d = E(c, function (a) {
                        return "." + a
                    }).join(",");
                    a.addSelector(b, d, function (a) {
                        z(a, yf.removeClasses(c))
                    })
                })
            }
        },
        GN = function (a) {
            return 0 === a.button
        }, Ep = function (a, b) {
            return {
                bind: function (c, d) {
                    return ys.bind(c, a, b, d)
                }
            }
        }, vm = {
            realClick: Ep("click", function (a) {
                return 6 === a.mozInputSource || 0 === a.mozInputSource ? !1 : void 0 !== a.isTrusted && !0 !== a.isTrusted ? !1 : !0
            }), leftDown: Ep("mousedown", GN), leftPressedOver: Ep("mouseover", function (a) {
                return void 0 === a.buttons ? !0 : 0 !== (a.buttons & 1)
            }), leftUp: Ep("mouseup", GN)
        }, Vz = aa.detect(), HW = function (a) {
            var b = aa.detect(), c = b.os.isOSX(), d = b.os.isLinux(), e = c ? R.META() : R.CTRL();
            b = [[e, "Z"]];
            var f = c ? [[R.META(), R.SHIFT(), "Z"]] : d ? [[R.CTRL(), "Y"], [R.CTRL(), R.SHIFT(), "Z"]] : [[R.CTRL(), "Y"]],
                k = [[R.SHIFT(), 121]], g = c ? [[R.ALT(), 121]] : [[121]], h = [[e, R.SHIFT(), "F"]];
            d = c ? [[R.META(), R.ALT(), "U"]] : d ? [[R.CTRL(), R.ALT(), "U"]] : [[R.CTRL(), R.SHIFT(), "U"]];
            c = c ? [[R.CTRL(), R.ALT(), "H"]] : [[R.CTRL(), R.SHIFT(), "H"]];
            var m = [[e, "B"]], w = [[e, "I"]], n = [[e, "U"]], p = [[e, 221], [e, "M"]],
                r = [[e, 219], [e, R.SHIFT(), "M"]], t = [[e, R.SHIFT(), "9"]], u = [[e, "K"]];
            e = [[e, "F"]];
            var v = O("keys", "trigger");
            return {
                undo: v(b, a.trigger.undo),
                redo: v(f,
                    a.trigger.redo),
                context: v(k, a.trigger.context),
                toolbar: v(g, a.trigger.toolbar),
                bold: v(m, a.trigger.bold),
                italic: v(w, a.trigger.italic),
                underline: v(n, a.trigger.underline),
                indent: v(p, a.trigger.indent),
                outdent: v(r, a.trigger.outdent),
                link: v(u, a.trigger.link),
                search: v(e, a.trigger.search),
                blockquote: v(t, a.trigger.blockquote),
                help: v(c, a.trigger.help),
                fullscreen: v(h, a.trigger.fullscreen),
                plaincode: v(d, a.trigger.plaincode)
            }
        }, IW = function (a, b) {
            return function (c) {
                return U(a, c) ? g.some(b) : g.none()
            }
        }, HN = function (a) {
            return function (b) {
                return b.key() ===
                    a
            }
        }, Vda = O("key", "value"), KW = {
            put: function (a, b, c, d, e) {
                var f = void 0 !== d ? d : Vda, k = void 0 !== e ? e : HN(b);
                a = hb(a, function (a, d) {
                    var e = k(d) ? f(b, c) : d;
                    return {updated: k(d) || a.updated, acc: a.acc.concat([e])}
                }, {updated: !1, acc: []});
                return a.updated ? a.acc : a.acc.concat([f(b, c)])
            }, get: function (a, b, c) {
                b = void 0 !== c ? c : HN(b);
                return qa(a, b)
            }
        }, LW = O("popup", "anchor"), Yz = {
            bind: function (a, b) {
                var c = Za.get(a);
                return {
                    unbind: K.bind(a, "scroll", function (d) {
                        d = Za.get(a);
                        d.top() === c.top() && d.left() === c.left() || b(d);
                        c = d
                    }).unbind
                }
            }
        }, SW =
            {
                isDefaultEmpty: function (a) {
                    return /^\s*<p>\s*<br\s?\/?>\s*<\/p>\s*$/.test(a)
                }
            }, QW = {
            fromInitial: function (a) {
                return Zz({initial: a, undo: [], redo: []})
            }, fromState: function (a) {
                return Zz(a)
            }
        }, wm = O("raw", "marked"), RW = function (a) {
            return wm(a.raw, a.marked)
        }, $z = function (a, b) {
            return {initial: b(a.initial), undo: E(a.undo, b), redo: E(a.redo, b)}
        }, TW = function (a) {
            return {raw: a.raw(), marked: a.marked()}
        }, cw = ta.generate([{aboveView: ["item"]}, {inView: ["item"]}, {belowView: ["item"]}]), Rg = {
            aboveView: cw.aboveView, inView: cw.inView,
            belowView: cw.belowView, cata: function (a, b, c, d) {
                return a.fold(b, c, d)
            }
        }, aA = function (a) {
            return a.dom().getBoundingClientRect()
        }, E0 = function (a, b, c) {
            var d = oz(a), e = yW(c.profile), f = YV(c.filters), k = $V(), l = kca(f, k, a.content, b, c.content),
                m = DW(b, f, l), n = GW(l, a.shortcuts), w = a.ui.layout.bounds(a.ui), p = MW(l, w, b, a.ui),
                r = !1 !== a.fullscreen.bundled ? ZV(l, n, a.fullscreen) : Ta.fullscreen(), t = xW(l, p, b, r, a.platform),
                u = OW(l, n, p, t, r, b, a.ui, c.ui), v = dW(l, u), y = PW(f, l, v, n, c.undo), A = QV(l, m, v, y),
                B = zW(l, v, y), D = fW(f, l), F = TV(l, y, a.editorcontext),
                E = UW(l, a.ui.autoresize), H = AW(u, a.registration), I = OV(b, l, v, n, p, a.contextmenu),
                K = Az.onNodeChange(l, D), M = ey(c.laundry);
            y.events.changed.bind(function () {
                M.setDirty(!0)
            });
            M.events.clean.bind(function () {
                l.undoChanged()
            });
            l.events.interaction.bind(function (a) {
                !M.isDirty() && y.checkChanged() && M.setDirty(!0)
            });
            var N = aa.detect(), O = N.deviceType.isTouch();
            w = n.isHelpShortcutEnabled();
            c = !l.isInline() && !O && a.ui.showHelpHint;
            a = rba.editor(a.ui.editorName, a.ui.isFullScreen);
            N = x.translate(N.os.isOSX() ? "aria.help.mac" :
                "aria.help.ctrl");
            w = w ? g.some(N) : g.none();
            var P = (l.isInline() ? S.inline : S.editor)(u.element(), l.element(), a, w, c), Q = g.none();
            l.runOrOnLoaded(function (a) {
                var b = tm.handle(a, function (a) {
                    L.closest(a.target(), "a").each(function (b) {
                        L.closest(b, '[contenteditable="false"]').each(a.kill)
                    })
                });
                Q = g.some(b);
                O && (S.label(a, x.translate("aria.label.content")), S.region(u.viewport()), S.region(u.tabstrip.element()))
            });
            return {
                region: h(b),
                communication: h(d),
                profile: h(e),
                filter: h(f),
                internalevents: h(k),
                content: h(l),
                keyboard: h(v),
                shortcuts: h(n),
                smartview: h(p),
                undo: h(y),
                del: h(A),
                proximity: h(B),
                operations: h(D),
                context: h(F),
                fullscreen: h(r),
                platform: h(t),
                registration: h(H),
                contextmenu: h(I),
                ui: h(u),
                selections: h(m),
                insertFilteredHtmlAtCursor: function (a) {
                    a = f.filterHtml(f.input(), a);
                    l.insertHtmlAtCursor(a)
                },
                viewablearea: h(E),
                laundry: h(M),
                state: function () {
                    return {ui: u.state(), undo: y.state(), content: l.state(), profile: e.state(), laundry: M.state()}
                },
                destroy: function () {
                    Q.each(function (a) {
                        a.unbind()
                    });
                    z([l, E, K, I, H, t, r, F, D, B, y, A, p, n, v, m, f,
                        e, d, u], function (a) {
                        a.destroy ? a.destroy() : console.log("Feature missing destroy method: ", a)
                    });
                    P.destroy()
                }
            }
        }, Sb = {resolve: Lb.create("ephox-hermes").resolve}, IN = function () {
            var a = H.create({upload: p(["files"])}), b = r.fromTag("input");
            n.add(b, Sb.resolve("hidden"));
            n.add(b, Sb.resolve("file-selector-input"));
            m.setAll(b, {type: "file", accept: "image/*"});
            var c = K.bind(b, "change", function (b) {
                b = ve.toFiles(b);
                a.trigger.upload(b)
            });
            return {
                element: h(b), open: function () {
                    fa.set(b, "");
                    b.dom().click()
                }, destroy: function () {
                    c.unbind()
                },
                events: a.registry
            }
        }, cA = {
            single: IN, multiple: function () {
                var a = IN();
                m.set(a.element(), "multiple", "multiple");
                return {element: a.element, open: a.open, destroy: a.destroy, events: a.events}
            }
        }, JN = function (a, b) {
            return E(b, function (b) {
                var c = r.fromTag("img"), e = K.bind(c, "load", function () {
                    e.unbind();
                    a.domChanged()
                });
                b = Qc.cata(b, function (a, b, c) {
                    return c
                }, function (a, b, c) {
                    return b
                });
                m.set(c, "src", b);
                return c
            })
        }, qr = {
            insertMobileAssets: function (a, b, c, d) {
                var e = JN(a, d);
                return a.undoOperation(function () {
                    var f = sd.insertAt(a,
                        b, e);
                    c.uploadAssets(d);
                    return f
                })
            }, insertAssets: function (a, b, c) {
                var d = JN(a, c);
                a.focus();
                a.undoOperation(function () {
                    sd.insertAtCursor(a, d).each(function (b) {
                        a.setSelection(b.element(), b.offset(), b.element(), b.offset())
                    });
                    b.uploadAssets(c)
                })
            }
        }, lc = {resolve: Lb.create("ephox-gel").resolve}, YW = aa.detect().deviceType.isiOS(), ZW = aa.detect(),
        KN = function (a) {
            a.dom().click();
            return g.some(a)
        }, Kb = {
            setup: function (a, b, c) {
                b = Ba.dialog({
                    execute: function (a) {
                        a.dom().click()
                    }, ok: b.ok().element(), cancel: b.cancel().element()
                });
                a = ha.dialog(a.element(), c, b);
                return {enter: a.enter, exit: a.exit, destroy: a.destroy}
            }, button: function (a) {
                return (Fa.is(a, ".ephox-pastry-button") ? g.some(a) : L.descendant(a, ".ephox-pastry-button")).bind(KN)
            }, click: KN, radio: function (a, b, c) {
                b = {item: h(b), selected: h(c)};
                return ha.radio(a, b, Ba.radio({
                    one: function (a, b) {
                        b.dom().click()
                    }
                }))
            }
        }, aX = {
            previewAsset: function (a, b) {
                Qc.cata(a, yb("asset should not be a file type"), function (a, d, e) {
                    n.add(b, Sb.resolve("fluid-image"));
                    m.set(b, "src", d)
                })
            }
        }, fA = aa.detect(), Sg = O("heading",
        "renderer"), or = {left: h("left"), top: h("top")}, Wda = ["image"], Xda = function (a, b, c) {
            return Xa(Wda, function (a) {
                return xa(b.getType()) && -1 < b.getType().indexOf(a)
            })
        }, kX = {
            validate: function (a) {
                a = hb(a, function (a, c) {
                    return !1 === Qc.cata(c, Xda, h(!0)) ? {assets: a.assets, failure: !0} : {
                        assets: a.assets.concat([c]),
                        failure: a.failure
                    }
                }, {assets: [], failure: !1});
                return {assets: h(a.assets), failure: h(a.failure)}
            }
        }, Re = {
            multiple: function (a) {
                return ve.multiple(a)
            }, single: function (a) {
                return ve.single(a)
            }, singleWithUrl: function (a,
                                        b) {
                return ve.singleWithUrl(a, b)
            }
        },
        dw = [0, .01, .02, .04, .05, .06, .07, .08, .1, .11, .12, .14, .15, .16, .17, .18, .2, .21, .22, .24, .25, .27, .28, .3, .32, .34, .36, .38, .4, .42, .44, .46, .48, .5, .53, .56, .59, .62, .65, .68, .71, .74, .77, .8, .83, .86, .89, .92, .95, .98, 1, 1.06, 1.12, 1.18, 1.24, 1.3, 1.36, 1.42, 1.48, 1.54, 1.6, 1.66, 1.72, 1.78, 1.84, 1.9, 1.96, 2, 2.12, 2.25, 2.37, 2.5, 2.62, 2.75, 2.87, 3, 3.2, 3.4, 3.6, 3.8, 4, 4.3, 4.7, 4.9, 5, 5.5, 6, 6.5, 6.8, 7, 7.3, 7.5, 7.8, 8, 8.4, 8.7, 9, 9.4, 9.6, 9.8, 10],
        of = {
            identity: function () {
                return [1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0,
                    1, 0, 0, 0, 0, 0, 1]
            }, adjust: pr, multiply: Tf, adjustContrast: function (a, b) {
                b = ge(b, -1, 1);
                b *= 100;
                if (0 > b) var c = 127 + b / 100 * 127; else c = b % 1, c = 0 === c ? dw[b] : dw[Math.floor(b)] * (1 - c) + dw[Math.floor(b) + 1] * c, c = 127 * c + 127;
                return Tf(a, [c / 127, 0, 0, 0, .5 * (127 - c), 0, c / 127, 0, 0, .5 * (127 - c), 0, 0, c / 127, 0, .5 * (127 - c), 0, 0, 0, 1, 0, 0, 0, 0, 0, 1])
            }, adjustBrightness: function (a, b) {
                b = ge(255 * b, -255, 255);
                return Tf(a, [1, 0, 0, 0, b, 0, 1, 0, 0, b, 0, 0, 1, 0, b, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1])
            }, adjustSaturation: function (a, b) {
                b = ge(b, -1, 1);
                b = 1 + (0 < b ? 3 * b : b);
                return Tf(a, [.3086 * (1 -
                    b) + b, .6094 * (1 - b), .082 * (1 - b), 0, 0, .3086 * (1 - b), .6094 * (1 - b) + b, .082 * (1 - b), 0, 0, .3086 * (1 - b), .6094 * (1 - b), .082 * (1 - b) + b, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1])
            }, adjustHue: function (a, b) {
                b = ge(b, -180, 180) / 180 * Math.PI;
                var c = Math.cos(b);
                b = Math.sin(b);
                return Tf(a, [.213 + .787 * c + -.213 * b, .715 + -.715 * c + -.715 * b, .072 + -.072 * c + .928 * b, 0, 0, .213 + -.213 * c + .143 * b, .715 + c * (1 - .715) + .14 * b, .072 + -.072 * c + -.283 * b, 0, 0, .213 + -.213 * c + -.787 * b, .715 + -.715 * c + .715 * b, .072 + .928 * c + .072 * b, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1])
            }, adjustColors: function (a, b, c, d) {
                b = ge(b, 0, 2);
                c = ge(c,
                    0, 2);
                d = ge(d, 0, 2);
                return Tf(a, [b, 0, 0, 0, 0, 0, c, 0, 0, 0, 0, 0, d, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1])
            }, adjustSepia: function (a, b) {
                b = ge(b, 0, 1);
                return Tf(a, pr([.393, .769, .189, 0, 0, .349, .686, .168, 0, 0, .272, .534, .131, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1], b))
            }, adjustGrayscale: function (a, b) {
                b = ge(b, 0, 1);
                return Tf(a, pr([.33, .34, .33, 0, 0, .33, .34, .33, 0, 0, .33, .34, .33, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1], b))
            }
        }, Wd = {
            invert: function (a) {
                return function (b) {
                    return xm(b, a)
                }
            }([-1, 0, 0, 0, 255, 0, -1, 0, 0, 255, 0, 0, -1, 0, 255, 0, 0, 0, 1, 0]),
            brightness: Mh(of.adjustBrightness),
            hue: Mh(of.adjustHue),
            saturate: Mh(of.adjustSaturation),
            contrast: Mh(of.adjustContrast),
            grayscale: Mh(of.adjustGrayscale),
            sepia: Mh(of.adjustSepia),
            colorize: function (a, b, c, d) {
                return xm(a, of.adjustColors(of.identity(), b, c, d))
            },
            sharpen: mA([0, -1, 0, -1, 5, -1, 0, -1, 0]),
            emboss: mA([-2, -1, 0, -1, 1, 1, 0, 1, 2]),
            gamma: lA(function (a, b) {
                return 255 * Math.pow(a / 255, 1 - b)
            }),
            exposure: lA(function (a, b) {
                return 255 * (1 - Math.exp(-(a / 255) * b))
            }),
            colorFilter: xm,
            convoluteFilter: kA
        }, Yda = {scale: nA}, Fp = {
            rotate: function (a, b) {
                return a.toCanvas().then(function (c) {
                    var d =
                        a.getType(), e = b, f = Uc.create(c.width, c.height), k = Uc.get2dContext(f), g = 0, h = 0;
                    e = 0 > e ? 360 + e : e;
                    90 != e && 270 != e || Uc.resize(f, f.height, f.width);
                    if (90 == e || 180 == e) g = f.width;
                    if (270 == e || 180 == e) h = f.height;
                    k.translate(g, h);
                    k.rotate(e * Math.PI / 180);
                    k.drawImage(c, 0, 0);
                    return xe.fromCanvas(f, d)
                })
            }, flip: function (a, b) {
                return a.toCanvas().then(function (c) {
                    var d = a.getType(), e = Uc.create(c.width, c.height), f = Uc.get2dContext(e);
                    "v" == b ? (f.scale(1, -1), f.drawImage(c, 0, -e.height)) : (f.scale(-1, 1), f.drawImage(c, -e.width, 0));
                    return xe.fromCanvas(e,
                        d)
                })
            }, crop: function (a, b, c, d, e) {
                return a.toCanvas().then(function (f) {
                    var k = a.getType(), g = Uc.create(d, e);
                    Uc.get2dContext(g).drawImage(f, -b, -c);
                    return xe.fromCanvas(g, k)
                })
            }, resize: function (a, b, c) {
                return a.toCanvas().then(function (d) {
                    return Yda.scale(d, b, c).then(function (b) {
                        return xe.fromCanvas(b, a.getType())
                    })
                })
            }
        }, LN = function () {
            function a(a) {
                this.littleEndian = !1;
                this._dv = new DataView(a)
            }

            a.prototype.readByteAt = function (a) {
                return this._dv.getUint8(a)
            };
            a.prototype.read = function (a, c) {
                if (a + c > this.length()) return null;
                for (var b = this.littleEndian ? 0 : -8 * (c - 1), e = 0, f = 0; e < c; e++) f |= this.readByteAt(a + e) << Math.abs(b + 8 * e);
                return f
            };
            a.prototype.BYTE = function (a) {
                return this.read(a, 1)
            };
            a.prototype.SHORT = function (a) {
                return this.read(a, 2)
            };
            a.prototype.LONG = function (a) {
                return this.read(a, 4)
            };
            a.prototype.SLONG = function (a) {
                a = this.read(a, 4);
                return 2147483647 < a ? a - 4294967296 : a
            };
            a.prototype.CHAR = function (a) {
                return String.fromCharCode(this.read(a, 1))
            };
            a.prototype.STRING = function (a, c) {
                return this.asArray("CHAR", a, c).join("")
            };
            a.prototype.SEGMENT =
                function (a, c) {
                    var b = this._dv.buffer;
                    switch (arguments.length) {
                        case 2:
                            return b.slice(a, a + c);
                        case 1:
                            return b.slice(a);
                        default:
                            return b
                    }
                };
            a.prototype.asArray = function (a, c, d) {
                for (var b = [], f = 0; f < d; f++) b[f] = this[a](c + f);
                return b
            };
            a.prototype.length = function () {
                return this._dv ? this._dv.byteLength : 0
            };
            return a
        }(), Zda = {
            274: "Orientation",
            270: "ImageDescription",
            271: "Make",
            272: "Model",
            305: "Software",
            34665: "ExifIFDPointer",
            34853: "GPSInfoIFDPointer"
        }, $da = {
            36864: "ExifVersion",
            40961: "ColorSpace",
            40962: "PixelXDimension",
            40963: "PixelYDimension",
            36867: "DateTimeOriginal",
            33434: "ExposureTime",
            33437: "FNumber",
            34855: "ISOSpeedRatings",
            37377: "ShutterSpeedValue",
            37378: "ApertureValue",
            37383: "MeteringMode",
            37384: "LightSource",
            37385: "Flash",
            37386: "FocalLength",
            41986: "ExposureMode",
            41987: "WhiteBalance",
            41990: "SceneCaptureType",
            41988: "DigitalZoomRatio",
            41992: "Contrast",
            41993: "Saturation",
            41994: "Sharpness"
        }, aea = {0: "GPSVersionID", 1: "GPSLatitudeRef", 2: "GPSLatitude", 3: "GPSLongitudeRef", 4: "GPSLongitude"},
        bea = {
            513: "JPEGInterchangeFormat",
            514: "JPEGInterchangeFormatLength"
        }, MN = {
            ColorSpace: {1: "sRGB", 0: "Uncalibrated"},
            MeteringMode: {
                0: "Unknown",
                1: "Average",
                2: "CenterWeightedAverage",
                3: "Spot",
                4: "MultiSpot",
                5: "Pattern",
                6: "Partial",
                255: "Other"
            },
            LightSource: {
                1: "Daylight",
                2: "Fliorescent",
                3: "Tungsten",
                4: "Flash",
                9: "Fine weather",
                10: "Cloudy weather",
                11: "Shade",
                12: "Daylight fluorescent (D 5700 - 7100K)",
                13: "Day white fluorescent (N 4600 -5400K)",
                14: "Cool white fluorescent (W 3900 - 4500K)",
                15: "White fluorescent (WW 3200 - 3700K)",
                17: "Standard light A",
                18: "Standard light B",
                19: "Standard light C",
                20: "D55",
                21: "D65",
                22: "D75",
                23: "D50",
                24: "ISO studio tungsten",
                255: "Other"
            },
            Flash: {
                0: "Flash did not fire",
                1: "Flash fired",
                5: "Strobe return light not detected",
                7: "Strobe return light detected",
                9: "Flash fired, compulsory flash mode",
                13: "Flash fired, compulsory flash mode, return light not detected",
                15: "Flash fired, compulsory flash mode, return light detected",
                16: "Flash did not fire, compulsory flash mode",
                24: "Flash did not fire, auto mode",
                25: "Flash fired, auto mode",
                29: "Flash fired, auto mode, return light not detected",
                31: "Flash fired, auto mode, return light detected",
                32: "No flash function",
                65: "Flash fired, red-eye reduction mode",
                69: "Flash fired, red-eye reduction mode, return light not detected",
                71: "Flash fired, red-eye reduction mode, return light detected",
                73: "Flash fired, compulsory flash mode, red-eye reduction mode",
                77: "Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",
                79: "Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",
                89: "Flash fired, auto mode, red-eye reduction mode",
                93: "Flash fired, auto mode, return light not detected, red-eye reduction mode",
                95: "Flash fired, auto mode, return light detected, red-eye reduction mode"
            },
            ExposureMode: {0: "Auto exposure", 1: "Manual exposure", 2: "Auto bracket"},
            WhiteBalance: {0: "Auto white balance", 1: "Manual white balance"},
            SceneCaptureType: {0: "Standard", 1: "Landscape", 2: "Portrait", 3: "Night scene"},
            Contrast: {0: "Normal", 1: "Soft", 2: "Hard"},
            Saturation: {0: "Normal", 1: "Low saturation", 2: "High saturation"},
            Sharpness: {0: "Normal", 1: "Soft", 2: "Hard"},
            GPSLatitudeRef: {N: "North latitude", S: "South latitude"},
            GPSLongitudeRef: {E: "East longitude", W: "West longitude"}
        }, cea = function () {
            function a(a) {
                this._offsets = {tiffHeader: 10, IFD0: null, IFD1: null, exifIFD: null, gpsIFD: null};
                this._tiffTags = {};
                this._reader = new LN(a);
                this._idx = this._offsets.tiffHeader;
                if (65505 !== this.SHORT(0) || "EXIF\x00" !== this.STRING(4, 5).toUpperCase()) throw Error("Exif data cannot be read or not available.");
                this._reader.littleEndian = 18761 == this.SHORT(this._idx);
                if (42 !== this.SHORT(this._idx += 2)) throw Error("Invalid Exif data.");
                this._offsets.IFD0 = this._offsets.tiffHeader + this.LONG(this._idx += 2);
                this._tiffTags = this.extractTags(this._offsets.IFD0, Zda);
                "ExifIFDPointer" in this._tiffTags && (this._offsets.exifIFD = this._offsets.tiffHeader + this._tiffTags.ExifIFDPointer, delete this._tiffTags.ExifIFDPointer);
                "GPSInfoIFDPointer" in this._tiffTags && (this._offsets.gpsIFD = this._offsets.tiffHeader + this._tiffTags.GPSInfoIFDPointer, delete this._tiffTags.GPSInfoIFDPointer);
                if (a = this.LONG(this._offsets.IFD0 + 12 * this.SHORT(this._offsets.IFD0) + 2)) this._offsets.IFD1 = this._offsets.tiffHeader + a
            }

            a.prototype.BYTE = function (a) {
                return this._reader.BYTE(a)
            };
            a.prototype.SHORT = function (a) {
                return this._reader.SHORT(a)
            };
            a.prototype.LONG = function (a) {
                return this._reader.LONG(a)
            };
            a.prototype.SLONG = function (a) {
                return this._reader.SLONG(a)
            };
            a.prototype.CHAR = function (a) {
                return this._reader.CHAR(a)
            };
            a.prototype.STRING = function (a, c) {
                return this._reader.STRING(a, c)
            };
            a.prototype.SEGMENT = function (a,
                                            c) {
                return this._reader.SEGMENT(a, c)
            };
            a.prototype.asArray = function (a, c, d) {
                for (var b = [], f = 0; f < d; f++) b[f] = this[a](c + f);
                return b
            };
            a.prototype.length = function () {
                return this._reader.length()
            };
            a.prototype.UNDEFINED = function () {
                return this.BYTE.apply(this, arguments)
            };
            a.prototype.RATIONAL = function (a) {
                return this.LONG(a) / this.LONG(a + 4)
            };
            a.prototype.SRATIONAL = function (a) {
                return this.SLONG(a) / this.SLONG(a + 4)
            };
            a.prototype.ASCII = function (a) {
                return this.CHAR(a)
            };
            a.prototype.TIFF = function () {
                return this._tiffTags
            };
            a.prototype.EXIF = function () {
                var a = null;
                if (this._offsets.exifIFD) {
                    try {
                        a = this.extractTags(this._offsets.exifIFD, $da)
                    } catch (e) {
                        return null
                    }
                    if (a.ExifVersion && Array.isArray(a.ExifVersion)) {
                        for (var c = 0, d = ""; c < a.ExifVersion.length; c++) d += String.fromCharCode(a.ExifVersion[c]);
                        a.ExifVersion = d
                    }
                }
                return a
            };
            a.prototype.GPS = function () {
                var a = null;
                if (this._offsets.gpsIFD) {
                    try {
                        a = this.extractTags(this._offsets.gpsIFD, aea)
                    } catch (c) {
                        return null
                    }
                    a.GPSVersionID && Array.isArray(a.GPSVersionID) && (a.GPSVersionID = a.GPSVersionID.join("."))
                }
                return a
            };
            a.prototype.thumb = function () {
                if (this._offsets.IFD1) try {
                    var a = this.extractTags(this._offsets.IFD1, bea);
                    if ("JPEGInterchangeFormat" in a) return this.SEGMENT(this._offsets.tiffHeader + a.JPEGInterchangeFormat, a.JPEGInterchangeFormatLength)
                } catch (c) {
                }
                return null
            };
            a.prototype.extractTags = function (a, c) {
                var b, e = {}, f = {
                    1: "BYTE",
                    7: "UNDEFINED",
                    2: "ASCII",
                    3: "SHORT",
                    4: "LONG",
                    5: "RATIONAL",
                    9: "SLONG",
                    10: "SRATIONAL"
                }, k = {BYTE: 1, UNDEFINED: 1, ASCII: 1, SHORT: 2, LONG: 4, RATIONAL: 8, SLONG: 4, SRATIONAL: 8};
                var g = this.SHORT(a);
                for (b =
                         0; b < g; b++) {
                    var h = a + 2 + 12 * b;
                    var m = c[this.SHORT(h)];
                    if (void 0 !== m) {
                        var w = f[this.SHORT(h += 2)];
                        var n = this.LONG(h += 2);
                        var p = k[w];
                        if (!p) throw Error("Invalid Exif data.");
                        h += 4;
                        4 < p * n && (h = this.LONG(h) + this._offsets.tiffHeader);
                        if (h + p * n >= this.length()) throw Error("Invalid Exif data.");
                        "ASCII" === w ? e[m] = this.STRING(h, n).replace(/\0$/, "").trim() : (w = this.asArray(w, h, n), n = 1 == n ? w[0] : w, MN.hasOwnProperty(m) && "object" != typeof n ? e[m] = MN[m][n] : e[m] = n)
                    }
                }
                return e
            };
            return a
        }(), dea = function (a) {
            var b = [], c;
            for (c = 2; c <= a.length();) {
                var d =
                    a.SHORT(c);
                if (65488 <= d && 65495 >= d) c += 2; else {
                    if (65498 === d || 65497 === d) break;
                    var e = a.SHORT(c + 2) + 2;
                    65505 <= d && 65519 >= d && b.push({
                        hex: d,
                        name: "APP" + (d & 15),
                        start: c,
                        length: e,
                        segment: a.SEGMENT(c, e)
                    });
                    c += e
                }
            }
            return b
        }, eea = function (a) {
            return jd.blobToArrayBuffer(a).then(function (b) {
                try {
                    var c = new LN(b);
                    if (65496 === c.SHORT(0)) {
                        var d = dea(c), e = d.filter(function (a) {
                            return "APP1" === a.name
                        });
                        b = {};
                        if (e.length) {
                            var f = new cea(e[0].segment);
                            b = {tiff: f.TIFF(), exif: f.EXIF(), gps: f.GPS(), thumb: f.thumb()}
                        } else return Md.reject("Headers did not include required information");
                        b.rawHeaders = d;
                        return b
                    }
                    return Md.reject("Image was not a jpeg")
                } catch (k) {
                    return Md.reject("Unsupported format or not an image: " + a.type + " (Exception: " + k.message + ")")
                }
            })
        }, Gp = function (a, b) {
            return Fp.rotate(a, b)
        }, Ti = {
            invert: function (a) {
                return Wd.invert(a)
            }, sharpen: function (a) {
                return Wd.sharpen(a)
            }, emboss: function (a) {
                return Wd.emboss(a)
            }, brightness: function (a, b) {
                return Wd.brightness(a, b)
            }, hue: function (a, b) {
                return Wd.hue(a, b)
            }, saturate: function (a, b) {
                return Wd.saturate(a, b)
            }, contrast: function (a, b) {
                return Wd.contrast(a,
                    b)
            }, grayscale: function (a, b) {
                return Wd.grayscale(a, b)
            }, sepia: function (a, b) {
                return Wd.sepia(a, b)
            }, colorize: function (a, b, c, d) {
                return Wd.colorize(a, b, c, d)
            }, gamma: function (a, b) {
                return Wd.gamma(a, b)
            }, exposure: function (a, b) {
                return Wd.exposure(a, b)
            }, flip: function (a, b) {
                return Fp.flip(a, b)
            }, crop: function (a, b, c, d, e) {
                return Fp.crop(a, b, c, d, e)
            }, resize: function (a, b, c) {
                return Fp.resize(a, b, c)
            }, rotate: Gp, exifRotate: function (a) {
                return a.toBlob().then(eea).then(function (b) {
                    switch (b.tiff.Orientation) {
                        case 6:
                            return Gp(a,
                                90);
                        case 3:
                            return Gp(a, 180);
                        case 8:
                            return Gp(a, 270);
                        default:
                            return a
                    }
                }, function () {
                    return a
                })
            }
        }, nl = function (a) {
            return function (b) {
                return Yc.blobToImageResult(b).then(function (b) {
                    return a(b)
                }).then(Yc.imageResultToOriginalBlob)
            }
        }, NN = function (a) {
            return nl(function (b) {
                return Ti.rotate(b, a)
            })
        }, ON = function (a) {
            return nl(function (b) {
                return Ti.flip(b, a)
            })
        }, fea = function (a) {
            return nl(function (b) {
                return Ti.resize(b, a.width(), a.height())
            })
        }, gea = Ua.pToFR(nl(Ti.sharpen)), hea = Ua.pToFR(NN(-90)), iea = Ua.pToFR(NN(90)),
        jea = Ua.pToFR(ON("v")), kea = Ua.pToFR(ON("h")), Wg = {
            rotateLeft: hea,
            rotateRight: iea,
            flipVertical: jea,
            flipHorizontal: kea,
            sharpen: gea,
            crop: function (a, b, c, d) {
                return Ua.pToFR(nl(function (e) {
                    return Ti.crop(e, a, b, c, d)
                }))
            },
            resizeTo: function (a) {
                return Ua.pToFR(fea(a))
            },
            doExifRotate: function (a) {
                return Ua.fromPromise(Ti.exifRotate(a))
            }
        }, PN = {
            mapIfSet: function (a, b) {
                return Ua.map(a, function (a) {
                    return a.map(b)
                })
            }, applyIfSet: function (a) {
                return function (b) {
                    return Ua.bind(a, function (a) {
                        return a.fold(function () {
                                return Ua.pure(b)
                            },
                            function (a) {
                                return a(b)
                            })
                    })
                }
            }
        }, Rj = {
            partition: function (a) {
                var b = [], c = [];
                z(a, function (a) {
                    a.fold(function (a) {
                        b.push(a)
                    }, function (a) {
                        c.push(a)
                    })
                });
                return {errors: b, values: c}
            }
        }, Hp = O("width", "height"), QN = ta.generate([{special: ["size"]}, {regular: ["value", "size", "unit"]}]), Ip = {
            identify: function (a) {
                a = a.match(/(\d*\.?\d*)(.*)/);
                return "" !== a[1] ? QN.regular(a[0], Number(a[1]), a[2]) : QN.special(a[0])
            }
        }, lea = function (a, b) {
            return v.getRaw(a, b).orThunk(function () {
                return m.has(a, b) ? g.some(m.get(a, b)) : g.none()
            }).bind(function (a) {
                return Ip.identify(a).fold(function (a) {
                        return g.none()
                    },
                    function (a, b, c) {
                        switch (c) {
                            case "":
                            case "px":
                                return g.some(parseInt(b, 10));
                            default:
                                return g.none()
                        }
                    })
            })
        }, ew = function (a, b, c) {
            b = b(a);
            return 0 < b ? g.some(b) : lea(a, c)
        }, mea = {
            get: function (a) {
                return ew(a, Ia.get, "width").bind(function (b) {
                    return ew(a, sa.get, "height").map(function (a) {
                        return Hp(b, a)
                    })
                })
            }, measure: ew
        }, RN = function (a, b) {
            a = b / a;
            return 1 > a ? a : 1
        }, nea = function (a, b) {
            var c = RN(a.height, b.height);
            return 1 === c ? a : {width: a.width * c, height: b.height}
        }, oea = function (a, b) {
            var c = RN(a.width, b.width);
            return 1 === c ? a : {
                width: b.width,
                height: a.height * c
            }
        }, pea = {
            max: function (a, b) {
                var c = 0 < b.height ? b.height : 0;
                b = 0 < b.width ? b.width : 0;
                if (!(a.height > c || a.width > b) || c === b && 0 === c) return a;
                c = {width: b, height: c};
                b = a.width > a.height;
                var d = 0 < c.height, e = (d ? a.height / c.height : 0) > (0 < c.width ? a.width / c.width : 0);
                return (c.width === c.height && b || !d || !e ? oea : nea)(a, c)
            }
        }, qea = function (a) {
            var b = dg.createObjectURL(a);
            return Ua.map(rp.load(b), function (a) {
                a = SN(a);
                dg.revokeObjectURL(b);
                return a
            })
        }, SN = function (a) {
            return Hp(a.dom().naturalWidth, a.dom().naturalHeight)
        },
        rea = function (a) {
            var b = SN(a);
            return mea.get(a).filter(function (a) {
                return a.width() !== b.width() || a.height() !== b.height()
            })
        }, vr = {
            restrain: function (a) {
                var b = a.width(), c = a.height(), d = function (a) {
                    var d = pea.max({width: a.width(), height: a.height()}, {width: b, height: c});
                    return a.height() > c || a.width() > b ? g.some(Hp(d.width, d.height)) : g.none()
                };
                return function (a) {
                    a = qea(a);
                    return Ua.map(a, d)
                }
            }, changedBounds: function (a) {
                return Ua.map(rp.loadIfNeeded(a), rea)
            }
        }, sea = function (a) {
            a = PN.mapIfSet(a, Wg.resizeTo);
            return PN.applyIfSet(a)
        },
        TN = function (a, b, c) {
            return Ua.fromChain([sea(a), c])(b)
        }, Fj = {
            instance: function (a) {
                var b = vr.restrain(a);
                return function (a) {
                    return Qc.cata(a, function (c, e, f) {
                        c = Ua.fromPromise(Yc.imageResultToOriginalBlob(e));
                        return Ua.bind(c, function (c) {
                            var d = b(c);
                            return TN(d, c, function (b) {
                                if (b === c) return Ua.pure(a);
                                dg.revokeObjectURL(f);
                                return Ua.fromFuture(Re.single(b))
                            })
                        })
                    }, function () {
                        return Ua.pure(a)
                    })
                }
            }, processResults: function (a) {
                return function (b) {
                    b = Rj.partition(b);
                    0 < b.errors.length && (a("imageedit.generic"), console.error("Image resample errors: ",
                        b.errors));
                    return b.values
                }
            }, resampleAction: TN
        }, oA = {
            maybeDoRotate: function (a) {
                return Ce(a, function (a) {
                    return a.fold(function (a) {
                        return Ua.error(a)
                    }, function (a) {
                        return Qc.cata(a, function (b, c, f) {
                            b = Wg.doExifRotate(c);
                            return Ua.bind(b, function (b) {
                                if (b === c) return Ua.pure(a);
                                b = Ua.fromPromise(Yc.imageResultToOriginalBlob(b));
                                return Ua.bind(b, function (a) {
                                    URL.revokeObjectURL(f);
                                    return Ua.fromFuture(Re.single(a))
                                })
                            })
                        }, function () {
                            return Ua.pure(a)
                        })
                    })
                })
            }
        }, UN = B.resolve("find-match"), VN = B.resolve("find-mark"),
        fw = "." + UN + ", ." + VN, Od = {
            configure: function (a) {
                a.addSelector(a.output(), fw, Na.unwrap);
                a.addSelector(a.history(), fw, Na.unwrap);
                a.addSelector(a.internal(), fw, Na.unwrap)
            }, matchClass: h(UN), markClass: h(VN), findIdAttr: h("data-ephox-find-id"), shiftKeyState: function (a) {
                return {isShift: h(a)}
            }
        }, Jp = {
            created: function (a) {
                return {
                    fold: function (b, c) {
                        return c(a)
                    }
                }
            }, preserved: function (a) {
                return {
                    fold: function (b, c) {
                        return b(a)
                    }
                }
            }
        }, tea = O("id", "match", "current"), gw = {resolve: Lb.create("data.ephox.cram").resolve},
        hw = {resolve: Lb.create("ephox-cram").resolve},
        WN = gw.resolve("highlight-id"), uea = hw.resolve("highlight-wrap"), XN = function (a, b) {
            return L.closest(a, "." + b)
        }, YN = function (a) {
            return g.from(m.get(a, WN))
        }, zg = {
            marker: XN, idMarker: function (a) {
                return XN(a, uea)
            }, id: YN, set: function (a, b) {
                m.set(a, WN, b);
                n.add(a, b)
            }, all: function (a) {
                return YN(a).fold(h([a]), function (b) {
                    var c = A.owner(a);
                    return Y.descendants(c, "." + b)
                })
            }
        }, iw = O("word", "pattern"), vea = {
            separate: function (a, b, c) {
                var d = ia(c, function (a) {
                    return [a.start(), a.finish()]
                }), e = Rd.splits(b, d, function (b, c) {
                    return qH.subdivide(a,
                        b.element(), c)
                });
                return E(c, function (b) {
                    var c = Rd.sublist(e, b.start(), b.finish());
                    c = E(c, function (a) {
                        return a.element()
                    });
                    var d = E(c, a.property().getText).join("");
                    return {elements: h(c), word: b.word, exact: h(d)}
                })
            }
        }, wea = function (a, b) {
            return Rd.generate(b, function (b, d) {
                var c = d + a.property().getText(b).length;
                return g.from(W.range(b, d, c))
            })
        }, jw = function (a, b, c, d) {
            b = rH.group(a, b, d);
            return ia(b, function (b) {
                b = nn.justText(b);
                var d = E(b, a.property().getText).join("");
                d = Mo.findmany(d, c);
                b = wea(a, b);
                return vea.separate(a,
                    b, d)
            })
        }, kw = {
            safeWords: function (a, b, c, d) {
                c = E(c, function (a) {
                    var b = Cb.safeword(a);
                    return iw(a, b)
                });
                return jw(a, b, c, d)
            }, safeToken: function (a, b, c, d) {
                c = iw(c, Cb.safetoken(c));
                return jw(a, b, [c], d)
            }, run: jw
        }, lw = {
            safeWords: function (a, b, c, d) {
                return kw.safeWords(a, b, c, d)
            }, safeToken: function (a, b, c, d) {
                return kw.safeToken(a, b, c, d)
            }, run: function (a, b, c, d) {
                return kw.run(a, b, c, d)
            }
        }, mw = nb(), Kp = {
            safeWords: function (a, b, c) {
                return lw.safeWords(mw, a, b, c)
            }, safeToken: function (a, b, c) {
                return lw.safeToken(mw, a, b, c)
            }, run: function (a,
                              b, c) {
                return lw.run(mw, a, b, c)
            }
        }, xea = function (a, b) {
            var c = ia(a.elements(), function (a) {
                return zg.marker(a, b).fold(h([]), function (a) {
                    return [a]
                })
            }), d = Ha("ephox-cram");
            return tea(d, a, g.from(c[0]))
        }, ol = {
            matchWords: function (a, b, c) {
                return Kp.safeWords(a, b, c)
            }, matchToken: function (a, b, c) {
                return Kp.safeToken(a, b, c)
            }, matchPattern: function (a, b, c) {
                return Kp.run(a, [b], c)
            }, annotates: function (a, b) {
                return E(a, function (a) {
                    return xea(a, b)
                })
            }
        }, ZN = function (a, b, c, d) {
            b = ol.annotates(d, c.label());
            return ia(b, function (b) {
                return b.current().fold(function () {
                    var d =
                        b.match();
                    if (a.ignore(d)) return [];
                    d = wi.wrapper(d.elements(), c.nu) || [];
                    z(d, u(c.tag, b));
                    return [Jp.created(d)]
                }, function (a) {
                    return [Jp.preserved(a)]
                })
            })
        }, yea = {
            highlight: function (a, b, c, d) {
                c = ol.matchToken(b, c, a.optimise);
                return ZN(a, b, d, c)
            }, highlightPattern: function (a, b, c, d) {
                c = ol.matchPattern(b, c, a.optimise);
                return ZN(a, b, d, c)
            }
        }, zea = function (a, b) {
            return D.isElement(b) && pa.isBlock(b) ? 0 > Vb.get(b).toLowerCase().indexOf(a) : !1
        }, Aea = function (a) {
            return {ignore: h(!1), optimise: u(zea, a.toLowerCase())}
        }, Lp = h("." + Od.matchClass()),
        Bea = {
            label: Od.matchClass, tag: function (a, b) {
                n.add(b, Od.matchClass());
                m.set(b, Od.findIdAttr(), a.id())
            }, nu: function () {
                var a = r.fromTag("span");
                return {element: h(a), wrap: u(y.append, a)}
            }
        }, $N = function (a) {
            z(a, function (a) {
                n.add(a, Od.markClass())
            })
        }, Cea = function (a) {
            z(a, function (a) {
                n.remove(a, Od.markClass())
            })
        }, nw = function (a, b) {
            a = hm(Y.descendants(a, b), function (a) {
                return m.get(a, Od.findIdAttr())
            });
            return 0 === a.length ? g.none() : g.some(a)
        }, aO = function (a, b) {
            b = Cb.custom(Cb.sanitise(a), h(0), h(0), b);
            return iw(a, b)
        },
        ow = function (a, b, c) {
            return nw(a, Lp()).map(function (d) {
                var e = ka(d, function (a) {
                    return n.has(a[0], Od.markClass())
                }), f = Va(d, function (a) {
                    return U(e, a)
                }).getOr(-1);
                return {pos: c(d, Qb(e), f, b(f, d.length)), all: nw(a, Lp())}
            })
        }, pw = function (a, b, c, d) {
            Cea(b);
            $N(a[d]);
            return d
        }, bO = function (a, b) {
            return a === b - 1 ? 0 : a + 1
        }, Dea = function (a, b) {
            return 0 === a ? b - 1 : a - 1
        }, cO = function (a, b) {
            return ow(a, bO, function (a, d, e, f) {
                pw(a, d, e, f);
                y.before(d[0], r.fromText(b));
                z(d, F.remove);
                return 0 === f ? f : e
            })
        }, pf = {
            search: function (a, b, c) {
                if (0 === b.length) return g.none();
                var d = Aea(b), e = A.children(a);
                b = !0 === c ? aO(b, g.none()) : aO(b, g.some("gi"));
                yea.highlightPattern(d, e, b, Bea);
                return nw(a, Lp()).map(function (a) {
                    $N(a[0]);
                    return {all: g.some(a), pos: 0}
                })
            }, clear: function (a) {
                a = Y.descendants(a, Lp());
                z(a, F.unwrap);
                return g.none()
            }, next: function (a) {
                return ow(a, bO, pw)
            }, prev: function (a) {
                return ow(a, Dea, pw)
            }, replace: cO, replaceAll: function (a, b) {
                for (; cO(a, b).isSome();) ;
                return g.none()
            }
        }, rA = aa.detect().deviceType.isiOS(), qw = function (a, b, c) {
            a = a();
            var d = a.element();
            ma.add(d, b);
            S.button(d,
                c);
            m.set(d, "tabindex", "-1");
            a.events.click.bind(function () {
                Z.focus(d)
            });
            return a
        }, rw = function (a, b) {
            a = qw(Oc, a, b);
            m.set(a.element(), "title", b);
            return a
        }, dO = function (a, b) {
            var c = B.resolve("inline-main-button");
            a = a.concat([c]);
            a = qw(Oc, a, b);
            a.content(Rc(b));
            return a
        }, eO = function (a, b, c) {
            var d = B.resolve("inline-main-button-toggle");
            a = a.concat([d]);
            c = qw($d, a, c);
            m.set(c.element(), "title", b);
            return c
        }, sw = function (a, b, c) {
            var d = r.fromTag("input");
            ma.add(d, a);
            m.set(d, "placeholder", b);
            S.label(d, c);
            return {
                element: h(d),
                destroy: u(F.remove, d)
            }
        }, ym = {
            counter: function (a) {
                var b = T.div(), c = T.span();
                n.add(b, B.resolve("search-widget-counter"));
                n.add(c, B.resolve("search-widget-counter-text"));
                y.append(b, c);
                return {
                    element: h(b), update: function (a, b) {
                        a = x.translate("units.amount-of-total", a, b);
                        F.empty(c);
                        y.append(c, r.fromText(a));
                        sc.isVisible(c) && ib.speak(ja.body(), a)
                    }, hide: function () {
                        v.set(b, "display", "none")
                    }, show: function () {
                        v.remove(b, "display")
                    }, destroy: function () {
                        F.remove(c);
                        F.remove(b)
                    }
                }
            }, dummyCounter: function (a) {
                a = T.div();
                n.add(a, B.resolve("search-widget-counter"));
                return {element: h(a), update: t, hide: t, show: t, destroy: u(F.remove, a)}
            }, searchField: function () {
                var a = T.span(),
                    b = rw([B.resolve("stepper-button"), B.resolve("search-widget-previous")], x.translate("search.previous")),
                    c = rw([B.resolve("stepper-button"), B.resolve("search-widget-next")], x.translate("search.next")),
                    d = eO([B.resolve("search-widget-more")], x.translate("aria.label.more"), x.translate("aria.label.more"));
                n.add(a, B.resolve("search-widget-searchField"));
                var e =
                        sw([B.resolve("search-widget-input"), B.resolve("search-widget-input-search")].concat(xc.isSmallTouch() ? [B.resolve("search-widget-small-touch")] : []), x.translate("search.search"), x.translate("search.field.search")),
                    f = H.create({
                        next: Q([], c.events.click),
                        previous: Q([], b.events.click),
                        more: Q([], d.events.click),
                        input: p(["raw"])
                    }), k = K.bind(e.element(), "input", f.trigger.input);
                P.append(a, [e.element(), b.element(), c.element(), d.element()]);
                return {
                    events: f.registry, element: h(a), input: e.element, focus: function () {
                        Z.focus(e.element())
                    },
                    previous: b.element, next: c.element, moreToggle: d, destroy: function () {
                        k.unbind();
                        e.destroy();
                        b.destroy();
                        c.destroy();
                        d.destroy()
                    }
                }
            }, replaceDrawer: function () {
                var a = sw([B.resolve("search-widget-input"), B.resolve("search-widget-input-replace")], x.translate("search.replace"), x.translate("search.field.replace")),
                    b = eO([B.resolve("search-widget-matchcase")], x.translate("search.matchcase"), x.translate("search.matchcase")),
                    c = dO([B.resolve("search-widget-replace")], x.translate("search.replace")),
                    d = dO([B.resolve("search-widget-replace-all")],
                        x.translate("search.replace-all")), e = r.fromTag("div");
                S.group(e);
                var f = T.div();
                n.add(e, B.resolve("search-widget-replace-drawer"));
                n.add(f, B.resolve("search-widget-replace-drawer-tools"));
                P.append(f, [b.element(), c.element(), d.element()]);
                P.append(e, [a.element(), f]);
                return {
                    element: h(e), replace: c, replaceAll: d, input: a, matchcase: b, destroy: function () {
                        b.destroy();
                        c.destroy();
                        d.destroy();
                        F.remove(f);
                        F.remove(e)
                    }
                }
            }, button: rw, input: sw
        }, tA = function (a, b, c) {
            a ? (ra.expanded(b), S.hidden(c, !1)) : (ra.collapsed(b), S.hidden(c,
                !0))
        }, Gj = {
            text: ta.generate([{text: ["field", "input"]}]).text, cata: function (a, b) {
                return a.fold(b)
            }
        }, oX = aa.detect(),
        nX = kn("element addEscape open close execute type events destroy".split(" "), pD.isFunctionOrEvents(["toEditor"])),
        fO = B.resolve("toolbar-dialog"), Eea = function (a) {
            var b = lX(a);
            return Py(a, b, "search", fO)
        }, Fea = function (a) {
            var b = mX(a);
            return zm(a, b, fO)
        }, qX = function (a) {
            return (aa.detect().deviceType.isTouch() ? Fea : Eea)(a)
        }, Gea = function (a) {
            return se.isAnnotation(a) || m.has(a, Rb.overrideSpan())
        }, gO =
            function (a, b, c, d, e, f) {
                var k = function (b) {
                    a(b, e, Gea)
                };
                Zb.cata(d.get(), t, Po.multiple(b, c, k, f), Po.single(b, c, k, f))
            }, Mp = function (a, b, c, d, e) {
            gO(a, b, c, d, e, b.toEditing)
        }, Uf = {
            face: u(Mp, Bi.face),
            background: u(Mp, Bi.background),
            foreground: u(Mp, Bi.foreground),
            size: u(Mp, Bi.size),
            partialSize: u(function (a, b, c, d, e) {
                gO(a, b, c, d, e, t)
            }, Bi.size)
        }, Oh = {color: O("hex", "name"), face: O("textkey", "value", "icon"), size: O("name", "size")}, qc = Oh.color,
        Se = Oh.face, xA = {
            colors: function () {
                return [qc("#FFF", x.key("color.white")), qc("#000",
                    x.key("color.black")), qc("#444", x.key("color.gray")), qc("#777", x.key("color.metal")), qc("#CCC", x.key("color.smoke")), qc("#FC1D00", x.key("color.red")), qc("#C81500", x.key("color.darkred")), qc("#FF8C00", x.key("color.darkorange")), qc("#FEBE00", x.key("color.orange")), qc("#FFFC00", x.key("color.yellow")), qc("#22AE50", x.key("color.green")), qc("#006400", x.key("color.darkgreen")), qc("#3CB371", x.key("color.mediumseagreen")), qc("#8FCD4E", x.key("color.lightgreen")), qc("#00FF00", x.key("color.lime")), qc("#0000CD",
                    x.key("color.mediumblue")), qc("#002360", x.key("color.navy")), qc("#0173C1", x.key("color.blue")), qc("#14B2F2", x.key("color.lightblue")), qc("#ee82ee", x.key("color.violet"))]
            }, faces: function () {
                return [Se(x.key("font.arial"), "Arial", g.none()), Se(x.key("font.comicsans"), "Comic Sans MS", g.none()), Se(x.key("font.consolas"), "Consolas", g.none()), Se(x.key("font.courier"), "Courier", g.none()), Se(x.key("font.georgia"), "Georgia", g.none()), Se(x.key("font.impact"), "Impact", g.none()), Se(x.key("font.tahoma"), "Tahoma",
                    g.none()), Se(x.key("font.timesnr"), "Times New Roman", g.none()), Se(x.key("font.trebuchet"), "Trebuchet MS", g.none()), Se(x.key("font.verdana"), "Verdana", g.none())]
            }
        }, Am = {
            configuration: h({
                i18nNamespace: "font",
                cssNamespace: "font",
                property: "font-size",
                tag: "span",
                specials: ["xx-small x-small small medium large x-large xx-large".split(" ")]
            })
        }, Hea = function (a) {
            var b = !isNaN(parseFloat(a)) && isFinite(a);
            return a + (b ? "px" : "")
        }, Iea = function (a, b, c) {
            return (v.isValidValue(a, b, c) ? g.some(c) : g.none()).fold(function () {
                return I.error("Invalid value: " +
                    c)
            }, function (a) {
                return a === c ? I.value(c) : I.error("Invalid value: " + c)
            })
        }, hO = function (a) {
            return Ip.identify(a).fold(function (a) {
                return a
            }, function (a, c, d) {
                return Math.round(10 * c) / 10 + d
            })
        }, Vf = {
            identify: Ip.identify, validate: function (a, b, c) {
                return (xf.isEmpty(a) ? I.error("can not use empty value for font size.") : I.value(a)).map(Hea).map(hO).bind(u(Iea, b, c))
            }, sanitise: function (a) {
                return hO(a)
            }
        }, Np = {px: 1, em: .1, "%": 10, pt: 1, rem: "0.1"}, Jea = function (a, b, c) {
            return qa(b, function (a) {
                return U(a, c)
            }).bind(function (b) {
                return Gc(b,
                    c).bind(function (c) {
                    return g.from(b[a(c, b)])
                })
            }).getOr(c)
        }, iO = function (a, b, c, d) {
            return Vf.identify(d).fold(function (b) {
                return Jea(a, c, b)
            }, function (a, c, d) {
                a = void 0 !== Np[d] ? Np[d] : 1;
                var e = b * (void 0 !== Np[d] ? Np[d] : 1);
                return ($e(c) && 0 <= c ? Math.max(a, c + e) : a) + d
            })
        }, Bm = {
            decrease: u(iO, function (a, b) {
                return Math.max(0, a - 1)
            }, -1), increase: u(iO, function (a, b) {
                return Math.min(b.length - 1, a + 1)
            }, 1)
        }, sX = Aa(["i18nNamespace", "cssNamespace", "property", "tag", "specials"], []), Kea = O("size"),
        Mea = function (a) {
            a = Zb.toSelection(a.get()).fold(Da.off,
                function (a) {
                    a = U(["td", "th"], D.name(a.startContainer())) ? kb.freefallLtr(a.startContainer()).element() : a.startContainer();
                    a = Lea(a);
                    return Da.on(a)
                });
            return Kea(a)
        }, Nea = function (a) {
            return a.body().bind(function (a) {
                a = v.get(a, "font-size");
                return g.from(a)
            })
        }, jO = function (a) {
            var b = a.dom();
            if (!b.style) return !1;
            b = b.style.fontSize;
            return "body" !== D.name(a) && !xf.isEmpty(b)
        }, Lea = function (a) {
            var b = D.isText(a) ? A.parent(a).getOrDie() : a;
            return (jO(b) ? g.some(b) : Ja.ancestor(b, jO)).fold(function () {
                    return v.get(b, "font-size")
                },
                function (a) {
                    return a.dom().style.fontSize
                })
        }, Cm = {
            getState: function (a, b) {
                return {readState: Mea(a), fallbackSize: Nea(b).getOr("12px")}
            }
        }, Oea = function (a) {
            a.dom().click();
            return g.some(a)
        }, Pea = function (a, b) {
            var c = Y.descendants(a, b);
            if (0 < sa.get(a) && 0 < c.length) {
                var d = bb.absolute(c[0]).top();
                return Va(c.slice(1), function (a) {
                    return bb.absolute(a).top() !== d
                }).map(function (a) {
                    return {rows: h(Math.ceil(c.length / (a + 1))), columns: h(a + 1)}
                })
            }
            return g.none()
        }, Qea = function (a) {
            return E(a, function (a) {
                var b = a.text;
                b = x.has("color." +
                    b) ? x.key("color." + b) : x.raw(b);
                return Oh.color(a.value, b)
            })
        }, Ij = {
            create: function (a) {
                var b = 0 < a.length ? Qea(a) : xA.colors();
                a = uX();
                var c = E(b, function (a) {
                    var b = uA(a);
                    m.set(b.element(), "tabIndex", "-1");
                    n.add(b.element(), B.resolve("palette-color-option"));
                    v.set(b.element(), "background-color", a.hex());
                    return b
                });
                z(c, a.add);
                b = b.length % 5;
                if (0 !== b % 5) for (b = 5 - b, c = 0; c < b; c++) {
                    var d = uA(Oh.color("#FFF", x.key("color.white")));
                    n.add(d.element(), B.resolve("palette-color-option"));
                    n.add(d.element(), B.resolve("palette-color-option-spacer"));
                    a.add(d)
                }
                return a
            }, makeLayout: function (a, b, c) {
                c = Ba.grid(oa({trigger: Oea}, c));
                var d = ha.grid(a, {cell: h(b)}, 4, 5, c);
                return {
                    layout: h(d), refresh: function () {
                        d.clear();
                        Pea(a, b).each(function (a) {
                            d.resize(a.rows(), a.columns())
                        })
                    }
                }
            }
        }, Rea = "." + B.resolve("palette-detail-active"), vA = function (a) {
            return Db.closest(a, Rea)
        }, wX = aa.detect().deviceType.isTouch, Sea = function (a) {
            var b = na(g.none());
            return {
                clear: function () {
                    b.get().each(a);
                    b.set(g.none())
                }, isSet: function () {
                    return b.get().isSome()
                }, set: function (c) {
                    b.get().each(a);
                    b.set(g.some(c))
                }
            }
        }, Tea = function () {
            return Sea(function (a) {
                a.destroy()
            })
        }, pl = h("touchstart"), tw = h("touchmove"), uw = h("touchend"), ql = h("mousedown"), vw = h("mousemove"),
        kO = h("mouseup"), Uea = h("keydown");
    h("click");
    var Vea = h("alloy.tap"), yh = h("alloy.focus"), Wea = h("alloy.blur.post"), lO = h("alloy.receive"),
        mO = h("alloy.execute");
    aa.detect().deviceType.isTouch();
    var Xea = h("alloy.longpress"), ww = h("alloy.system.init"), Yea = h("alloy.system.scroll"),
        nO = h("alloy.system.attached"), oO = h("alloy.system.detached"), Tg = function (a) {
            a =
                Pc.shallow(a);
            return Ea.getOuter(a)
        }, pO = [], Zea = ["alloy/data/Fields", "alloy/debugging/Debugging"], $ea = function () {
            var a = Error();
            return void 0 !== a.stack ? (a = a.stack.split("\n"), qa(a, function (a) {
                return 0 < a.indexOf("alloy") && !Xa(Zea, function (b) {
                    return -1 < a.indexOf(b)
                })
            }).getOr("unknown")) : "unknown"
        }, afa = {logEventCut: t, logEventStopped: t, logNoParent: t, logEventNoHandlers: t, logEventResponse: t, write: t},
        xw = function (a, b, c) {
            var d = "*" === pO || U(pO, a) ? function () {
                var c = [];
                return {
                    logEventCut: function (a, b, d) {
                        c.push({
                            outcome: "cut",
                            target: b, purpose: d
                        })
                    }, logEventStopped: function (a, b, d) {
                        c.push({outcome: "stopped", target: b, purpose: d})
                    }, logNoParent: function (a, b, d) {
                        c.push({outcome: "no-parent", target: b, purpose: d})
                    }, logEventNoHandlers: function (a, b) {
                        c.push({outcome: "no-handlers-left", target: b})
                    }, logEventResponse: function (a, b, d) {
                        c.push({outcome: "response", purpose: d, target: b})
                    }, write: function () {
                        U(["mousemove", "mouseover", "mouseout", ww()], a) || ld.log(a, {
                            event: a, target: b.dom(), sequence: E(c, function (a) {
                                return U(["cut", "stopped", "response"],
                                    a.outcome) ? "{" + a.purpose + "} " + a.outcome + " at (" + Tg(a.target) + ")" : a.outcome
                            })
                        })
                    }
                }
            }() : afa;
            c = c(d);
            d.write();
            return c
        }, qO = function (a) {
            a = a.raw();
            return void 0 === a.touches || 1 !== a.touches.length ? g.none() : g.some(a.touches[0])
        }, bfa = function (a) {
            var b = na(g.none()), c = xX(function (c) {
                b.set(g.none());
                a.triggerEvent(Xea(), c)
            }, 400), d = pb([{
                key: pl(), value: function (a) {
                    qO(a).each(function (d) {
                        c.cancel();
                        d = {x: h(d.clientX), y: h(d.clientY), target: a.target};
                        c.schedule(a);
                        b.set(g.some(d))
                    });
                    return g.none()
                }
            }, {
                key: tw(), value: function (a) {
                    c.cancel();
                    qO(a).each(function (a) {
                        b.get().each(function (c) {
                            var d = Math.abs(a.clientX - c.x());
                            c = Math.abs(a.clientY - c.y());
                            (5 < d || 5 < c) && b.set(g.none())
                        })
                    });
                    return g.none()
                }
            }, {
                key: uw(), value: function (d) {
                    c.cancel();
                    return b.get().filter(function (a) {
                        return N.eq(a.target(), d.target())
                    }).map(function (b) {
                        return a.triggerEvent(Vea(), d)
                    })
                }
            }]);
            return {
                fireIfReady: function (a, b) {
                    return zc(d, b).bind(function (b) {
                        return b(a)
                    })
                }
            }
        }, rO = aa.detect().browser.isFirefox(),
        cfa = od([gp("triggerEvent", gL), gp("broadcastEvent", gL), da("stopBackspace",
            !0)]), dfa = function (a, b) {
            return rO ? K.capture(a, "focus", b) : K.bind(a, "focusin", b)
        }, efa = function (a, b) {
            return rO ? K.capture(a, "blur", b) : K.bind(a, "focusout", b)
        }, ffa = function (a, b) {
            var c = Oe("Getting GUI events settings", cfa, b);
            b = aa.detect().deviceType.isTouch() ? ["touchstart", "touchmove", "touchend", "gesturestart"] : "mousedown mouseup mouseover mousemove mouseout click".split(" ");
            var d = bfa(c),
                e = E(b.concat("selectstart input contextmenu change transitionend drag dragstart dragend dragenter dragleave dragover drop".split(" ")),
                    function (b) {
                        return K.bind(a, b, function (a) {
                            d.fireIfReady(a, b).each(function (b) {
                                b && a.kill()
                            });
                            c.triggerEvent(b, a) && a.kill()
                        })
                    }), f = K.bind(a, "keydown", function (a) {
                    if (c.triggerEvent("keydown", a)) a.kill(); else {
                        var b;
                        if (b = !0 === c.stopBackspace) b = 8 === a.raw().which && !U(["input", "textarea"], D.name(a.target()));
                        b && a.prevent()
                    }
                }), k = dfa(a, function (a) {
                    c.triggerEvent("focusin", a) && a.kill()
                }), g = efa(a, function (a) {
                    c.triggerEvent("focusout", a) && a.kill();
                    Kf(function () {
                        c.triggerEvent(Wea(), a)
                    }, 0)
                });
            b = A.defaultView(a);
            var h = K.bind(b, "scroll", function (a) {
                c.broadcastEvent(Yea(), a) && a.kill()
            });
            return {
                unbind: function () {
                    z(e, function (a) {
                        a.unbind()
                    });
                    f.unbind();
                    k.unbind();
                    g.unbind();
                    h.unbind()
                }
            }
        }, yw = function (a, b) {
            a = zc(a, "target").map(function (a) {
                return a()
            }).getOr(b);
            return na(a)
        }, gfa = function (a, b) {
            var c = na(!1), d = na(!1);
            return {
                stop: function () {
                    c.set(!0)
                }, cut: function () {
                    d.set(!0)
                }, isStopped: c.get, isCut: d.get, event: h(a), setSource: b.set, getSource: b.get
            }
        }, hfa = function (a) {
            var b = na(!1);
            return {
                stop: function () {
                    b.set(!0)
                },
                cut: t,
                isStopped: b.get,
                isCut: h(!1),
                event: h(a),
                setSource: yb("Cannot set source of a broadcasted event"),
                getSource: yb("Cannot get source of a broadcasted event")
            }
        }, rl = ta.generate([{stopped: []}, {resume: ["element"]}, {complete: []}]), sO = function (a, b, c, d, e, f) {
            a = a(b, d);
            var k = gfa(c, e);
            return a.fold(function () {
                f.logEventNoHandlers(b, d);
                return rl.complete()
            }, function (a) {
                var c = a.descHandler(), d = c.cHandler;
                d(k);
                return k.isStopped() ? (f.logEventStopped(b, a.element(), c.purpose()), rl.stopped()) : k.isCut() ? (f.logEventCut(b,
                    a.element(), c.purpose()), rl.complete()) : A.parent(a.element()).fold(function () {
                    f.logNoParent(b, a.element(), c.purpose());
                    return rl.complete()
                }, function (d) {
                    f.logEventResponse(b, a.element(), c.purpose());
                    return rl.resume(d)
                })
            })
        }, zw = function (a, b, c, d, e, f) {
            return sO(a, b, c, d, e, f).fold(function () {
                return !0
            }, function (d) {
                return zw(a, b, c, d, e, f)
            }, function () {
                return !1
            })
        }, ifa = function (a, b, c) {
            var d = hfa(b);
            z(a, function (a) {
                a = a.descHandler().cHandler;
                a(d)
            });
            return d.isStopped()
        }, AX = function (a, b, c) {
            return Ja.closest(a,
                function (a) {
                    return b(a).isSome()
                }, c).bind(b)
        }, jfa = h("alloy-id-"), tO = h("data-alloy-id"), CX = jfa(), wA = tO(), Jj = function (a) {
            a = D.isElement(a) ? m.get(a, wA) : null;
            return g.from(a)
        }, zX = O("element", "descHandler"), sl = function (a) {
            if (!ye(a, "can") && !ye(a, "abort") && !ye(a, "run")) throw Error("EventHandler defined by: " + Nb.stringify(a, null, 2) + " does not have can, abort, or run!");
            return Oe("Extracting event.handler", od([da("can", h(!0)), da("abort", h(!1)), da("run", t)]), a)
        }, kfa = function (a, b) {
            return function () {
                for (var c =
                    [], d = 0; d < arguments.length; d++) c[d] = arguments[d];
                return hb(a, function (a, d) {
                    return a && b(d).apply(void 0, c)
                }, !0)
            }
        }, lfa = function (a, b) {
            return function () {
                for (var c = [], d = 0; d < arguments.length; d++) c[d] = arguments[d];
                return hb(a, function (a, d) {
                    return a || b(d).apply(void 0, c)
                }, !1)
            }
        }, mfa = function (a) {
            return vb(a) ? {can: h(!0), abort: h(!1), run: a} : a
        }, nfa = function (a) {
            var b = kfa(a, function (a) {
                return a.can
            }), c = lfa(a, function (a) {
                return a.abort
            });
            return sl({
                can: b, abort: c, run: function () {
                    for (var b = [], c = 0; c < arguments.length; c++) b[c] =
                        arguments[c];
                    z(a, function (a) {
                        a.run.apply(void 0, b)
                    })
                }
            })
        }, Te = function (a, b, c) {
            Op(a, a.element(), b, c)
        }, Op = function (a, b, c, d) {
            d = oa({target: b}, d);
            a.getSystem().triggerEvent(c, b, eb(d, h))
        }, Yb = function (a, b) {
            return {key: a, value: sl({run: b})}
        }, Aw = function (a, b, c) {
            return {
                key: a, value: sl({
                    run: function (a) {
                        b.apply(void 0, [a].concat(c))
                    }
                })
            }
        }, Bw = function (a) {
            return function (b) {
                return {
                    key: a, value: sl({
                        run: function (a, d) {
                            N.eq(a.element(), d.event().target()) && b(a, d)
                        }
                    })
                }
            }
        }, ofa = function (a, b) {
            return Yb(a, function (c, d) {
                c.getSystem().getByUid(b).each(function (b) {
                    var c =
                        b.element();
                    b.getSystem().triggerEvent(a, c, d.event())
                })
            })
        }, Ui = function (a, b, c) {
            b = b.partUids()[c];
            return ofa(a, b)
        }, Pp = Bw(nO()), pfa = Bw(oO()), qfa = Bw(ww());
    (function (a) {
        return function (b) {
            return Yb(a, b)
        }
    })(mO());
    var rfa = pb([function (a, b) {
            return {key: a, value: sl({can: b})}
        }(yh(), function (a, b) {
            var c = b.event().originator();
            b = b.event().target();
            return N.eq(c, a.element()) && !N.eq(c, b) ? (ld.warn(yh() + " did not get interpreted by the desired target. \nOriginator: " + Tg(c) + "\nTarget: " + Tg(b) + "\nCheck the " + yh() + " event handlers"),
                !1) : !0
        })]), sfa = Object.freeze({events: rfa}), tfa = ca,
        uO = xd("debugInfo triggerFocus triggerEvent triggerEscape addToWorld removeFromWorld addToGui removeFromGui build getByUid getByDom broadcast broadcastOn isConnected".split(" ")),
        vO = function (a) {
            var b = function (b) {
                return function () {
                    throw Error("The component must be in a context to send: " + b + "\n" + Tg(a().element()) + " is not in context.");
                }
            };
            return uO({
                debugInfo: h("fake"),
                triggerEvent: b("triggerEvent"),
                triggerFocus: b("triggerFocus"),
                triggerEscape: b("triggerEscape"),
                build: b("build"),
                addToWorld: b("addToWorld"),
                removeFromWorld: b("removeFromWorld"),
                addToGui: b("addToGui"),
                removeFromGui: b("removeFromGui"),
                getByUid: b("getByUid"),
                getByDom: b("getByDom"),
                broadcast: b("broadcast"),
                broadcastOn: b("broadcastOn"),
                isConnected: h(!1)
            })
        }, ufa = function (a, b, c) {
            c = c.toString();
            var d = c.indexOf(")") + 1, e = c.indexOf("("), f = c.substring(e + 1, d - 1).split(/,\s*/);
            a.toFunctionAnnotation = function () {
                return {name: b, parameters: Cw(f.slice(0, 1).concat(f.slice(3)))}
            };
            return a
        }, Cw = function (a) {
            return E(a,
                function (a) {
                    return je(a, "/*") ? a.substring(0, a.length - 2) : a
                })
        }, Dw = function (a, b) {
            var c = a.toString(), d = c.indexOf(")") + 1, e = c.indexOf("("), f = c.substring(e + 1, d - 1).split(/,\s*/);
            a.toFunctionAnnotation = function () {
                return {name: b, parameters: Cw(f)}
            };
            return a
        }, vfa = function (a, b) {
            b = b.toString();
            var c = b.indexOf(")") + 1, d = b.indexOf("("), e = b.substring(d + 1, c - 1).split(/,\s*/);
            a.toFunctionAnnotation = function () {
                return {name: "OVERRIDE", parameters: Cw(e.slice(1))}
            };
            return a
        }, wfa = Ha("alloy-premade"), wO = Ha("api"), Ew = function (a) {
            return vfa(function (b) {
                for (var c =
                    [], d = 1; d < arguments.length; d++) c[d - 1] = arguments[d];
                d = b.config(wO);
                return a.apply(void 0, [d].concat([b].concat(c)))
            }, a)
        }, xfa = h(wO), me = {
            init: function () {
                return tl({
                    readState: function () {
                        return "No State required"
                    }
                })
            }
        }, tl = function (a) {
            eh(fh, ["readState"])(a);
            return a
        }, yfa = function (a, b) {
            var c = E(b, function (a) {
                return fl(a.name(), [za("config"), da("state", me)])
            });
            c = tg("component.behaviours", Cc(c), a.behaviours).fold(function (b) {
                throw Error(bp(b) + "\nComplete spec:\n" + Nb.stringify(a, null, 2));
            }, function (a) {
                return a
            });
            return {
                list: b, data: eb(c, function (a) {
                    var b = a().map(function (a) {
                        return {config: a.config(), state: a.state().init(a.config())}
                    });
                    return function () {
                        return b
                    }
                })
            }
        }, xO = function (a, b) {
            var c = {};
            Ma(a, function (a, e) {
                Ma(a, function (a, d) {
                    var f = XK(d, [])(c);
                    c[d] = f.concat([b(e, a)])
                })
            });
            return c
        }, Fw = Aa(["tag"], "classes attributes styles value innerHtml domChildren defChildren".split(" ")),
        Afa = function (a) {
            a = zfa(a);
            return Nb.stringify(a, null, 2)
        }, zfa = function (a) {
            return {
                tag: a.tag(),
                classes: a.classes().getOr([]),
                attributes: a.attributes().getOr({}),
                styles: a.styles().getOr({}),
                value: a.value().getOr("<none>"),
                innerHtml: a.innerHtml().getOr("<none>"),
                defChildren: a.defChildren().fold(function () {
                    return "<none>"
                }, function (a) {
                    return Nb.stringify(a, null, 2)
                }),
                domChildren: a.domChildren().fold(function () {
                    return "<none>"
                }, function (a) {
                    return 0 === a.length ? "0 children, but still specified" : String(a.length)
                })
            }
        }, Vi = Aa([], "classes attributes styles value innerHtml defChildren domChildren".split(" ")),
        yO = function (a, b, c) {
            return b.fold(function () {
                return c.fold(function () {
                        return {}
                    },
                    function (b) {
                        return fc(a, b)
                    })
            }, function (b) {
                return c.fold(function () {
                    return fc(a, b)
                }, function (b) {
                    return fc(a, b)
                })
            })
        }, Bfa = function (a, b) {
            a = oa({
                    tag: a.tag(),
                    classes: b.classes().getOr([]).concat(a.classes().getOr([])),
                    attributes: ua(a.attributes().getOr({}), b.attributes().getOr({})),
                    styles: ua(a.styles().getOr({}), b.styles().getOr({}))
                }, b.innerHtml().or(a.innerHtml()).map(function (a) {
                    return fc("innerHtml", a)
                }).getOr({}), yO("domChildren", b.domChildren(), a.domChildren()), yO("defChildren", b.defChildren(), a.defChildren()),
                b.value().or(a.value()).map(function (a) {
                    return fc("value", a)
                }).getOr({}));
            return Fw(a)
        }, Qp = function (a, b) {
            return 1 < a.length ? I.error('Multiple behaviours have tried to change DOM "' + b + '". The guilty behaviours are: ' + Nb.stringify(E(a, function (a) {
                return a.name()
            })) + ". At this stage, this is not supported. Future releases might provide strategies for resolving this.") : 0 === a.length ? I.value({}) : I.value(a[0].modification().fold(function () {
                return {}
            }, function (a) {
                return fc(b, a)
            }))
        }, Cfa = function (a, b, c, d) {
            return I.error("Mulitple behaviours have tried to change the _" +
                b + '_ "' + a + '". The guilty behaviours are: ' + Nb.stringify(ia(d, function (a) {
                    return void 0 !== a.modification().getOr({})[b] ? [a.name()] : []
                }), null, 2) + ". This is not currently supported.")
        }, zO = function (a, b) {
            return hb(a, function (c, d) {
                var e = d.modification().getOr({});
                return c.bind(function (c) {
                    var d = Nf(e, function (d, f) {
                        return void 0 !== c[f] ? Cfa(b, f, e, a) : I.value(fc(f, d))
                    });
                    return rv(d, c)
                })
            }, I.value({})).map(function (a) {
                return fc(b, a)
            })
        }, Dfa = {
            classes: function (a, b) {
                a = ia(a, function (a) {
                    return a.modification().getOr([])
                });
                return I.value(fc(b, a))
            }, attributes: zO, styles: zO, domChildren: Qp, defChildren: Qp, innerHtml: Qp, value: Qp
        }, Efa = function (a, b, c, d) {
            var e = oa({}, b);
            z(c, function (b) {
                e[b.name()] = b.exhibit(a, d)
            });
            b = xO(e, function (a, b) {
                return {
                    name: function () {
                        return a
                    }, modification: b
                }
            });
            b = eb(b, function (a, b) {
                return ia(a, function (a) {
                    return a.modification().fold(function () {
                        return []
                    }, function (b) {
                        return [a]
                    })
                })
            });
            b = Nf(b, function (a, b) {
                return zc(Dfa, b).fold(function () {
                    return I.error("Unknown field type: " + b)
                }, function (c) {
                    return c(a, b)
                })
            });
            return rv(b, {}).map(Vi)
        }, Ffa = function (a, b, c, d) {
            c = c.slice(0);
            try {
                var e = c.sort(function (c, e) {
                    c = c[b]();
                    e = e[b]();
                    var f = d.indexOf(c), k = d.indexOf(e);
                    if (-1 === f) throw Error("The ordering for " + a + " does not have an entry for " + c + ".\nOrder specified: " + Nb.stringify(d, null, 2));
                    if (-1 === k) throw Error("The ordering for " + a + " does not have an entry for " + e + ".\nOrder specified: " + Nb.stringify(d, null, 2));
                    return f < k ? -1 : k < f ? 1 : 0
                });
                return I.value(e)
            } catch (f) {
                return I.error([f])
            }
        }, Gfa = function (a, b) {
            return {name: h(a), handler: h(b)}
        },
        Hfa = function (a, b) {
            var c = {};
            z(a, function (a) {
                c[a.name()] = a.handlers(b)
            });
            return c
        }, Ifa = function (a) {
            var b = mfa(a);
            return function (a, d) {
                for (var c = [], f = 2; f < arguments.length; f++) c[f - 2] = arguments[f];
                c = [a, d].concat(c);
                b.abort.apply(void 0, c) ? d.stop() : b.can.apply(void 0, c) && b.run.apply(void 0, c)
            }
        }, Jfa = function (a, b) {
            return I.error(["The event (" + a + ') has more than one behaviour that listens to it.\nWhen this occurs, you must specify an event ordering for the behaviours in your spec (e.g. [ "listing", "toggling" ]).\nThe behaviours that can trigger it are: ' +
            Nb.stringify(E(b, function (a) {
                return a.name()
            }), null, 2)])
        }, Kfa = function (a, b, c) {
            return (b = b[c]) ? Ffa("Event: " + c, "name", a, b).map(function (a) {
                a = E(a, function (a) {
                    return a.handler()
                });
                return nfa(a)
            }) : Jfa(c, a)
        }, Lfa = function (a, b) {
            a = Nf(a, function (a, d) {
                return (1 === a.length ? I.value(a[0].handler()) : Kfa(a, b, d)).map(function (c) {
                    c = Ifa(c);
                    var e = 1 < a.length ? ka(b, function (b) {
                        return U(a, function (a) {
                            return a.name() === b
                        })
                    }).join(" > ") : a[0].name();
                    return qv(d, {handler: c, purpose: h(e)})
                })
            });
            return rv(a, {})
        }, Mfa = h([za("menu"),
            za("selectedMenu")]), AO = h([za("item"), za("selectedItem")]);
    h(od(AO().concat(Mfa())));
    h(od(AO()));
    var Nfa = el("initSize", [za("numColumns"), za("numRows")]), Gw = function (a, b, c) {
            $ea();
            return Dc(b, b, c, cL(function (a) {
                return I.value(function () {
                    for (var b = [], c = 0; c < arguments.length; c++) b[c] = arguments[c];
                    return a.apply(void 0, b)
                })
            }))
        }, Ag = function (a) {
            return Gw("onHandler", a, Ne.defaultedThunk(h(t)))
        }, Xd = function (a) {
            return Gw("onKeyboardHandler", a, Ne.defaultedThunk(h(g.none)))
        }, Bg = function (a, b) {
            return ug(a, h(b))
        },
        Ofa = h(Nfa), Pfa = function (a) {
            return tg("custom.definition", od([Dc("dom", "dom", sg(), od([za("tag"), da("styles", {}), da("classes", []), da("attributes", {}), Dd("value"), Dd("innerHtml")])), za("components"), za("uid"), da("events", {}), da("apis", h({})), Dc("eventOrder", "eventOrder", Ne.mergeWithThunk(h({
                "alloy.execute": ["disabling", "alloy.base.behaviour", "toggling"],
                "alloy.focus": ["alloy.base.behaviour", "focusing", "keying"],
                "alloy.system.init": ["alloy.base.behaviour", "disabling", "toggling", "representing"],
                input: ["alloy.base.behaviour",
                    "representing", "streaming", "invalidating"],
                "alloy.system.detached": ["alloy.base.behaviour", "representing"],
                mousedown: ["focusing", "alloy.base.behaviour", "item-type-events"]
            })), cp()), Dd("domModification"), al("originalSpec", ca), da("debug.sketcher", "unknown")]), a)
        }, Qfa = function (a) {
            return qv(tO(), a.uid())
        }, Rfa = function (a) {
            var b = {
                tag: a.dom().tag(),
                classes: a.dom().classes(),
                attributes: oa(Qfa(a), a.dom().attributes()),
                styles: a.dom().styles(),
                domChildren: E(a.components(), function (a) {
                    return a.element()
                })
            };
            return Fw(oa(b,
                a.dom().innerHtml().map(function (a) {
                    return fc("innerHtml", a)
                }).getOr({}), a.dom().value().map(function (a) {
                    return fc("value", a)
                }).getOr({})))
        }, Sfa = function (a) {
            return a.domModification().fold(function () {
                return Vi({})
            }, Vi)
        }, Ufa = function (a) {
            if (a.domChildren().isSome() && a.defChildren().isSome()) throw Error("Cannot specify children and child specs! Must be one or the other.\nDef: " + Afa(a));
            return a.domChildren().fold(function () {
                var b = a.defChildren().getOr([]);
                return E(b, Tfa)
            }, function (a) {
                return a
            })
        }, BO =
            function (a) {
                var b = r.fromTag(a.tag());
                m.setAll(b, a.attributes().getOr({}));
                ma.add(b, a.classes().getOr([]));
                v.setAll(b, a.styles().getOr({}));
                Ea.set(b, a.innerHtml().getOr(""));
                var c = Ufa(a);
                P.append(b, c);
                a.value().each(function (a) {
                    fa.set(b, a)
                });
                return b
            }, Tfa = function (a) {
            a = Fw(a);
            return BO(a)
        }, Vfa = function (a) {
            var b = zc(a, "behaviours").getOr({});
            a = ka(cb(b), function (a) {
                return void 0 !== b[a]
            });
            return E(a, function (a) {
                return b[a].me
            })
        }, Wfa = function (a) {
            var b = Vfa(a);
            return yfa(a, b)
        },
        Xfa = xd("getSystem config hasConfigured spec connect disconnect element syncComponents readState components events".split(" ")),
        Yfa = function (a, b, c) {
            var d = Rfa(a);
            a = {"alloy.base.modification": Sfa(a)};
            b = Efa(c, a, b, d).getOrDie();
            return Bfa(d, b)
        }, Zfa = function (a, b, c) {
            var d = {"alloy.base.behaviour": a.events()};
            a = a.eventOrder();
            b = oa(d, Hfa(b, c));
            b = xO(b, Gfa);
            return Lfa(b, a).getOrDie()
        }, $fa = function (a) {
            var b = function () {
                return n
            }, c = na(vO(b)), d = Ki(Pfa(oa(a, {behaviours: void 0}))), e = Wfa(a), f = e.list, k = e.data;
            e = Yfa(d, f, k);
            var g = BO(e);
            f = Zfa(d, f, k);
            var m = na(d.components()), n = Xfa({
                getSystem: c.get, config: function (b) {
                    if (b === xfa()) return d.apis();
                    if (xa(b)) throw Error("Invalid input: only API constant is allowed");
                    return (vb(k[b.name()]) ? k[b.name()] : function () {
                        throw Error("Could not find " + b.name() + " in " + Nb.stringify(a, null, 2));
                    })()
                }, hasConfigured: function (a) {
                    return vb(k[a.name()])
                }, spec: h(a), readState: function (a) {
                    return k[a]().map(function (a) {
                        return a.state.readState()
                    }).getOr("not enabled")
                }, connect: function (a) {
                    c.set(a)
                }, disconnect: function () {
                    c.set(vO(b))
                }, element: h(g), syncComponents: function () {
                    var a = A.children(g);
                    a = ia(a, function (a) {
                        return c.get().getByDom(a).fold(function () {
                                return []
                            },
                            function (a) {
                                return [a]
                            })
                    });
                    m.set(a)
                }, components: m.get, events: h(f)
            });
            return n
        }, Em = function (a) {
            return zc(a, wfa).fold(function () {
                var b = oa({uid: Ha("")}, a);
                b = tfa(b);
                var c = XK("components", [])(b);
                c = E(c, Em);
                b = oa(sfa, b, fc("components", c));
                return I.value($fa(b)).getOrDie()
            }, function (a) {
                return a
            })
        }, ul = function (a, b) {
            return fba(a, {}, E(b, function (b) {
                return eba(b.name(), "Cannot configure " + b.name() + " for " + a)
            }).concat([al("dump", ca)]))
        }, Rp = ta.generate([{single: ["required", "valueThunk"]}, {multiple: ["required", "valueThunks"]}]),
        aga = function (a, b, c, d) {
            return a.exists(function (a) {
                return a !== c.owner
            }) ? Rp.single(!0, h(c)) : zc(d, c.name).fold(function () {
                throw Error("Unknown placeholder component: " + c.name + "\nKnown: [" + cb(d) + "]\nNamespace: " + a.getOr("none") + "\nSpec: " + Nb.stringify(c, null, 2));
            }, function (a) {
                return a.replace()
            })
        }, bga = function (a, b, c, d) {
            return "placeholder" === c.uiType ? aga(a, b, c, d) : Rp.single(!1, h(c))
        }, CO = function (a, b, c, d) {
            return bga(a, b, c, d).fold(function (e, f) {
                e = f(b, c.config, c.validated);
                f = zc(e, "components").getOr([]);
                f =
                    ia(f, function (c) {
                        return CO(a, b, c, d)
                    });
                return [oa(e, {components: f})]
            }, function (a, d) {
                return d(b, c.config, c.validated)
            })
        }, cga = function (a, b, c, d) {
            return ia(c, function (c) {
                return CO(a, b, c, d)
            })
        }, dga = function (a, b) {
            var c = !1;
            return {
                name: h(a), required: function () {
                    return b.fold(function (a, b) {
                        return a
                    }, function (a, b) {
                        return a
                    })
                }, used: function () {
                    return c
                }, replace: function () {
                    if (!0 === c) throw Error("Trying to use the same placeholder more than once: " + a);
                    c = !0;
                    return b
                }
            }
        }, ega = function (a, b, c, d) {
            d = eb(d, function (a, b) {
                return dga(b,
                    a)
            });
            c = cga(a, b, c, d);
            Ma(d, function (c) {
                if (!1 === c.used() && c.required()) throw Error("Placeholder: " + c.name() + " was not found in components list\nNamespace: " + a.getOr("none") + "\nComponents: " + Nb.stringify(b.components(), null, 2));
            });
            return c
        }, DO = Rp.single, fga = Rp.multiple, EO = h("placeholder"),
        FO = ta.generate([{required: ["data"]}, {external: ["data"]}, {optional: ["data"]}, {group: ["data"]}]),
        Hw = da("factory", {sketch: ca}), Iw = da("schema", []), Jw = za("name"),
        Kw = Dc("pname", "pname", Haa(function (a) {
            return "<alloy." + Ha(a.name) +
                ">"
        }), cp()), Lw = da("defaults", h({})), Mw = da("overrides", h({})), gga = Cc([Hw, Iw, Jw, Kw, Lw, Mw]),
        hga = Cc([Hw, Iw, Jw, Kw, Lw, Mw]);
    Cc([Hw, Iw, Jw, za("unit"), Kw, Lw, Mw]);
    var iga = function (a) {
            var b = function (a) {
                return a.name()
            };
            return a.fold(b, b, b, b)
        }, GO = function (a, b) {
            return function (c) {
                c = Ki(tg("Converting part type", b, c));
                return a(c)
            }
        }, Sp = GO(FO.required, gga), Nw = GO(FO.optional, hga), HO = h("entirety"), Ow = function (a, b, c, d) {
            return oa(b.defaults()(a, c, d), c, {uid: a.partUids()[b.name()]}, b.overrides()(a, c, d), {
                "debug.sketcher": qv("part-" +
                    b.name(), c)
            })
        }, jga = function (a, b, c) {
            var d = {}, e = {};
            z(c, function (a) {
                a.fold(function (a) {
                    d[a.pname()] = DO(!0, function (b, c, d) {
                        return a.factory().sketch(Ow(b, a, c, d))
                    })
                }, function (a) {
                    var c = b.parts()[a.name()]();
                    e[a.name()] = h(Ow(b, a, c[HO()]()))
                }, function (a) {
                    d[a.pname()] = DO(!1, function (b, c, d) {
                        return a.factory().sketch(Ow(b, a, c, d))
                    })
                }, function (a) {
                    d[a.pname()] = fga(!0, function (b, c, d) {
                        c = b[a.name()]();
                        return E(c, function (c) {
                            return a.factory().sketch(oa(a.defaults()(b, c), c, a.overrides()(b, c)))
                        })
                    })
                })
            });
            return {
                internals: h(d),
                externals: h(e)
            }
        }, lga = function (a, b) {
            var c = {};
            z(b, function (b) {
                b.fold(g.some, g.none, g.some, g.some).each(function (b) {
                    var d = kga(a, b.pname());
                    c[b.name()] = function (c) {
                        var e = Oe("Part: " + b.name() + " in " + a, Cc(b.schema()), c);
                        return oa(d, {config: c, validated: e})
                    }
                })
            });
            return c
        }, kga = function (a, b) {
            return {uiType: EO(), owner: a, name: b}
        }, mga = function (a) {
            return ia(a, function (a) {
                return a.fold(g.none, g.some, g.none, g.none).map(function (a) {
                    return el(a.name(), a.schema().concat([al(HO(), ca)]))
                }).toArray()
            })
        }, ne = function (a, b,
                          c) {
            b = b.partUids()[c];
            return a.getSystem().getByUid(b).toOption()
        }, IO = function (a, b, c) {
            return ne(a, b, c).getOrDie("Could not find part: " + c)
        }, nga = function (a, b, c) {
            var d = {}, e = b.partUids(), f = a.getSystem();
            z(c, function (a) {
                d[a] = f.getByUid(e[a])
            });
            return eb(d, h)
        }, oga = function (a, b) {
            var c = a.getSystem();
            return eb(b.partUids(), function (a, b) {
                return h(c.getByUid(a))
            })
        }, pga = function (a, b) {
            b = E(b, iga);
            return pb(E(b, function (b) {
                return {key: b, value: a + "-" + b}
            }))
        }, qga = function (a) {
            return Dc("partUids", "partUids", Iaa(function (b) {
                return pga(b.uid,
                    a)
            }), cp())
        }, JO = function (a, b, c, d, e) {
            d = (0 < d.length ? [el("parts", d)] : []).concat([za("uid"), da("dom", {}), da("components", []), al("originalSpec", ca), da("debug.sketcher", {})]).concat(e);
            b = od(d.concat(b));
            return Ki(tg(a + " [SpecSchema]", b, c))
        }, LO = function (a, b, c, d, e) {
            var f = KO(e), k = mga(c), h = qga(c);
            b = JO(a, b, f, k, [h]);
            c = jga(a, b, c);
            k = c.internals();
            k = ega(g.some(a), b, b.components(), k);
            return oa(d(b, k, f, c.externals()), {"debug.sketcher": fc(a, e)})
        }, KO = function (a) {
            return oa({uid: Ha("uid")}, a)
        }, rga = od([za("name"), za("factory"),
            za("configFields"), da("apis", {}), da("extraApis", {})]),
        sga = od([za("name"), za("factory"), za("configFields"), za("partFields"), da("apis", {}), da("extraApis", {})]),
        vl = function (a) {
            var b = Oe("Sketcher for " + a.name, rga, a);
            a = eb(b.apis, Ew);
            var c = eb(b.extraApis, function (a, b) {
                return Dw(a, b)
            });
            return oa({
                name: h(b.name), partFields: h([]), configFields: h(b.configFields), sketch: function (a) {
                    var c = b.name, d = b.configFields, k = b.factory, g = KO(a);
                    d = JO(c, d, g, [], []);
                    return oa(k(d, g), {"debug.sketcher": fc(c, a)})
                }
            }, a, c)
        }, MO = function (a) {
            var b =
                Oe("Sketcher for " + a.name, sga, a);
            a = lga(b.name, b.partFields);
            var c = eb(b.apis, Ew), d = eb(b.extraApis, function (a, b) {
                return Dw(a, b)
            });
            return oa({
                name: h(b.name), partFields: h(b.partFields), configFields: h(b.configFields), sketch: function (a) {
                    return LO(b.name, b.configFields, b.partFields, b.factory, a)
                }, parts: h(a)
            }, c, d)
        }, tga = vl({
            name: "Container",
            factory: function (a) {
                return {
                    uid: a.uid(),
                    dom: oa({tag: "div", attributes: {role: "presentation"}}, a.dom()),
                    components: a.components(),
                    behaviours: a.containerBehaviours().dump(),
                    events: a.events(),
                    domModification: a.domModification(),
                    eventOrder: a.eventOrder()
                }
            },
            configFields: [da("components", []), ul("containerBehaviours", []), da("events", {}), da("domModification", {}), da("eventOrder", {})]
        }), NO = function (a) {
            var b = oO();
            Op(a, a.element(), b, {});
            a = a.components();
            z(a, NO)
        }, Pw = function (a) {
            var b = a.components();
            z(b, Pw);
            b = nO();
            Op(a, a.element(), b, {})
        }, uga = function (a) {
            NO(a);
            F.remove(a.element());
            a.getSystem().removeFromWorld(a)
        }, OO = function (a) {
            var b = A.parent(a.element()).bind(function (b) {
                return a.getSystem().getByDom(b).fold(g.none,
                    g.some)
            });
            uga(a);
            b.each(function (a) {
                a.syncComponents()
            })
        }, GX = function (a, b) {
            y.append(a, b.element());
            a = A.children(b.element());
            z(a, function (a) {
                b.getByDom(a).each(Pw)
            })
        }, EX = function () {
            var a = Em(tga.sketch({dom: {tag: "div"}}));
            return vga(a)
        }, vga = function (a) {
            var b = function (b) {
                return A.parent(a.element()).fold(function () {
                    return !0
                }, function (a) {
                    return N.eq(b, a)
                })
            }, c = BX(), d = function (a, d) {
                return c.find(b, a, d)
            }, e = ffa(a.element(), {
                triggerEvent: function (a, b) {
                    return xw(a, b.target(), function (c) {
                        var e = b.target(), f =
                            yw(b, e);
                        return zw(d, a, b, e, f, c)
                    })
                }, broadcastEvent: function (a, b) {
                    a = c.filter(a);
                    return ifa(a, b)
                }
            }), f = uO({
                debugInfo: h("real"), triggerEvent: function (a, b, c) {
                    xw(a, b, function (e) {
                        var f = yw(c, b);
                        zw(d, a, c, b, f, e)
                    })
                }, triggerFocus: function (a, b) {
                    Jj(a).fold(function () {
                        Z.focus(a)
                    }, function (c) {
                        xw(yh(), a, function (c) {
                            var e = yh(), f = {originator: h(b), kill: t, prevent: t, target: h(a)}, k = yw(f, a);
                            sO(d, e, f, a, k, c)
                        })
                    })
                }, triggerEscape: function (a, b) {
                    f.triggerEvent("keydown", a.element(), b.event())
                }, getByUid: function (a) {
                    return r(a)
                }, getByDom: function (a) {
                    return u(a)
                },
                build: Em, addToGui: function (a) {
                    m(a)
                }, removeFromGui: function (a) {
                    OO(a)
                }, addToWorld: function (a) {
                    k(a)
                }, removeFromWorld: function (a) {
                    g(a)
                }, broadcast: function (a) {
                    w(a)
                }, broadcastOn: function (a, b) {
                    p(a, b)
                }, isConnected: h(!0)
            }), k = function (a) {
                a.connect(f);
                D.isText(a.element()) || (c.register(a), z(a.components(), k), f.triggerEvent(ww(), a.element(), {target: h(a.element())}))
            }, g = function (a) {
                D.isText(a.element()) || (z(a.components(), g), c.unregister(a));
                a.disconnect()
            }, m = function (b) {
                var c = y.append;
                a.getSystem().addToWorld(b);
                c(a.element(), b.element());
                ja.inBody(a.element()) && Pw(b);
                a.syncComponents()
            }, n = function (a) {
                var b = c.filter(lO());
                z(b, function (b) {
                    b = b.descHandler().cHandler;
                    b(a)
                })
            }, w = function (a) {
                n({universal: h(!0), data: h(a)})
            }, p = function (a, b) {
                n({universal: h(!1), channels: h(a), data: h(b)})
            }, r = function (a) {
                return c.getById(a).fold(function () {
                    return I.error(Error('Could not find component with uid: "' + a + '" in system.'))
                }, I.value)
            }, u = function (a) {
                a = Jj(a).getOr("not found");
                return r(a)
            };
            k(a);
            return {
                root: h(a), element: a.element,
                destroy: function () {
                    e.unbind();
                    F.remove(a.element())
                }, add: m, remove: function (a) {
                    OO(a)
                }, getByUid: r, getByDom: u, addToWorld: k, removeFromWorld: g, broadcast: w, broadcastOn: p
            }
        }, wga = function (a, b, c) {
            return qfa(function (d, e) {
                c(d, a, b)
            })
        }, xga = function (a, b, c) {
            return ufa(function (d) {
                for (var e = [], f = 1; f < arguments.length; f++) e[f - 1] = arguments[f];
                var k = [d].concat(e);
                return d.config({name: h(a)}).fold(function () {
                    throw Error("We could not find any behaviour configuration for: " + a + ". Using API: " + c);
                }, function (a) {
                    var c = Array.prototype.slice.call(k,
                        1);
                    return b.apply(void 0, [d, a.config, a.state].concat(c))
                })
            }, c, b)
        }, yga = function (a) {
            return {key: a, value: void 0}
        }, PO = function (a, b, c, d, e, f, k) {
            var h = function (a) {
                return ye(a, c) ? a[c]() : g.none()
            };
            e = eb(e, function (a, b) {
                return xga(c, a, b)
            });
            f = eb(f, function (a, b) {
                return Dw(a, b)
            });
            var m = oa(f, e, {
                revoke: u(yga, c), config: function (b) {
                    var d = Ki(tg(c + "-config", a, b));
                    return {
                        key: c, value: {
                            config: d, me: m, configAsRaw: gc(function () {
                                return Oe(c + "-config", a, b)
                            }), initialConfig: b, state: k
                        }
                    }
                }, schema: function () {
                    return b
                }, exhibit: function (a,
                                      b) {
                    return h(a).bind(function (a) {
                        return zc(d, "exhibit").map(function (c) {
                            return c(b, a.config, a.state)
                        })
                    }).getOr(Vi({}))
                }, name: function () {
                    return c
                }, handlers: function (a) {
                    return h(a).bind(function (a) {
                        return zc(d, "events").map(function (b) {
                            return b(a.config, a.state)
                        })
                    }).getOr({})
                }
            });
            return m
        }, zga = od([za("fields"), za("name"), da("active", {}), da("apis", {}), da("state", me), da("extra", {})]),
        Cg = function (a) {
            var b = Oe("Creating behaviour: " + a.name, zga, a), c = b.fields;
            a = b.name;
            var d = b.active, e = b.apis, f = b.extra;
            b = b.state;
            var k = od(c);
            c = Dc("config", "config", Yk(), od(c));
            c = fl(a, [c]);
            return PO(k, c, a, d, e, f, b)
        },
        Aga = od([za("branchKey"), za("branches"), za("name"), da("active", {}), da("apis", {}), da("state", me), da("extra", {})]),
        Bga = function (a, b, c) {
            var d = kd(a.slice(0, b));
            a = kd(a.slice(b + 1));
            return qa(d.concat(a), c)
        }, Cga = function (a, b, c) {
            a = kd(a.slice(0, b));
            return qa(a, c)
        }, Dga = function (a, b, c) {
            var d = a.slice(0, b);
            a = a.slice(b + 1);
            return qa(a.concat(d), c)
        }, Ega = function (a, b, c) {
            a = a.slice(b + 1);
            return qa(a, c)
        }, Qa = function (a) {
            return function (b) {
                b =
                    b.raw();
                return U(a, b.which)
            }
        }, oe = function (a) {
            return function (b) {
                return ob(a, function (a) {
                    return a(b)
                })
            }
        }, Wi = function (a) {
            return !0 === a.raw().shiftKey
        }, Fga = function (a) {
            return !0 === a.raw().ctrlKey
        }, wl = zf(Wi), Sa = function (a, b) {
            return {matches: a, classification: b}
        }, Gga = function (a, b) {
            return qa(a, function (a) {
                return a.matches(b)
            }).map(function (a) {
                return a.classification
            })
        }, Xi = function (a, b, c, d) {
            a += b;
            return a > d ? c : a < c ? d : a
        }, xl = function (a, b, c) {
            return a <= b ? b : a >= c ? c : a
        }, QO = function (a, b, c) {
            c = Y.descendants(a.element(), "." +
                b.highlightClass());
            z(c, function (c) {
                n.remove(c, b.highlightClass());
                a.getSystem().getByDom(c).each(function (c) {
                    b.onDehighlight()(a, c)
                })
            })
        }, yl = function (a, b, c, d) {
            var e = Qw(a, b, c, d);
            QO(a, b, c);
            n.add(d.element(), b.highlightClass());
            e || b.onHighlight()(a, d)
        }, Qw = function (a, b, c, d) {
            return n.has(d.element(), b.highlightClass())
        }, Hga = function (a, b, c, d) {
            b = Y.descendants(a.element(), "." + b.itemClass());
            return g.from(b[d]).fold(function () {
                return I.error("No element found with index " + d)
            }, a.getSystem().getByDom)
        }, RO = function (a,
                          b, c) {
            return L.descendant(a.element(), "." + b.itemClass()).bind(function (b) {
                return a.getSystem().getByDom(b).toOption()
            })
        }, SO = function (a, b, c) {
            b = Y.descendants(a.element(), "." + b.itemClass());
            return (0 < b.length ? g.some(b[b.length - 1]) : g.none()).bind(function (b) {
                return a.getSystem().getByDom(b).toOption()
            })
        }, TO = function (a, b, c, d) {
            var e = Y.descendants(a.element(), "." + b.itemClass());
            return Va(e, function (a) {
                return n.has(a, b.highlightClass())
            }).bind(function (b) {
                b = Xi(b, d, 0, e.length - 1);
                return a.getSystem().getByDom(e[b]).toOption()
            })
        },
        UO = function (a, b, c) {
            b = Y.descendants(a.element(), "." + b.itemClass());
            return ee(E(b, function (b) {
                return a.getSystem().getByDom(b).toOption()
            }))
        }, Iga = Object.freeze({
            dehighlightAll: QO, dehighlight: function (a, b, c, d) {
                c = Qw(a, b, c, d);
                n.remove(d.element(), b.highlightClass());
                c && b.onDehighlight()(a, d)
            }, highlight: yl, highlightFirst: function (a, b, c) {
                RO(a, b, c).each(function (d) {
                    yl(a, b, c, d)
                })
            }, highlightLast: function (a, b, c) {
                SO(a, b, c).each(function (d) {
                    yl(a, b, c, d)
                })
            }, highlightAt: function (a, b, c, d) {
                Hga(a, b, c, d).fold(function (a) {
                    throw Error(a);
                }, function (d) {
                    yl(a, b, c, d)
                })
            }, highlightBy: function (a, b, c, d) {
                var e = UO(a, b, c);
                qa(e, d).each(function (d) {
                    yl(a, b, c, d)
                })
            }, isHighlighted: Qw, getHighlighted: function (a, b, c) {
                return L.descendant(a.element(), "." + b.highlightClass()).bind(function (b) {
                    return a.getSystem().getByDom(b).toOption()
                })
            }, getFirst: RO, getLast: SO, getPrevious: function (a, b, c) {
                return TO(a, b, c, -1)
            }, getNext: function (a, b, c) {
                return TO(a, b, c, 1)
            }, getCandidates: UO
        }), Jga = [za("highlightClass"), za("itemClass"), Ag("onHighlight"), Ag("onDehighlight")];
    Cg({
        fields: Jga,
        name: "highlighting", apis: Iga
    });
    var Kga = function () {
            return {
                get: function (a) {
                    return Z.search(a.element())
                }, set: function (a, b) {
                    a.getSystem().triggerFocus(b, a.element())
                }
            }
        }, zh = function (a, b, c, d, e, f) {
            var k = function (a, b, d, e) {
                var f = c(a, b, d, e);
                return Gga(f, b.event()).bind(function (c) {
                    return c(a, b, d, e)
                })
            }, g = {
                schema: function () {
                    return a.concat([da("focusManager", Kga()), Bg("handler", g), Bg("state", b)])
                }, processKey: k, toEvents: function (a, b) {
                    var c = d(a, b), e = pb(f.map(function (c) {
                        return Yb(yh(), function (d, e) {
                            c(d, a, b, e);
                            e.stop()
                        })
                    }).toArray().concat([Yb(Uea(), function (c, d) {
                        k(c, d, a, b).each(function (a) {
                            d.stop()
                        })
                    })]));
                    return oa(c, e)
                }, toApis: e
            };
            return g
        }, VO = function (a) {
            a = [Dd("onEscape"), Dd("onEnter"), da("selector", '[data-alloy-tabstop="true"]'), da("firstTabstop", 0), da("useTabstopAt", h(!0)), Dd("visibilitySelector")].concat([a]);
            var b = function (a, b) {
                    a = a.visibilitySelector().bind(function (a) {
                        return L.closest(b, a)
                    }).getOr(b);
                    return 0 < sa.get(a)
                }, c = function (a, c) {
                    a = Y.descendants(a.element(), c.selector());
                    a = ka(a, function (a) {
                        return b(c,
                            a)
                    });
                    return g.from(a[c.firstTabstop()])
                }, d = function (a, b) {
                    return b.focusManager().get(a).bind(function (a) {
                        return L.closest(a, b.selector())
                    })
                }, e = function (a, c, d, e, f) {
                    return f(c, d, function (a) {
                        return b(e, a) && e.useTabstopAt()(a)
                    }).fold(function () {
                        return e.cyclic() ? g.some(!0) : g.none()
                    }, function (b) {
                        e.focusManager().set(a, b);
                        return g.some(!0)
                    })
                }, f = function (a, b, c, f) {
                    var k = Y.descendants(a.element(), c.selector());
                    return d(a, c).bind(function (b) {
                        return Va(k, u(N.eq, b)).bind(function (b) {
                            return e(a, k, b, c, f)
                        })
                    })
                },
                k = h([Sa(oe([Wi, Qa([9])]), function (a, b, c, d) {
                    d = c.cyclic() ? Bga : Cga;
                    return f(a, b, c, d)
                }), Sa(Qa([9]), function (a, b, c, d) {
                    d = c.cyclic() ? Dga : Ega;
                    return f(a, b, c, d)
                }), Sa(Qa([27]), function (a, b, c, d) {
                    return c.onEscape().bind(function (c) {
                        return c(a, b)
                    })
                }), Sa(oe([wl, Qa([13])]), function (a, b, c, d) {
                    return c.onEnter().bind(function (c) {
                        return c(a, b)
                    })
                })]), l = h({}), m = h({});
            return zh(a, me.init, k, l, m, g.some(function (a, b) {
                c(a, b).each(function (c) {
                    b.focusManager().set(a, c)
                })
            }))
        }, Lga = VO(ug("cyclic", h(!1))), Mga = VO(ug("cyclic", h(!0))),
        WO = function (a) {
            return "input" === D.name(a) && "radio" !== m.get(a, "type") || "textarea" === D.name(a)
        }, zl = function (a, b, c) {
            WO(c) && Qa([32])(b.event()) ? a = g.none() : (b = mO(), Op(a, c, b, {}), a = g.some(!0));
            return a
        }, Nga = [da("execute", zl), da("useSpace", !1), da("useEnter", !0), da("useControlEnter", !1), da("useDown", !1)],
        XO = function (a, b, c) {
            return c.execute()(a, b, a.element())
        }, Oga = h({}), Pga = h({}), Qga = zh(Nga, me.init, function (a, b, c, d) {
            a = c.useSpace() && !WO(a.element()) ? [32] : [];
            b = c.useEnter() ? [13] : [];
            d = c.useDown() ? [40] : [];
            a = a.concat(b).concat(d);
            return [Sa(Qa(a), XO)].concat(c.useControlEnter() ? [Sa(oe([Fga, Qa([13])]), XO)] : [])
        }, Oga, Pga, g.none()), YO = function (a) {
            var b = na(g.none());
            return tl({
                readState: h({}), setGridSize: function (a, d) {
                    b.set(g.some({numRows: h(a), numColumns: h(d)}))
                }, getNumRows: function () {
                    return b.get().map(function (a) {
                        return a.numRows()
                    })
                }, getNumColumns: function () {
                    return b.get().map(function (a) {
                        return a.numColumns()
                    })
                }
            })
        }, Rga = Object.freeze({
            flatgrid: YO, init: function (a) {
                return a.state()(a)
            }
        }), $O = function (a) {
            return function (b, c, d, e) {
                var f =
                    a(b.element());
                return ZO(f, b, c, d, e)
            }
        }, Rw = function (a, b) {
            a = ae.onDirection(a, b);
            return $O(a)
        }, Sw = function (a, b) {
            a = ae.onDirection(b, a);
            return $O(a)
        }, Dg = function (a) {
            return function (b, c, d, e) {
                return ZO(a, b, c, d, e)
            }
        }, ZO = function (a, b, c, d, e) {
            return d.focusManager().get(b).bind(function (c) {
                return a(b.element(), c, d, e)
            }).map(function (a) {
                d.focusManager().set(b, a);
                return !0
            })
        }, Sga = Aa(["index", "candidates"], []), Tga = function (a, b) {
            return Va(a, b).map(function (b) {
                return Sga({index: b, candidates: a})
            })
        }, aP = function (a, b, c) {
            b =
                u(N.eq, b);
            a = Y.descendants(a, c);
            a = ka(a, sc.isVisible);
            return Tga(a, b)
        }, bP = function (a, b) {
            return Va(a, function (a) {
                return N.eq(b, a)
            })
        }, cP = function (a, b, c, d) {
            return d(Math.floor(b / c), b % c).bind(function (b) {
                b = b.row() * c + b.column();
                return 0 <= b && b < a.length ? g.some(a[b]) : g.none()
            })
        }, dP = function (a, b, c, d, e) {
            return cP(a, b, d, function (b, k) {
                k = Xi(k, e, 0, (b === c - 1 ? a.length - b * d : d) - 1);
                return g.some({row: h(b), column: h(k)})
            })
        }, eP = function (a, b, c, d, e) {
            return cP(a, b, d, function (b, k) {
                b = Xi(b, e, 0, c - 1);
                k = xl(k, 0, (b === c - 1 ? a.length - b *
                    d : d) - 1);
                return g.some({row: h(b), column: h(k)})
            })
        }, Uga = [za("selector"), da("execute", zl), Xd("onEscape"), da("captureTab", !1), Ofa()], Vga = function (a, b) {
            return b.focusManager().get(a).bind(function (a) {
                return L.closest(a, b.selector())
            })
        }, Tp = function (a) {
            return function (b, c, d, e) {
                return aP(b, c, d.selector()).bind(function (b) {
                    return a(b.candidates(), b.index(), e.getNumRows().getOr(d.initSize().numRows()), e.getNumColumns().getOr(d.initSize().numColumns()))
                })
            }
        }, fP = function (a, b, c, d) {
            return c.captureTab() ? g.some(!0) :
                g.none()
        }, gP = Tp(function (a, b, c, d) {
            return dP(a, b, c, d, -1)
        }), hP = Tp(function (a, b, c, d) {
            return dP(a, b, c, d, 1)
        }), Wga = Tp(function (a, b, c, d) {
            return eP(a, b, c, d, -1)
        }), Xga = Tp(function (a, b, c, d) {
            return eP(a, b, c, d, 1)
        }),
        Yga = h([Sa(Qa([37]), Rw(gP, hP)), Sa(Qa([39]), Sw(gP, hP)), Sa(Qa([38]), Dg(Wga)), Sa(Qa([40]), Dg(Xga)), Sa(oe([Wi, Qa([9])]), fP), Sa(oe([wl, Qa([9])]), fP), Sa(Qa([27]), function (a, b, c, d) {
            return c.onEscape()(a, b)
        }), Sa(Qa([32].concat([13])), function (a, b, c, d) {
            return Vga(a, c).bind(function (d) {
                return c.execute()(a, b,
                    d)
            })
        })]), Zga = h({}), $ga = zh(Uga, YO, Yga, Zga, {}, g.some(function (a, b, c) {
            L.descendant(a.element(), b.selector()).each(function (c) {
                b.focusManager().set(a, c)
            })
        })), Up = function (a, b, c, d) {
            return aP(a, c, b).bind(function (a) {
                var b = a.index();
                a = a.candidates();
                b = Xi(b, d, 0, a.length - 1);
                return g.from(a[b])
            })
        },
        aha = [za("selector"), da("getInitial", g.none), da("execute", zl), Xd("onEscape"), da("executeOnMove", !1), da("allowVertical", !0)],
        bha = function (a, b) {
            return b.focusManager().get(a).bind(function (a) {
                return L.closest(a, b.selector())
            })
        },
        Tw = function (a, b, c) {
            return bha(a, c).bind(function (d) {
                return c.execute()(a, b, d)
            })
        }, iP = function (a, b, c) {
            return Up(a, c.selector(), b, -1)
        }, jP = function (a, b, c) {
            return Up(a, c.selector(), b, 1)
        }, kP = function (a) {
            return function (b, c, d) {
                return a(b, c, d).bind(function () {
                    return d.executeOnMove() ? Tw(b, c, d) : g.some(!0)
                })
            }
        }, cha = function (a, b, c, d) {
            return c.onEscape()(a, b)
        }, dha = h({}), eha = h({}), fha = zh(aha, me.init, function (a, b, c, d) {
            a = [37].concat(c.allowVertical() ? [38] : []);
            c = [39].concat(c.allowVertical() ? [40] : []);
            return [Sa(Qa(a),
                kP(Rw(iP, jP))), Sa(Qa(c), kP(Sw(iP, jP))), Sa(Qa([13]), Tw), Sa(Qa([32]), Tw), Sa(Qa([27]), cha)]
        }, dha, eha, g.some(function (a, b) {
            b.getInitial()(a).or(L.descendant(a.element(), b.selector())).each(function (c) {
                b.focusManager().set(a, c)
            })
        })), gha = Aa(["rowIndex", "columnIndex", "cell"], []), Vp = function (a, b, c) {
            return g.from(a[b]).bind(function (a) {
                return g.from(a[c]).map(function (a) {
                    return gha({rowIndex: b, columnIndex: c, cell: a})
                })
            })
        }, lP = function (a, b, c, d) {
            c = Xi(c, d, 0, a[b].length - 1);
            return Vp(a, b, c)
        }, mP = function (a, b, c, d) {
            c =
                Xi(c, d, 0, a.length - 1);
            b = xl(b, 0, a[c].length - 1);
            return Vp(a, c, b)
        }, nP = function (a, b, c, d) {
            c = xl(c + d, 0, a[b].length - 1);
            return Vp(a, b, c)
        }, oP = function (a, b, c, d) {
            c = xl(c + d, 0, a.length - 1);
            b = xl(b, 0, a[c].length - 1);
            return Vp(a, c, b)
        },
        hha = [el("selectors", [za("row"), za("cell")]), da("cycles", !0), da("previousSelector", g.none), da("execute", zl)],
        iha = function (a, b) {
            return E(a, function (a) {
                return Y.descendants(a, b.selectors().cell())
            })
        }, Wp = function (a, b) {
            return function (c, d, e) {
                var f = e.cycles() ? a : b;
                return L.closest(d, e.selectors().row()).bind(function (a) {
                    var b =
                        Y.descendants(a, e.selectors().cell());
                    return bP(b, d).bind(function (b) {
                        var d = Y.descendants(c, e.selectors().row());
                        return bP(d, a).bind(function (a) {
                            var c = iha(d, e);
                            return f(c, a, b).map(function (a) {
                                return a.cell()
                            })
                        })
                    })
                })
            }
        }, pP = Wp(function (a, b, c) {
            return lP(a, b, c, -1)
        }, function (a, b, c) {
            return nP(a, b, c, -1)
        }), qP = Wp(function (a, b, c) {
            return lP(a, b, c, 1)
        }, function (a, b, c) {
            return nP(a, b, c, 1)
        }), jha = Wp(function (a, b, c) {
            return mP(a, c, b, -1)
        }, function (a, b, c) {
            return oP(a, c, b, -1)
        }), kha = Wp(function (a, b, c) {
            return mP(a, c, b, 1)
        },
        function (a, b, c) {
            return oP(a, c, b, 1)
        }),
        lha = h([Sa(Qa([37]), Rw(pP, qP)), Sa(Qa([39]), Sw(pP, qP)), Sa(Qa([38]), Dg(jha)), Sa(Qa([40]), Dg(kha)), Sa(Qa([32].concat([13])), function (a, b, c) {
            return Z.search(a.element()).bind(function (d) {
                return c.execute()(a, b, d)
            })
        })]), mha = h({}), nha = h({}), oha = zh(hha, me.init, lha, mha, nha, g.some(function (a, b) {
            b.previousSelector()(a).orThunk(function () {
                var c = b.selectors();
                return L.descendant(a.element(), c.cell())
            }).each(function (c) {
                b.focusManager().set(a, c)
            })
        })), pha = [za("selector"), da("execute",
        zl), da("moveOnTab", !1)], rP = function (a, b, c) {
            return c.focusManager().get(a).bind(function (d) {
                return c.execute()(a, b, d)
            })
        }, sP = function (a, b, c) {
            return Up(a, c.selector(), b, -1)
        }, tP = function (a, b, c) {
            return Up(a, c.selector(), b, 1)
        }, qha = h([Sa(Qa([38]), Dg(sP)), Sa(Qa([40]), Dg(tP)), Sa(oe([Wi, Qa([9])]), function (a, b, c) {
            return c.moveOnTab() ? Dg(sP)(a, b, c) : g.none()
        }), Sa(oe([wl, Qa([9])]), function (a, b, c) {
            return c.moveOnTab() ? Dg(tP)(a, b, c) : g.none()
        }), Sa(Qa([13]), rP), Sa(Qa([32]), rP)]), rha = h({}), sha = h({}), tha = zh(pha, me.init,
        qha, rha, sha, g.some(function (a, b) {
            L.descendant(a.element(), b.selector()).each(function (c) {
                b.focusManager().set(a, c)
            })
        })),
        uha = [Xd("onSpace"), Xd("onEnter"), Xd("onShiftEnter"), Xd("onLeft"), Xd("onRight"), Xd("onTab"), Xd("onShiftTab"), Xd("onUp"), Xd("onDown"), Xd("onEscape"), Dd("focusIn")],
        vha = zh(uha, me.init, function (a, b, c) {
            return [Sa(Qa([32]), c.onSpace()), Sa(oe([wl, Qa([13])]), c.onEnter()), Sa(oe([Wi, Qa([13])]), c.onShiftEnter()), Sa(oe([Wi, Qa([9])]), c.onShiftTab()), Sa(oe([wl, Qa([9])]), c.onTab()), Sa(Qa([38]),
                c.onUp()), Sa(Qa([40]), c.onDown()), Sa(Qa([37]), c.onLeft()), Sa(Qa([39]), c.onRight()), Sa(Qa([32]), c.onSpace()), Sa(Qa([27]), c.onEscape())]
        }, function () {
            return {}
        }, function () {
            return {}
        }, g.some(function (a, b) {
            return b.focusIn().bind(function (c) {
                return c(a, b)
            })
        })), wha = Lga.schema(), xha = Mga.schema(), yha = fha.schema(), zha = $ga.schema(), Aha = oha.schema(),
        Bha = Qga.schema(), Cha = tha.schema(), Dha = vha.schema(), Al = function (a) {
            var b = Oe("Creating behaviour: " + a.name, Aga, a);
            a = bL(b.branchKey, b.branches);
            var c = b.name, d = b.active,
                e = b.apis, f = b.extra;
            b = b.state;
            var k = fl(c, [qL("config", a)]);
            return PO(a, k, c, d, e, f, b)
        }({
            branchKey: "mode",
            branches: Object.freeze({
                acyclic: wha,
                cyclic: xha,
                flow: yha,
                flatgrid: zha,
                matrix: Aha,
                execution: Bha,
                menu: Cha,
                special: Dha
            }),
            name: "keying",
            active: {
                events: function (a, b) {
                    return a.handler().toEvents(a, b)
                }
            },
            apis: {
                focusIn: function (a) {
                    a.getSystem().triggerFocus(a.element(), a.element())
                }, setGridSize: function (a, b, c, d, e) {
                    ye(c, "setGridSize") ? c.setGridSize(d, e) : ld.error("Layout does not support setGridSize")
                }
            },
            state: Rga
        }),
        Eha = Object.freeze({
            getCurrent: function (a, b, c) {
                return b.find()(a)
            }
        }), Fha = [za("find")], ze = Cg({fields: Fha, name: "composing", apis: Eha}), uP = function (a, b) {
            b.ignore() || (Z.focus(a.element()), b.onFocus()(a))
        }, Gha = Object.freeze({
            focus: uP, blur: function (a, b) {
                b.ignore() || Z.blur(a.element())
            }, isFocused: function (a) {
                return Z.hasFocus(a.element())
            }
        }), Hha = Object.freeze({
            exhibit: function (a, b) {
                a = b.ignore() ? {} : {attributes: {tabindex: "-1"}};
                return Vi(a)
            }, events: function (a) {
                return pb([Yb(yh(), function (b, c) {
                    uP(b, a);
                    c.stop()
                })].concat(a.stopMousedown() ?
                    [Yb(ql(), function (a, c) {
                        c.event().prevent()
                    })] : []))
            }
        }), Iha = [Ag("onFocus"), da("stopMousedown", !1), da("ignore", !1)],
        Yi = Cg({fields: Iha, name: "focusing", active: Hha, apis: Gha}), Uw = aa.detect().deviceType.isTouch(),
        Eg = function (a) {
            return Nw({
                name: "" + a + "-edge", overrides: function (b) {
                    return b.model().manager().edgeActions()[a].fold(function () {
                        return {}
                    }, function (a) {
                        var c = pb([Aw(pl(), a, [b])]), e = pb([Aw(ql(), a, [b]), Aw(vw(), function (b, c) {
                            c.mouseIsDown().get() && a(b, c)
                        }, [b])]);
                        return {events: Uw ? c : e}
                    })
                }
            })
        }, Jha = Eg("top-left"),
        Kha = Eg("top"), Lha = Eg("top-right"), Mha = Eg("right"), Nha = Eg("bottom-right"), Oha = Eg("bottom"),
        Pha = Eg("bottom-left"), Qha = Eg("left"), Rha = Sp({
            name: "thumb", defaults: h({dom: {styles: {position: "absolute"}}}), overrides: function (a) {
                return {events: pb([Ui(pl(), a, "spectrum"), Ui(tw(), a, "spectrum"), Ui(uw(), a, "spectrum"), Ui(ql(), a, "spectrum"), Ui(vw(), a, "spectrum"), Ui(kO(), a, "spectrum")])}
            }
        }), Sha = Sp({
            schema: [ug("mouseIsDown", function () {
                return na(!1)
            })], name: "spectrum", overrides: function (a) {
                var b = a.model().manager(), c =
                    function (c, d) {
                        return b.getValueFromEvent(d).map(function (d) {
                            return b.setValueFrom(c, a, d)
                        })
                    }, d = pb([Yb(pl(), c), Yb(tw(), c)]), e = pb([Yb(ql(), c), Yb(vw(), function (b, d) {
                    a.mouseIsDown().get() && c(b, d)
                })]);
                return {
                    behaviours: pb(Uw ? [] : [Al.config({
                        mode: "special", onLeft: function (c) {
                            return b.onLeft(c, a)
                        }, onRight: function (c) {
                            return b.onRight(c, a)
                        }, onUp: function (c) {
                            return b.onUp(c, a)
                        }, onDown: function (c) {
                            return b.onDown(c, a)
                        }
                    }), Yi.config({})]), events: Uw ? d : e
                }
            }
        }), Tha = [Qha, Mha, Kha, Oha, Jha, Lha, Pha, Nha, Rha, Sha], Vw = function (a,
                                                                                     b, c) {
            b.store().manager().onLoad(a, b, c)
        }, vP = function (a, b, c) {
            b.store().manager().onUnload(a, b, c)
        }, Uha = Object.freeze({
            onLoad: Vw, onUnload: vP, setValue: function (a, b, c, d) {
                b.store().manager().setValue(a, b, c, d)
            }, getValue: function (a, b, c) {
                return b.store().manager().getValue(a, b, c)
            }, getState: function (a, b, c) {
                return c
            }
        }), Vha = Object.freeze({
            events: function (a, b) {
                var c = a.resetOnDom() ? [Pp(function (c, e) {
                    Vw(c, a, b)
                }), pfa(function (c, e) {
                    vP(c, a, b)
                })] : [wga(a, b, Vw)];
                return pb(c)
            }
        }), wP = function () {
            var a = na(null);
            return tl({
                set: a.set,
                get: a.get, isNotSet: function () {
                    return null === a.get()
                }, clear: function () {
                    a.set(null)
                }, readState: function () {
                    return {mode: "memory", value: a.get()}
                }
            })
        }, xP = function () {
            var a = na({}), b = na({});
            return tl({
                readState: function () {
                    return {mode: "dataset", dataByValue: a.get(), dataByText: b.get()}
                }, lookup: function (c) {
                    return YK(a.get(), c).orThunk(function () {
                        return YK(b.get(), c)
                    })
                }, update: function (c) {
                    var d = a.get(), e = b.get(), f = {}, k = {};
                    z(c, function (a) {
                        f[a.value] = a;
                        k[a.text] = a
                    });
                    a.set(oa(d, f));
                    b.set(oa(e, k))
                }, clear: function () {
                    a.set({});
                    b.set({})
                }
            })
        }, Wha = Object.freeze({
            memory: wP, dataset: xP, manual: function () {
                return tl({
                    readState: function () {
                    }
                })
            }, init: function (a) {
                return a.store().manager().state(a)
            }
        }), yP = function (a, b, c, d) {
            var e = b.store();
            c.update([d]);
            e.setValue()(a, d);
            b.onSetValue()(a, d)
        }, Xha = [Dd("initialValue"), za("getFallbackEntry"), za("getDataKey"), za("setValue"), Bg("manager", {
            setValue: yP, getValue: function (a, b, c) {
                var d = b.store(), e = d.getDataKey()(a);
                return c.lookup(e).fold(function () {
                    return d.getFallbackEntry()(e)
                }, function (a) {
                    return a
                })
            },
            onLoad: function (a, b, c) {
                b.store().initialValue().each(function (d) {
                    yP(a, b, c, d)
                })
            }, onUnload: function (a, b, c) {
                c.clear()
            }, state: xP
        })], Yha = [za("getValue"), da("setValue", t), Dd("initialValue"), Bg("manager", {
            setValue: function (a, b, c, d) {
                b.store().setValue()(a, d);
                b.onSetValue()(a, d)
            }, getValue: function (a, b, c) {
                return b.store().getValue()(a)
            }, onLoad: function (a, b, c) {
                b.store().initialValue().each(function (c) {
                    b.store().setValue()(a, c)
                })
            }, onUnload: t, state: me.init
        })], Zha = [Dd("initialValue"), Bg("manager", {
            setValue: function (a,
                                b, c, d) {
                c.set(d);
                b.onSetValue()(a, d)
            }, getValue: function (a, b, c) {
                return c.get()
            }, onLoad: function (a, b, c) {
                b.store().initialValue().each(function (a) {
                    c.isNotSet() && c.set(a)
                })
            }, onUnload: function (a, b, c) {
                c.clear()
            }, state: wP
        })], $ha = [function (a, b, c) {
            return Dc(a, a, Ne.defaultedThunk(h(b)), c)
        }("store", {mode: "memory"}, eL("mode", {
            memory: Zha,
            manual: Yha,
            dataset: Xha
        })), Ag("onSetValue"), da("resetOnDom", !1)], Wb = Cg({
            fields: $ha, name: "representing", active: Vha, apis: Uha, extra: {
                setValueFrom: function (a, b) {
                    b = Wb.getValue(b);
                    Wb.setValue(a,
                        b)
                }
            }, state: Wha
        }), aia = aa.detect().deviceType.isTouch(), Bl = h("slider.change.value"), Ww = function (a) {
            a = a.event().raw();
            return aia ? void 0 !== a.touches && 1 === a.touches.length ? g.some(a.touches[0]).map(function (a) {
                return Ra(a.clientX, a.clientY)
            }) : g.none() : void 0 !== a.clientX ? g.some(a).map(function (a) {
                return Ra(a.clientX, a.clientY)
            }) : g.none()
        }, Xw = function (a, b, c, d) {
            return a < b ? a : a > c ? c : a === b ? b - 1 : Math.max(b, a - d)
        }, Yw = function (a, b, c, d) {
            return a > c ? a : a < b ? b : a === c ? c + 1 : Math.min(c, a + d)
        }, bia = function (a, b, c, d, e) {
            return e.fold(function () {
                return Math.max(b -
                    1, Math.min(c + 1, b + Math.round((a - b) / d) * d))
            }, function (b) {
                return Math.max(b, b + Math.min(Math.floor((c - b) / d), Math.floor((a - b) / d) + Math.round((a - b) % d / d)) * d)
            })
        }, zP = function (a) {
            var b = a.min, c = a.max, d = a.value, e = a.step, f = a.snapStart, k = a.rounded, g = a.minBound,
                h = a.maxBound, m = a.hasMinEdge ? b - 1 : b, n = a.hasMaxEdge ? c + 1 : c;
            if (d < g) return m;
            if (d > h) return n;
            d = Math.max(m, Math.min(n, (Math.min(h, Math.max(d, g)) - g) / a.screenRange * a.range + b));
            return a.snap && d >= b && d <= c ? bia(d, b, c, e, f) : k ? Math.round(d) : d
        }, AP = function (a) {
            var b = a.min, c =
                    a.max, d = a.range, e = a.value, f = a.hasMinEdge, k = a.hasMaxEdge, g = a.maxBound, h = a.maxOffset,
                m = a.centerMinEdge;
            a = a.centerMaxEdge;
            return e < b ? f ? 0 : m : e > c ? k ? g : a : (e - b) / d * h
        }, Ue = function (a) {
            return a.model().minX()
        }, Ve = function (a) {
            return a.model().minY()
        }, We = function (a) {
            return a.model().maxX()
        }, Xe = function (a) {
            return a.model().maxY()
        }, Fg = function (a, b, c) {
            return b(a) - c(a)
        }, Gg = function (a, b) {
            return void 0 !== a[b + "-edge"]
        }, If = function (a) {
            return a.model().value().get()
        }, Hg = function (a, b) {
            return {x: h(a), y: h(b)}
        }, Yd = function (a,
                          b) {
            Te(a, Bl(), {value: b})
        }, rc = function (a) {
            return a.element().dom().getBoundingClientRect()
        }, BP = function (a, b) {
            a = rc(a);
            b = rc(b);
            return (a.left + a.right) / 2 - b.left
        }, CP = function (a, b) {
            a = rc(a);
            b = rc(b);
            return (a.top + a.bottom) / 2 - b.top
        }, Xp = function (a, b) {
            Te(a, Bl(), {value: b})
        }, Zw = function (a, b, c) {
            a = {
                min: Ue(b),
                max: We(b),
                range: Fg(b, We, Ue),
                value: c,
                step: b.stepSize(),
                snap: b.snapToGrid(),
                snapStart: b.snapStart(),
                rounded: b.rounded(),
                hasMinEdge: Gg(b, "left"),
                hasMaxEdge: Gg(b, "right"),
                minBound: rc(a).left,
                maxBound: rc(a).right,
                screenRange: rc(a).width
            };
            return zP(a)
        }, cia = function (a, b, c) {
            a = (0 < a ? Yw : Xw)(If(c).x(), Ue(c), We(c), c.stepSize());
            Xp(b, {x: h(a)});
            return g.some(a)
        }, DP = function (a) {
            return function (b, c) {
                return cia(a, b, c).map(function () {
                    return !0
                })
            }
        }, dia = function (a, b, c, d, e) {
            var f = rc(a).width;
            d = d.bind(function (b) {
                return g.some(BP(b, a))
            }).getOr(0);
            e = e.bind(function (b) {
                return g.some(BP(b, a))
            }).getOr(f);
            b = {
                min: Ue(b),
                max: We(b),
                range: Fg(b, We, Ue),
                value: c,
                hasMinEdge: Gg(b, "left"),
                hasMaxEdge: Gg(b, "right"),
                minBound: rc(a).left,
                minOffset: 0,
                maxBound: rc(a).right,
                maxOffset: f,
                centerMinEdge: d,
                centerMaxEdge: e
            };
            return AP(b)
        }, $w = function (a, b, c, d, e, f) {
            c = dia(b, f, c, d, e);
            return rc(b).left - rc(a).left + c
        }, eia = DP(-1), fia = DP(1), gia = g.none, hia = g.none, iia = h({
            "top-left": g.none(), top: g.none(), "top-right": g.none(), right: g.some(function (a, b) {
                Yd(a, {x: h(b.model().maxX() + 1)})
            }), "bottom-right": g.none(), bottom: g.none(), "bottom-left": g.none(), left: g.some(function (a, b) {
                Yd(a, {x: h(b.model().minX() - 1)})
            })
        }), jia = Object.freeze({
            setValueFrom: function (a, b, c) {
                b = Zw(a, b, c);
                c = {x: h(b)};
                Xp(a, c);
                return b
            }, setToMin: function (a, b) {
                b = Ue(b);
                Xp(a, {x: h(b)})
            }, setToMax: function (a, b) {
                b = We(b);
                Xp(a, {x: h(b)})
            }, findValueOfOffset: Zw, getValueFromEvent: function (a) {
                return Ww(a).map(function (a) {
                    return a.left()
                })
            }, findPositionOfValue: $w, setPositionFromValue: function (a, b, c, d) {
                var e = If(c);
                a = $w(a, d.getSpectrum(a), e.x(), d.getLeftEdge(a), d.getRightEdge(a), c);
                c = Ia.get(b.element()) / 2;
                v.set(b.element(), "left", a - c + "px")
            }, onLeft: eia, onRight: fia, onUp: gia, onDown: hia, edgeActions: iia
        }), Yp = function (a, b) {
            Te(a, Bl(), {value: b})
        },
        ax = function (a, b, c) {
            a = {
                min: Ve(b),
                max: Xe(b),
                range: Fg(b, Xe, Ve),
                value: c,
                step: b.stepSize(),
                snap: b.snapToGrid(),
                snapStart: b.snapStart(),
                rounded: b.rounded(),
                hasMinEdge: Gg(b, "top"),
                hasMaxEdge: Gg(b, "bottom"),
                minBound: rc(a).top,
                maxBound: rc(a).bottom,
                screenRange: rc(a).height
            };
            return zP(a)
        }, kia = function (a, b, c) {
            a = (0 < a ? Yw : Xw)(If(c).y(), Ve(c), Xe(c), c.stepSize());
            Yp(b, {y: h(a)});
            return g.some(a)
        }, EP = function (a) {
            return function (b, c) {
                return kia(a, b, c).map(function () {
                    return !0
                })
            }
        }, lia = function (a, b, c, d, e) {
            var f = rc(a).height;
            d = d.bind(function (b) {
                return g.some(CP(b, a))
            }).getOr(0);
            e = e.bind(function (b) {
                return g.some(CP(b, a))
            }).getOr(f);
            b = {
                min: Ve(b),
                max: Xe(b),
                range: Fg(b, Xe, Ve),
                value: c,
                hasMinEdge: Gg(b, "top"),
                hasMaxEdge: Gg(b, "bottom"),
                minBound: rc(a).top,
                minOffset: 0,
                maxBound: rc(a).bottom,
                maxOffset: f,
                centerMinEdge: d,
                centerMaxEdge: e
            };
            return AP(b)
        }, bx = function (a, b, c, d, e, f) {
            c = lia(b, f, c, d, e);
            return rc(b).top - rc(a).top + c
        }, mia = g.none, nia = g.none, oia = EP(-1), pia = EP(1), qia = h({
            "top-left": g.none(), top: g.some(function (a, b) {
                Yd(a, {
                    y: h(b.model().minY() -
                        1)
                })
            }), "top-right": g.none(), right: g.none(), "bottom-right": g.none(), bottom: g.some(function (a, b) {
                Yd(a, {y: h(b.model().maxY() + 1)})
            }), "bottom-left": g.none(), left: g.none()
        }), ria = Object.freeze({
            setValueFrom: function (a, b, c) {
                b = ax(a, b, c);
                c = {y: h(b)};
                Yp(a, c);
                return b
            }, setToMin: function (a, b) {
                b = Ve(b);
                Yp(a, {y: h(b)})
            }, setToMax: function (a, b) {
                b = Xe(b);
                Yp(a, {y: h(b)})
            }, findValueOfOffset: ax, getValueFromEvent: function (a) {
                return Ww(a).map(function (a) {
                    return a.top()
                })
            }, findPositionOfValue: bx, setPositionFromValue: function (a,
                                                                        b, c, d) {
                var e = If(c);
                a = bx(a, d.getSpectrum(a), e.y(), d.getTopEdge(a), d.getBottomEdge(a), c);
                c = sa.get(b.element()) / 2;
                v.set(b.element(), "top", a - c + "px")
            }, onLeft: mia, onRight: nia, onUp: oia, onDown: pia, edgeActions: qia
        }), Zp = function (a, b) {
            Te(a, Bl(), {value: b})
        }, $p = function (a, b) {
            return {x: h(a), y: h(b)}
        }, sia = function (a, b, c, d) {
            var e = 0 < a ? Yw : Xw;
            a = b ? If(d).x() : e(If(d).x(), Ue(d), We(d), d.stepSize());
            b = b ? e(If(d).y(), Ve(d), Xe(d), d.stepSize()) : If(d).y();
            Zp(c, $p(a, b));
            return g.some(a)
        }, aq = function (a, b) {
            return function (c, d) {
                return sia(a,
                    b, c, d).map(function () {
                    return !0
                })
            }
        }, tia = aq(-1, !1), uia = aq(1, !1), via = aq(-1, !0), wia = aq(1, !0), xia = h({
            "top-left": g.some(function (a, b) {
                Yd(a, Hg(b.model().minX() - 1, b.model().minY() - 1))
            }), top: g.some(function (a, b) {
                Yd(a, Hg(Fg(b, We, Ue) / 2, b.model().minY() - 1))
            }), "top-right": g.some(function (a, b) {
                Yd(a, Hg(b.model().maxX() + 1, b.model().minY() - 1))
            }), right: g.some(function (a, b) {
                Yd(a, Hg(b.model().maxX() + 1, Fg(b, Xe, Ve) / 2))
            }), "bottom-right": g.some(function (a, b) {
                Yd(a, Hg(b.model().maxX() + 1, b.model().maxY() + 1))
            }), bottom: g.some(function (a,
                                         b) {
                Yd(a, Hg(Fg(b, We, Ue) / 2, b.model().maxY() + 1))
            }), "bottom-left": g.some(function (a, b) {
                Yd(a, Hg(b.model().minX() - 1, b.model().maxY() + 1))
            }), left: g.some(function (a, b) {
                Yd(a, Hg(b.model().minX() - 1, Fg(b, Xe, Ve) / 2))
            })
        }), yia = Object.freeze({
            setValueFrom: function (a, b, c) {
                var d = Zw(a, b, c.left());
                b = ax(a, b, c.top());
                d = $p(d, b);
                Zp(a, d);
                return d
            }, setToMin: function (a, b) {
                var c = Ue(b);
                b = Ve(b);
                Zp(a, $p(c, b))
            }, setToMax: function (a, b) {
                var c = We(b);
                b = Xe(b);
                Zp(a, $p(c, b))
            }, getValueFromEvent: function (a) {
                return Ww(a)
            }, setPositionFromValue: function (a,
                                               b, c, d) {
                var e = If(c), f = $w(a, d.getSpectrum(a), e.x(), d.getLeftEdge(a), d.getRightEdge(a), c);
                a = bx(a, d.getSpectrum(a), e.y(), d.getTopEdge(a), d.getBottomEdge(a), c);
                c = Ia.get(b.element()) / 2;
                d = sa.get(b.element()) / 2;
                v.set(b.element(), "left", f - c + "px");
                v.set(b.element(), "top", a - d + "px")
            }, onLeft: tia, onRight: uia, onUp: via, onDown: wia, edgeActions: xia
        }), zia = aa.detect().deviceType.isTouch(),
        Aia = [da("stepSize", 1), da("onChange", t), da("onInit", t), da("onDragStart", t), da("onDragEnd", t), da("snapToGrid", !1), da("rounded", !0), Dd("snapStart"),
            gp("model", eL("mode", {
                x: [da("minX", 0), da("maxX", 100), ug("value", function (a) {
                    return na(a.mode.minX)
                }), za("getInitialValue"), Bg("manager", jia)],
                y: [da("minY", 0), da("maxY", 100), ug("value", function (a) {
                    return na(a.mode.minY)
                }), za("getInitialValue"), Bg("manager", ria)],
                xy: [da("minX", 0), da("maxX", 100), da("minY", 0), da("maxY", 100), ug("value", function (a) {
                    return na({x: h(a.mode.minX), y: h(a.mode.minY)})
                }), za("getInitialValue"), Bg("manager", yia)]
            })), ul("sliderBehaviours", [Al, Wb])].concat(zia ? [] : [ug("mouseIsDown",
            function () {
                return na(!1)
            })]), Bia = function (a, b) {
            return b.universal() ? a : ka(a, function (a) {
                return U(b.channels(), a)
            })
        }, Cia = Object.freeze({
            events: function (a) {
                return pb([Yb(lO(), function (b, c) {
                    var d = a.channels(), e = cb(d);
                    e = Bia(e, c);
                    z(e, function (a) {
                        var e = d[a](), f = e.schema();
                        a = "channel[" + a + "] data\nReceiver: " + Tg(b.element());
                        var g = c.data();
                        f = Ki(tg(a, f, g));
                        e.onReceive()(b, f)
                    })
                })])
            }
        }), Dia = [gp("channels", function (a, b) {
            var c = function (b, c) {
                return aL(Ji(a)).extract(b, ca, c)
            };
            return {
                extract: function (a, e, f) {
                    var d =
                        cb(f);
                    return c(a, d).bind(function (c) {
                        c = E(c, function (a) {
                            return tv.field(a, a, sg(), b)
                        });
                        return Cc(c).extract(a, e, f)
                    })
                }, toString: function () {
                    return "setOf(" + b.toString() + ")"
                }, toDsl: function () {
                    return Zk.setOf(a, b)
                }
            }
        }(I.value, od([Gw("onHandler", "onReceive", sg()), da("schema", cp())])))],
        Eia = Cg({fields: Dia, name: "receiving", active: Cia}), FP = aa.detect().deviceType.isTouch(), Zi = MO({
            name: "Slider", configFields: Aia, partFields: Tha, factory: function (a, b, c, d) {
                var e = function (b) {
                    return IO(b, a, "thumb")
                }, f = function (b) {
                    return IO(b,
                        a, "spectrum")
                }, k = function (b) {
                    return ne(b, a, "left-edge")
                }, l = function (b) {
                    return ne(b, a, "right-edge")
                }, m = function (b) {
                    return ne(b, a, "top-edge")
                }, n = function (b) {
                    return ne(b, a, "bottom-edge")
                }, w = a.model(), p = w.manager(), r = function (b, c) {
                    p.setPositionFromValue(b, c, a, {
                        getLeftEdge: k,
                        getRightEdge: l,
                        getTopEdge: m,
                        getBottomEdge: n,
                        getSpectrum: f
                    })
                }, t = function (b, c) {
                    w.value().set(c);
                    var d = e(b);
                    r(b, d);
                    a.onChange()(b, d, c);
                    return g.some(!0)
                };
                c = [Yb(pl(), function (b, c) {
                    a.onDragStart()(b, e(b))
                }), Yb(uw(), function (b, c) {
                    a.onDragEnd()(b,
                        e(b))
                })];
                d = [Yb(ql(), function (b, c) {
                    c.stop();
                    a.onDragStart()(b, e(b));
                    a.mouseIsDown().set(!0)
                }), Yb(kO(), function (b, c) {
                    a.onDragEnd()(b, e(b));
                    a.mouseIsDown().set(!1)
                })];
                c = FP ? c : d;
                return {
                    uid: a.uid(),
                    dom: a.dom(),
                    components: b,
                    behaviours: oa(pb(Qb([FP ? [] : [Al.config({
                            mode: "special", focusIn: function (b) {
                                return ne(b, a, "spectrum").map(Al.focusIn).map(h(!0))
                            }
                        })], [Wb.config({
                            store: {
                                mode: "manual", getValue: function (b) {
                                    return a.model().value().get()
                                }
                            }
                        }), Eia.config({
                            channels: {
                                "mouse.released": {
                                    onReceive: function (b, c) {
                                        a.mouseIsDown().set(!1)
                                    }
                                }
                            }
                        })]])),
                        a.sliderBehaviours().dump()),
                    events: pb([Yb(Bl(), function (a, b) {
                        t(a, b.event().value())
                    }), Pp(function (b, c) {
                        c = w.getInitialValue();
                        w.value().set(c());
                        c = e(b);
                        r(b, c);
                        var d = f(b);
                        a.onInit()(b, c, d, w.value().get())
                    })].concat(c)),
                    apis: {
                        resetToMin: function (b) {
                            p.setToMin(b, a)
                        }, resetToMax: function (b) {
                            p.setToMax(b, a)
                        }, changeValue: t, refresh: r
                    },
                    domModification: {styles: {position: "relative"}}
                }
            }, apis: {
                resetToMin: function (a, b) {
                    a.resetToMin(b)
                }, resetToMax: function (a, b) {
                    a.resetToMax(b)
                }, refresh: function (a, b) {
                    a.refresh(b)
                }
            }
        }),
        GP = /^#?([a-f\d])([a-f\d])([a-f\d])$/i, HP = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i, Fia = function (a) {
            return GP.test(a) || HP.test(a)
        }, Gia = function (a) {
            a = a.value().replace(GP, function (a, c, d, e) {
                return c + c + d + d + e + e
            });
            return {value: h(a)}
        }, cx = function (a) {
            a = a.toString(16);
            return 1 == a.length ? "0" + a : a
        }, dx = function (a) {
            a = cx(a.red()) + cx(a.green()) + cx(a.blue());
            return {value: h(a)}
        }, IP = Math.min, JP = Math.max, bq = Math.round, Cl = function (a, b, c, d) {
            return {red: h(a), green: h(b), blue: h(c), alpha: h(d)}
        }, ex = function (a) {
            var b = parseInt(a,
                10);
            return b.toString() === a && 0 <= b && 255 >= b
        }, KP = function (a) {
            var b;
            var c = (a.hue() || 0) % 360;
            var d = a.saturation() / 100;
            a = a.value() / 100;
            d = JP(0, IP(d, 1));
            a = JP(0, IP(a, 1));
            if (0 === d) {
                var e = b = d = bq(255 * a);
                return Cl(e, b, d, 1)
            }
            e = c / 60;
            d *= a;
            c = d * (1 - Math.abs(e % 2 - 1));
            a -= d;
            switch (Math.floor(e)) {
                case 0:
                    e = d;
                    b = c;
                    d = 0;
                    break;
                case 1:
                    e = c;
                    b = d;
                    d = 0;
                    break;
                case 2:
                    e = 0;
                    b = d;
                    d = c;
                    break;
                case 3:
                    e = 0;
                    b = c;
                    break;
                case 4:
                    e = c;
                    b = 0;
                    break;
                case 5:
                    e = d;
                    b = 0;
                    d = c;
                    break;
                default:
                    e = b = d = 0
            }
            e = bq(255 * (e + a));
            b = bq(255 * (b + a));
            d = bq(255 * (d + a));
            return Cl(e, b, d, 1)
        }, fx =
            function (a) {
                a = Gia(a);
                var b = HP.exec(a.value());
                a = parseInt(b[1], 16);
                var c = parseInt(b[2], 16);
                b = parseInt(b[3], 16);
                return Cl(a, c, b, 1)
            }, LP = function (a) {
            return "rgba(" + a.red() + "," + a.green() + "," + a.blue() + "," + a.alpha() + ")"
        }, MP = h(Cl(255, 0, 0, 1)), Hia = h(Ha("rgb-hex-update")), NP = h(Ha("slider-update")),
        OP = h(Ha("palette-update")), Iia = {
            paletteFactory: function (a, b) {
                var c = Zi.parts().spectrum({
                    dom: {
                        tag: "canvas",
                        attributes: {role: "presentation"},
                        classes: [b("sv-palette-spectrum")]
                    }
                }), d = Zi.parts().thumb({
                    dom: {
                        tag: "div",
                        attributes: {role: "presentation"},
                        classes: [b("sv-palette-thumb")],
                        innerHtml: "<div class=" + b("sv-palette-inner-thumb") + ' role="presentation"></div>'
                    }
                }), e = function (a, b) {
                    var c = a.width, d = a.height;
                    a = a.getContext("2d");
                    a.fillStyle = b;
                    a.fillRect(0, 0, c, d);
                    b = a.createLinearGradient(0, 0, c, 0);
                    b.addColorStop(0, "rgba(255,255,255,1)");
                    b.addColorStop(1, "rgba(255,255,255,0)");
                    a.fillStyle = b;
                    a.fillRect(0, 0, c, d);
                    b = a.createLinearGradient(0, 0, 0, d);
                    b.addColorStop(0, "rgba(0,0,0,0)");
                    b.addColorStop(1, "rgba(0,0,0,1)");
                    a.fillStyle = b;
                    a.fillRect(0, 0, c, d)
                };
                return vl({
                    factory: function (a) {
                        a =
                            h({x: h(0), y: h(0)});
                        var f = pb([ze.config({find: g.some}), Yi.config({})]);
                        return Zi.sketch({
                            dom: {tag: "div", attributes: {role: "presentation"}, classes: [b("sv-palette")]},
                            model: {mode: "xy", getInitialValue: a},
                            rounded: !1,
                            components: [c, d],
                            onChange: function (a, b, c) {
                                Te(a, OP(), {value: c})
                            },
                            onInit: function (a, b, c, d) {
                                e(c.element().dom(), LP(MP()))
                            },
                            sliderBehaviours: f
                        })
                    }, name: "SaturationBrightnessPalette", configFields: [], apis: {
                        setRgba: function (a, b, c) {
                            a = b.components()[0].element().dom();
                            e(a, LP(c))
                        }
                    }, extraApis: {}
                })
            }
        }, Jia =
            {
                sliderFactory: function (a, b) {
                    a = Zi.parts().spectrum({
                        dom: {
                            tag: "div",
                            classes: [b("hue-slider-spectrum")],
                            attributes: {role: "presentation"}
                        }
                    });
                    var c = Zi.parts().thumb({
                        dom: {
                            tag: "div",
                            classes: [b("hue-slider-thumb")],
                            attributes: {role: "presentation"}
                        }
                    });
                    return Zi.sketch({
                        dom: {tag: "div", classes: [b("hue-slider")], attributes: {role: "presentation"}},
                        rounded: !1,
                        model: {mode: "y", getInitialValue: h({y: h(0)})},
                        components: [a, c],
                        sliderBehaviours: pb([Yi.config({})]),
                        onChange: function (a, b, c) {
                            Te(a, NP(), {value: c})
                        }
                    })
                }
            }, gx =
            function (a) {
                var b = void 0 !== a.uid && ye(a, "uid") ? a.uid : Ha("memento");
                return {
                    get: function (a) {
                        return a.getSystem().getByUid(b).getOrDie()
                    }, getOpt: function (a) {
                        return a.getSystem().getByUid(b).fold(g.none, g.some)
                    }, asSpec: function () {
                        return oa(a, {uid: b})
                    }
                }
            }, PP = function (a, b) {
            b = pb(b);
            b = Cg({fields: [za("enabled")], name: a, active: {events: h(b)}});
            return {key: a, value: {config: {}, me: b, configAsRaw: h({}), initialConfig: {}, state: me}}
        }, Kia = [ul("formBehaviours", [Wb])], Lia = function (a, b) {
            return a.fold(function () {
                    return I.error(b)
                },
                I.value)
        }, Mia = function (a, b, c) {
            return oa({
                "debug.sketcher": {Form: c},
                uid: a.uid(),
                dom: a.dom(),
                components: b,
                behaviours: oa(pb([Wb.config({
                    store: {
                        mode: "manual", getValue: function (b) {
                            b = oga(b, a);
                            return eb(b, function (a, b) {
                                return a().bind(function (a) {
                                    a = ze.getCurrent(a);
                                    return Lia(a, "missing current")
                                }).map(Wb.getValue)
                            })
                        }, setValue: function (b, c) {
                            Ma(c, function (c, d) {
                                ne(b, a, d).each(function (a) {
                                    ze.getCurrent(a).each(function (a) {
                                        Wb.setValue(a, c)
                                    })
                                })
                            })
                        }
                    }
                })]), a.formBehaviours().dump()),
                apis: {
                    getField: function (b, c) {
                        return ne(b,
                            a, c).bind(ze.getCurrent)
                    }
                }
            })
        }, QP = {
            getField: Ew(function (a, b, c) {
                return a.getField(b, c)
            }), sketch: function (a) {
                var b = function () {
                    var a = [];
                    return {
                        field: function (b, c) {
                            a.push(b);
                            b = "<alloy.field." + b + ">";
                            return {uiType: EO(), owner: "form", name: b, config: c, validated: {}}
                        }, record: function () {
                            return a
                        }
                    }
                }();
                a = a(b);
                b = b.record();
                b = E(b, function (a) {
                    return Sp({name: a, pname: "<alloy.field." + a + ">"})
                });
                return LO("form", Kia, b, Mia, a)
            }
        }, Nia = h([da("prefix", "form-field"), ul("fieldBehaviours", [ze, Wb])]), Oia = h([Nw({
            schema: [za("dom")],
            name: "label"
        }), Nw({
            factory: {
                sketch: function (a) {
                    return {
                        uid: a.uid,
                        dom: {
                            tag: "span",
                            styles: {display: "none"},
                            attributes: {"aria-hidden": "true"},
                            innerHtml: a.text
                        }
                    }
                }
            }, schema: [za("text")], name: "aria-descriptor"
        }), Sp({
            factory: {
                sketch: function (a) {
                    var b = Jaa(a, ["factory"]);
                    return a.factory.sketch(b)
                }
            }, schema: [za("factory")], name: "field"
        })]), Ah = MO({
            name: "FormField", configFields: Nia(), partFields: Oia(), factory: function (a, b, c, d) {
                c = oa(pb([ze.config({
                    find: function (b) {
                        return ne(b, a, "field")
                    }
                }), Wb.config({
                    store: {
                        mode: "manual",
                        getValue: function (a) {
                            return ze.getCurrent(a).bind(Wb.getValue)
                        }, setValue: function (a, b) {
                            ze.getCurrent(a).each(function (a) {
                                Wb.setValue(a, b)
                            })
                        }
                    }
                })]), a.fieldBehaviours().dump());
                d = pb([Pp(function (b, c) {
                    var d = nga(b, a, ["label", "field", "aria-descriptor"]);
                    d.field().each(function (b) {
                        var c = Ha(a.prefix());
                        d.label().each(function (a) {
                            m.set(a.element(), "for", c);
                            m.set(b.element(), "id", c)
                        });
                        d["aria-descriptor"]().each(function (c) {
                            var d = Ha(a.prefix());
                            m.set(c.element(), "id", d);
                            m.set(b.element(), "aria-labelledby",
                                d)
                        })
                    })
                })]);
                return {
                    uid: a.uid(), dom: a.dom(), components: b, behaviours: c, events: d, apis: {
                        getField: function (b) {
                            return ne(b, a, "field")
                        }, getLabel: function (b) {
                            return ne(b, a, "label")
                        }
                    }
                }
            }, apis: {
                getField: function (a, b) {
                    return a.getField(b)
                }, getLabel: function (a, b) {
                    return a.getLabel(b)
                }
            }
        }),
        Pia = h([Dd("data"), da("inputAttributes", {}), da("inputStyles", {}), da("type", "input"), da("tag", "input"), da("inputClasses", []), Ag("onSetValue"), da("styles", {}), Dd("placeholder"), da("eventOrder", {}), ul("inputBehaviours", [Wb, Yi]), da("selectOnFocus",
            !0)]), Qia = function (a) {
            return pb([Yi.config({
                onFocus: !1 === a.selectOnFocus() ? t : function (a) {
                    a = a.element();
                    var b = fa.get(a);
                    a.dom().setSelectionRange(0, b.length)
                }
            })])
        }, Ria = function (a) {
            return oa(pb([Wb.config({
                store: {
                    mode: "manual", initialValue: a.data().getOr(void 0), getValue: function (a) {
                        return fa.get(a.element())
                    }, setValue: function (a, c) {
                        fa.get(a.element()) !== c && fa.set(a.element(), c)
                    }
                }, onSetValue: a.onSetValue()
            })]), Qia(a), a.inputBehaviours().dump())
        }, Sia = function (a) {
            return {
                tag: a.tag(), attributes: oa(pb([{
                    key: "type",
                    value: a.type()
                }].concat(a.placeholder().map(function (a) {
                    return {key: "placeholder", value: a}
                }).toArray())), a.inputAttributes()), styles: a.inputStyles(), classes: a.inputClasses()
            }
        }, Tia = vl({
            name: "Input", configFields: Pia(), factory: function (a, b) {
                return {uid: a.uid(), dom: Sia(a), components: [], behaviours: Ria(a), eventOrder: a.eventOrder()}
            }
        }), Uia = aa.detect().browser.isFirefox(), Via = {position: "absolute", left: "-9999px"}, Wia = function (a, b) {
            var c = r.fromTag("span", a.dom());
            m.set(c, "role", "presentation");
            a = r.fromText(b,
                a.dom());
            y.append(c, a);
            return c
        }, Xia = function (a, b) {
            var c = Ha("ephox-alloy-aria-voice");
            m.set(b, "id", c);
            m.set(a, "aria-describedby", c)
        }, Yia = function (a, b, c) {
            var d = A.owner(b), e = Wia(d, c);
            Uia && Xia(b, e);
            m.setAll(e, a(c));
            v.setAll(e, Via);
            y.append(b, e);
            Kf(function () {
                m.remove(e, "aria-live");
                F.remove(e)
            }, 1E3)
        }, Zia = function (a) {
            return {"aria-live": "assertive", "aria-atomic": "true", role: "alert"}
        }, $ia = function (a, b) {
            return Yia(Zia, a, b)
        }, aja = ["input", "textarea"], RP = function (a) {
            a = D.name(a);
            return U(aja, a)
        }, SP = function (a,
                          b) {
            var c = b.getRoot()(a).getOr(a.element());
            n.remove(c, b.invalidClass());
            b.notify().each(function (b) {
                RP(a.element()) && m.remove(c, "title");
                b.getContainer()(a).each(function (a) {
                    Ea.set(a, b.validHtml())
                });
                b.onValid()(a)
            })
        }, TP = function (a, b, c, d) {
            c = b.getRoot()(a).getOr(a.element());
            n.add(c, b.invalidClass());
            b.notify().each(function (b) {
                RP(a.element()) && m.set(a.element(), "title", d);
                $ia(ja.body(), d);
                b.getContainer()(a).each(function (a) {
                    Ea.set(a, d)
                });
                b.onInvalid()(a, d)
            })
        }, UP = function (a, b, c) {
            return b.validator().fold(function () {
                    return Ga.pure(I.value(!0))
                },
                function (b) {
                    return b.validate()(a)
                })
        }, hx = function (a, b, c) {
            b.notify().each(function (b) {
                b.onValidate()(a)
            });
            return UP(a, b, c).map(function (d) {
                return a.getSystem().isConnected() ? d.fold(function (d) {
                    TP(a, b, c, d);
                    return I.error(d)
                }, function (c) {
                    SP(a, b);
                    return I.value(c)
                }) : I.error("No longer in system")
            })
        }, bja = Object.freeze({
            markValid: SP, markInvalid: TP, query: UP, run: hx, isInvalid: function (a, b) {
                a = b.getRoot()(a).getOr(a.element());
                return n.has(a, b.invalidClass())
            }
        }), cja = Object.freeze({
            events: function (a, b) {
                return a.validator().map(function (c) {
                    return pb([Yb(c.onEvent(),
                        function (c) {
                            hx(c, a, b).get(ca)
                        })].concat(c.validateOnLoad() ? [Pp(function (c) {
                        hx(c, a, b).get(t)
                    })] : []))
                }).getOr({})
            }
        }),
        dja = [za("invalidClass"), da("getRoot", g.none), fl("notify", [da("aria", "alert"), da("getContainer", g.none), da("validHtml", ""), Ag("onValid"), Ag("onInvalid"), Ag("onValidate")]), fl("validator", [za("validate"), da("onEvent", "input"), da("validateOnLoad", !0)])],
        cq = Cg({
            fields: dja, name: "invalidating", active: cja, apis: bja, extra: {
                validation: function (a) {
                    return function (b) {
                        b = Wb.getValue(b);
                        return Ga.pure(a(b))
                    }
                }
            }
        }),
        eja = Object.freeze({
            exhibit: function (a, b) {
                return Vi({attributes: pb([{key: b.tabAttr(), value: "true"}])})
            }
        }), fja = [da("tabAttr", "data-alloy-tabstop")], gja = Cg({fields: fja, name: "tabstopping", active: eja}),
        VP = Ha("valid-input"), WP = Ha("invalid-input"), XP = Ha("validating-input"), hja = {
            rgbFormFactory: function (a, b, c, d) {
                var e = function (c, d) {
                    return cq.config({
                        invalidClass: b("invalid"), notify: {
                            onValidate: function (a) {
                                Te(a, XP, {type: c})
                            }, onValid: function (a) {
                                Te(a, VP, {type: c, value: Wb.getValue(a)})
                            }, onInvalid: function (a) {
                                Te(a,
                                    WP, {type: c, value: Wb.getValue(a)})
                            }
                        }, validator: {
                            validate: function (b) {
                                b = Wb.getValue(b);
                                b = d(b) ? I.value(!0) : I.error(a("aria.input.invalid"));
                                return Ga.pure(b)
                            }, validateOnLoad: !1
                        }
                    })
                }, f = function (b, c, d, f, k) {
                    var g = a("colorcustom.rgb.range");
                    d = Ah.parts().label({dom: {tag: "label", innerHtml: d, attributes: {"aria-label": f}}});
                    b = Ah.parts().field({
                        data: k,
                        factory: Tia,
                        inputAttributes: {type: "text"},
                        inputBehaviours: pb([e(c, b), gja.config({})]),
                        onSetValue: function (a) {
                            cq.isInvalid(a) && cq.run(a).get(t)
                        }
                    });
                    b = [d, b];
                    c = "hex" !==
                    c ? [Ah.parts()["aria-descriptor"]({text: g})] : [];
                    return {dom: {tag: "div", attributes: {role: "presentation"}}, components: b.concat(c)}
                }, k = function (a, b) {
                    var c = dx(b);
                    QP.getField(a, "hex").each(function (b) {
                        Yi.isFocused(b) || Wb.setValue(a, {hex: c.value()})
                    });
                    return c
                }, l = function (a, b) {
                    var c = b.red(), d = b.green();
                    b = b.blue();
                    Wb.setValue(a, {red: c, green: d, blue: b})
                }, m = gx({
                    dom: {
                        tag: "div",
                        classes: [b("rgba-preview")],
                        styles: {"background-color": "white"},
                        attributes: {role: "presentation"}
                    }
                }), n = function (a, b) {
                    m.getOpt(a).each(function (a) {
                        v.set(a.element(),
                            "background-color", "#" + b.value())
                    })
                };
                return vl({
                    factory: function (e) {
                        var q = {
                            red: h(na(g.some(255))),
                            green: h(na(g.some(255))),
                            blue: h(na(g.some(255))),
                            hex: h(na(g.some("ffffff")))
                        }, w = function (a, b) {
                            q[a]().set(b)
                        }, p = function () {
                            return q.red().get().bind(function (a) {
                                return q.green().get().bind(function (b) {
                                    return q.blue().get().map(function (c) {
                                        return Cl(a, b, c, 1)
                                    })
                                })
                            })
                        }, r = function (a) {
                            var b = a.red(), c = a.green();
                            a = a.blue();
                            w("red", g.some(b));
                            w("green", g.some(c));
                            w("blue", g.some(a))
                        }, t = function (a, b) {
                            b = b.event();
                            "hex" !== b.type() ? w(b.type(), g.none()) : d(a)
                        }, C = function (a, b, c) {
                            c = parseInt(c, 10);
                            w(b, g.some(c));
                            p().each(function (b) {
                                b = k(a, b);
                                n(a, b)
                            })
                        }, u = function (a, b) {
                            b = b.event();
                            if ("hex" === b.type()) {
                                var d = b.value();
                                c(a);
                                b = {value: h(d)};
                                w("hex", g.some(d));
                                d = fx(b);
                                l(a, d);
                                r(d);
                                Te(a, Hia(), {hex: b});
                                n(a, b)
                            } else C(a, b.type(), b.value())
                        };
                        e = function (b) {
                            return {
                                label: a("colorcustom.rgb." + b + ".label"),
                                description: a("colorcustom.rgb." + b + ".description")
                            }
                        };
                        var v = e("red"), y = e("green"), x = e("blue"), z = e("hex");
                        return oa(QP.sketch(function (c) {
                            return {
                                dom: {
                                    tag: "form",
                                    classes: [b("rgb-form")], attributes: {"aria-label": a("aria.color.picker")}
                                },
                                components: [c.field("red", Ah.sketch(f(ex, "red", v.label, v.description, 255))), c.field("green", Ah.sketch(f(ex, "green", y.label, y.description, 255))), c.field("blue", Ah.sketch(f(ex, "blue", x.label, x.description, 255))), c.field("hex", Ah.sketch(f(Fia, "hex", z.label, z.description, "ffffff"))), m.asSpec()],
                                formBehaviours: pb([cq.config({invalidClass: b("form-invalid")}), PP("rgb-form-events", [Yb(VP, u), Yb(WP, t), Yb(XP, t)])])
                            }
                        }), {
                            apis: {
                                updateHex: function (a,
                                                     b) {
                                    Wb.setValue(a, {hex: b.value()});
                                    var c = fx(b);
                                    l(a, c);
                                    r(c);
                                    n(a, b)
                                }
                            }
                        })
                    }, name: "RgbForm", configFields: [], apis: {
                        updateHex: function (a, b, c) {
                            a.updateHex(b, c)
                        }
                    }, extraApis: {}
                })
            }
        }, dq = function (a, b, c) {
            return {hue: h(a), saturation: h(b), value: h(c)}
        }, FX = {
            makeFactory: function (a, b) {
                return vl({
                    name: "ColourPicker",
                    configFields: [da("onValidHex", t), da("onInvalidHex", t), qL("formChangeEvent", Yaa)],
                    factory: function (c) {
                        var d = hja.rgbFormFactory(a, b, c.onValidHex(), c.onInvalidHex()), e = Iia.paletteFactory(a, b),
                            f = {paletteRgba: h(na(MP()))},
                            k = gx(e.sketch({})), g = gx(d.sketch({})), m = function (a, b) {
                                k.getOpt(a).each(function (a) {
                                    var c = fx(b);
                                    f.paletteRgba().set(c);
                                    e.setRgba(a, c)
                                })
                            }, n = function (a, b) {
                                g.getOpt(a).each(function (a) {
                                    d.updateHex(a, b)
                                })
                            }, w = function (a, b, c) {
                                z(c, function (c) {
                                    c(a, b)
                                })
                            };
                        return {
                            uid: c.uid(),
                            dom: c.dom(),
                            components: [k.asSpec(), Jia.sliderFactory(a, b), g.asSpec()],
                            behaviours: pb([PP("colour-picker-events", [Yb(OP(), function () {
                                var a = [n];
                                return function (b, c) {
                                    c = c.event().value();
                                    var d = f.paletteRgba().get();
                                    var e = d.red() / 255;
                                    var k = d.green() /
                                        255;
                                    d = d.blue() / 255;
                                    var g = Math.min(e, Math.min(k, d));
                                    var h = Math.max(e, Math.max(k, d));
                                    e = g === h ? dq(0, 0, 100 * g) : dq(Math.round(60 * ((e === g ? 3 : d === g ? 1 : 5) - (e === g ? k - d : d === g ? e - k : d - e) / (h - g))), Math.round((h - g) / h * 100), Math.round(100 * h));
                                    c = dq(e.hue(), c.x(), 100 - c.y());
                                    c = KP(c);
                                    c = dx(c);
                                    w(b, c, a)
                                }
                            }()), Yb(NP(), function () {
                                var a = [m, n];
                                return function (b, c) {
                                    c = c.event().value().y();
                                    c = dq(360 * (100 - c / 100), 100, 100);
                                    c = KP(c);
                                    c = dx(c);
                                    w(b, c, a)
                                }
                            }())]), ze.config({
                                find: function (a) {
                                    return g.getOpt(a)
                                }
                            }), Al.config({mode: "acyclic"})])
                        }
                    }
                })
            }
        },
        YP = function (a) {
            var b = $e(a) ? a : 10, c = um.access("local.customColors");
            a = c.read();
            var d = function () {
                return n1(b, function () {
                    return "#ffffff"
                })
            }, e = function (a) {
                return 0 > b - a.length ? a.slice(0, b) : a
            }(Mb(a) ? a : d()), f = function (a) {
                e.splice(a, 1)
            };
            return {
                add: function (a) {
                    Gc(e, a).each(f);
                    e.unshift(a);
                    e.length >= b && e.pop();
                    c.write(e)
                }, state: function () {
                    return e.slice(0)
                }
            }
        }(10), Fm = {
            create: function (a, b) {
                var c = H.create({selected: p(["color"]), menuDone: p([])}), d = r.fromTag("div"), e = Oc(),
                    f = x.translate("font.colorcustom");
                S.button(e.element(),
                    f);
                e.events.click.bind(function () {
                    c.trigger.menuDone();
                    a.hideInlineSelection();
                    var d = HX(a, b);
                    d.events.color.bind(function (a) {
                        YP.add(a.color());
                        c.trigger.selected(a.color());
                        d.destroy()
                    });
                    d.show()
                });
                e.content(Rc(f));
                n.add(e.element(), B.resolve("color-picker-custom"));
                S.presentation(d);
                var k = Dm(d), g = ha.button(e.element(), Ba.button({execute: Kb.click})), h = Tea();
                return {
                    elements: [e.element(), d], layouts: [g, k.grid], events: c.registry, refresh: function () {
                        var a = E(YP.state(), function (a) {
                            return {text: a, value: a}
                        });
                        a = Ij.create(a);
                        h.set(a);
                        F.empty(d);
                        y.append(d, a.element());
                        a.events.selected.bind(function (a) {
                            c.trigger.selected(a.value())
                        });
                        a.show();
                        k.refresh()
                    }, destroy: function () {
                        k.destroy();
                        g.destroy();
                        h.clear()
                    }
                }
            }, stub: function (a, b) {
                return {
                    elements: [],
                    layouts: [],
                    events: H.create({selected: p([]), menuDone: p([])}).registry,
                    refresh: t,
                    destroy: t
                }
            }
        }, RX = {
            widget: function (a, b) {
                var c = a.content(), d = a.undo(), e = a.selections(), f = a.smartview().uiContainer(), k = IX(c, f, b),
                    g = H.create({
                        color: Q(["value"], k.events.color), highlight: Q(["value"],
                            k.events.highlight), done: p([]), abort: Q([], k.events.abort)
                    });
                k.events.color.bind(function (a) {
                    g.trigger.done();
                    Uf.foreground(c, d, e, a.value());
                    c.toEditing()
                });
                k.events.highlight.bind(function (a) {
                    g.trigger.done();
                    Uf.background(c, d, e, a.value());
                    c.toEditing()
                });
                k.events.menuDone.bind(function () {
                    return g.trigger.done()
                });
                return {
                    element: k.element,
                    name: h("color"),
                    textkey: h(x.key("font.coloroption")),
                    menuTextkey: h(x.key("aria.color.menu")),
                    open: k.open,
                    close: k.close,
                    updateWidget: function (b) {
                        lj.isHighContrast(a.smartview()) ?
                            b.disable() : k.open()
                    },
                    ability: t,
                    destroy: k.destroy,
                    events: g.registry,
                    label: h(!1)
                }
            }
        }, LX = Aa(["i18nNamespace", "cssNamespace", "property", "tag", "specials"], []), PX = {
            widget: function (a, b) {
                b = Mq.cata(b, h(t), h(function (a) {
                    a.initLayout()
                }));
                var c = a.content(), d = a.undo(), e = Gm(Am.configuration());
                b(e);
                var f = H.create({done: p([]), abort: Q([], e.events.abort)});
                e.events.close.bind(function (a) {
                    f.trigger.done()
                });
                e.events.action.bind(function (b) {
                    var e = Z.active();
                    c.focus();
                    Uf.size(c, d, a.selections(), b.value());
                    e.each(Z.focus)
                });
                return {
                    element: e.element,
                    item: e.item,
                    name: h("size"),
                    textkey: h(x.key("font.size")),
                    open: e.open,
                    close: e.close,
                    updateInlineWidget: function () {
                        var b = Cm.getState(a.selections(), c);
                        e.updateInlineWidget(b.readState, b.fallbackSize)
                    },
                    ability: t,
                    destroy: e.destroy,
                    events: f.registry
                }
            }
        }, OX = {
            widget: function (a, b) {
                var c = a.content(), d = a.smartview().uiContainer();
                b = a.ui().tabstrip.element;
                var e = a.undo(), f = Gm(Am.configuration()), k = f.input(), g = rm(b());
                m.set(k, "disabled", "true");
                var q = K.bind(k, "touchstart", function (b) {
                    b.kill();
                    g.closeMenus();
                    var f = MX(c, d, u(Gm, Am.configuration()));
                    f.show();
                    b = f.contents;
                    var k = Cm.getState(a.selections(), c), h = function () {
                        f.destroy();
                        c.cursorIntoView()
                    };
                    b.updateInlineWidget(k.readState, k.fallbackSize);
                    b.events.close.bind(h);
                    b.events.action.bind(function (b) {
                        Uf.size(c, e, a.selections(), b.value())
                    });
                    f.events.close.bind(f.destroy);
                    f.events.ok.bind(function (b) {
                        Uf.size(c, e, a.selections(), b.value());
                        h()
                    })
                }), n = H.create({done: p([]), abort: Q([], f.events.abort)});
                f.events.close.bind(function (a) {
                    n.trigger.done()
                });
                f.events.action.bind(function (b) {
                    Uf.size(c, e, a.selections(), b.value())
                });
                return {
                    element: f.element,
                    item: f.item,
                    name: h("size"),
                    textkey: h(x.key("font.size")),
                    open: f.open,
                    close: f.close,
                    updateInlineWidget: function () {
                        var b = Cm.getState(a.selections(), c);
                        f.updateInlineWidget(b.readState, b.fallbackSize)
                    },
                    ability: t,
                    destroy: function () {
                        q.unbind();
                        f.destroy()
                    },
                    events: n.registry
                }
            }
        }, QX = {
            face: function (a) {
                return Zb.toSelection(a.get()).map(function (a) {
                    a = U(["td", "th"], D.name(a.startContainer())) ? kb.freefallLtr(a.startContainer()).element() :
                        a.startContainer();
                    a = vj.value(a, "font-family");
                    return xf.isEmpty(a) ? Da.off() : Da.on(a)
                }).getOrThunk(Da.unchanged)
            }
        }, TX = function (a) {
            var b = a.baseUrl;
            !0 === a.source && (b += "/licenses");
            return b + "/textbox-licenses.html"
        }, Dl = function (a, b) {
            return a.map(function (a) {
                return a.bind(function (a) {
                    var c = a[b];
                    return void 0 === c ? I.error("Cannot find method " + b + " in help article list: " + cb(a)) : vb(c) ? I.value(c()) : I.error("Key " + b + " in help article list was not a function")
                })
            })
        }, VX = function (a) {
            a = gn.addScript(a, ca);
            a.get(function (a) {
                a.each(function (a) {
                    Wf.weakMatch(a.version,
                        "Help articles").each(function (a) {
                        console.warn(a)
                    })
                })
            });
            return {
                about: Dl(a, "about"),
                accessibility: Dl(a, "accessibility"),
                a11ycheck: Dl(a, "a11ycheck"),
                markdown: Dl(a, "markdown"),
                shortcuts: Dl(a, "shortcuts")
            }
        }, Mj = function (a, b) {
            return a ? g.some(b) : g.none()
        }, XX = function (a) {
            var b = {item: h(".ephox-pastry-statebutton.ephox-pastry-tablayout-item")},
                c = Ba.flow({trigger: Kb.button, executeOnArrow: !0});
            return ha.flow(a.menu(), b, c)
        }, YX = function (a) {
            var b = {stops: h(["a"])}, c = Ba.page({trigger: Kb.click, first: ".ephox-pastry-tablayout-active"});
            return ha.page(a.body(), b, c)
        }, bY = O("prefix", "suffix", "style"), zA = {
            rehighlight: function (a, b, c) {
                var d = A.children(c), e = E(d, function (a) {
                    return D.isText(a) ? Ya.get(a) : ""
                }).join("");
                qa(b, function (a) {
                    return Gb(e, a.prefix()) && je(e, a.suffix())
                }).fold(function () {
                    a.preserve(function () {
                        F.unwrap(c)
                    })
                }, function (b) {
                    var e = r.fromTag("span");
                    ma.add(e, [rf.highlightClass()]);
                    v.setAll(e, b.style());
                    a.preserve(function () {
                        y.before(c, e);
                        P.append(e, d);
                        F.remove(c)
                    })
                })
            }, unhighlight: function (a, b) {
                var c = A.children(b), d = r.fromTag("span");
                ma.add(d, [rf.placeholderClass()]);
                a.preserve(function () {
                    y.before(b, d);
                    F.unwrap(b);
                    P.append(d, c)
                })
            }
        }, ija = function (a, b) {
            b = E(b, function (a) {
                var b = Cb.sanitise(a.prefix()), c = Cb.sanitise(a.suffix());
                b = Cb.unsafetoken(b + "[^" + c + "]*" + c);
                return {pattern: h(b), style: a.style}
            });
            return Mo.findmany(a, b)
        }, jja = hr("." + rf.highlightClass(), Na.unwrap), cY = {
            run: function (a, b) {
                a.body().each(function (a) {
                    qm.filterDom(a, [jja]);
                    a = ed.descendants(a, D.isText);
                    z(a, function (a) {
                        var c = Ya.get(a);
                        c = ija(c, b);
                        var d = ia(c, function (a) {
                            return [a.start(),
                                a.finish()]
                        }), k = ti.subdivide(a, d);
                        z(c, function (a) {
                            var b = Rd.sublist(k, a.start(), a.finish());
                            b = E(b, function (a) {
                                return a.element()
                            });
                            wi.wrapper(b, function () {
                                var b = r.fromTag("span");
                                ma.add(b, [rf.highlightClass()]);
                                v.setAll(b, a.style());
                                return wi.nu(b)
                            })
                        })
                    })
                })
            }
        }, ix = B.resolve("input-invalid-field"), kja = function (a) {
            return parseInt(a, 10).toString() === a && 0 <= parseInt(a, 10)
        }, ZP = function (a, b, c) {
            var d = fa.get(a);
            if ("" === d) return I.value("");
            var e = r.fromTag("img");
            c = kja(d) ? d + c.getOr("") : d;
            v.set(e, b, c);
            c = v.getRaw(e,
                b);
            v.remove(e, b);
            return c.fold(function () {
                return I.error(a)
            }, I.value)
        }, $P = function (a) {
            n.remove(a, ix)
        }, Mc = {
            highlight: function (a) {
                ib.shout(a, x.translate("aria.input.invalid"));
                n.add(a, ix)
            }, dehighlight: $P, clearHighlights: function (a) {
                a = Y.descendants(a, "." + ix);
                z(a, $P)
            }, validate: function (a) {
                return Eb(a, function (a, c) {
                    return a.bind(function (a) {
                        return ZP(c.input(), c.property(), c.defaultUnit()).map(function (b) {
                            fa.set(c.input(), b);
                            var d = {};
                            d[c.property()] = h(b);
                            return oa(d, a)
                        })
                    })
                }, I.value({}))
            }, validateField: ZP,
            rule: O("input", "property", "defaultUnit")
        }, lja = O("size", "unit"), eq = function (a) {
            return Ip.identify(a).fold(g.none, function (a, c, d) {
                return g.some(lja(c, d))
            })
        }, tr = {
            fromHeight: function (a, b) {
                return eq(b).map(function (b) {
                    return Math.ceil(a * b.size()) + b.unit()
                })
            }, fromWidth: function (a, b) {
                return eq(b).map(function (b) {
                    return Math.ceil(1 / a * b.size()) + b.unit()
                })
            }, calculate: function (a, b) {
                return eq(a).fold(g.none, function (a) {
                    return eq(b).fold(g.none, function (b) {
                        return g.some((a.size() + 0) / (b.size() + 0))
                    })
                })
            }
        }, mja = aa.detect(),
        aQ = O("value", "text", "attrs"), bQ = function (a) {
            return "img" === D.name(a)
        }, cQ = function (a) {
            return 0 === a.length ? Jb : function (b) {
                return vc.allowedForEditing(b, a)
            }
        }, BA = {
            image: function (a) {
                var b = cQ(a.imageExcludes), c = g.none(),
                    d = H.create({properties: p(["image"]), contextmenu: p(["image"])});
                return {
                    situation: function (a) {
                        a = c.map(function (a) {
                            return [aQ("imagemenu-properties", x.translate("image.context.properties"), {})]
                        }).getOr([]);
                        return {primary: h(a), secondary: h([]), submenus: h([])}
                    }, handle: function (a) {
                        c.each(function (a) {
                            d.trigger.properties(a)
                        })
                    },
                    assign: function (e) {
                        c = e.filter(bQ).filter(b);
                        c.each(function (b) {
                            mja.browser.isFirefox() || ie.select(a, b);
                            d.trigger.contextmenu(b)
                        })
                    }, events: d.registry
                }
            }, imageEdit: function (a, b, c, d) {
                var e = cQ(d), f = g.none(), k = function (a) {
                    return E(a, function (a) {
                        return aQ(a.spec.value, x.get(a.spec.textkey), {})
                    })
                };
                return {
                    situation: function (a) {
                        a = f.map(k).getOr([]);
                        return {primary: h(a), secondary: h([]), submenus: h([])}
                    }, handle: function (a) {
                        f.each(function (b) {
                            var c = m.get(a, "data-ephox-gopher-item-value");
                            qa(b, function (a) {
                                return a.spec.value ===
                                    c
                            }).each(function (a) {
                                a.spec.action()
                            })
                        })
                    }, assign: function (d) {
                        f = a() ? g.some(b) : d.filter(bQ).filter(e).map(h(c))
                    }
                }
            }
        }, CA = {
            generate: function (a, b, c) {
                a = function () {
                    e();
                    d.trigger.close()
                };
                var d = H.create({ok: Q(c, b.events.ok), close: p([])});
                b.events.close.bind(a);
                var e = function () {
                    b.destroy()
                };
                return {
                    open: function () {
                        b.open()
                    }, hide: a, destroy: e, represent: b.represent, events: d.registry
                }
            }
        }, dQ = ta.generate([{html: ["key", "value"]}, {css: ["key", "value"]}]), eQ = function (a, b) {
            return Qb(Nf(a, function (a, d) {
                var c = [];
                if (m.has(b,
                    d)) {
                    var f = m.get(b, d);
                    c.push(dQ.html(a, f))
                }
                v.getRaw(b, d).each(function (b) {
                    c.push(dQ.css(a, b))
                });
                return c
            }))
        }, nja = function (a) {
            v.remove(a, "width");
            v.remove(a, "height");
            m.remove(a, "width");
            m.remove(a, "height")
        }, oja = u(eQ, {width: "width", height: "height"}), pja = u(eQ, {width: "height", height: "width"}), fQ = h([]),
        sf = {
            keepCrop: fQ, keepFlip: oja, keepRotate: pja, keepResample: fQ, updater: function (a, b) {
                var c = a(b);
                return Ua.effect(function () {
                    nja(b);
                    z(c, function (a) {
                        a.fold(function (a, c) {
                            m.set(b, a, c)
                        }, function (a, c) {
                            v.set(b,
                                a, c)
                        })
                    })
                })
            }
        }, gQ = function (a) {
            return "" !== a.trim() && !Bb(a, "://")
        }, ur = {
            local: function (a) {
                return Gb(a, "data:") || Gb(a, "blob:") || Gb(a, "file:")
            }, relative: gQ, sameDomain: function (a, b) {
                if ("" === a.trim() || "" === b.trim()) return !1;
                if (gQ(a)) return !0;
                b = Sh.parse(b);
                a = Sh.parse(a);
                return b.host === a.host && b.port === a.port
            }
        }, qja = O("bannerMessage", "consoleMessage"), hQ = function (a) {
            return vb(a.message) && vb(a.status) && vb(a.responseText)
        }, iQ = function (a) {
            if (hQ(a)) {
                var b = a.responseText();
                return a.message() + ". Response code " + a.status() +
                    (0 === b.length ? "." : ". Error details: " + b)
            }
            return a
        }, wr = {
            diagnoseImageEdit: function (a, b) {
                var c = 18 === a.code || "SecurityError" === a.name ? "imageedit.needsproxy" : hQ(a) && 0 === a.status() ? "imageedit.proxyerror" : "imageedit.generic",
                    d = Sh.parse(b);
                b = "" === d.host || ur.relative(b) ? b : "" === d.port ? d.host : d.host + ":" + d.port;
                c = mf.get(c, [b]);
                return qja(c, iQ(a))
            }, consoleMessage: iQ
        }, Ph = {
            make: function (a, b, c) {
                return {
                    type: "general",
                    spec: {
                        value: a,
                        textkey: x.key(b),
                        action: c,
                        updateGeneral: t,
                        icon: !0,
                        hasPopup: !1,
                        toggle: !1,
                        tooltip: qb.get
                    }
                }
            }
        },
        rja = h(4), tb = {resolve: Lb.create("ephox-clipper").resolve, CORNER_SIZE: rja}, sja = function (a, b) {
            a = {left: "0px", top: "0px", width: a.width() + "px", height: a.height() + "px"};
            b = {left: v.get(b, "left"), top: v.get(b, "top"), width: v.get(b, "width"), height: v.get(b, "height")};
            return {outside: h(a), inside: h(b)}
        }, tja = {
            snap: function (a, b) {
                var c = sja(a, b), d = r.fromTag("div");
                n.add(d, tb.resolve("dynamic-box"));
                v.setAll(d, c.outside());
                var e = r.fromTag("div");
                n.add(e, tb.resolve("opaque-box"));
                v.setAll(e, c.outside());
                var f = function (a,
                                  b) {
                    return 2 < Math.abs(parseInt(a, 10) - parseInt(b, 10))
                }, k = function (a) {
                    return Ga.nu(function (b) {
                        b(a)
                    })
                }, g = function (a, b) {
                    return Ga.nu(function (c) {
                        var d = K.bind(a, "transitionend", function () {
                            d.unbind();
                            c(a)
                        });
                        v.setAll(a, b.inside())
                    })
                };
                return {
                    prepare: function (a, c, f) {
                        var k = m.get(c, "src"), g = v.get(c, "width");
                        c = v.get(c, "height");
                        v.setAll(b, {
                            "background-image": "url(" + k + ")",
                            "background-size": g + " " + c,
                            "background-position-x": -f.left() + "px",
                            "background-position-y": -f.top() + "px"
                        });
                        n.add(b, tb.resolve("snapshot"));
                        n.add(d,
                            tb.resolve("dynamic-box-animate"));
                        P.append(a, [d, e]);
                        v.reflow(a)
                    }, showcase: function () {
                        var a = c.outside(), b = c.inside();
                        return f(a.left, b.left) || f(a.top, b.top) || f(a.right, b.right) || f(a.bottom, b.bottom) ? g(d, c) : k(d)
                    }
                }
            }
        }, uY = {
            slide: function () {
                return {
                    animate: function (a, b, c, d) {
                        c = tja.snap(c.box(), c.shade());
                        c.prepare(a, b, {left: d.cropX, top: d.cropY, width: d.cropWidth, height: d.cropHeight});
                        return c.showcase().map(h(d))
                    }
                }
            }, none: function () {
                return {
                    animate: function (a, b, c, d) {
                        return Ga.pure(d)
                    }
                }
            }
        }, sY = Aa("displayWidth displayHeight cropX cropY cropWidth cropHeight".split(" "),
        []), pY = {
            bind: function (a, b) {
                return K.bind(a, "mousedown", function (a) {
                    a.kill();
                    var c = a.target(), e = !1, f = K.bind(c, "mouseup", function () {
                        e = !0;
                        f.unbind()
                    });
                    setTimeout(function () {
                        e || (f.unbind(), b(c))
                    }, 250)
                })
            }
        }, uja = Aa(["top", "left", "width", "height"], []), vja = Aa(["top", "left"], []), wja = Aa(["top", "left"], []),
        Fb = {boxModel: uja, delta: vja, cornersMovements: wja}, jx = function (a, b) {
            b = Math.min(a.top() + a.height(), Math.max(0, a.top() + b.top()));
            var c = b - a.top();
            a = a.height() - c;
            return {top: b, height: a}
        }, kx = function (a, b, c) {
            a = Math.min(a.width(),
                Math.max(b.left(), b.left() + b.width() + c.left())) - b.left() - b.width();
            return {width: b.width() + a}
        }, lx = function (a, b, c) {
            return Math.min(a.height(), Math.max(b.top(), b.top() + c.top() + b.height())) - b.top()
        }, mx = function (a, b) {
            b = Math.min(a.width() + a.left(), Math.max(0, a.left() + b.left()));
            var c = b - a.left();
            a = a.width() - c;
            return {left: b, width: a}
        }, Lm = {
            nw: function (a, b, c) {
                a = jx(b, c);
                b = mx(b, c);
                return Fb.boxModel({left: b.left, width: b.width, top: a.top, height: a.height})
            }, n: function (a, b, c) {
                a = jx(b, c);
                return Fb.boxModel({
                    left: b.left(),
                    width: b.width(), top: a.top, height: a.height
                })
            }, ne: function (a, b, c) {
                var d = jx(b, c);
                a = kx(a, b, c);
                return Fb.boxModel({left: b.left(), width: a.width, top: d.top, height: d.height})
            }, e: function (a, b, c) {
                a = kx(a, b, c);
                return Fb.boxModel({left: b.left(), width: a.width, top: b.top(), height: b.height()})
            }, se: function (a, b, c) {
                var d = kx(a, b, c);
                a = lx(a, b, c);
                return Fb.boxModel({left: b.left(), width: d.width, top: b.top(), height: a})
            }, s: function (a, b, c) {
                a = lx(a, b, c);
                return Fb.boxModel({left: b.left(), width: b.width(), top: b.top(), height: a})
            },
            sw: function (a, b, c) {
                a = lx(a, b, c);
                c = mx(b, c);
                return Fb.boxModel({left: c.left, width: c.width, top: b.top(), height: a})
            }, w: function (a, b, c) {
                a = mx(b, c);
                return Fb.boxModel({left: a.left, width: a.width, top: b.top(), height: b.height()})
            }, translate: function (a, b, c) {
                var d = Math.min(Math.max(0, b.top() + c.top()), Math.max(0, a.height() - b.height()));
                a = Math.min(Math.max(0, b.left() + c.left()), Math.max(0, a.width() - b.width()));
                return Fb.boxModel({top: d, left: a, width: b.width(), height: b.height()})
            }
        }, Oj = {
            navigation: function (a, b) {
                var c =
                    function (a, c, f) {
                        return function () {
                            b(a, Ra(c, f));
                            return g.some(!0)
                        }
                    };
                return [ea.rule(ea.and([ea.isShift, ea.inSet(R.LEFT())]), c(a, -1, 0)), ea.rule(ea.and([ea.isShift, ea.inSet(R.RIGHT())]), c(a, 1, 0)), ea.rule(ea.and([ea.isShift, ea.inSet(R.UP())]), c(a, 0, -1)), ea.rule(ea.and([ea.isShift, ea.inSet(R.DOWN())]), c(a, 0, 1)), ea.basic(R.LEFT()[0], c(a, -10, 0)), ea.basic(R.RIGHT()[0], c(a, 10, 0)), ea.basic(R.UP()[0], c(a, 0, -10)), ea.basic(R.DOWN()[0], c(a, 0, 10))]
            }
        }, jQ = function (a, b, c) {
            var d = b.top(), e = b.left() + b.width() / 2 - c.middle(),
                f = d + b.height() / 2 - c.middle(), k = b.left() + b.width() - c.right();
            a = b.left() - c.left();
            c = d + b.height() - c.bottom();
            b = Fb.cornersMovements({top: d, left: e});
            e = Fb.cornersMovements({top: c, left: e});
            var g = Fb.cornersMovements({top: f, left: k});
            f = Fb.cornersMovements({top: f, left: a});
            var m = Fb.cornersMovements({top: d, left: a});
            d = Fb.cornersMovements({top: d, left: k});
            k = Fb.cornersMovements({top: c, left: k});
            a = Fb.cornersMovements({top: c, left: a});
            return {n: h(b), s: h(e), e: h(g), w: h(f), nw: h(m), ne: h(d), se: h(k), sw: h(a)}
        }, DA = {
            calculate: function (a,
                                 b) {
                var c = {
                    middle: h(2 * tb.CORNER_SIZE() + 1),
                    right: h(tb.CORNER_SIZE()),
                    left: h(0),
                    bottom: h(tb.CORNER_SIZE())
                };
                return jQ(a, b, c)
            }, limitBounds: function (a, b) {
                var c = {};
                if (20 > b.width()) {
                    var d = 20 - b.width();
                    c.width = b.width() + d;
                    c.left = b.left() === a.left() ? a.left() : b.left() - d
                }
                20 > b.height() && (d = 20 - b.height(), c.height = b.height() + d, c.top = b.top() === a.top() ? a.top() : b.top() - d);
                return ua(b, eb(c, h))
            }, doCalculate: jQ
        }, nx = function (a) {
            return Fb.boxModel({
                left: parseInt(m.get(a, "data-" + tb.resolve("image-left")), 10),
                top: parseInt(m.get(a,
                    "data-" + tb.resolve("image-top")), 10),
                width: parseInt(m.get(a, "data-" + tb.resolve("image-width")), 10),
                height: parseInt(m.get(a, "data-" + tb.resolve("image-height")), 10)
            })
        }, kQ = function (a, b) {
            m.set(a, "data-" + tb.resolve("image-left"), b.left());
            m.set(a, "data-" + tb.resolve("image-top"), b.top());
            m.set(a, "data-" + tb.resolve("image-width"), b.width());
            m.set(a, "data-" + tb.resolve("image-height"), b.height())
        }, Ug = {
            readPosition: nx, writePosition: kQ, updatePosition: function (a, b) {
                var c = nx(a);
                b = b(c);
                c = DA.limitBounds(c, b);
                kQ(a,
                    c);
                return c
            }, drawAtOrigin: function (a) {
                var b = nx(a);
                v.setAll(a, {
                    left: b.left() + "px",
                    top: b.top() + "px",
                    width: b.width() + "px",
                    height: b.height() + "px"
                })
            }
        }, xja = tb.resolve("magic-box"), FA = {magicBox: h(xja)}, Km = {
            grab: function (a, b) {
                m.set(a, "aria-grabbed", b)
            }, effect: function (a, b) {
                m.set(a, "aria-dropeffect", b)
            }
        }, yja = O("help", "ids"), lQ = function (a) {
            m.set(a, "role", "gridcell")
        }, Vg = {
            base: function (a, b) {
                m.setAll(a, {role: "grid", "aria-label": b})
            }, row: function (a) {
                m.set(a, "role", "row")
            }, cell: function (a, b) {
                lQ(a);
                m.set(a, "aria-label",
                    b)
            }, gridcell: lQ, createHelp: function (a, b, c) {
                var d = r.fromTag("div");
                S.presentation(d);
                n.add(d, nk.resolve("aria-help"));
                for (var e = [], f = 0; f < b; f++) {
                    var k = Ha("ephox-aria"), g = r.fromTag("span");
                    S.presentation(g);
                    m.set(g, "id", k);
                    n.add(g, nk.resolve("aria-help"));
                    y.append(g, r.fromText(c.col(f + 1)));
                    y.append(d, g);
                    e[f] = k
                }
                f = [];
                for (k = 0; k < a; k++) {
                    g = Ha("ephox-aria");
                    var h = r.fromTag("span");
                    S.presentation(h);
                    m.set(h, "id", g);
                    n.add(h, nk.resolve("aria-help"));
                    y.append(h, r.fromText(c.row(k + 1)));
                    y.append(d, h);
                    f[k] = [];
                    for (h =
                             0; h < b; h++) f[k][h] = e[h] + " " + g
                }
                return yja(d, f)
            }
        }, Yf = function (a, b, c) {
            var d = r.fromTag("div");
            v.set(d, "position", "absolute");
            var e = r.fromTag("div");
            y.append(d, e);
            c.each(function (a) {
                Vg.cell(d, a);
                Km.grab(d, !1)
            });
            ma.add(d, [tb.resolve("corner-wrapper"), tb.resolve("corner-wrapper-" + b)]);
            ma.add(e, [tb.resolve("corner-element"), tb.resolve("corner-" + a)]);
            m.set(d, "data-" + tb.resolve("direction"), b);
            return d
        }, Zf = function (a, b) {
            v.setAll(a, {top: b.top() + "px", left: b.left() + "px"})
        }, EA = function (a, b, c) {
            var d = b() < c() ? 0 : 1;
            z(a, function (a) {
                v.set(a, "opacity", String(d))
            })
        }, lY = {
            derive: function (a, b) {
                return {
                    leftRim: function () {
                        var c = b.left(), d = a.height();
                        return Fb.boxModel({top: 0, left: 0, width: c, height: d})
                    }, topRim: function () {
                        var c = b.left(), d = a.width() - b.left(), e = b.top();
                        return Fb.boxModel({top: 0, left: c, width: d, height: e})
                    }, rightRim: function () {
                        return Fb.boxModel({
                            top: b.top(),
                            left: b.left() + b.width(),
                            width: a.width() - b.width() - b.left(),
                            height: a.height() - b.top()
                        })
                    }, bottomRim: function () {
                        return Fb.boxModel({
                            top: b.top() + b.height(),
                            left: b.left(), width: b.width(), height: a.height() - b.height() - b.top()
                        })
                    }, shadeBox: h(b)
                }
            }
        }, Im = function (a) {
            var b = r.fromTag("div");
            ma.add(b, [tb.resolve("panel-" + a), tb.resolve("side-panel")]);
            return b
        }, Jm = function (a, b) {
            v.setAll(a, {top: b.top() + "px", left: b.left() + "px", width: b.width() + "px", height: b.height() + "px"})
        }, oY = function (a) {
            var b = a.width();
            a = a.height();
            var c = Math.floor(.125 * a), d = Math.floor(.125 * b);
            return Fb.boxModel({top: c, left: d, width: b - 2 * d, height: a - 2 * c})
        }, rY = function (a) {
            var b = bb.absolute(a), c = b.top(),
                d = sa.get(a);
            b = b.left();
            a = Ia.get(a);
            return Fb.boxModel({top: c, left: b, width: a, height: d})
        }, vY = function (a, b) {
            vc.detect(a.getSelection()).fold(function () {
                a.setRelativeSelection(la.before(b), la.before(b))
            }, function (b) {
                a.setRelativeSelection(la.on(b.image(), 0), la.on(b.image(), 0))
            })
        }, mQ = function (a, b, c, d) {
            return a(function (a) {
                var e = K.bind(b, c, function (b) {
                    sr(k);
                    e.unbind();
                    a(I.value(b))
                }), k = Kf(function () {
                    e.unbind();
                    a(I.error("Event " + c + " did not fire within " + d + "ms"))
                }, d)
            })
        }, zja = {
            cWaitFor: function (a, b, c) {
                return mQ(lf.nu,
                    a, b, c)
            }, waitFor: function (a, b, c) {
                return mQ(Ga.nu, a, b, c)
            }
        }, Aja = Ua.fToFR(Re.single), xr = {
            run: function (a, b, c) {
                return Ua.fromChain([a.getImage, b, Aja, c])
            }, applyEdit: function (a) {
                return function (b) {
                    var c = Qc.cata(b, function (a, b, c) {
                        return c
                    }, function (a, b, c) {
                        return b
                    });
                    m.set(a, "src", c);
                    b = Ua.pure(b);
                    return a.dom().loaded ? b : Ua.bind(zja.waitFor(a, "load", 1E3), h(b))
                }
            }
        }, Bja = function (a) {
            return 20 <= a
        }, ox = function (a) {
            return g.from(a).filter(Bja)
        }, xY = {
            ensureMin: ox, parse: function (a, b) {
                a = ox(a).getOr(0);
                b = ox(b).getOr(0);
                return 0 === a && 0 === b ? g.none() : g.some(Hp(a, b))
            }
        }, AY = function (a) {
            return function (b) {
                var c = b.image(), d = b.asset(), e = function (a) {
                    a.fold(function () {
                        m.remove(c, "src")
                    }, function (a) {
                        Qc.cata(a, function (a, b, d) {
                            m.set(c, "src", d)
                        }, t)
                    })
                };
                return rp.loadIfNeeded(c).bind(function () {
                    return a(d).map(function (a) {
                        e(a);
                        return a
                    })
                })
            }
        }, yY = h(Ua.pure), zY = h(function (a) {
            return Ua.pure(a.asset())
        }), GA = {
            edit: function (a, b, c, d) {
                return {
                    items: d, updatePalette: function (d) {
                        if (c()) d.hide(g.none()) && a(); else {
                            var e = u(d.show, g.some(x.translate("image.context.palette.show")));
                            d = u(d.hide, g.some(x.translate("image.context.palette.hide")));
                            (b().isSome() ? e : d)() && a()
                        }
                    }
                }
            }, crop: function (a, b, c) {
                return {
                    items: c, updatePalette: function (c) {
                        (b() ? c.show : c.hide)(g.none()) && a()
                    }
                }
            }
        }, nQ = function (a) {
            var b = Gb(a, "www.") ? "http://" + a : a;
            return {text: h(a), href: h(b)}
        }, px = {
            preprocess: nQ, auto: function (a) {
                return nQ(a).href()
            }
        }, oQ = function (a, b) {
            a.setRelativeSelection(la.after(b), la.after(b))
        }, Cja = function (a, b, c, d) {
            var e = a.getSelection();
            return vc.detect(e).fold(function () {
                return e.fold(function () {
                        return []
                    },
                    function (a) {
                        return (a.collapsed() ? c : d)(a)
                    })
            }, function (a) {
                return b(a.image())
            })
        }, Dja = function (a, b, c) {
            var d = r.fromTag("a");
            fq(d, oa(b, {text: h(g.none())}));
            y.wrap(c, d);
            ie.select(a, c);
            return [d]
        }, fq = function (a, b) {
            b.url().each(function (b) {
                b = px.auto(b);
                ri.attr(a, "href", b)
            });
            b.title().each(function (b) {
                ri.attr(a, "title", b)
            });
            b.target().each(function (b) {
                ri.attr(a, "target", b)
            });
            b.action().each(function (b) {
                b(a)
            });
            return b.text().filter(b.textChanged).map(function (b) {
                Vb.set(a, b);
                return !0
            }).getOr(!1)
        }, Eja = function (a) {
            return function (b) {
                return {
                    link: b,
                    properties: a
                }
            }
        }, Fja = function (a) {
            return function (b) {
                return {link: b, properties: oa(a, {text: h(g.some(Vb.get(b)))})}
            }
        }, Gja = function (a) {
            return function (b) {
                var c = xj.findDescendants(b.startContainer(), b.startOffset(), b.endContainer(), b.endOffset(), "a");
                b = 0 < c.length ? c : xj.findAncestors(b.startContainer(), b.endContainer(), "a");
                return E(b, 1 === b.length ? Eja(a) : Fja(a))
            }
        }, Hja = function (a, b) {
            return Cja(a, u(Dja, a, b), function (c) {
                var d = r.fromTag("a");
                fq(d, b);
                sd.insertAtCursor(a, [d]);
                b.action().each(function (a) {
                    a(d)
                });
                oQ(a, d);
                return [d]
            }, function (c) {
                a.execCommand("CreateLink", !1, px.auto(b.url().getOr("")));
                c = a.getSelection().map(Gja(b)).getOr([]);
                z(c, function (c) {
                    fq(c.link, c.properties);
                    b.action().each(function (a) {
                        a(c.link)
                    });
                    oQ(a, c.link)
                });
                return E(c, function (a) {
                    return a.link
                })
            })
        }, qx = {
            hyperlink: function (a, b) {
                var c = b.text().fold(h(b), function (a) {
                    return oa(b, {
                        text: h(g.some(0 < a.trim().length ? a : b.url().getOr(""))),
                        textChanged: 0 < a.trim().length ? b.textChanged : h(!0)
                    })
                });
                a.focus();
                return c.url().fold(h([]), function (b) {
                    return 0 <
                    b.trim().length ? Hja(a, c) : []
                })
            }, setProperties: fq
        }, pQ = function (a, b) {
            var c = wa.getEnd(b);
            a.setSelection(b, c, b, c)
        }, qQ = function (a, b) {
            a.setSelection(b, 0, b, 0)
        }, pB = {
            selectEnd: pQ, moveToEnd: function (a) {
                a.getSelection().each(function (b) {
                    pQ(a, b.endContainer());
                    a.focus()
                })
            }, selectStart: qQ, moveToStart: function (a) {
                a.getSelection().each(function (b) {
                    qQ(a, b.endContainer());
                    a.focus()
                })
            }
        }, rQ = function (a, b) {
            return a.getSelection().bind(function (c) {
                return Ld.sharedLinkOrClosest(c, a.isRoot).map(function (a) {
                    b(a);
                    return a
                })
            })
        },
        Br = {
            insert: qx.hyperlink, update: function (a, b) {
                return rQ(a, function (c) {
                    b.text().fold(function () {
                        qx.setProperties(c, b)
                    }, function (d) {
                        "" === d && "" !== Vb.get(c) ? (a.setRelativeSelection(la.before(c), la.before(c)), F.remove(c)) : qx.setProperties(c, b) && (d = A.children(c).length, a.setRelativeSelection(la.on(c, d), la.on(c, d)))
                    });
                    a.focus()
                })
            }, unlink: function (a) {
                rQ(a, function (b) {
                    a.setSelection(b, 0, b, A.children(b).length);
                    var c = A.lastChild(b);
                    F.unwrap(b);
                    c.each(function (b) {
                        pB.selectEnd(a, b)
                    });
                    a.focus()
                })
            }
        }, Ija = function (a) {
            return a.getSelection().bind(function (b) {
                return a.win().bind(function (a) {
                    var c =
                        Lc.exact(b.startContainer(), b.startOffset(), b.endContainer(), b.endOffset());
                    return Wa.getFirstRect(a, c).map(function (a) {
                        a = {
                            left: a.left(),
                            top: a.top(),
                            right: a.right(),
                            bottom: a.bottom(),
                            width: a.width(),
                            height: a.height()
                        };
                        return {bounds: h(a), element: h(b.startContainer())}
                    })
                })
            })
        }, sQ = function (a, b, c) {
            Ija(b).fold(function () {
                Nz.insertAtCursor(a, b, c)
            }, function (d) {
                var e = d.bounds();
                d = d.element();
                (D.isText(d) ? A.parent(d) : g.some(d)).each(function (d) {
                    d = a.directionAt(d);
                    var f = b.translateScreen(e.left, e.top);
                    c({
                        left: f.left,
                        top: f.top, height: h(e.height), width: h(e.width), direction: h(d)
                    })
                })
            })
        }, tQ = function (a, b, c, d, e, f, k) {
            var g = e.direction();
            a = Pm.makeshift(a, b, e.left(), e.top(), e.width(), e.height(), g, f, k);
            b.show(c, a);
            c.setComponents([d.element()])
        }, Ar = {
            show: function (a, b, c, d, e) {
                sQ(a, b, function (a) {
                    tQ(b, c, d, e, a, Fh(0, 0))
                })
            }, showExpandable: function (a, b, c, d, e) {
                sQ(a, b, function (a) {
                    n.add(d.panel(), B.resolve("expandable-popup"));
                    var f = Fh(22, 14), g = {maxHeightFunction: cf.expandable()};
                    tQ(b, c, d, e, a, f, g)
                })
            }
        }, rx = function (a, b, c) {
            a = Oc(a);
            b =
                x.translate(b);
            a.content(Rc(b));
            n.add(a.element(), B.resolve(c));
            S.button(a.element(), b);
            return a
        }, uQ = function (a) {
            var b = T.div();
            n.add(b, B.resolve("main-controls"));
            P.append(b, a);
            return b
        }, vQ = function (a, b, c) {
            var d = rx("remove", "link.dialog.remove", "link-remove"), e = rx("cancel", "button.cancel", "link-cancel"),
                f = rx(a, b, c);
            a = H.create({remove: Q([], d.events.click), cancel: Q([], e.events.click), execute: Q([], f.events.click)});
            b = [ha.button(d.element(), Ba.button({execute: Kb.click})), ha.button(e.element(), Ba.button({execute: Kb.click})),
                ha.button(f.element(), Ba.button({execute: Kb.click}))];
            return {
                remove: d, cancel: e, execute: f, keylayouts: b, events: a.registry, destroy: function () {
                    d.destroy();
                    e.destroy();
                    f.destroy()
                }
            }
        }, LA = {
            insert: function () {
                var a = vQ("insert", "link.dialog.insert", "link-insert"),
                    b = uQ([a.cancel.element(), a.execute.element()]);
                a.remove.disable();
                ra.disable(a.remove.element());
                return {
                    dialogTitle: h(x.key("link.dialog.aria.insert")),
                    elements: h([a.remove.element(), b]),
                    events: h(a.events),
                    keylayouts: h(a.keylayouts),
                    execute: a.execute,
                    destroy: a.destroy
                }
            }, update: function () {
                var a = vQ("update", "link.dialog.update", "link-update"),
                    b = uQ([a.cancel.element(), a.execute.element()]);
                return {
                    dialogTitle: h(x.key("link.dialog.aria.update")),
                    elements: h([a.remove.element(), b]),
                    events: h(a.events),
                    keylayouts: h(a.keylayouts),
                    execute: a.execute,
                    destroy: a.destroy
                }
            }
        }, wQ = B.resolve("link-validation-highlight"), xQ = B.resolve("link-validation-invalid"),
        yQ = B.resolve("link-validation-unknown"), zQ = h([wQ, xQ, yQ]), De = {
            configure: function (a) {
                z(zQ(), function (b) {
                    a.add(a.output(),
                        b, Na.removeClass(b));
                    a.add(a.internal(), b, Na.removeClass(b))
                })
            }, allClasses: zQ, invalidLink: h(xQ), unknownLink: h(yQ), validationHighlight: h(wQ)
        }, KA = {
            enabled: function (a) {
                var b = g.none(), c = O("value", "text", "attrs"),
                    d = H.create({properties: p(["link"]), follow: p(["link"]), ignore: p(["link"]), remove: p(["link"])}),
                    e = {
                        "linkmenu-properties": d.trigger.properties,
                        "linkmenu-follow": d.trigger.follow,
                        "linkmenu-ignore": d.trigger.ignore,
                        "linkmenu-remove": d.trigger.remove
                    };
                return {
                    situation: function (a) {
                        a = b.map(function (a) {
                            var b =
                                [c("linkmenu-properties", x.translate("link.context.edit"), {}), c("linkmenu-follow", x.translate("link.context.follow"), {}), c("linkmenu-remove", x.translate("link.context.remove"), {})];
                            a = n.has(a, De.validationHighlight()) ? [c("linkmenu-ignore", x.translate("link.context.ignore"), {})] : [];
                            return b.concat(a)
                        }).getOr([]);
                        return {primary: h(a), secondary: h([]), submenus: h([])}
                    }, handle: function (a) {
                        b.each(function (b) {
                            var c = m.get(a, "data-ephox-gopher-item-value");
                            c = e[c];
                            void 0 !== c && c(b)
                        })
                    }, assign: function (c) {
                        b = c.bind(function (b) {
                            return L.closest(b,
                                "a[href]", a.isRoot)
                        })
                    }, events: d.registry
                }
            }, disabled: function () {
                var a = Jg.noSituation(), b = H.create({properties: p(["link"])});
                return {situation: a, handle: t, assign: t, events: b.registry}
            }
        }, gq = B.resolve("link-eph-cursor"), Jja = function (a) {
            z(a, F.remove)
        }, Kja = function (a, b) {
            AQ("textbox-bookmark-top", a, y.prepend, b, rb.top())
        }, Lja = function (a, b) {
            AQ("textbox-bookmark-bottom", a, y.append, b, rb.bottom())
        }, AQ = function (a, b, c, d, e) {
            var f = jm.generate(a);
            z(b, function (a) {
                m.set(a, "href", "#" + f)
            });
            a = Y.children(d, "[" + rb.bookmarkDataAttr() +
                '="' + e + '"]');
            z(a, F.remove);
            0 < b.length && (b = r.fromTag("span"), m.setAll(b, {
                id: f,
                style: "visibility: hidden;"
            }), m.set(b, rb.bookmarkDataAttr(), e), c(d, b))
        }, Rh = {
            configure: function (a) {
                a.add(a.internal(), gq, Na.remove);
                a.add(a.output(), gq, Na.remove);
                a.addExcludedContext(["." + gq]);
                a.addSelector(a.input(), "[" + rb.bookmarkDataAttr() + "]", Jja);
                a.addSelector(a.output(), "[" + rb.bookmarkAnchorDataAttr() + '="' + rb.top() + '"]', Kja);
                a.addSelector(a.output(), "[" + rb.bookmarkAnchorDataAttr() + '="' + rb.bottom() + '"]', Lja)
            }, properties: Aa("url textChanged text title target action invalid".split(" "),
            []), insertCursor: h(gq)
        }, Pj = B.resolve("inline-popup-expanded"), Mja = {
            setValue: function (a, b, c) {
                a = a.dom();
                a.value = b;
                a.text = c
            }
        }, BQ = function (a, b) {
            a.dom().add(b.dom())
        }, zr = {
            getValue: function (a) {
                var b = a.dom();
                a = b.selectedIndex;
                b = b.options[a];
                return void 0 === b || -1 === a ? g.none() : g.from(b.value)
            }, add: BQ, addAll: function (a, b) {
                z(b, function (b) {
                    BQ(a, b)
                })
            }, setSelected: function (a, b) {
                a.dom().selectedIndex = b
            }
        }, CQ = [{value: "", i18nKey: "link.properties.target.none"}, {
            value: "_blank",
            i18nKey: "link.properties.target.blank"
        },
            {value: "_top", i18nKey: "link.properties.target.top"}, {
                value: "_self",
                i18nKey: "link.properties.target.self"
            }, {value: "_parent", i18nKey: "link.properties.target.parent"}], GY = {
            target: function (a) {
                var b = Wc.common("select", "target-container", "link.properties.target.label"), c = E(CQ, function (a) {
                    var b = r.fromTag("option");
                    Mja.setValue(b, a.value, x.translate(a.i18nKey));
                    return b
                });
                zr.addAll(b.field(), c);
                var d = a.target().getOr("");
                a = Va(CQ, function (a) {
                    return a.value === d
                }).getOr(0);
                zr.setSelected(b.field(), a);
                return {
                    element: b.element,
                    input: b.field
                }
            }
        }, FY = function () {
            var a = T.div();
            n.add(a, B.resolve("invalid-link-info"));
            var b = Wc.comboBox("href-url-value", "link.properties.url.label", g.some(a));
            m.setAll(b.input(), {
                placeholder: x.translate("link.properties.url.placeholder"),
                autocomplete: "off",
                autocorrect: "off"
            });
            var c = n.toggler(b.element(), B.resolve("link-is-invalid"));
            return {
                input: b.input, element: b.element, dropArrow: b.dropArrow, showInvalid: function () {
                    c.on();
                    var d = T.span();
                    ma.add(d, [B.resolve("icon"), B.resolve("invalid-link-icon")]);
                    y.append(a, d);
                    var e = x.translate("link.properties.url.invalid");
                    m.set(d, "title", e);
                    d = ib.describe(b.input(), e);
                    m.set(d, "aria-live", "assertive");
                    y.append(a, d)
                }, hideInvalid: function () {
                    c.off();
                    F.empty(a);
                    m.remove(b.input(), "aria-describedby")
                }
            }
        }, KY = function (a) {
            var b = {};
            z(a, function (a) {
                b[a] = {}
            });
            return cb(b)
        }, Qj = {
            url: function (a) {
                return g.some(a.url())
            }, title: function (a) {
                return a.title()
            }, innerText: function (a) {
                a = a.innerText();
                return 0 < a.length ? g.some(a) : g.none()
            }
        }, Ec = {resolve: Lb.create("ephox-tarot").resolve},
        DQ = function (a, b, c, d, e) {
            var f = r.fromText(a.substr(0, b));
            b = r.fromText(a.substr(b, c));
            a = r.fromText(a.substr(d));
            e = r.fromTag(e);
            y.append(e, b);
            return [f, e, a]
        }, EQ = function (a, b, c, d) {
            var e = T.tag(b);
            P.append(e, c);
            d.each(function (a) {
                n.add(e, a)
            });
            return {item: h(a), marked: h(g.some(e))}
        }, FQ = function (a, b, c, d) {
            var e = a.text, f = a.marker.start(), k = a.marker.length(), h = 0;
            0 < d - (f + k) || 0 === f || (h = k > d ? f - 10 : f - Math.floor((d - k) / 2));
            d = e.substr(h);
            f -= h;
            b = DQ(d, f, k, f + k, b);
            e = d.length === e.length ? g.none() : g.some(Ec.resolve("anchor-before"));
            return EQ(a.item(), c, b, e)
        }, sx = function (a, b) {
            var c = T.span();
            n.add(c, b);
            P.append(c, a);
            return c
        }, GQ = function (a, b, c) {
            var d = [];
            b = sx(b, Ec.resolve("content-innertext"));
            0 < a.length && (a = sx([r.fromText(a)], Ec.resolve("anchor-before")), d.push(a));
            d.push(b);
            0 < c.length && (c = sx([r.fromText(c)], Ec.resolve("anchor-after")), d.push(c));
            return d
        }, tx = {
            contentMarker: function (a, b, c, d) {
                var e = a.item().before(), f = a.item().after(), k = a.text;
                if (0 === e.length && 0 === f.length && k.length > d) return FQ(a, b, c, d);
                d = a.marker.start();
                var h =
                    a.marker.length();
                b = DQ(k, d, h, d + h, b);
                e = GQ(e, b, f);
                return EQ(a.item(), c, e, g.none())
            }, contentUnderlined: GQ, attrMarker: FQ
        }, HQ = function (a, b, c) {
            a = T.tag(b);
            y.append(a, r.fromText(c));
            return a
        }, IA = {
            anchors: function (a, b) {
                var c = b.item(), d = c.url(), e = T.div();
                n.add(e, Ec.resolve("item-line"));
                var f = c.title().getOr(d);
                m.set(e, "title", f);
                b = b.marked().fold(function () {
                    return HQ(a, "div", f)
                }, function (a) {
                    return a
                });
                n.add(b, Ec.resolve("item-main-label"));
                d = g.from(d).map(function (b) {
                    return b !== f ? (b = HQ(a, "div", b), n.add(b,
                        Ec.resolve("item-secondary-label")), [b]) : []
                }).getOr([]);
                d = [b].concat(d);
                P.append(e, d);
                return e
            }, standard: function (a, b) {
                var c = b.item();
                a = T.div();
                n.add(a, Ec.resolve("item-line"));
                n.add(a, Ec.resolve("bookmark-icon"));
                var d = [c.before(), c.innerText(), c.after()].join("");
                m.set(a, "title", d);
                b = b.marked().fold(function () {
                    var a = tx.contentUnderlined(c.before(), [r.fromText(c.innerText())], c.after()), b = T.div();
                    P.append(b, a);
                    return b
                }, function (a) {
                    return a
                });
                n.add(b, Ec.resolve("item-main-label"));
                c.indent() && n.add(b,
                    Ec.resolve("indent"));
                y.append(a, b);
                return a
            }, error: function (a, b) {
                a = T.span();
                b = r.fromText(b);
                y.append(a, b);
                return a
            }
        }, Nja = O("matchFunction", "start", "length"), Oja = function (a, b, c) {
            for (var d = 0, e = [], f = function (a) {
                e.push(a);
                d++
            }, k = 0, g = a.length; k < g && d < b; k++) c(a[k]).each(f);
            return e
        }, ux = {
            unmarked: function (a, b) {
                b = b.getOr(1E3);
                a = a.length > b ? a.slice(0, b) : a;
                return E(a, function (a) {
                    return {item: h(a), marked: g.none}
                })
            }, match: function (a, b, c, d) {
                var e = c.toLowerCase();
                c = d.getOr(1E3);
                return Oja(a, c, function (a) {
                    return yc(b,
                        function (b) {
                            return b(a).bind(function (c) {
                                var d = c.toLowerCase().indexOf(e);
                                if (-1 < d) {
                                    var f = e.length;
                                    return g.some({item: h(a), marked: g.none, text: c, marker: Nja(b, d, f)})
                                }
                                return g.none()
                            })
                        })
                })
            }, mark: function (a, b, c, d) {
                return E(a, function (a) {
                    return (a.marker.matchFunction() === Qj.innerText ? tx.contentMarker : tx.attrMarker)(a, b, c, d)
                })
            }
        }, IQ = "data" + Ec.resolve("section-id"), vx = {
            create: function (a, b) {
                var c = r.fromTag("ol");
                m.set(c, IQ, b.id());
                var d = function () {
                    F.empty(c)
                };
                return {
                    element: h(c), clear: d, add: function (a) {
                        var b =
                            r.fromTag("li");
                        y.append(b, a);
                        y.append(c, b);
                        return b
                    }, spec: h(b), destroy: function () {
                        d()
                    }
                }
            }, dataIdAttribute: h(IQ)
        }, Pja = Aa(["container", "sections", "translate"], ["doc"]),
        Qja = Aa("id highlight contentLimit items render extractors".split(" "), ["itemLimit"]),
        wx = "data" + Ec.resolve("item-id"), Nm = {
            init: function (a, b) {
                var c = b.doc().getOr(r.fromDom(document)), d = b.translate(), e = {}, f = Ej(), k = T.div();
                n.add(k, Ec.resolve("predictive-menu"));
                S.hidden(k, !0);
                var l = IY(a, k), q = function () {
                        z(f.state(), function (a) {
                            u(a, [])
                        })
                    },
                    u = function (a, b) {
                        F.remove(a.element());
                        a.clear();
                        var d = {};
                        0 < b.length && (z(b, function (b) {
                            var e = a.spec().render()(c, b);
                            e = a.add(e);
                            var f = Ha("");
                            m.set(e, wx, f);
                            d[f] = {gui: h(e), item: h(b.item())}
                        }), y.append(k, a.element()));
                        e[a.spec().id()] = d
                    }, w = function () {
                        return A.parent(k).isSome()
                    }, v = function (a) {
                        n.add(a, Ec.resolve("selected"));
                        I().bind(P).each(function (a) {
                            ib.speak(ja.body(), a.item().url())
                        })
                    }, x = function (a) {
                        v(a);
                        Za.intoViewIfNeeded(a, k)
                    }, B = function (a) {
                        n.remove(a, Ec.resolve("selected"))
                    }, D = function () {
                        L.descendant(k,
                            "li").each(x)
                    }, E = function () {
                        Fa.one("ol:last-child li:last-child", k).each(x)
                    }, I = function () {
                        return L.descendant(k, "li." + Ec.resolve("selected"))
                    }, M = function () {
                        return I().bind(P).map(function (a) {
                            a = a.item();
                            ib.speak(ja.body(), d("link.dialog.autocomplete.accept", a.url()));
                            return a
                        })
                    }, N = function (a) {
                        0 === A.children(a).length ? A.nextSibling(a).fold(D, N) : A.firstChild(a).fold(E, x)
                    }, O = function (a) {
                        0 === A.children(a).length ? A.prevSibling(a).fold(E, O) : A.lastChild(a).fold(D, x)
                    }, P = function (a) {
                        a = L.closest(a, "[" + wx + "]");
                        var b = a.bind(function (a) {
                            return L.closest(a, "[" + vx.dataIdAttribute() + "]")
                        }), c = a.map(function (a) {
                            return m.get(a, wx)
                        });
                        return b.map(function (a) {
                            return m.get(a, vx.dataIdAttribute())
                        }).bind(function (a) {
                            return g.from(e[a])
                        }).bind(function (a) {
                            return c.bind(function (b) {
                                return g.from(a[b])
                            })
                        })
                    }, Q = K.capture(k, "mouseover", function (a) {
                        a = a.target();
                        Db.closest(a, "li." + Ec.resolve("selected")) || P(a).fold(t, function (a) {
                            I().each(function (a) {
                                B(a)
                            });
                            v(a.gui())
                        })
                    }), R = K.capture(k, "click", function (a) {
                        M().each(U.trigger.click)
                    }),
                    U = H.create({click: p(["item"])}), W = eh(fh, ["url", "indent"]);
                z(b.sections(), function (a) {
                    z(a.items(), W);
                    a = vx.create(c, a);
                    f.push(a)
                });
                q();
                return {
                    element: h(k), events: U.registry, reset: q, resetFull: function () {
                        z(f.state(), function (a) {
                            a.clear();
                            var b = a.spec().items(), c = a.spec().itemLimit();
                            b = ux.unmarked(b, c);
                            u(a, b)
                        })
                    }, filter: function (a) {
                        0 < a.length ? (e = {}, z(f.state(), function (b) {
                            var c = b.spec(), d = ux.match(c.items(), c.extractors(), a, c.itemLimit());
                            c = ux.mark(d, c.highlight(), "div", c.contentLimit());
                            u(b, c)
                        })) : q()
                    },
                    show: function (a) {
                        var c = b.container();
                        y.append(c, k);
                        l.position(a, Lh.relativeOrigin(c));
                        ib.speak(ja.body(), d("link.dialog.autocomplete.open"))
                    }, isShowing: w, hide: function () {
                        w() && ib.speak(ja.body(), d("link.dialog.autocomplete.close"));
                        F.remove(k);
                        I().each(B)
                    }, getSelectedData: M, moveup: function () {
                        I().fold(E, function (a) {
                            B(a);
                            A.prevSibling(a).fold(function () {
                                A.parent(a).bind(A.prevSibling).fold(E, O)
                            }, x)
                        })
                    }, movedown: function () {
                        I().fold(D, function (a) {
                            B(a);
                            A.nextSibling(a).fold(function () {
                                A.parent(a).bind(A.nextSibling).fold(D,
                                    N)
                            }, x)
                        })
                    }, destroy: function () {
                        Q.unbind();
                        R.unbind();
                        z(f, function (a) {
                            a.destroy()
                        });
                        F.remove(k)
                    }
                }
            }, config: Pja, section: Qja
        }, MY = aa.detect().browser.isSafari(), yr = O("url", "indent", "action", "before", "innerText", "after"),
        LY = O("url", "indent", "title", "action"), JA = O("url", "action"), HA = O("url", "indent", "action"),
        xx = ta.generate([{invalid: ["invalidUrl"]}, {unknown: ["unknownUrl"]}, {valid: ["validUrl"]}]), NA = {
            cata: function (a, b, c, d) {
                return a.fold(b, c, d)
            }, derive: function (a, b) {
                return "VALID" === b ? xx.valid(a) : "INVALID" ===
                b ? xx.invalid(a) : xx.unknown(a)
            }
        }, JQ = [za("url"), da("fresh", !1)], Rja = Cc(JQ), Sja = Cc([Dc("urls", "urls", sg(), Vaa(JQ))]),
        MA = {one: h(Rja), many: h(Sja)}, VY = O("href", "resolved"), XY = {
            generate: function (a) {
                var b = {};
                z(a, function (a) {
                    var c = a.resolved();
                    a = a.href();
                    b.hasOwnProperty(c) ? U(b[c], a) || b[c].push(a) : b[c] = [a]
                });
                return b
            }
        }, Tja = {
            rules: [{current: Ca.backtrack, next: Ca.sidestep, fallback: g.none()}, {
                current: Ca.sidestep,
                next: Ca.sidestep,
                fallback: g.some(Ca.backtrack)
            }, {current: Ca.advance, next: Ca.sidestep, fallback: g.some(Ca.sidestep)}],
            inclusion: function (a, b, c) {
                return !a.property().parent(c).exists(function (c) {
                    return a.eq(c, b.item())
                })
            }
        }, Uja = Ca.walkers(), KQ = function (a, b, c, d) {
            return Ca.walk(a, b, c, Uja.left(), d.rules).map(function (c) {
                return a.property().isEmptyTag(c.item()) || a.property().isBoundary(c.item()) ? [] : (d.inclusion(a, c, b) ? [c.item()] : []).concat(KQ(a, c.item(), c.mode(), d))
            }).getOr([])
        }, LQ = function (a, b, c) {
            a = KQ(b, c, Ca.sidestep, a);
            return kd(a).concat([c])
        }, MQ = {
            top: u(LQ, Tja), all: u(LQ, {
                rules: void 0, inclusion: function (a, b, c) {
                    return a.property().isText(b.item())
                }
            })
        },
        NQ = nb(), OQ = {
            top: function (a) {
                return MQ.top(NQ, a)
            }, all: function (a) {
                return MQ.all(NQ, a)
            }
        }, Vja = function (a, b) {
            b = Rd.generate(b, function (b, c) {
                return a.property().isText(b) ? g.some(W.range(b, c, c + a.property().getText(b).length)) : g.none()
            });
            var c = Eb(b, function (b, c) {
                return a.property().getText(c.element()) + b
            }, "");
            return {list: h(b), text: h(c)}
        }, Wja = function (a, b, c, d) {
            var e = Rd.find(b.list(), function (b) {
                return a.eq(b.element(), c)
            }).map(function (a) {
                return a.start() + d
            });
            return {list: b.list, text: b.text, cursor: h(e)}
        }, Xja =
            {
                from: function (a, b, c, d) {
                    b = Vja(a, b);
                    return Wja(a, b, c, d)
                }
            }, Yja = nb(), Zja = {
            from: function (a, b, c) {
                return Xja.from(Yja, a, b, c)
            }
        }, dZ = {
            get: function (a, b) {
                var c = OQ.all(a), d = Zja.from(c, a, b);
                b = d.cursor().orThunk(function () {
                    return D.isText(a) ? g.none() : g.some(d.text().length)
                });
                return {list: d.list, text: d.text, cursor: h(b)}
            }
        }, PQ = function (a, b) {
            return {
                patterns: function () {
                    return [new RegExp("^(" + a + ")(.+)", "gi")]
                }, useCursor: fd, generate: function (a, d) {
                    a = r.fromTag(b, a.dom());
                    P.append(a, d.clones());
                    return Zd.species({
                        elements: h([a]),
                        cursor: g.none, dictation: g.none, notify: g.none
                    })
                }, derive: function (a) {
                    var b = a[1];
                    return g.some({startIndex: h(a.index), finishIndex: h(a.index + b.length)})
                }
            }
        }, Th = {
            normal: function (a, b) {
                a = Cb.sanitise(a);
                return PQ(a, b)
            }, spaced: function (a, b) {
                a = Cb.sanitise(a) + "\\s";
                return PQ(a, b)
            }
        }, QQ = function (a, b) {
            return Zd.species({elements: h([r.fromText(b.text())]), cursor: g.none, dictation: g.none, notify: g.none})
        }, $ja = function () {
            return {
                patterns: function () {
                    return [/([^.?!][.?!]\s+)([a-z][^\s]*)/g, /^()([a-z][^\s]*)/g]
                }, useCursor: h(!0),
                generate: QQ, derive: function (a) {
                    var b = a.index, c = b + a[0].length;
                    a = a[1] + ns(a[2]);
                    return g.some({startIndex: h(b), finishIndex: h(c), text: h(a)})
                }
            }
        }(), aka = function () {
            return {
                patterns: function () {
                    return [/([A-Z][A-Z]+)([a-z]+)/g]
                }, useCursor: h(!1), generate: QQ, derive: function (a) {
                    var b = a[2];
                    b = ns(a[1].toLowerCase()) + b.toLowerCase();
                    var c = a.index;
                    a = c + a[0].length;
                    return g.some({startIndex: h(c), finishIndex: h(a), text: h(b)})
                }
            }
        }(), OA = {capitalise: h($ja), normalise: h(aka)}, bZ = {
            patterns: function () {
                return [In.autolink()]
            }, useCursor: h(!0),
            generate: function (a, b) {
                a = r.fromTag("a");
                m.set(a, "href", b.href());
                y.append(a, r.fromText(b.text()));
                return Zd.species({elements: h([a]), cursor: g.none, dictation: g.none, notify: u(g.some, [a])})
            }, derive: function (a) {
                var b = px.preprocess(a[1]), c = b.text();
                b = b.href();
                return -1 < c.indexOf("@") ? g.none() : g.some({
                    startIndex: h(a.index),
                    finishIndex: h(a.index + c.length),
                    text: h(c),
                    href: h(b)
                })
            }
        }, aZ = h(function (a, b) {
            return b
        }), bka = {
            cloneAfter: function (a, b, c) {
                var d = b;
                return E(a, function (a) {
                    var b = Pc.deep(a);
                    D.isText(a) && N.eq(c.endContainer(),
                        a) && Ya.get(a).length > c.endOffset() && Ya.set(b, Ya.get(b).substring(0, c.endOffset()));
                    if (D.isText(b) && 0 < d) {
                        var e = Ya.get(b);
                        a = Math.min(e.length, d);
                        e = e.substring(a);
                        Ya.set(b, e);
                        d -= a
                    }
                    return b
                })
            }
        }, RQ = {
            matcher: function (a, b, c) {
                var d = function (a) {
                    return c.fold(function () {
                        return a && 1 < a.length
                    }, function (b) {
                        return a && 0 < a.length && a.index + a[0].length === b
                    })
                };
                return yc(a, function (a) {
                    a:{
                        if (!a.global) throw"Macro matching only works with global regexes: " + a;
                        for (var c = a.exec(b); c;) {
                            if (d(c)) {
                                a = g.some(c);
                                break a
                            }
                            c = a.exec(b)
                        }
                        a =
                            g.none()
                    }
                    return a
                })
            }
        }, cka = function (a, b, c, d) {
            b = bka.cloneAfter(b, d.finishIndex(), c);
            var e = ua(d, {clones: h(b)});
            return {
                build: function (b) {
                    b = a.generate(b, e);
                    return Zd.applicator({
                        elements: b.elements,
                        cursor: b.cursor,
                        range: h(c),
                        dictation: b.dictation,
                        notify: b.notify
                    })
                }
            }
        }, dka = function (a, b, c) {
            b = Rd.get(a, b);
            var d = Rd.get(a, c);
            return b.bind(function (a) {
                return d.map(function (b) {
                    return {start: h(a), finish: h(b)}
                })
            })
        }, eka = function (a, b) {
            return b(a.start().element()) && b(a.finish().element()) ? g.some(a) : g.none()
        }, fka = function (a,
                           b, c) {
            return b.doc().bind(function (d) {
                d = a.build(d);
                var e = d.elements();
                E(e, rg.doNotMerge);
                var f = Ez.handle(d.range());
                sd.insertAt(b, f, e);
                E(e, rg.clear);
                d.dictation().each(function (a) {
                    ib.shout(ja.body(), a())
                });
                d.notify().each(function () {
                    c.input(e)
                });
                return d.cursor()
            })
        }, SQ = function (a, b, c, d, e) {
            return a.detect(b, c, d, e).map(function (a) {
                return {execute: u(fka, a)}
            })
        }, Er = {
            block: u(SQ, {
                detect: function (a, b, c, d) {
                    var e = b.patterns(), f = a.cursor().filter(b.useCursor);
                    return RQ.matcher(e, a.text(), f).bind(b.derive).bind(function (a) {
                        var e =
                            OQ.top(c);
                        if (0 < e.length) {
                            var f = au(e[0], 0, c, d);
                            return g.some(cka(b, e, f, a))
                        }
                        return g.none()
                    })
                }
            }), inline: u(SQ, {
                detect: function (a, b, c, d) {
                    c = b.patterns();
                    d = a.cursor().filter(b.useCursor);
                    return RQ.matcher(c, a.text(), d).bind(b.derive).bind(function (c) {
                        return dka(a.list(), c.startIndex(), c.finishIndex()).bind(function (a) {
                            return eka(a, b.allowed).map(function (a) {
                                var d = c.startIndex() - a.start().start(), e = c.finishIndex() - a.finish().start(),
                                    f = au(a.start().element(), d, a.finish().element(), e);
                                return {
                                    build: function (a) {
                                        a =
                                            b.generate(a, c);
                                        return Zd.applicator({
                                            elements: a.elements,
                                            cursor: a.cursor,
                                            range: h(f),
                                            dictation: a.dictation,
                                            notify: a.notify
                                        })
                                    }
                                }
                            })
                        })
                    })
                }
            })
        }, gZ = aa.detect().deviceType.isTouch(), QA = function (a) {
            a.disable();
            ra.disable(a.element())
        }, jZ = aa.detect().deviceType.isiOS(), gka = O("rawData", "extra"), RA = function (a, b, c) {
            if (Mb(b) && Mb(c)) return I.value(gka(b, c));
            console.error(a + " callback parameters were not both arrays", b, c);
            return I.error(a + " callback parameters were not both arrays")
        }, Fr = function (a, b) {
            if (ck.isPrototypeOf(b)) return I.value(r.fromDom(b));
            console.error(a + " was not a DOM element", b);
            return I.error(a + " was not a DOM element")
        }, wZ = {
            configure: function (a) {
                var b = [a.internal(), a.history(), a.output()];
                z(b, function (b) {
                    a.addSelector(b, "span.ephox-polish-incomplete-mention", Na.unwrap)
                });
                a.addExcludedContext(["span.ephox-polish-incomplete-mention"])
            }
        }, TA = B.resolve("no-results"), SA = B.resolve("loading-results"),
        Gr = ta.generate([{none: ["item"]}, {extra: ["value", "item"]}, {fetched: ["userId", "name", "rawname", "info", "item"]}]),
        Hr = ta.generate([{nothing: []},
            {refetch: ["term"]}, {open: ["term"]}]), TQ = function () {
            return new RegExp(Cb.wordbreak(), "i")
        }, hka = function (a, b, c) {
            return uh.repeatLeft(a, c, function (a, b, c, g, h) {
                return uh.previousChar(g, h).fold(function () {
                    return b.kontinue()
                }, function (a) {
                    return b.finish(a.ch())
                })
            }).fold(g.none, g.none, g.some)
        }, ika = function (a, b, c, d) {
            return 0 <= d && "@" === c.charAt(d) ? a.finish(W.point(b, d)) : a.abort()
        }, jka = function (a, b, c, d) {
            return a.finish(W.point(b, d))
        }, kka = function (a) {
            return g.some(W.point(a, wa.getEnd(a)))
        }, VA = {
            isValidMention: function (a,
                                      b) {
                return hka(a, Ca.sidestep, b).fold(h(!0), function (a) {
                    return null === a.match(/[0-9a-zA-Z]/)
                })
            }, scan: function (a, b) {
                return uh.expandLeft(a, b, {regex: TQ, attempt: ika}).fold(g.none, g.none, g.some).bind(function (c) {
                    return uh.expandRight(a, b, {regex: TQ, attempt: jka}).fold(g.none, kka, g.some).map(function (a) {
                        return {start: c.element, soffset: c.offset, finish: a.element, foffset: a.offset}
                    })
                })
            }
        },
        $i = ta.generate([{none: []}, {bare: ["text", "start", "soffset", "finish", "foffset"]}, {incomplete: ["text", "element"]}, {
            complete: ["text",
                "element"]
        }]), UQ = B.resolve("incomplete-mention"), lka = function (a, b) {
            return VA.scan(a, b).map(function (a) {
                return $i.bare("", a.start(), a.soffset(), a.finish(), a.foffset())
            })
        }, VQ = function (a) {
            if (D.isText(a)) return Ya.get(a);
            a = ed.descendants(a, D.isText);
            return E(a, Ya.get).join("")
        }, WQ = function (a, b) {
            return a.collapsed() ? L.closest(a.startContainer(), b.hoverSelector()).fold(function () {
                return L.closest(a.startContainer(), "." + UQ).fold(function () {
                    return lka(a.startContainer(), a.startOffset())
                }, function (a) {
                    return g.some($i.incomplete(VQ(a),
                        a))
                })
            }, function (a) {
                return g.some($i.complete(VQ(a), a))
            }).getOrThunk($i.none) : $i.none()
        }, Uh = {
            detect: function (a, b) {
                return a.getSelection().map(function (a) {
                    return WQ(a, b)
                }).getOrThunk($i.none)
            }, detectOn: WQ, withinIncomplete: function (a) {
                return L.closest(a, "." + UQ)
            }
        }, XQ = function (a) {
            n.remove(a, B.resolve("incomplete-mention"));
            F.unwrap(a)
        }, Jr = {
            cancel: XQ, create: function () {
                var a = r.fromTag("span");
                n.add(a, B.resolve("incomplete-mention"));
                var b = r.fromText("@");
                y.append(a, b);
                return a
            }, validatePrevious: function (a,
                                           b) {
                Uh.withinIncomplete(a).filter(function (a) {
                    return Uh.withinIncomplete(b).forall(function (b) {
                        return !N.eq(a, b)
                    })
                }).each(XQ)
            }
        }, Ir = "." + B.resolve("mentions-business-card"), tZ = function (a, b) {
            return 1 < arguments.length || /\{(\d+)\}/.test(a) ? In.tokens.call(void 0, a, b) : a
        }, yZ = O("textkey", "value", "icon"), mka = function () {
            return {
                configure: function (a) {
                    var b = [a.internal(), a.history(), a.output(), a.paste()];
                    z(b, function (b) {
                        a.addSelector(b, "[unselectable]", Na.removeAttr("unselectable"))
                    })
                }, clean: function (a) {
                    m.remove(a,
                        "unselectable")
                }, disableNativeResize: function (a) {
                    m.set(a, "unselectable", "on")
                }
            }
        }, nka = function () {
            return {
                configure: t, clean: function (a) {
                    A.nextSibling(a).filter(se.isEmptyText).each(F.remove)
                }, disableNativeResize: t
            }
        }, YQ = aa.detect().browser,
        Kr = YQ.isIE() ? mka() : YQ.isFirefox() ? nka() : {configure: t, clean: t, disableNativeResize: t},
        oka = aa.detect().browser.isChrome(), ZQ = "data-" + B.resolve("resize-direction"), hq = function (a, b) {
            var c = r.fromTag("span");
            ma.add(c, [B.resolve(a), B.resolve("resize-eph-resizer")]);
            m.set(c,
                ZQ, b);
            return c
        }, GZ = {
            create: function () {
                var a = hq("element-se-resize", "1"), b = hq("element-ne-resize", "1"), c = hq("element-sw-resize", "-1"),
                    d = hq("element-nw-resize", "-1"), e = r.fromTag("div");
                n.add(e, B.resolve("resize-wrapper"));
                P.append(e, [a, b, c, d]);
                var f = function () {
                    F.remove(e)
                }, g = H.create({click: p(["multiplier"])}), l = K.bind(e, "mousedown", function (a) {
                    n.has(a.target(), B.resolve("resize-eph-resizer")) && (oka || a.prevent(), a = m.get(a.target(), ZQ), a = void 0 !== a ? parseInt(a, 10) : 1, g.trigger.click(a))
                });
                return {
                    refresh: function (f,
                                       g) {
                        y.append(f, e);
                        f = bb.absolute(g);
                        var k = sa.get(g);
                        g = Ia.get(g);
                        g = {top: f.top, height: h(k), left: f.left, width: h(g)};
                        f = Ia.get(c) / 2;
                        v.setAll(c, {top: g.top() + g.height() - f + "px", left: g.left() - f + "px"});
                        v.setAll(a, {top: g.top() + g.height() - f + "px", left: g.width() + g.left() - f + "px"});
                        v.setAll(b, {top: g.top() - f + "px", left: g.width() + g.left() - f + "px"});
                        v.setAll(d, {top: g.top() - f + "px", left: g.left() - f + "px"})
                    }, clear: f, events: g.registry, destroy: function () {
                        l.unbind();
                        f()
                    }
                }
            }
        }, $Q = aa.detect().browser, JZ = $Q.isChrome(), IZ = $Q.isFirefox(),
        pka = O("minRow", "minCol", "maxRow", "maxCol"), qka = function (a, b) {
            var c = a.grid().columns(), d = a.grid().rows(), e = c, f = 0, g = 0;
            Ma(a.access(), function (a) {
                if (b(a)) {
                    var c = a.row(), k = c + a.rowspan() - 1, h = a.column();
                    a = h + a.colspan() - 1;
                    c < d ? d = c : k > f && (f = k);
                    h < e ? e = h : a > g && (g = a)
                }
            });
            return pka(d, e, f, g)
        }, rka = function (a, b, c, d) {
            for (var e = b.grid().columns(), f = b.grid().rows(), g = 0; g < f; g++) for (var h = !1, m = 0; m < e; m++) if (!(g < c.minRow() || g > c.maxRow() || m < c.minCol() || m > c.maxCol())) if (Ib.getAt(b, g, m).filter(d).isNone()) {
                var n = h, p = a[g].element(),
                    t = r.fromTag("td");
                y.append(t, r.fromTag("br"));
                (n ? y.append : y.prepend)(p, t)
            } else h = !0
        }, ska = function (a, b) {
            var c = ka(uk.firstLayer(a, "tr"), function (a) {
                return 0 === a.dom().childElementCount
            });
            z(c, F.remove);
            b.minCol() !== b.maxCol() && b.minRow() !== b.maxRow() || z(uk.firstLayer(a, "th,td"), function (a) {
                m.remove(a, "rowspan");
                m.remove(a, "colspan")
            });
            m.remove(a, "width");
            m.remove(a, "height");
            v.remove(a, "width");
            v.remove(a, "height")
        }, tka = {
            extract: function (a, b) {
                var c = function (a) {
                        return Fa.is(a.element(), b)
                    }, d = hg.fromTable(a),
                    e = Ib.generate(d), f = qka(e, c), g = "th:not(" + b + "),td:not(" + b + ")",
                    h = uk.filterFirstLayer(a, "th,td", function (a) {
                        return Fa.is(a, g)
                    });
                z(h, F.remove);
                rka(d, e, f, c);
                ska(a, f);
                return a
            }
        }, NZ = function (a) {
            z(a, function (a) {
                F.empty(a);
                y.append(a, r.fromTag("br"))
            })
        }, uka = function (a) {
            return sb.table(a[0]).map(Pc.deep).map(function (a) {
                return [tka.extract(a, te.selectedSelector())]
            })
        }, LZ = function (a, b) {
            var c = lz.register({
                doc: a.doc,
                win: a.win,
                body: a.body,
                baseURI: a.baseURI,
                getSelection: a.getSelection,
                setSelection: a.setSelection
            });
            return function (b, e, f, g) {
                f = Uj.injectEphemera(f);
                g();
                var d = Qm.fromSafe(a);
                d.begin();
                c.setClipboard(b, e, f, function () {
                    d.end()
                })
            }
        }, MZ = function (a, b) {
            return uka(a).map(function (a) {
                z(a, b);
                var c = u(rn.toText, a);
                a = u(rn.toHtml, a);
                return {text: c, html: a}
            })
        }, OZ = function (a, b, c) {
            return Mi.fragment(b.win(), a).map(function (a) {
                var b = u(Mi.text, a);
                a = u(Mi.html, a, c);
                return {text: b, html: a}
            })
        }, ud = {resolve: Lb.create("ephox-cement").resolve}, vka = ud.resolve("smartpaste-eph-bin"),
        jB = {binStyle: h(vka)}, aR = function (a, b) {
            return Zb.cata(b.get(),
                h([]), ca, h([a]))
        }, yx = {
            mergable: function (a, b) {
                return Zb.cata(b.get(), g.none, function (b, d) {
                    return 0 === b.length ? g.none() : Xz.retrieveBox(a, te.firstSelectedSelector(), te.lastSelectedSelector()).bind(function (a) {
                        return 1 < b.length ? g.some({bounds: h(a), cells: h(b)}) : g.none()
                    })
                }, g.none)
            }, unmergable: function (a, b) {
                var c = function (a) {
                    return m.has(a, "rowspan") && 1 < parseInt(m.get(a, "rowspan"), 10) || m.has(a, "colspan") && 1 < parseInt(m.get(a, "colspan"), 10)
                };
                a = aR(a, b);
                return 0 < a.length && ob(a, c) ? g.some(a) : g.none()
            }, selection: aR
        },
        bR = function (a) {
            return {element: h(a), mergable: g.none, unmergable: g.none, selection: h([])}
        }, wka = O("element", "clipboard", "generators"), Um = {
            noMenu: bR, forMenu: function (a, b, c) {
                return {
                    element: h(c),
                    mergable: h(yx.mergable(b, a)),
                    unmergable: h(yx.unmergable(c, a)),
                    selection: h(yx.selection(c, a))
                }
            }, notCell: function (a) {
                return bR(a)
            }, paste: wka
        }, xka = function (a) {
            return "table" === D.name(a) || 0 === Vb.get(a).trim().length
        }, cR = function (a) {
            var b = ka(a, function (a) {
                return "table" === D.name(a)
            });
            return 1 !== b.length ? g.none() : ob(a, xka) ?
                g.from(b[0]) : g.none()
        }, A_ = {
            rules: function (a, b, c) {
                var d = t, e = function (e, f) {
                    return sb.table(e, a.isRoot).bind(function (g) {
                        var k = a.doc().getOrDie();
                        k = cF.paste(k);
                        k = Um.paste(e, f, k);
                        var l = h(c);
                        return Ac.execute(b, nc.pasteCells, d, l)(a, g, k).map(function (a) {
                            return a.startContainer()
                        })
                    })
                }, f = function (a) {
                    return cR(a).map(function (a) {
                        return {single: h(a)}
                    })
                };
                return {
                    collapsed: h(jb(function (a, b, c) {
                        return sb.cell(b, a)
                    }, f, function (a, b) {
                        return e(a.element(), b.single())
                    }, "custom arcade table insert collapsed")), ranged: h(jb(function (a,
                                                                                        b, c) {
                        return sb.cell(b.element(), a).map(function (a) {
                            return {left: h(a), right: h(a)}
                        })
                    }, f, function (a, b) {
                        return e(a.left(), b.single())
                    }, "custom arcade table insert ranged"))
                }
            }, extractTable: cR
        }, dR = "officeStyles htmlStyles isWord isGoogleDocs proxyBin isInternal backgroundAssets".split(" "),
        eR = Aa([], dR), Xb = {
            nu: eR, merge: function (a, b) {
                var c = {};
                z(dR, function (d) {
                    b[d]().or(a[d]()).each(function (a) {
                        c[d] = a
                    })
                });
                return eR(c)
            }
        }, El = ta.generate([{error: ["message"]}, {paste: ["elements", "correlated"]}, {cancel: []}, {
            incomplete: ["elements",
                "correlated", "message"]
        }]), zx = function (a, b, c, d, e) {
            return a.fold(b, c, d, e)
        }, db = {
            error: El.error,
            paste: El.paste,
            cancel: El.cancel,
            incomplete: El.incomplete,
            cata: zx,
            carry: function (a, b) {
                return zx(a, g.none, g.none, g.none, function (a, d, e) {
                    return zx(b, g.none, function (a, b) {
                        return g.some(El.incomplete(a, b, e))
                    }, g.none, g.none)
                }).getOr(b)
            }
        }, Ax = Aa(["response", "bundle"], []), Fl = function (a) {
            return Bx(function (b) {
                var c = Ax(a);
                b(c)
            })
        }, Bx = function (a) {
            var b = Bx;
            return {
                get: function (b) {
                    a(b)
                }, map: function (c) {
                    return b(function (b) {
                        a(function (a) {
                            a =
                                c(a);
                            b(a)
                        })
                    })
                }, bind: function (c) {
                    return b(function (b) {
                        a(function (a) {
                            c(a).get(b)
                        })
                    })
                }
            }
        }, La = {
            call: function (a, b) {
                a(Ax(b))
            }, sync: Bx, pure: Fl, pass: function (a) {
                return Fl({response: a.response(), bundle: a.bundle()})
            }, done: Ax, error: function (a) {
                return Fl({response: db.error(a), bundle: Xb.nu({})})
            }, initial: function () {
                return Fl({response: db.paste([], []), bundle: Xb.nu({})})
            }, cancel: function () {
                return Fl({response: db.cancel(), bundle: Xb.nu({})})
            }
        }, fR = O("steps", "input", "label", "capture"), yka = function (a, b) {
            return yc(a, function (a) {
                return a.getAvailable(b).map(function (b) {
                    return fR(a.steps(),
                        b, a.label(), a.capture())
                })
            })
        }, zka = function (a, b) {
            var c = u(La.pass, a), d = function () {
                return b().map(function (b) {
                    var c = Xb.merge(a.bundle(), b.bundle());
                    b = db.carry(a.response(), b.response());
                    return La.done({response: b, bundle: c})
                })
            };
            return db.cata(a.response(), c, d, c, d)
        }, bB = {
            choose: function (a, b, c) {
                return yka(a, c).getOrThunk(function () {
                    var a = b.getAvailable(c);
                    return fR(b.steps(), a, b.label(), b.capture())
                })
            }, run: function (a, b) {
                return hb(a, function (a, d) {
                    return a.bind(function (a) {
                        return zka(a, function () {
                            return d(b,
                                a)
                        })
                    })
                }, La.initial())
            }
        }, Aka = function (a, b) {
            a = D.value(a);
            var c = r.fromTag("div"), d = a.indexOf("]>");
            c.dom().innerHTML = a.substr(d + 2);
            return Ja.descendant(c, function (a) {
                return D.name(a) === b
            })
        }, Bka = function (a) {
            return D.isComment(a) ? Aka(a, "v:shape") : g.none()
        }, Cka = function (a) {
            if ("img" === D.name(a)) {
                var b = m.get(a, "src");
                if (void 0 !== b && null !== b && Gb(b, "file://")) return a = Pc.shallow(a), b = b.split(/[\/\\]/), m.set(a, "data-image-id", b[b.length - 1]), m.remove(a, "src"), m.set(a, "data-image-type", "local"), n.add(a, "rtf-data-image"),
                    g.some(a)
            }
            return g.none()
        }, Dka = function (a) {
            return Bka(a).map(function (a) {
                var b = m.get(a, "o:spid");
                b = void 0 === b ? m.get(a, "id") : b;
                var d = r.fromTag("img");
                n.add(d, "rtf-data-image");
                m.set(d, "data-image-id", b.substr(7));
                m.set(d, "data-image-type", "code");
                v.setAll(d, {width: v.get(a, "width"), height: v.get(a, "height")});
                return d
            })
        }, gR = {
            validStyles: function () {
                return /^(mso-.*|tab-stops|tab-interval|language|text-underline|text-effect|text-line-through|font-color|horiz-align|list-image-[0-9]+|separator-image|table-border-color-(dark|light)|vert-align|vnd\..*)$/
            },
            specialInline: function () {
                return /^(font|em|strong|samp|acronym|cite|code|dfn|kbd|tt|b|i|u|s|sub|sup|ins|del|var|span)$/
            }
        },
        aj = ta.generate([{starts: ["value", "f"]}, {pattern: ["regex", "f"]}, {contains: ["value", "f"]}, {exact: ["value", "f"]}, {all: []}, {not: ["stringMatch"]}]),
        hR = function (a, b) {
            return a.fold(function (a, d) {
                return 0 === d(b).indexOf(d(a))
            }, function (a, d) {
                return a.test(d(b))
            }, function (a, d) {
                return 0 <= d(b).indexOf(d(a))
            }, function (a, d) {
                return d(b) === d(a)
            }, function () {
                return !0
            }, function (a) {
                return !hR(a, b)
            })
        },
        M = {
            starts: aj.starts,
            pattern: aj.pattern,
            contains: aj.contains,
            exact: aj.exact,
            all: aj.all,
            not: aj.not,
            cata: function (a, b, c, d, e, f, g) {
                return a.fold(b, c, d, e, f, g)
            },
            matches: hR,
            caseSensitive: function (a) {
                return a
            },
            caseInsensitive: function (a) {
                return a.toLowerCase()
            }
        }, iq = {
            keyval: function (a, b, c, d) {
                var e = d.name, f = void 0 !== d.condition ? d.condition : h(!0);
                d = void 0 !== d.value ? d.value : M.all();
                return M.matches(e, c) && M.matches(d, b) && f(a)
            }, name: function (a, b) {
                var c = D.name(a), d = b.name;
                b = void 0 !== b.condition ? b.condition : h(!0);
                return M.matches(d, c) && b(a)
            }
        }, Eka = function (a, b, c) {
            z(b, function (b) {
                m.remove(a, b)
            });
            Ma(c, function (b, c) {
                m.set(a, c, b)
            })
        }, iR = {
            filter: function (a, b) {
                var c = {};
                z(a.dom().attributes, function (a) {
                    b(a.value, a.name) || (c[a.name] = a.value)
                });
                return c
            }, clobber: function (a, b, c) {
                c = E(a.dom().attributes, function (a) {
                    return a.name
                });
                cb(b).length !== c.length && Eka(a, c, b)
            }, scan: h({})
        }, Fka = function (a) {
            var b = {};
            a = void 0 !== a && null !== a ? a.split(";") : [];
            z(a, function (a) {
                a = a.split(":");
                2 === a.length && (b[Zh(a[0])] = Zh(a[1]))
            });
            return b
        },
        jR = function (a) {
            var b = cb(a);
            return E(b, function (b) {
                return b + ": " + a[b]
            }).join("; ")
        }, Ig = {
            filter: function (a, b) {
                var c = a.dom().style, d = {};
                z(void 0 === c || null === c ? [] : c, function (c) {
                    var e = a.dom().style.getPropertyValue(c);
                    b(e, c) || (d[c] = e)
                });
                return d
            }, clobber: function (a, b, c) {
                m.set(a, "style", "");
                var d = cb(b).length, e = cb(c).length;
                0 === d && 0 === e ? m.remove(a, "style") : 0 === d ? m.set(a, "style", jR(c)) : (Ma(b, function (b, c) {
                    v.set(a, c, b)
                }), b = m.get(a, "style"), c = 0 < e ? jR(c) + "; " : "", m.set(a, "style", c + b))
            }, scan: function (a, b, c) {
                a =
                    a.dom().getAttribute("style");
                var d = Fka(a), e = {};
                z(b, function (a) {
                    var b = d[a];
                    void 0 === b || c(b, a) || (e[a] = b)
                });
                return e
            }
        }, Gka = ["mso-list"], kR = function (a, b) {
            var c = Ig.scan(a, Gka, b);
            b = Ig.filter(a, b);
            Ig.clobber(a, b, c)
        }, lR = function (a, b) {
            b = iR.filter(a, b);
            iR.clobber(a, b, {})
        }, jq = {
            style: kR, attribute: lR, styleDom: function (a, b) {
                kR(r.fromDom(a), b)
            }, attributeDom: function (a, b) {
                lR(r.fromDom(a), b)
            }, validateStyles: function (a) {
                var b = Ig.filter(a, h(!1));
                Ig.clobber(a, b, {})
            }
        }, mR = function (a, b, c) {
            a(c, function (a, e) {
                return Xa(b,
                    function (b) {
                        return iq.keyval(c, a, e, b)
                    })
            })
        }, kq = {
            remover: function (a, b) {
                var c = ua({styles: [], attributes: [], classes: [], tags: []}, b);
                b = Y.descendants(a, "*");
                z(b, function (a) {
                    mR(jq.style, c.styles, a);
                    mR(jq.attribute, c.attributes, a);
                    z(c.classes, function (b) {
                        var c = m.has(a, "class") ? ma.get(a) : [];
                        z(c, function (c) {
                            M.matches(b.name, c) && n.remove(a, c)
                        })
                    })
                });
                a = Y.descendants(a, "*");
                z(a, function (a) {
                    Xa(c.tags, u(iq.name, a)) && F.remove(a)
                })
            }, unwrapper: function (a, b) {
                var c = ua({tags: []}, b);
                a = Y.descendants(a, "*");
                z(a, function (a) {
                    Xa(c.tags,
                        u(iq.name, a)) && F.unwrap(a)
                })
            }, transformer: function (a, b) {
                var c = ua({tags: []}, b);
                a = Y.descendants(a, "*");
                z(a, function (a) {
                    qa(c.tags, u(iq.name, a)).each(function (b) {
                        b.mutate(a)
                    })
                })
            }, validator: function (a) {
                a = Y.descendants(a, "*");
                z(a, function (a) {
                    jq.validateStyles(a)
                })
            }
        }, Gl = function (a, b, c) {
            var d = r.fromDom(a);
            switch (a.nodeType) {
                case 1:
                    if (b) var e = "endElement"; else e = "startElement", v.setAll(d, c || {});
                    var f = "HTML" !== a.scopeName && a.scopeName && a.tagName && 0 >= a.tagName.indexOf(":") ? (a.scopeName + ":" + a.tagName).toUpperCase() :
                        a.tagName;
                    break;
                case 3:
                    e = "text";
                    var g = a.nodeValue;
                    break;
                case 8:
                    e = "comment";
                    g = a.nodeValue;
                    break;
                default:
                    console.log("WARNING: Unsupported node type encountered: " + a.nodeType)
            }
            return {
                getNode: function () {
                    return a
                }, tag: function () {
                    return f
                }, type: function () {
                    return e
                }, text: function () {
                    return g
                }
            }
        }, nR = function (a, b) {
            return Gl(b.createElement(a), !0)
        }, Ab = {
            START_ELEMENT_TYPE: "startElement",
            END_ELEMENT_TYPE: "endElement",
            TEXT_TYPE: "text",
            COMMENT_TYPE: "comment",
            FINISHED: nR("HTML", window.document),
            token: Gl,
            createStartElement: function (a,
                                          b, c, d) {
                var e = d.createElement(a);
                Ma(b, function (a, b) {
                    e.setAttribute(b, a)
                });
                return Gl(e, !1, c)
            },
            createEndElement: nR,
            createComment: function (a, b) {
                return Gl(b.createComment(a), !1)
            },
            createText: function (a, b) {
                return Gl(b.createTextNode(a))
            }
        }, Hka = {
            create: function (a) {
                var b = a.createDocumentFragment(), c = b;
                return {
                    dom: c, receive: function (d) {
                        var e = function (a) {
                            a = a.getNode().cloneNode(!1);
                            b.appendChild(a);
                            b = a
                        }, f = function (c, d) {
                            c = a.createTextNode(c.text());
                            b.appendChild(c)
                        };
                        switch (d.type()) {
                            case Ab.START_ELEMENT_TYPE:
                                e(d);
                                break;
                            case Ab.TEXT_TYPE:
                                f(d);
                                break;
                            case Ab.END_ELEMENT_TYPE:
                                b = b.parentNode;
                                null === b && (b = c);
                                break;
                            case Ab.COMMENT_TYPE:
                                break;
                            default:
                                throw{message: "Unsupported token type: " + d.type()};
                        }
                    }, label: "SERIALISER"
                }
            }
        }, Ika = {
            tokenise: function (a, b) {
                b = b || window.document;
                var c = b.createElement("div");
                b.body.appendChild(c);
                c.style.position = "absolute";
                c.style.left = "-10000px";
                c.innerHTML = a;
                var d = c.firstChild || Ab.FINISHED, e = [], f = !1;
                return {
                    hasNext: function () {
                        return void 0 !== d
                    }, next: function () {
                        var a = d, g = f;
                        !f && d.firstChild ?
                            (e.push(d), d = d.firstChild) : f || 1 !== d.nodeType ? d.nextSibling ? (d = d.nextSibling, f = !1) : (d = e.pop(), f = !0) : f = !0;
                        a === Ab.FINISHED || d || (b.body.removeChild(c), d = Ab.FINISHED);
                        a = a === Ab.FINISHED ? a : a ? Ab.token(a, g) : void 0;
                        return a
                    }
                }
            }
        }, oR = function (a, b, c) {
            var d = c;
            for (c = b.length - 1; 0 <= c; c--) d = b[c](d, {}, a);
            return d
        }, Jka = {
            build: oR, run: function (a, b, c) {
                var d = Hka.create(a);
                b = Ika.tokenise(b, a);
                for (a = oR(a, c, d); b.hasNext();) c = b.next(), a.receive(c);
                return d.dom
            }
        }, gb = {
            removal: function (a) {
                return function (b) {
                    kq.remover(b, a)
                }
            }, unwrapper: function (a) {
                return function (b) {
                    kq.unwrapper(b,
                        a)
                }
            }, transformer: function (a) {
                return function (b) {
                    kq.transformer(b, a)
                }
            }, validate: function () {
                return function (a) {
                    kq.validator(a)
                }
            }, pipeline: function (a) {
                return function (b) {
                    var c = Ea.get(b), d = A.owner(b);
                    c = Jka.run(d.dom(), c, a);
                    F.empty(b);
                    b.dom().appendChild(c)
                }
            }, isWordContent: function (a, b) {
                return 0 <= a.indexOf("<o:p>") || b.browser.isEdge() && 0 <= a.indexOf('v:shapes="') || b.browser.isEdge() && 0 <= a.indexOf("mso-") || 0 <= a.indexOf("mso-list") || 0 <= a.indexOf("p.MsoNormal, li.MsoNormal, div.MsoNormal") || 0 <= a.indexOf("MsoListParagraphCxSpFirst") ||
                    0 <= a.indexOf("<w:WordDocument>")
            }, go: function (a, b, c) {
                var d = r.fromTag("div", a.dom());
                d.dom().innerHTML = b;
                z(c, function (a) {
                    a(d)
                });
                return Ea.get(d)
            }
        }, Cx = {
            getAttribute: function (a, b) {
                a = r.fromDom(a.getNode());
                return m.get(a, b)
            }, getStyle: function (a, b) {
                a = r.fromDom(a.getNode());
                return v.get(a, b)
            }, isWhitespace: function (a) {
                return a.type() === Ab.TEXT_TYPE && /^[\s\u00A0]*$/.test(a.text())
            }, getMsoList: function (a) {
                a = r.fromDom(a.getNode());
                return Ig.scan(a, ["mso-list"], h(!1))["mso-list"]
            }
        }, pR = function (a, b, c) {
            return a ===
                b || a && b && a.tag === b.tag && a.type === b.type && (c || a.variant === b.variant)
        }, qR = {
            guessFrom: function (a, b) {
                return qa(a, function (a) {
                    return "UL" === a.tag || b && pR(a, b, !0)
                }).orThunk(function () {
                    return 0 === a.length ? g.none() : g.some(a[0])
                })
            }, eqListType: pR
        }, Dx = function (a, b) {
            if (void 0 === a || void 0 === b) throw console.trace(), "brick";
            a.nextFilter.set(b)
        }, rR = function (a, b, c) {
            b.nextFilter.get()(a, b, c)
        }, lq = {
            next: Dx, go: rR, jump: function (a) {
                return function (b, c, d) {
                    Dx(c, a);
                    rR(b, c, d)
                }
            }, isNext: function (a, b) {
                return a.nextFilter.get() ===
                    b
            }, setNext: function (a) {
                return function (b, c, d) {
                    Dx(c, a)
                }
            }
        }, Kka = O("level", "token", "type"), Lka = function (a, b, c, d) {
            a = c.getCurrentListType();
            c = c.getCurrentLevel() == d.level() ? a : null;
            return qR.guessFrom(d.emblems(), c).filter(function (a) {
                if (a = "OL" === a.tag) a = !U(["P"], b.tag()) || /^MsoHeading/.test(Cx.getAttribute(b, "class"));
                return !a
            })
        }, sR = {
            predicate: function (a, b) {
                return m.has(r.fromDom(b.getNode()), "data-list-level")
            }, action: function (a) {
                return function (b, c, d) {
                    b = r.fromDom(d.getNode());
                    var e = parseInt(m.get(b, "data-list-level"),
                        10), f = m.get(b, "data-list-emblems");
                    f = JSON.parse(f);
                    m.remove(b, "data-list-level");
                    m.remove(b, "data-list-emblems");
                    b = {level: h(e), emblems: h(f)};
                    b.level();
                    c.originalToken.set(d);
                    Lka(c.listType.get(), d, c.emitter, b).each(c.listType.set);
                    d = Kka(b.level(), c.originalToken.get(), c.listType.get());
                    c.emitter.openItem(d.level(), d.token(), d.type());
                    lq.next(c, a.inside())
                }
            }
        }, ZA = function (a, b) {
            return function (a, d, e) {
                return b(a, d, e)
            }
        }, tR = {
            inside: function (a) {
                return YA("Inside.List.Item", [Lr(function (a, c) {
                    return c.type() ===
                        Ab.END_ELEMENT_TYPE && a.originalToken.get() && c.tag() === a.originalToken.get().tag()
                }, function (b, c, d) {
                    lq.next(c, a.outside())
                }, "Closing open tag")], function (a, c, d) {
                    a.emit(d)
                })
            }, outside: function (a) {
                return YA("Outside.List.Item", [Lr(sR.predicate, sR.action(a), "Data List ****"), Lr(function (a, c) {
                    return c.type() === Ab.TEXT_TYPE && Cx.isWhitespace(c)
                }, function (a, c, d) {
                    a.emit(d)
                }, "Whitespace")], function (b, c, d) {
                    c.emitter.closeAllLists();
                    b.emit(d);
                    lq.next(c, a.outside())
                })
            }
        }, Mka = O("state", "result"), Nka = O("state", "value"),
        mc = {state: O("level", "type", "types", "items"), value: Nka, result: Mka}, Ex = {
            start: function (a, b) {
                var c = a.items().slice(0);
                b = void 0 !== b && "P" !== b ? g.some(b) : g.none();
                b.fold(function () {
                    c.push("P")
                }, function (a) {
                    c.push(a)
                });
                a = mc.state(a.level(), a.type(), a.types(), c);
                return mc.value(a, b)
            }, finish: function (a) {
                var b = a.items().slice(0);
                if (0 < b.length && "P" !== b[b.length - 1]) {
                    var c = b[b.length - 1];
                    b[b.length - 1] = "P";
                    a = mc.state(a.level(), a.type(), a.types(), b);
                    return mc.value(a, g.some(c))
                }
                return mc.value(a, g.none())
            }
        }, Fx = function (a,
                          b, c) {
            for (var d = []; b(a);) {
                var e = c(a);
                a = e.state();
                d = d.concat(e.result())
            }
            return mc.result(a, d)
        }, uR = {
            moveRight: function (a, b, c) {
                return Fx(a, function (a) {
                    return a.level() < b
                }, c)
            }, moveLeft: function (a, b, c) {
                return Fx(a, function (a) {
                    return a.level() > b
                }, c)
            }, moveUntil: Fx
        }, Oka = {
            from: function (a) {
                var b = {"list-style-type": "none"};
                a ? (a = Cx.getStyle(a, "margin-left"), a = void 0 !== a && "0px" !== a ? {"margin-left": a} : {}) : a = b;
                return a
            }
        }, vR = function (a, b, c) {
            var d = b.start && 1 < b.start ? {start: b.start} : {}, e = a.level() + 1, f = a.types().concat([b]);
            c = [u(Ab.createStartElement, b.tag, d, c)];
            a = mc.state(e, b, f, a.items());
            return mc.result(a, c)
        }, wR = function (a) {
            var b = a.types().slice(0), c = [u(Ab.createEndElement, b.pop().tag)], d = a.level() - 1;
            a = mc.state(d, b[b.length - 1], b, a.items());
            return mc.result(a, c)
        }, Pka = function (a, b) {
            a = wR(a);
            b = vR(a.state(), b, b.type ? {"list-style-type": b.type} : {});
            return mc.result(b.state(), a.result().concat(b.result()))
        }, bj = {
            open: vR, openItem: function (a, b, c) {
                var d = Oka.from(b);
                a = a.type() && !qR.eqListType(a.type(), c) ? Pka(a, c) : mc.result(a,
                    []);
                d = [u(Ab.createStartElement, "LI", {}, d)];
                c = Ex.start(a.state(), b && b.tag());
                var e = c.value().map(function (a) {
                    jq.styleDom(b.getNode(), h(!0));
                    return [h(b)]
                }).getOr([]);
                return mc.result(c.state(), a.result().concat(d).concat(e))
            }, close: wR, closeItem: function (a) {
                var b = u(Ab.createEndElement, "LI");
                a = Ex.finish(a);
                var c = a.value().fold(function () {
                    return [b]
                }, function (a) {
                    return [u(Ab.createEndElement, a), b]
                });
                return mc.result(a.state(), c)
            }
        }, mq = function (a) {
            if (0 === a.length) throw"Compose must have at least one element in the list";
            var b = a[a.length - 1];
            a = ia(a, function (a) {
                return a.result()
            });
            return mc.result(b.state(), a)
        }, Qka = function (a) {
            a = bj.closeItem(a);
            var b = bj.close(a.state());
            return mq([a, b])
        }, Rka = function (a, b, c, d) {
            return uR.moveRight(a, c, function (a) {
                var e = a.level() === c - 1 && b.type ? {"list-style-type": b.type} : {};
                a = bj.open(a, b, e);
                e = bj.openItem(a.state(), a.state().level() == c ? d : void 0, b);
                return mq([a, e])
            })
        }, xR = function (a, b) {
            return uR.moveLeft(a, b, Qka)
        }, Ska = function (a, b, c, d) {
            var e = 1 < c ? Ex.finish(a) : mc.value(a, g.none());
            a = e.value().map(function (a) {
                return [u(Ab.createEndElement,
                    a)]
            }).getOr([]);
            e.state().level();
            b = Rka(e.state(), b, c, d);
            return mc.result(b.state(), a.concat(b.result()))
        }, $A = {
            openItem: function (a, b, c, d) {
                a = a.level() > b ? xR(a, b) : mc.result(a, []);
                a.state().level() === b ? (b = a.state(), b = 0 < b.level() ? bj.closeItem(b) : mc.result(b, []), c = bj.openItem(b.state(), c, d), c = mq([b, c])) : c = Ska(a.state(), d, b, c);
                return mq([a, c])
            }, closeAllLists: xR
        }, SZ = ["disc", "circle", "square"], Tka = {
            getCurrentListType: function () {
                return Hl().getCurrentListType()
            }, getCurrentLevel: function () {
                return Hl().getCurrentLevel()
            },
            closeAllLists: function () {
                return Hl().closeAllLists.apply(void 0, arguments)
            }, openItem: function () {
                return Hl().openItem.apply(void 0, arguments)
            }
        }, Hl = function () {
            return {getCurrentListType: h({}), getCurrentLevel: h(1), closeAllLists: ca, openItem: ca}
        }, zR = {
            inside: function () {
                return Uka
            }, outside: function () {
                return yR
            }
        }, Vka = function () {
            var a = !1, b = "";
            return {
                check: function (c) {
                    return a && c.type() === Ab.TEXT_TYPE ? (b += c.text(), !0) : c.type() === Ab.START_ELEMENT_TYPE && "STYLE" === c.tag() ? a = !0 : c.type() === Ab.END_ELEMENT_TYPE && "STYLE" ===
                    c.tag() ? (a = !1, !0) : !1
                }
            }
        }(), Uka = tR.inside(zR), yR = tR.outside(zR), AR = function (a) {
            var b = na(a), c = na(null), d = na(null);
            return {
                reset: function (e) {
                    b.set(a);
                    c.set(null);
                    d.set(null);
                    e = RZ(e, e.document);
                    Hl = h(e)
                }, nextFilter: b, originalToken: c, listType: d, emitter: Tka
            }
        }(yR), Wka = XA(function (a, b, c) {
            Vka.check(b) || lq.go(a, AR, b)
        }, AR.reset, "list.filters"), Xka = [{regex: /^\(?[dc][\.\)]$/, type: {tag: "OL", type: "lower-alpha"}}, {
            regex: /^\(?[DC][\.\)]$/,
            type: {tag: "OL", type: "upper-alpha"}
        }, {
            regex: /^\(?M*(CM|CD|D?C{0,3})(XC|XL|L?X{0,3})(IX|IV|V?I{0,3})[\.\)]$/,
            type: {tag: "OL", type: "upper-roman"}
        }, {
            regex: /^\(?m*(cm|cd|d?c{0,3})(xc|xl|l?x{0,3})(ix|iv|v?i{0,3})[\.\)]$/,
            type: {tag: "OL", type: "lower-roman"}
        }, {regex: /^\(?[0-9]+[\.\)]$/, type: {tag: "OL"}}, {
            regex: /^([0-9]+\.)*[0-9]+\.?$/,
            type: {tag: "OL", variant: "outline"}
        }, {regex: /^\(?[a-z]+[\.\)]$/, type: {tag: "OL", type: "lower-alpha"}}, {
            regex: /^\(?[A-Z]+[\.\)]$/,
            type: {tag: "OL", type: "upper-alpha"}
        }], BR = {
            "\u2022": {tag: "UL", type: "disc"},
            "\u00b7": {tag: "UL", type: "disc"},
            "\u00a7": {tag: "UL", type: "square"}
        }, CR = {
            o: {tag: "UL", type: "circle"},
            "-": {tag: "UL", type: "disc"}, "\u25cf": {tag: "UL", type: "disc"}, "\ufffd": {tag: "UL", type: "circle"}
        }, Yka = {
            extract: function (a, b) {
                var c = CR[a] ? [CR[a]] : [];
                b = b && BR[a] ? [BR[a]] : b ? [{tag: "UL", variant: a}] : [];
                var d = ia(Xka, function (b) {
                    if (b.regex.test(a)) {
                        var c = b.type;
                        var d = a.split(".");
                        if (0 === d.length) d = a; else {
                            var e = d[d.length - 1];
                            d = 0 === e.length && 1 < d.length ? d[d.length - 2] : e
                        }
                        d = parseInt(d, 10);
                        d = isNaN(d) ? {} : {start: d};
                        b = b.type;
                        b = void 0 !== b.variant ? b.variant : "(" === a.charAt(0) ? "()" : ")" === a.charAt(a.length - 1) ? ")" : ".";
                        c = [ua(c,
                            d, {variant: b})]
                    } else c = [];
                    return c
                });
                c = c.concat(b).concat(d);
                return E(c, function (b) {
                    return void 0 !== b.variant ? b : ua(b, {variant: a})
                })
            }
        }, DR = function (a) {
            return Ig.scan(a, ["mso-list"], h(!1))["mso-list"]
        }, ER = function (a) {
            return D.isElement(a) && v.getRaw(a, "font-family").exists(function (a) {
                return U(["wingdings", "symbol"], a.toLowerCase())
            })
        }, Fc = {
            getMsoList: DR, extractLevel: function (a) {
                a = DR(a);
                return (a = / level([0-9]+)/.exec(a)) && a[1] ? g.some(parseInt(a[1], 10)) : g.none()
            }, extractEmblem: function (a, b) {
                a = Vb.get(a).trim();
                b = Yka.extract(a, b);
                return 0 < b.length ? g.some(b) : g.none()
            }, extractSymSpan: function (a) {
                return Ja.child(a, ER)
            }, extractMsoIgnore: function (a) {
                return Ja.descendant(a, function (a) {
                    return !!(D.isElement(a) ? Ig.scan(a, ["mso-list"], h(!1)) : [])["mso-list"]
                })
            }, extractCommentSpan: function (a) {
                return Ja.child(a, D.isComment).bind(A.nextSibling).filter(function (a) {
                    return "span" === D.name(a)
                })
            }, isSymbol: ER, deduceLevel: function (a) {
                return v.getRaw(a, "margin-left").bind(function (a) {
                    a = parseInt(a, 10);
                    return isNaN(a) ? g.none() :
                        g.some(Math.max(1, Math.ceil(a / 18)))
                })
            }
        }, FR = function (a) {
            for (var b = []; null !== a.nextNode();) b.push(r.fromDom(a.currentNode));
            return b
        }, Zka = function (a) {
            try {
                return FR(a)
            } catch (b) {
                return []
            }
        }, GR = aa.detect().browser, $ka = GR.isIE() || GR.isEdge() ? Zka : FR, ala = h(h(!0)), bla = {
            find: function (a, b) {
                b = b.fold(ala, function (a) {
                    return function (b) {
                        return a(b.nodeValue)
                    }
                });
                b.acceptNode = b;
                a = Hb.createTreeWalker(a.dom(), Kc.getOrDie("NodeFilter").SHOW_COMMENT, b, !1);
                return $ka(a)
            }
        }, Il = function (a, b, c, d) {
            m.set(a, "data-list-level",
                b);
            b = JSON.stringify(c);
            m.set(a, "data-list-emblems", b);
            b = bla.find(a, g.none());
            z(b, F.remove);
            z(d, F.remove);
            m.remove(a, "style");
            m.remove(a, "class")
        }, cla = function (a) {
            return Fc.extractLevel(a).bind(function (b) {
                return Fc.extractSymSpan(a).bind(function (c) {
                    return Fc.extractEmblem(c, !0).map(function (d) {
                        return {
                            mutate: function () {
                                Il(a, b, d, [c])
                            }
                        }
                    })
                })
            })
        }, dla = function (a) {
            return Fc.extractLevel(a).bind(function (b) {
                return Fc.extractCommentSpan(a).bind(function (c) {
                    return Fc.extractEmblem(c, Fc.isSymbol(c)).map(function (d) {
                        return {
                            mutate: function () {
                                Il(a,
                                    b, d, [c])
                            }
                        }
                    })
                })
            })
        }, ela = function (a) {
            return Fc.extractLevel(a).bind(function (b) {
                return Fc.extractCommentSpan(a).bind(function (c) {
                    return Fc.extractEmblem(c, Fc.isSymbol(c)).map(function (d) {
                        return {
                            mutate: function () {
                                Il(a, b, d, [c])
                            }
                        }
                    })
                })
            })
        }, fla = function (a) {
            return "p" !== D.name(a) ? g.none() : Fc.extractLevel(a).bind(function (b) {
                return Fc.extractMsoIgnore(a).bind(function (c) {
                    return Fc.extractEmblem(c, !1).map(function (d) {
                        return {
                            mutate: function () {
                                Il(a, b, d, [A.parent(c).getOr(c)])
                            }
                        }
                    })
                })
            })
        }, gla = function (a) {
            return "p" !==
            D.name(a) ? g.none() : Fc.extractMsoIgnore(a).bind(function (b) {
                var c = A.parent(b).getOr(b), d = Fc.isSymbol(c);
                return Fc.extractEmblem(b, d).bind(function (b) {
                    return Fc.deduceLevel(a).map(function (d) {
                        return {
                            mutate: function () {
                                Il(a, d, b, [c])
                            }
                        }
                    })
                })
            })
        }, hla = {
            find: function (a) {
                return cla(a).orThunk(function () {
                    return dla(a)
                }).orThunk(function () {
                    return ela(a)
                }).orThunk(function () {
                    return fla(a)
                }).orThunk(function () {
                    return gla(a)
                })
            }
        }, ila = gb.transformer({
            tags: [{
                name: M.pattern(/^(p|h\d+)$/, M.caseInsensitive), mutate: function (a) {
                    hla.find(a).each(function (a) {
                        a.mutate()
                    })
                }
            }]
        }),
        jla = function (a) {
            var b = a.dom().attributes;
            b = void 0 !== b && null !== b && 0 < b.length;
            return "span" === D.name(a) ? b : !0
        }, Gx = function (a) {
            return void 0 === a.dom().attributes || null === a.dom().attributes ? !0 : 0 === a.dom().attributes.length || 1 === a.dom().attributes.length && "style" === a.dom().attributes[0].name
        }, HR = function (a, b) {
            var c = r.fromTag(a);
            y.before(b, c);
            a = b.dom().attributes;
            z(a, function (a) {
                c.dom().setAttribute(a.name, a.value)
            });
            a = A.children(b);
            P.append(c, a);
            F.remove(b);
            return c
        }, IR = function (a) {
            return A.prevSibling(a).bind(function (a) {
                return D.isText(a) &&
                0 === Ya.get(a).trim().length ? IR(a) : "li" === D.name(a) ? g.some(a) : g.none()
            })
        }, Bh = {
            changeTag: HR, addBrTag: function (a) {
                0 === Ea.get(a).length && y.append(a, r.fromTag("br"))
            }, properlyNest: function (a) {
                A.parent(a).each(function (b) {
                    b = D.name(b);
                    U(["ol", "ul"], b) && IR(a).fold(function () {
                        var b = r.fromTag("li");
                        v.set(b, "list-style-type", "none");
                        y.wrap(a, b)
                    }, function (b) {
                        y.append(b, a)
                    })
                })
            }, fontToSpan: function (a) {
                var b = HR("span", a),
                    c = {"font-size": {1: "8pt", 2: "10pt", 3: "12pt", 4: "14pt", 5: "18pt", 6: "24pt", 7: "36pt"}};
                Ma({
                    face: "font-family",
                    size: "font-size", color: "color"
                }, function (a, e) {
                    if (m.has(b, e)) {
                        var d = m.get(b, e);
                        v.set(b, a, void 0 !== c[a] && void 0 !== c[a][d] ? c[a][d] : d);
                        m.remove(b, e)
                    }
                })
            }
        }, kla = gb.unwrapper({tags: [{name: M.pattern(/^([OVWXP]|U[0-9]+|ST[0-9]+):/i, M.caseInsensitive)}]}),
        lla = gb.removal({
            attributes: [{
                name: M.exact("id", M.caseInsensitive),
                value: M.starts("docs-internal-guid", M.caseInsensitive)
            }]
        }), mla = [gb.pipeline([Wka])], nla = gb.removal({
            attributes: [{name: M.pattern(/^v:/, M.caseInsensitive)}, {
                name: M.exact("href", M.caseInsensitive),
                value: M.contains("#_toc", M.caseInsensitive)
            }, {
                name: M.exact("href", M.caseInsensitive),
                value: M.contains("#_mso", M.caseInsensitive)
            }, {name: M.pattern(/^xmlns(:|$)/, M.caseInsensitive)}, {
                name: M.exact("type", M.caseInsensitive),
                condition: function (a) {
                    return "ol" === D.name(a) || "ul" === D.name(a)
                }
            }]
        }), ola = gb.removal({
            tags: [{name: M.exact("script", M.caseInsensitive)}, {name: M.exact("link", M.caseInsensitive)}, {
                name: M.exact("style", M.caseInsensitive),
                condition: function (a) {
                    return 0 === Ea.get(a).length
                }
            }],
            attributes: [{
                name: M.starts("on",
                    M.caseInsensitive)
            }, {name: M.exact('"', M.caseInsensitive)}, {name: M.exact("lang", M.caseInsensitive)}, {name: M.exact("language", M.caseInsensitive)}],
            styles: [{name: M.all(), value: M.pattern(/OLE_LINK/i, M.caseInsensitive)}]
        }), JR = gb.removal({tags: [{name: M.exact("meta", M.caseInsensitive)}]}),
        pla = gb.removal({tags: [{name: M.exact("style", M.caseInsensitive)}]}), qla = gb.removal({
            styles: [{
                name: M.not(M.pattern(/width|height|list-style-type/, M.caseInsensitive)), condition: function (a) {
                    return !n.has(a, "ephox-limbo-transform")
                }
            },
                {
                    name: M.pattern(/width|height/, M.caseInsensitive), condition: function (a) {
                        return "img" !== D.name(a)
                    }
                }]
        }), rla = gb.removal({classes: [{name: M.not(M.exact("rtf-data-image", M.caseInsensitive))}]}),
        sla = gb.removal({styles: [{name: M.pattern(gR.validStyles(), M.caseInsensitive)}]}),
        tla = gb.removal({classes: [{name: M.pattern(/mso/i, M.caseInsensitive)}]}), ula = gb.unwrapper({
            tags: [{
                name: M.exact("img", M.caseInsensitive), condition: function (a) {
                    a = m.get(a, "src");
                    return /^file:/.test(a)
                }
            }]
        }), vla = gb.unwrapper({
            tags: [{
                name: M.exact("a",
                    M.caseInsensitive), condition: Gx
            }]
        }), wla = gb.removal({
            attributes: [{
                name: M.exact("style", M.caseInsensitive),
                value: M.exact("", M.caseInsensitive),
                debug: !0
            }]
        }), xla = gb.removal({
            attributes: [{
                name: M.exact("class", M.caseInsensitive),
                value: M.exact("", M.caseInsensitive),
                debug: !0
            }]
        }), yla = gb.unwrapper({
            tags: [{
                name: M.pattern(gR.specialInline(), M.caseInsensitive), condition: zf(function (a) {
                    return Gx(a) ? jla(a) && wd.descendant(a, function (a) {
                        var b = !Gx(a),
                            d = !U("font em strong samp acronym cite code dfn kbd tt b i u s sub sup ins del var span".split(" "),
                                D.name(a));
                        return D.isText(a) || b || d
                    }) : !0
                })
            }]
        }), zla = gb.unwrapper({
            tags: [{
                name: M.exact("p", M.caseInsensitive), condition: function (a) {
                    return function (b) {
                        return A.parent(b).exists(function (b) {
                            return D.name(b) === a && 1 === A.children(b).length
                        })
                    }
                }("li")
            }]
        }), Ala = gb.transformer({tags: [{name: M.exact("p", M.caseInsensitive), mutate: Bh.addBrTag}]}),
        Bla = gb.transformer({tags: [{name: M.pattern(/ol|ul/, M.caseInsensitive), mutate: Bh.properlyNest}]}),
        Cla = gb.transformer({
            tags: [{
                name: M.exact("b", M.caseInsensitive), mutate: u(Bh.changeTag,
                    "strong")
            }, {
                name: M.exact("i", M.caseInsensitive),
                mutate: u(Bh.changeTag, "em")
            }, {
                name: M.exact("u", M.caseInsensitive), mutate: function (a) {
                    a = Bh.changeTag("span", a);
                    n.add(a, "ephox-limbo-transform");
                    v.set(a, "text-decoration", "underline")
                }
            }, {
                name: M.exact("s", M.caseInsensitive),
                mutate: u(Bh.changeTag, "strike")
            }, {name: M.exact("font", M.caseInsensitive), mutate: Bh.fontToSpan, debug: !0}]
        }), Dla = gb.removal({classes: [{name: M.exact("ephox-limbo-transform", M.caseInsensitive)}]}),
        Ela = gb.removal({
            tags: [{
                name: M.exact("br",
                    M.caseInsensitive), condition: yf.hasClass("Apple-interchange-newline")
            }]
        }), Fla = gb.removal({
            styles: [{name: M.pattern(/^-/, M.caseInsensitive)}, {
                name: M.all(),
                value: M.exact("initial", M.caseInsensitive)
            }, {
                name: M.exact("background-color", M.caseInsensitive),
                value: M.exact("transparent", M.caseInsensitive)
            }, {
                name: M.exact("font-style", M.caseInsensitive),
                value: M.exact("normal", M.caseInsensitive)
            }, {name: M.pattern(/font-variant.*/, M.caseInsensitive)}, {name: M.exact("letter-spacing", M.caseInsensitive)}, {
                name: M.exact("font-weight",
                    M.caseInsensitive), value: M.pattern(/400|normal/, M.caseInsensitive)
            }, {name: M.exact("orphans", M.caseInsensitive)}, {
                name: M.exact("text-decoration", M.caseInsensitive),
                value: M.exact("none", M.caseInsensitive)
            }, {name: M.exact("text-size-adjust", M.caseInsensitive)}, {
                name: M.exact("text-indent", M.caseInsensitive),
                value: M.exact("0px", M.caseInsensitive)
            }, {name: M.exact("text-transform", M.caseInsensitive), value: M.exact("none", M.caseInsensitive)}, {
                name: M.exact("white-space", M.caseInsensitive), value: M.exact("normal",
                    M.caseInsensitive)
            }, {name: M.exact("widows", M.caseInsensitive)}, {
                name: M.exact("word-spacing", M.caseInsensitive),
                value: M.exact("0px", M.caseInsensitive)
            }, {
                name: M.exact("text-align", M.caseInsensitive),
                value: M.pattern(/start|end/, M.caseInsensitive)
            }, {
                name: M.exact("font-weight", M.caseInsensitive),
                value: M.pattern(/700|bold/, M.caseInsensitive),
                condition: function (a) {
                    return /^h\d$/.test(D.name(a))
                }
            }]
        }), Gla = function () {
            var a = function (a, b) {
                return function (c) {
                    return a(c).filter(function (a) {
                        return D.isText(c) && b(Vb.get(a),
                            " ")
                    }).isSome()
                }
            }, b = a(A.prevSibling, je), c = a(A.nextSibling, Gb);
            return gb.transformer({
                tags: [{
                    name: M.exact("span", M.caseInsensitive),
                    condition: yf.hasClass("Apple-converted-space"),
                    mutate: function (a) {
                        "\u00a0" === Vb.get(a) && (b(a) || c(a) ? F.unwrap(a) : (y.before(a, r.fromText(" ")), F.remove(a)))
                    }
                }]
            })
        }(), Hla = function () {
            var a = /^file:\/\/\/[^#]+(#[^#]+)$/;
            return gb.transformer({
                tags: [{
                    name: M.exact("a", M.caseInsensitive), condition: function (b) {
                        return (b = m.get(b, "href")) ? a.test(b) : !1
                    }, mutate: function (b) {
                        var c = m.get(b,
                            "href");
                        m.set(b, "href", c.replace(a, "$1"))
                    }
                }]
            })
        }(), Ila = gb.removal({
            attributes: [{
                name: M.exact("href", M.caseInsensitive),
                value: M.starts("file:///", M.caseInsensitive),
                debug: !0
            }]
        }), KR = function () {
            var a = function (a, c, d) {
                return {
                    name: M.exact(a, M.caseInsensitive), condition: function (a) {
                        return m.has(a, c)
                    }, mutate: function (a) {
                        var b = m.get(a, c);
                        m.set(a, d, b);
                        m.remove(a, c)
                    }
                }
            };
            return gb.transformer({tags: [a("a", "data-ephox-href", "href"), a("img", "data-ephox-src", "src")]})
        }(), Jla = function (a) {
            var b = "table thead tbody tfoot th tr td ul ol li".split(" "),
                c = ed.descendants(a, D.isComment), d = qa(c, function (a) {
                    return Bb(Dv.get(a), "StartFragment")
                }), e = qa(c, function (a) {
                    return Bb(Dv.get(a), "EndFragment")
                });
            d.each(function (c) {
                e.each(function (d) {
                    var e = c, f = [];
                    for (d = id.commonAncestorContainer(c, 0, d, 0); void 0 !== d && !N.eq(d, a);) U(b, D.name(d)) ? e = d : f.push(d), d = A.parent(d).getOr(void 0);
                    z(f, F.unwrap);
                    z(A.prevSiblings(e), F.remove)
                });
                F.remove(c)
            });
            e.each(F.remove)
        }, nq = t, oq = function (a) {
            return a.browser.isIE() && 11 <= a.browser.version.major
        }, Kla = function (a, b, c) {
            var d = r.fromDom(a.getNode());
            return b(d).fold(function () {
                return [a]
            }, function (b) {
                var d = a.type() === Ab.END_ELEMENT_TYPE, e = [Ab.token(b.dom(), d)];
                !d && c && e.push(Ab.token(b.dom(), !0));
                return e
            })
        }, Lla = function (a, b) {
            return XA(function (c, d) {
                d = Kla(d, a, b);
                z(d, c.emit)
            }, t, "image filters")
        }, Mla = {
            derive: function (a, b, c) {
                var d = c.browser.isFirefox() || c.browser.isEdge();
                var e = d ? Cka : Dka;
                var f = !d;
                e = oq(c) ? nq : gb.pipeline([Lla(e, f)]);
                e = [a ? e : nq];
                d = [d ? nq : ula];
                f = oq(c) || !a ? [] : [ila];
                var g = [Cla];
                if (a) {
                    var h = [kla];
                    var m = oq(c) ? [] : mla;
                    h = h.concat(m).concat([nla])
                } else h =
                    [nq];
                m = [lla];
                var n = [Bla], p = [ola], r = [JR];
                var t = [sla, tla];
                var u = [qla, rla];
                t = b ? t : u;
                u = [Hla, Ila, vla, KR];
                var v = [wla], x = [xla], y = [yla], z = [Ela];
                b = !a && b ? [Fla] : [];
                var A = [Gla], B = [Ala];
                a = oq(c) && a ? [zla] : [];
                return Qb([d, f, e, g, h, m, n, p, r, t, u, v, x, y, z, b, A, B, a, [Dla], [pla]])
            }
        }, Nla = In.link().source, Ola = function (a) {
            var b = O("word", "pattern"), c = Cb.unsafetoken(Nla);
            b = b("__INTERNAL__", c);
            return Kp.run(a, [b])
        }, Pla = function (a) {
            return !Db.closest(a, "a")
        }, Qla = function (a) {
            return g.from(a[0]).filter(Pla).map(function (b) {
                var c = r.fromTag("a");
                y.before(b, c);
                P.append(c, a);
                m.set(c, "href", Vb.get(c));
                return c
            })
        }, Rla = function (a) {
            a = Ola(a);
            z(a, function (a) {
                var b = a.exact(), d;
                (d = 0 > b.indexOf("@")) || (b = b.indexOf("://"), d = 3 <= b && 9 >= b);
                d && Qla(a.elements())
            })
        }, Sla = function (a) {
            z(a, function (a) {
                D.isElement(a) && v.getRaw(a, "position").isSome() && v.remove(a, "position")
            })
        }, Tla = function (a) {
            var b = ka(a, function (a) {
                return "li" === D.name(a)
            });
            if (0 < b.length) {
                var c = A.prevSiblings(b[0]), d = r.fromTag("ul");
                y.before(a[0], d);
                0 < c.length && (a = r.fromTag("li"), y.append(d, a), P.append(a,
                    c));
                P.append(d, b)
            }
        }, LR = function (a) {
            var b = A.children(a);
            z([Rla, Sla, Tla], function (a) {
                a(b)
            })
        }, pq = {
            go: function (a, b, c, d, e) {
                LR(c);
                c = Ea.get(c);
                b = Mla.derive(e, d, b);
                return gb.go(a, c, b)
            }, preprocess: LR, internal: function (a, b) {
                b = Ea.get(b);
                return gb.go(a, b, [JR, KR])
            }, clean: function (a, b) {
                b = Ea.get(b);
                return gb.go(a, b, [Jla])
            }
        }, Jl = Ha("simple-adt"), MR = {
            generate: function (a) {
                var b = function (a) {
                    return 0 === a.indexOf(Jl) ? a.substring(Jl.length + 1) : a
                }, c = cb(a), d = {};
                z(c, function (a) {
                    d["as" + ns(a)] = function (b) {
                        return b._simpleAdt ===
                        Jl + "_" + a ? g.some(b.data) : g.none()
                    }
                });
                var e = {};
                Ma(a, function (a, b) {
                    e[b] = function (c) {
                        var d = Jl + "_" + b;
                        var e = 0 === a.length ? {} : Aa(a, [])(c);
                        return {_simpleAdt: d, data: e, _simpleAdt_data: c}
                    }
                });
                return oa(d, {
                    constructors: e, match: function (a, d) {
                        var e = cb(d);
                        if (e.length !== c.length) throw Error("Partial match");
                        return yc(e, function (b) {
                            return a._simpleAdt === Jl + "_" + b ? g.some(d[b]) : g.none()
                        }).getOrDie("Must find branch for constructor: " + b(a._simpleAdt))(a.data)
                    }
                })
            }
        }, qq = MR.generate({getFromFlash: [], disabled: [], fromClipboard: ["rtf"]}),
        Rm = {
            getFromFlash: qq.constructors.getFromFlash,
            disabled: qq.constructors.disabled,
            fromClipboard: qq.constructors.fromClipboard,
            match: qq.match
        }, NR = function (a, b) {
            var c = new RegExp(b, "i");
            return yc(a, function (a) {
                return null !== a.match(c) ? g.some({type: a, flavor: b}) : g.none()
            })
        }, Hx = {
            isValidData: function (a) {
                return void 0 !== a && void 0 !== a.types && null !== a.types
            }, getPreferredFlavor: function (a, b) {
                return yc(a, function (a) {
                    return NR(b, a)
                })
            }, getFlavor: NR
        }, Xc = MR.generate({
            event: ["nativeEvent"], html: ["container"], word: ["html",
                "rtf"], text: ["text"], images: ["images"]
        }), Ix = aa.detect().browser, Ula = !(Ix.isIE() || Ix.isEdge() && 16 > Ix.version.major), Vla = ["^image/", "file"],
        Wla = function (a) {
            return Bb(a, "<html") && (Bb(a, 'xmlns:o="urn:schemas-microsoft-com:office:office"') || Bb(a, 'xmlns:x="urn:schemas-microsoft-com:office:excel"'))
        }, Xla = function (a) {
            return Bb(a, "<meta") && Bb(a, 'id="docs-internal-guid')
        }, Yla = function (a) {
            return 0 < a.length
        }, OR = function (a, b) {
            return Hx.getFlavor(a.types, b).map(function (b) {
                return a.getData(b.type)
            }).filter(Yla)
        },
        Jx = function (a) {
            return OR(a, "html")
        }, Zla = function (a) {
            return Jx(a).filter(Xla)
        }, cj = function (a) {
            return Ula ? g.some(a.clipboardData).filter(Hx.isValidData) : g.none()
        }, PR = function (a) {
            var b = r.fromTag("div");
            Ea.set(b, a);
            a = pq.clean(A.owner(b), b);
            b = r.fromTag("div");
            Ea.set(b, a);
            return Xc.constructors.html({container: b})
        }, TZ = {
            fromEvent: function (a) {
                var b = function (a) {
                    return void 0 === a.items ? g.none() : Hx.getPreferredFlavor(Vla, a.types).map(function (b) {
                        return Xc.constructors.images({images: a.items})
                    })
                }, c = function (a) {
                    return yc(a.types,
                        function (b) {
                            return "text/plain" === b ? g.some(a.getData(b)).map(function (a) {
                                return Xc.constructors.text({text: a})
                            }) : g.none()
                        })
                };
                return {
                    getWordData: function () {
                        return cj(a).bind(function (a) {
                            return Jx(a).filter(Wla).map(function (b) {
                                var c = OR(a, "rtf");
                                return Xc.constructors.word({
                                    html: b, rtf: c.fold(Rm.getFromFlash, function (a) {
                                        return Rm.fromClipboard({rtf: a})
                                    })
                                })
                            })
                        })
                    }, getGoogleDocsData: function () {
                        return cj(a).bind(Zla).map(PR)
                    }, getImage: function () {
                        return cj(a).bind(b)
                    }, getText: function () {
                        return cj(a).fold(function () {
                            var a =
                                Zg.clipboardData;
                            return void 0 !== a ? g.some(Xc.constructors.text({text: a.getData("text")})) : g.none()
                        }, c)
                    }, getHtml: function () {
                        return cj(a).bind(Jx).map(PR)
                    }, getOnlyText: function () {
                        return cj(a).bind(function (a) {
                            var b = a.types;
                            return 1 === b.length && "text/plain" === b[0] ? c(a) : g.none()
                        })
                    }, getNative: function () {
                        return Xc.constructors.event({nativeEvent: a})
                    }
                }
            }, fromHtml: function (a) {
                return {
                    getWordData: function () {
                        return g.some(Xc.constructors.word({html: a, rtf: Rm.disabled()}))
                    }, getGoogleDocsData: g.none, getImage: g.none,
                    getHtml: g.none, getText: g.none, getNative: yb("There is no native event"), getOnlyText: g.none
                }
            }, fromText: function (a) {
                return {
                    getWordData: g.none,
                    getGoogleDocsData: g.none,
                    getImage: g.none,
                    getHtml: g.none,
                    getText: function () {
                        return g.some(Xc.constructors.text({text: a}))
                    },
                    getNative: yb("There is no native event"),
                    getOnlyText: g.none
                }
            }
        }, $la = {resolve: Lb.create("ephox-sloth").resolve}.resolve("bin"), dB = {bin: h($la)}, QR = aa.detect(),
        ama = function (a, b, c) {
            b.control.block();
            a.dom().execCommand("paste");
            c();
            b.control.unblock()
        },
        bma = function (a, b, c) {
            setTimeout(c, 1)
        }, RR = QR.browser.isIE() && 10 >= QR.browser.version.major, cma = RR ? ama : bma, eB = {
            willBlock: h(RR), run: function (a, b, c) {
                return cma(a, b, c)
            }
        }, cB = function (a) {
            return E(a, function (a) {
                return a.asset()
            })
        }, Kl = O("asset", "image"), SR = function (a, b) {
            return Qc.cata(a, function (a, d, e, f) {
                m.set(b, "src", e);
                return !0
            }, fd)
        }, tf = {
            assetImage: Kl, createImages: function (a) {
                var b = [], c = [];
                z(a, function (a) {
                    return Qc.cata(a, function (d, f, g, h) {
                        d = r.fromTag("img");
                        m.set(d, "src", g);
                        b.push(d);
                        c.push(Kl(a, d))
                    }, function (a,
                                 b, c) {
                        ld.error("Internal error: Paste operation produced an image URL instead of a Data URI: ", b)
                    })
                });
                return db.paste(b, c)
            }, findImages: function (a, b) {
                var c = [], d = ia(a, function (a) {
                    return "img" === D.name(a) ? [a] : Y.descendants(a, "img")
                });
                z(b, function (a) {
                    Qc.cata(a, function (b, e, g, h) {
                        z(d, function (b) {
                            m.get(b, "src") === g && c.push(Kl(a, b))
                        })
                    }, t)
                });
                return c
            }, updateSource: SR, updateSources: function (a, b) {
                var c = [];
                z(a, function (a, e) {
                    e = b[e];
                    SR(a, e) && c.push(Kl(a, e))
                });
                return c
            }, browserBlobs: function (a) {
                return Ce(a, function (a) {
                    return Ga.nu(function (b) {
                        var c =
                            a.dom();
                        Yc.imageToImageResult(c).then(function (d) {
                            d.toBlob().then(function (e) {
                                e = Gb(c.src, "blob:") ? c.src : E1.createObjectURL(e);
                                var f = Ha("image");
                                e = Qc.blob(f, d, e);
                                b(Kl(e, a))
                            })
                        })
                    })
                })
            }
        }, dma = function (a) {
            return Ga.nu(function (b) {
                var c = Yc.imageResultToBlob(a, "image/png").then(function (a) {
                    Re.single(a).map(g.some).get(b)
                });
                return c["catch"].call(c, function (a) {
                    ld.warn(a);
                    b(g.none())
                })
            })
        }, UZ = function (a) {
            var b = function () {
                return Ga.pure(a)
            };
            return Qc.cata(a.asset(), function (c, d, e) {
                return /tiff$/.test(d.getType()) ?
                    dma(d).map(function (b) {
                        return b.map(function (b) {
                            var c = a.image();
                            dg.revokeObjectURL(e);
                            tf.updateSource(b, c);
                            return tf.assetImage(b, c)
                        }).getOr(a)
                    }) : b()
            }, b)
        }, ub = {
            blocking: function (a) {
                return function (b) {
                    return function (c, d) {
                        b.block();
                        return a(c, d).map(function (a) {
                            b.unblock();
                            return a
                        })
                    }
                }
            }, normal: function (a) {
                return h(a)
            }
        }, ema = {
            convert: function (a) {
                var b = bh("window.clipboardData.files"),
                    c = void 0 !== a.convertURL ? a.convertURL : void 0 !== a.msConvertURL ? a.msConvertURL : void 0;
                return void 0 !== b && void 0 !== c && 0 < b.length ?
                    (b = Ce(b, function (b) {
                        var d = dg.createObjectURL(b);
                        c.apply(a, [b, "specified", d]);
                        return Re.singleWithUrl(b, d)
                    }), g.some(b)) : g.none()
            }
        }, fma = function () {
            var a = g.none();
            return {
                convert: function (b) {
                    a = ema.convert(b)
                }, listen: function (b) {
                    return a.fold(function () {
                        return Ga.nu(function (a) {
                            a([])
                        })
                    }, function (a) {
                        return a
                    }).get(b)
                }, clear: function () {
                    a = g.none()
                }
            }
        }, gma = function (a, b) {
            return Nj.dataUriToBlobSync(b).map(function (b) {
                return tf.assetImage(Re.single(b), a)
            })
        }, hma = function (a, b) {
            return Nj.uriToBlob(b).map(function (b) {
                var c =
                    Ga.nu(function (a) {
                        b.then(function (b) {
                            Re.single(b).get(a)
                        })
                    });
                return tf.assetImage(c, a)
            })
        }, fB = function (a) {
            var b = r.fromTag("div");
            P.append(b, a);
            return Y.descendants(b, "img[src]")
        }, TR = function (a) {
            return 0 === a.indexOf("data:") && -1 < a.indexOf("base64")
        }, gB = function (a) {
            a = m.get(a, "src");
            return TR(a) || 0 === a.indexOf("blob:")
        }, VZ = function (a) {
            return ia(fB(a), function (a) {
                var b = m.get(a, "src");
                return TR(b) ? gma(a, b).toArray() : 0 === b.indexOf("blob:") ? hma(a, b).toArray() : []
            })
        }, WZ = function (a) {
            a = ka(a, function (a) {
                return "img" !==
                    D.name(a) || !gB(a)
            });
            return db.incomplete(a, [], "errors.local.images.disallowed")
        }, ima = {
            convert: function (a, b) {
                if (0 === a.length) throw"Zero length content passed to Hex conversion";
                for (var c = Array(a.length / 2), d = 0; d < a.length; d += 2) {
                    var e = a.substr(d, 2);
                    c[Math.floor(d / 2)] = parseInt(e, 16)
                }
                a = fz(c);
                return ez([a], {type: b})
            }
        },
        UR = ta.generate([{unsupported: ["id", "message", "isEquation"]}, {supported: ["id", "contentType", "blob", "isEquation"]}]),
        dj = {
            unsupported: UR.unsupported, supported: UR.supported, cata: function (a, b, c) {
                return a.fold(b,
                    c)
            }
        }, VR = function (a, b, c, d, e, f) {
            return -1 === a || -1 === b ? g.none() : g.some({start: a, end: b, bower: c, regex: d, idRef: e, isEquation: f})
        }, rq = function (a, b) {
            if (-1 === b) return b;
            var c = 0, d = a.length;
            do {
                var e = a.indexOf("{", b);
                var f = a.indexOf("}", b);
                f > e && -1 !== e ? (b = e + 1, ++c) : (e > f || 0 > e) && -1 !== f && (b = f + 1, --c);
                if (b > d || -1 === f) return -1
            } while (0 < c);
            return b
        }, jma = function (a, b, c, d, e) {
            a = a.substring(c, d);
            return VR(c, d, a, /[^a-fA-F0-9]([a-fA-F0-9]+)\}$/, "i", e)
        }, kma = function (a, b, c, d, e) {
            a = a.substring(c, d);
            return VR(c, d, a, /([a-fA-F0-9]{64,})(?:\}.*)/,
                "s", e)
        }, lma = {
            identify: function (a, b) {
                var c = a.indexOf("{\\pict{", b), d = rq(a, c), e = a.indexOf("{\\shp{", b), f = rq(a, e),
                    k = a.indexOf("{\\mmathPict{", b), h = rq(a, k);
                h = -1 !== k && (k < c && h > d || k < e && h > f);
                k = u(kma, a, b, e, f, h);
                a = u(jma, a, b, c, d, h);
                return -1 === c && -1 === e ? g.none() : -1 === c ? k() : -1 === e ? a() : e < c && f > d ? a() : c < e && d > f ? k() : c < e ? a() : e < c ? k() : g.none()
            }, endBracket: rq
        }, WR = function (a, b) {
            return lma.identify(a, b)
        }, XR = function (a) {
            return 0 <= a.indexOf("\\pngblip") ? I.value("image/png") : 0 <= a.indexOf("\\jpegblip") ? I.value("image/jpeg") :
                I.error("errors.imageimport.unsupported")
        }, YR = function (a, b) {
            return (a = a.match(b)) && a[1] && 0 === a[1].length % 2 ? I.value(a[1]) : I.error("errors.imageimport.invalid")
        }, ZR = function (a) {
            a = a.match(/\\shplid(\d+)/);
            return null !== a ? g.some(a[1]) : g.none()
        }, mma = function (a) {
            var b = a.bower, c = a.regex, d = a.isEquation;
            return ZR(b).map(function (e) {
                var f = a.idRef + e;
                return XR(b).fold(function (a) {
                    return dj.unsupported(f, a, d)
                }, function (a) {
                    return YR(b, c).fold(function (a) {
                        return dj.unsupported(f, a, d)
                    }, function (b) {
                        return dj.supported(f,
                            a, ima.convert(b, a), d)
                    })
                })
            })
        }, nma = function (a) {
            for (var b = [], c = function () {
                return a.length
            }, d = function (a) {
                var c = mma(a);
                b = b.concat(c.toArray());
                return a.end
            }, e = 0; e < a.length;) e = WR(a, e).fold(c, d);
            return b
        }, oma = {
            nextBower: WR, extractId: ZR, extractContentType: XR, extractHex: YR, images: function (a) {
                a = a.replace(/\r/g, "").replace(/\n/g, "");
                return nma(a)
            }
        }, uf = {
            images: function (a) {
                return oma.images(a)
            }, toId: function (a) {
                return dj.cata(a, function (a, c, d) {
                    return a
                }, function (a, c, d, e) {
                    return a
                })
            }, isEquation: function (a) {
                return dj.cata(a,
                    function (a, c, d) {
                        return d
                    }, function (a, c, d, e) {
                        return e
                    })
            }, toBlob: function (a) {
                return dj.cata(a, function (a, c, d) {
                    return I.error(c)
                }, function (a, c, d, e) {
                    return I.value(d)
                })
            }
        }, pma = function (a) {
            return hb(a, function (a, c) {
                var b = uf.toId(c), e = uf.isEquation(c);
                return Va(a, function (a) {
                    return uf.toId(a) === b && uf.isEquation(a) === e
                }).fold(function () {
                    return a.concat([c])
                }, function (b) {
                    return uf.toBlob(a[b]).isValue() ? a : a.slice(0, b).concat(a.slice(b + 1)).concat([c])
                })
            }, [])
        }, XZ = {
            convert: function (a, b, c, d) {
                var e = pma(b), f = [],
                    g = !1;
                a = ia(a, function (a, b) {
                    var c = m.get(a, "data-image-id"), k = "true" === m.get(a, "data-ms-equation");
                    m.remove(a, "rtf-data-image");
                    m.remove(a, "data-image-id");
                    m.remove(a, "data-ms-equation");
                    return "unsupported" === c ? (g = !0, m.set(a, "alt", d("errors.imageimport.unsupported")), []) : qa(e, function (a) {
                        return uf.toId(a) === c && uf.isEquation(a) === k
                    }).fold(function () {
                        ld.log("WARNING: unable to find data for image ", a.dom());
                        return []
                    }, function (b) {
                        return uf.toBlob(b).fold(function (b) {
                            g = !0;
                            m.set(a, "alt", d(b));
                            return []
                        }, function (b) {
                            f.push(a);
                            return [b]
                        })
                    })
                });
                Re.multiple(a).get(function (a) {
                    a = tf.updateSources(a, f);
                    c(a, g)
                })
            }
        }, $R = function (a) {
            return Y.descendants(a, "[rtf-data-image]")
        }, Tj = {
            exists: function (a) {
                return 0 < $R(a).length
            }, find: $R
        }, aS = function (a) {
            return a.officeStyles().getOr(!0)
        }, bS = function (a) {
            return a.htmlStyles().getOr(!1)
        }, cS = function (a) {
            return a.isWord().getOr(!1)
        }, pe = {
            proxyBin: function (a) {
                return {
                    handle: function (b, c) {
                        return a.proxyBin().fold(function () {
                            ld.error(b);
                            return La.pure({response: db.cancel(), bundle: Xb.nu({})})
                        }, c)
                    }
                }
            },
            backgroundAssets: function (a) {
                return Ga.nu(function (b) {
                    a.backgroundAssets().fold(function () {
                        b([])
                    }, function (a) {
                        a.listen(b)
                    })
                })
            }, merging: function (a) {
                var b = cS(a);
                return b && aS(a) || !b && bS(a)
            }, mergeOffice: aS, mergeNormal: bS, isWord: cS, isGoogleDocs: function (a) {
                return a.isGoogleDocs().getOr(!1)
            }, isInternal: function (a) {
                return a.isInternal().getOr(!1)
            }
        }, dS = function (a, b) {
            var c = ZZ(a, b);
            return function (a, b) {
                var d = b.bundle(), e = b.response();
                return La.sync(function (a) {
                    c.get(pe.isWord(d), function (c) {
                        c = c.fold(function () {
                            return {
                                response: db.cancel(),
                                bundle: b.bundle()
                            }
                        }, function (a) {
                            return {response: e, bundle: Xb.nu({officeStyles: a.officeStyles, htmlStyles: a.htmlStyles})}
                        });
                        La.call(a, c)
                    })
                })
            }
        }, Kx = {
            fixed: function (a, b) {
                return function (c, d) {
                    return La.pure({response: d.response(), bundle: Xb.nu({officeStyles: a, htmlStyles: b})})
                }
            }, fromConfig: dS, fromConfigIfNotForced: function (a, b) {
                return function (c, d) {
                    var e = function (a) {
                        return La.pure({response: d.response(), bundle: Xb.nu({officeStyles: a, htmlStyles: a})})
                    };
                    return pe.isInternal(d.bundle()) ? e(!0) : pe.isGoogleDocs(d.bundle()) ?
                        e(!1) : dS(a, b)(c, d)
                }
            }
        }, qma = {p: "p, li[data-converted-paragraph]"}, rma = function (a) {
            var b = function () {
                var b = r.fromTag("span");
                y.prepend(a, b);
                return b
            }();
            return {
                convertToPx: function (a) {
                    v.set(b, "margin-left", a);
                    return parseFloat(v.get(b, "margin-left").match(/-?\d+\.?\d*/)[0])
                }, destroy: function () {
                    return F.remove(b)
                }
            }
        }, sma = t, uma = function (a, b) {
            var c = function (a) {
                m.remove(a, "data-list-level");
                m.remove(a, "data-text-indent-alt");
                m.remove(a, "data-border-margin");
                v.remove(a, "margin-left");
                v.remove(a, "text-indent");
                Ma(v.getAllRaw(a), function (b, c) {
                    !c.startsWith("border") || "border-image" !== c && "none" !== b.trim() && "initial" !== b.trim() || v.remove(a, c)
                })
            }, d = Y.descendants(a, "li[data-converted-paragraph]");
            z(d, function (a) {
                m.remove(a, "data-converted-paragraph")
            });
            b && (b = Y.descendants(a, "li"), z(b, function (b) {
                var d = rma(a);
                var e = m.has(a, "data-tab-interval") ? m.get(a, "data-tab-interval") : "36pt";
                e = d.convertToPx(e);
                e = tma(b, e, d).getOr({});
                c(b);
                d.destroy();
                v.setAll(b, e)
            }), b = Y.descendants(a, "ol,ul"), z(b, function (a) {
                var b = Y.descendants(a,
                    "li");
                v.getRaw(a, "margin-top").isNone() && g.from(b[0]).each(function (b) {
                    v.set(a, "margin-top", v.get(b, "margin-top"))
                });
                v.getRaw(a, "margin-bottom").isNone() && g.from(b[b.length - 1]).each(function (b) {
                    v.set(a, "margin-bottom", v.get(b, "margin-bottom"))
                })
            }));
            m.remove(a, "data-tab-interval")
        }, tma = function (a, b, c) {
            var d = function (a) {
                return m.has(a, "data-list-level") ? parseInt(m.get(a, "data-list-level"), 10) : 1
            };
            return v.getRaw(a, "text-indent").bind(function (e) {
                return v.getRaw(a, "margin-left").map(function (f) {
                    var g =
                        v.getRaw(a, "list-style").exists(function (a) {
                            return Bb(a, "none")
                        }), h = m.has(a, "data-border-margin") ? m.get(a, "data-border-margin") : "0px";
                    g = g ? d(a) + 1 : d(a);
                    f = c.convertToPx(f) + c.convertToPx(h);
                    g *= b;
                    var n = m.has(a, "data-text-indent-alt") ? c.convertToPx(m.get(a, "data-text-indent-alt")) : c.convertToPx(e);
                    h = {};
                    n = b / 2 * -1 - n;
                    0 < n && (h["text-indent"] = n + "px");
                    f = f - g - n;
                    h["margin-left"] = 0 < f ? f + "px" : "0px";
                    return h
                })
            })
        }, vma = {
            process: function (a, b, c) {
                c = c.mergeInline();
                (c ? nz.inlineStyles : sma)(a, b, qma);
                uma(b, c)
            }
        }, wma = function (a) {
            var b =
                $Z(r.fromDom(Hb.body));
            return function (c, d) {
                b.play(c, function (b, c) {
                    vma.process(b, c, {mergeInline: h(a)});
                    return Ea.get(c)
                }, d)
            }
        }, xma = function (a, b, c, d) {
            var e = function (b) {
                La.call(a, {response: b, bundle: Xb.nu({})})
            };
            wma(b)(c, function (a) {
                var b = qe.fromHtml(a);
                a = function (a) {
                    e(db.paste(b, a))
                };
                var c = r.fromTag("div");
                P.append(c, b);
                var f = Fa.all("img[src]", c);
                0 === f.length ? a([]) : d ? tf.browserBlobs(f).get(a) : (z(f, F.remove), a = A.children(c), e(db.incomplete(a, [], "errors.local.images.disallowed")))
            })
        }, yma = {
            handle: function (a,
                              b, c, d) {
                var e = a.html();
                return La.sync(function (a) {
                    c.cleanDocument(e, b).get(function (c) {
                        c.fold(function (b) {
                            La.call(a, {response: db.error("errors.paste.process.failure"), bundle: Xb.nu({})})
                        }, function (c) {
                            void 0 === c || null === c || 0 === c.length ? La.call(a, {
                                response: db.paste([], []),
                                bundle: Xb.nu({})
                            }) : xma(a, b, c, d)
                        })
                    })
                })
            }
        }, zma = {
            handle: function (a) {
                a = ka(a, function (a) {
                    return "file" === a.kind && /image/.test(a.type)
                });
                var b = E(a, function (a) {
                    return a.getAsFile()
                });
                return La.sync(function (a) {
                    Re.multiple(b).get(function (b) {
                        b =
                            tf.createImages(b);
                        La.call(a, {response: b, bundle: Xb.nu({})})
                    })
                })
            }
        }, Ama = aa.detect(), eS = function (a) {
            try {
                var b = a(), c = void 0 !== b && null !== b && 0 < b.length ? qe.fromHtml(b) : [];
                return I.value(c)
            } catch (d) {
                return ld.error(d), I.error("errors.paste.process.failure")
            }
        }, fS = function (a) {
            return a.fold(function (a) {
                return La.error(a)
            }, function (a) {
                return La.pure({response: db.paste(a, []), bundle: Xb.nu({})})
            })
        }, gS = function (a, b, c, d) {
            return eS(function () {
                return pq.go(a, Ama, b, c, d)
            })
        }, sq = {
            direct: function (a, b, c) {
                a = gS(a, b, c, !1);
                return fS(a)
            },
            internal: function (a, b) {
                var c = eS(function () {
                    return pq.internal(a, b)
                });
                return fS(c)
            }, transfer: function (a, b, c, d, e) {
                return gS(a, b, d, c).fold(function (a) {
                    return La.error(a)
                }, function (a) {
                    return La.sync(function (b) {
                        e.get(function (c) {
                            c = tf.findImages(a, c);
                            La.call(b, {response: db.paste(a, c), bundle: Xb.nu({})})
                        })
                    })
                })
            }
        }, hS = {
            internal: function (a, b, c) {
                b = b.findClipboardTags(A.children(c)).getOr([]);
                z(b, F.remove);
                b = Ga.nu(function (a) {
                    a([])
                });
                return sq.transfer(a, c, !1, !0, b)
            }, external: function (a, b, c, d, e) {
                return sq.transfer(a,
                    b, d, c, e)
            }
        }, iS = {
            encode: function (a) {
                var b = r.fromTag("div");
                Vb.set(b, a);
                return Ea.get(b)
            }, convert: function (a) {
                a = a.trim().split(/\n{2,}|(?:\r\n){2,}/);
                a = E(a, function (a) {
                    return a.split(/\n|\r\n/).join("<br />")
                });
                return 1 === a.length ? a[0] : E(a, function (a) {
                    return "<p>" + a + "</p>"
                }).join("")
            }
        }, Bma = {
            handle: function (a) {
                var b = Xc.asText(a).getOrDie("Required text input for Text Handler");
                return La.sync(function (a) {
                    if (0 < b.text().length) {
                        var c = b.text();
                        c = iS.encode(c);
                        c = iS.convert(c);
                        c = qe.fromHtml(c);
                        c = db.paste(c, [])
                    } else c =
                        db.cancel();
                    La.call(a, {response: c, bundle: Xb.nu({})})
                })
            }
        }, dd = {
            plain: function (a, b, c) {
                return Bma.handle(a)
            }, autolink: function (a, b) {
                a = function (a, c) {
                    var d = r.fromTag("div");
                    P.append(d, a);
                    pq.preprocess(d);
                    a = A.children(d);
                    return La.pure({response: db.paste(a, c), bundle: b.bundle()})
                };
                var c = u(La.pass, b);
                return db.cata(b.response(), c, a, c, a)
            }, noImages: function () {
                return function (a, b) {
                    return La.error("errors.local.images.disallowed")
                }
            }, images: function () {
                return function (a, b) {
                    a = Xc.asImages(a).getOrDie("Must have image data for images handler");
                    return zma.handle(a.images())
                }
            }, handleInternal: function (a) {
                return function (b, c) {
                    b = Xc.asHtml(b).getOrDie("Wrong input type for HTML handler");
                    b = a.findClipboardTags(A.children(b.container()));
                    b.each(function (a) {
                        z(a, F.remove)
                    });
                    b = b.isSome();
                    return La.pure({response: c.response(), bundle: Xb.nu({isInternal: b})})
                }
            }, nativeHtml: function (a, b) {
                return function (c, d) {
                    c = Xc.asHtml(c).getOrDie("Wrong input type for HTML handler").container();
                    var e = A.owner(b);
                    d = d.bundle();
                    if (pe.isInternal(d)) return sq.internal(e, c);
                    a(c);
                    d = pe.merging(d);
                    return sq.direct(e, c, d)
                }
            }, external: function (a, b) {
                return function (c, d) {
                    var e = d.bundle();
                    return pe.proxyBin(e).handle("There was no proxy bin setup. Ensure you have run proxyStep first.", function (c) {
                        var d = pe.merging(e), f = pe.isWord(e), g = pe.isInternal(e), h = pe.backgroundAssets(e),
                            m = A.owner(a);
                        return g ? hS.internal(m, b, c) : hS.external(m, c, d, f, h)
                    })
                }
            }, wordimport: function (a, b) {
                return function (c, d) {
                    c = Xc.asWord(c).getOrDie("Wrong input type for Word Import handler");
                    d = pe.mergeOffice(d.bundle());
                    return yma.handle(c, d, a, b)
                }
            }, setBundle: function (a) {
                return function (b, c) {
                    b = Xb.merge(c.bundle(), Xb.nu(a));
                    return La.pure({response: c.response(), bundle: b})
                }
            }, none: function (a, b) {
                return La.cancel()
            }
        }, Cma = function (a, b) {
            return wd.descendant(a, function (a) {
                return m.has(a, "style") ? -1 < m.get(a, "style").indexOf("mso-") : !1
            })
        }, Dma = function (a, b) {
            a = Ea.get(a);
            return gb.isWordContent(a, b)
        }, b_ = {
            isWord: function (a, b) {
                var c = a.browser;
                return (c.isIE() && 11 <= c.version.major ? Cma : Dma)(b, a)
            }
        }, Nr = aa.detect(), c_ = function (a) {
            return Xa(a,
                function (a) {
                    return m.has(a, "id") && Gb(m.get(a, "id"), "docs-internal-guid")
                })
        }, Ema = function (a, b) {
            return a.isSupported() ? b.getWordData() : g.none()
        }, Fma = function (a) {
            return a.getNative()
        }, Gma = function (a) {
            return a.getImage()
        }, Hma = function (a) {
            return a.getHtml()
        }, Ima = function (a) {
            return a.getText()
        }, Jma = function (a) {
            return a.getOnlyText()
        }, Kma = function (a) {
            return a.getGoogleDocsData()
        }, Jf = function (a, b, c, d) {
            return {_label: a, label: h(a), getAvailable: b, steps: h(c), capture: h(d)}
        }, ag = {
            wordimport: function (a, b, c, d) {
                return Jf("Word Import pasting",
                    u(Ema, a), [ub.normal(dd.setBundle({isWord: !0})), ub.normal(Kx.fromConfig(b, c)), ub.normal(dd.wordimport(a, c.allowLocalImages)), ub.blocking(d_(c, iB(d, c))), ub.normal(Sj())], !0)
            }, googledocs: function (a, b, c) {
                return Jf(" pasting", Kma, [ub.normal(dd.setBundle({
                    officeStyles: !1,
                    htmlStyles: !1
                })), ub.normal(dd.nativeHtml(b, c)), ub.normal(Mr(a)), ub.normal(Sj())], !0)
            }, image: function (a) {
                return Jf("Image pasting", Gma, [ub.normal(!1 === a.allowLocalImages ? dd.noImages() : dd.images()), ub.normal(Sj())], !0)
            }, nativeHtml: function (a,
                                     b, c, d) {
                return Jf("Outside of Textbox.io pasting HTML5 API (could be internal)", Hma, [ub.normal(dd.handleInternal(b.intraFlag)), ub.normal(Kx.fromConfigIfNotForced(a, b)), ub.normal(dd.nativeHtml(c, d)), ub.normal(Mr(b)), ub.normal(Sj())], !0)
            }, text: function () {
                return Jf("Plain text pasting", Ima, [ub.normal(dd.plain), ub.normal(dd.autolink)], !0)
            }, onlyText: function () {
                return Jf("Only plain text is available to paste", Jma, [ub.normal(dd.plain), ub.normal(dd.autolink)], !0)
            }, none: function () {
                return Jf("There is no valid way to paste",
                    g.some, [ub.normal(dd.none)], !1)
            }, discard: function () {
                return Jf("There is no valid way to paste, discarding content", g.some, [ub.normal(dd.none)], !0)
            }, fallback: function (a, b, c, d, e, f) {
                return Jf("Outside of Textbox.io pasting offscreen (could be internal)", Fma, [ub.normal(a_(d, c, e, b.intraFlag, fma)), ub.normal(Kx.fromConfigIfNotForced(a, b)), ub.normal(dd.external(e, b.intraFlag)), ub.blocking(iB(f, b)), ub.normal(Mr(b)), ub.normal(Sj())], !1)
            }
        }, g_ = {
            responsive: function () {
                var a = na(g.none()), b = H.create({
                    crashed: p([]),
                    timeout: p([])
                });
                return {
                    start: function (c, d, e, f) {
                        var k = d, h = Or(function () {
                            e() ? Vh(h) : 0 >= k ? (b.trigger.timeout(), Vh(h)) : f() && (Vh(h), b.trigger.crashed());
                            k--
                        }, c);
                        a.set(g.some(h))
                    }, stop: function () {
                        a.get().each(function (a) {
                            Vh(a)
                        })
                    }, events: b.registry
                }
            }
        }, $f = mC.install("ephox.flash"), Pr = aa.detect(), h_ = g.none(), jS = function (a) {
            return r.fromHtml("<p>" + a("cement.dialog.flash.press-escape") + "</p>")
        }, Lx = {
            paste: function (a) {
                var b = r.fromTag("div");
                n.add(b, ud.resolve("flashbin-helpcopy"));
                var c = aa.detect().os.isOSX() ?
                    ["\u2318"] : ["Ctrl"];
                var d = r.fromHtml("<p>" + a("cement.dialog.flash.trigger-paste") + "</p>");
                c = r.fromHtml('<div><span class="ephox-polish-help-kbd">' + c + '</span> + <span class="ephox-polish-help-kbd">V</span></div>');
                n.add(c, ud.resolve("flashbin-helpcopy-kbd"));
                P.append(b, [d, c, jS(a)]);
                return b
            }, noflash: function (a) {
                var b = r.fromTag("div");
                n.add(b, ud.resolve("flashbin-helpcopy"));
                var c = r.fromHtml("<p>" + a("cement.dialog.flash.missing") + "</p>");
                P.append(b, [c, jS(a)]);
                return b
            }, indicator: function (a) {
                var b = r.fromTag("div");
                n.add(b, ud.resolve("flashbin-loading"));
                var c = r.fromTag("div");
                n.add(c, ud.resolve("flashbin-loading-spinner"));
                var d = r.fromTag("p");
                a = a("loading.wait");
                Ea.set(d, a);
                m.set(d, "aria-label", a);
                P.append(b, [c, d]);
                return b
            }
        }, j_ = aa.detect(), m_ = function (a, b, c, d) {
            b = Lx.noflash(d);
            y.append(a, b);
            return {reset: t}
        }, l_ = function (a, b, c, d) {
            var e = Lx.paste(d), f = Lx.indicator(d);
            P.append(a, [f, e, b.element()]);
            a = function () {
                v.set(e, "display", "block");
                v.set(f, "display", "none");
                c()
            };
            b.events.spin.bind(function () {
                v.set(e, "display",
                    "none");
                v.set(f, "display", "block");
                v.remove(f, "height");
                v.remove(f, "padding");
                c()
            });
            b.events.reset.bind(a);
            b.events.hide.bind(function () {
                v.setAll(f, {height: "0", padding: "0"})
            });
            return {reset: a}
        }, kS = aa.detect(), Lma = kS.deviceType.isiOS() || kS.deviceType.isAndroid(), Mma = function (a) {
            var b = gn.addScript(a + "/wordimport.js", ca);
            b.get(function (a) {
                a.fold(function (a) {
                    ld.error("Unable to load word import: ", a)
                }, t)
            });
            return {
                isSupported: h(!0), cleanDocument: function (a, d) {
                    return b.map(function (b) {
                        return b.map(function (b) {
                            return b.cleanDocument(a,
                                d)
                        })
                    })
                }
            }
        }, Nma = h({isSupported: h(!1), cleanDocument: h(bl.error("not supported"))}), Oma = Lma ? Nma : Mma,
        Pma = "b i u sub sup strike".split(" "), Qma = function (a) {
            z(A.children(a), function (a) {
                D.isElement(a) && !A.hasChildNodes(a) && U(Pma, D.name(a)) && F.remove(a)
            })
        }, Rma = function (a, b) {
            a = A.children(a);
            z(a, function (a) {
                if (b(a)) {
                    var c = A.children(a), e = r.fromTag("div", A.owner(a).dom());
                    P.append(e, c);
                    y.before(a, e);
                    F.remove(a)
                }
            })
        }, r_ = {
            consolidate: function (a, b) {
                A.nextSibling(a).filter(b).each(function (b) {
                    var c = A.children(b);
                    P.append(a, c);
                    F.remove(b)
                });
                Rma(a, b);
                Qma(a)
            }
        }, kB = dB.bin(), lB = kB + Ha(""), q_ = ae.onDirection("-100000px", "100000px"), Sma = function (a) {
            return {startContainer: a.start, startOffset: a.soffset, endContainer: a.finish, endOffset: a.foffset}
        }, u_ = {
            set: function (a, b) {
                Wa.setExact(a, b.startContainer(), b.startOffset(), b.endContainer(), b.endOffset())
            }, get: function (a, b) {
                return Wa.getExact(a).map(Sma)
            }
        }, z_ = function (a, b, c, d) {
            var e = w_(a.uiContainer(), d), f = function (a) {
                b.filterDom(b.paste(), a)
            }, g = x_(x, Uj.intraFlag(), c);
            return function (a) {
                var b =
                    Oma(g.baseUrl), c = u(n_, e), d = t_(void 0 !== g.pasteBinAttrs ? g.pasteBinAttrs : {});
                b = [ag.onlyText(), ag.wordimport(b, e, g, c), ag.googledocs(g, f, a), ag.nativeHtml(e, g, f, a), ag.image(g)];
                a = ag.fallback(e, g, f, d, a, c);
                return aB(b, a)
            }
        }, D_ = function (a) {
            for (var b = [], c = a.start.charCodeAt(0); c <= a.finish.charCodeAt(0); c++) b.push(String.fromCharCode(c));
            return b
        }, bg = function (a) {
            return {start: a, finish: a}
        }, G_ = {
            controls: function (a) {
                var b = a + "-";
                a = T.div();
                n.add(a, B.resolve(b + "dialog-controls"));
                var c = td.button(b, "cancel", "button.cancel"),
                    d = td.button(b, "insert", "specialchar.insert");
                td.makeNormal(c.element());
                td.makeDefault(d.element());
                P.append(a, [c.element(), d.element()]);
                b = H.create({insert: Q([], d.events.click), cancel: Q([], c.events.click)});
                return {
                    element: h(a), ok: h(d), cancel: h(c), destroy: function () {
                        d.destroy();
                        c.destroy()
                    }, events: b.registry
                }
            }
        }, Tma = function (a) {
            var b = r.fromTag("span");
            n.add(b, B.resolve("special-char"));
            var c = r.fromHtml(a);
            m.setAll(b, {
                "data-ephox-polish-special-char": a, "data-ephox-polish-char-code": a.charCodeAt(0).toString(16),
                tabindex: "-1"
            });
            Vg.gridcell(b);
            y.append(b, c);
            return b
        }, Uma = function (a, b) {
            var c = r.fromTag("div");
            ma.add(c, [B.resolve("special-char-row"), B.resolve("special-char-row-" + b)]);
            Vg.row(c);
            z(a, function (a) {
                y.append(c, Tma(a))
            });
            return c
        }, Vma = function (a, b, c) {
            var d = r.fromTag("div");
            n.add(d, B.resolve(b));
            Vg.base(d, x.translate("specialchar.grid"));
            a = o1(a, c);
            a = E(a, function (a) {
                return Uma(a, b)
            });
            P.append(d, a);
            return d
        }, F_ = {
            generateItems: function (a) {
                var b = 600 >= Math.min(window.innerWidth, window.innerHeight) ? 12 : 16;
                return Nf(a,
                    function (a, d) {
                        a = Vma(a, d, b);
                        return Sg(x.translate("specialchar." + d), jA(a))
                    })
            }
        }, H_ = function (a) {
            var b = {item: h(".ephox-pastry-statebutton.ephox-pastry-tablayout-item")},
                c = Ba.flow({trigger: Kb.button, executeOnArrow: !0});
            return ha.flow(a.menu(), b, c)
        }, Wma = function (a) {
            return Db.closest(a, ".ephox-pastry-tablayout-active")
        }, I_ = function (a) {
            var b = {
                row: h(".ephox-pastry-tablayout-active ." + B.resolve("special-char-row")),
                cell: h(".ephox-pastry-tablayout-active ." + B.resolve("special-char"))
            }, c = Ba.tabular({
                trigger: Kb.click,
                isValid: Wma
            });
            return ha.tabular(a.body(), b, c)
        }, lS = ta.generate([{single: ["element"]}, {range: ["start", "soffset", "finish", "foffset"]}]), Sm = {
            cata: function (a, b, c) {
                return a.fold(b, c)
            }, single: lS.single, range: function (a, b, c, d) {
                var e = id.after(c, d, a, b), f = e ? W.point(a, b) : W.point(c, d);
                a = e ? W.point(c, d) : W.point(a, b);
                return lS.range(f.element(), f.offset(), a.element(), a.offset())
            }
        }, mS = O("suggestions", "ignore"), ej = function (a) {
            var b = new RegExp(mb(), "g");
            return a.replace(b, "").replace(/[\u2018\u2019]/g, "'")
        }, g0 = function (a) {
            var b =
                {}, c = function (a) {
                return b.hasOwnProperty(a) && void 0 !== b[a] ? b[a] : {}
            }, d = function (a, d) {
                var e = c(a);
                d(e);
                b[a] = e
            }, e = function (a, b) {
                a = c(a);
                return b(a)
            }, f = function (a, b, c) {
                d(a, function (a) {
                    var d = ej(b);
                    a.hasOwnProperty(d) && void 0 !== a[d] || (a[d] = mS(g.some(c), !1))
                })
            }, k = function (a, b) {
                d(a, function (a) {
                    var c = ej(b), d = a.hasOwnProperty(c) ? a[c] : void 0;
                    d = void 0 !== d ? d.suggestions() : g.none();
                    d = mS(d, !0);
                    a[c] = d
                })
            };
            Ma(void 0 !== a ? a : {}, function (a, b) {
                Ma(a, function (a, c) {
                    !0 === a.ignore && k(b, c);
                    void 0 !== a.suggestions && f(b, c, a.suggestions)
                })
            });
            return {
                add: f, get: function (a, b) {
                    return e(a, function (a) {
                        var c = ej(b);
                        return a.hasOwnProperty(c) ? g.from(a[c]) : g.none()
                    })
                }, ignore: k, suggestions: function (a, b) {
                    return e(a, function (a) {
                        var c = ej(b);
                        return (a.hasOwnProperty(c) ? g.from(a[c]) : g.none()).bind(function (a) {
                            return a.suggestions()
                        })
                    })
                }, state: function () {
                    return eb(b, function (a, b) {
                        return eb(a, function (a, b) {
                            return {ignore: a.ignore(), suggestions: a.suggestions().getOr([])}
                        })
                    })
                }, destroy: function () {
                    b = {}
                }
            }
        }, Tr = {
            configure: function (a) {
                a.add(a.internal(), "ephox-cram-annotation-wrap",
                    Na.unwrap);
                a.add(a.output(), "ephox-cram-annotation-wrap", Na.unwrap);
                a.add(a.paste(), "ephox-cram-annotation-wrap", Na.unwrap);
                a.addExcludedContext([".ephox-cram-annotation-wrap"])
            }, isWrap: function (a) {
                return n.has(a, "ephox-cram-annotation-wrap")
            }
        }, Xma = {
            en_au: "en_gb",
            en_bz: "en_gb",
            en_ca: "en_gb",
            en_gb: "en_gb",
            en_ie: "en_gb",
            en_in: "en_gb",
            en_jm: "en_gb",
            en_my: "en_gb",
            en_nz: "en_gb",
            en_ph: "en_gb",
            en_sg: "en_gb",
            en_tt: "en_gb",
            en_za: "en_gb",
            en_zw: "en_gb",
            en_us: "en_us",
            en: "en_us"
        }, Yma = "da de en en_au en_br en_gb en_uk en_us es fi fr it nb nl pt pt_pt sv".split(" "),
        pd = function (a, b) {
            return {value: h(a), textkey: h(b), icon: g.none}
        }, Zma = function (a) {
            var b = ua(Ks.localeList(), Xma);
            return Ks.determineFrom(a, b).filter(function (a) {
                return U(Yma, a)
            })
        }, vf = {
            determine: function (a) {
                return "no.language" === a ? g.some(a) : Zma(a)
            }, get: function () {
                return [pd("no.language", x.key("spelling.none")), pd("en_us", x.key("parlance.en_us")), pd("en_gb", x.key("parlance.en_gb")), pd("da", x.key("parlance.da")), pd("de", x.key("parlance.de")), pd("es", x.key("parlance.es")), pd("fi", x.key("parlance.fi")), pd("fr",
                    x.key("parlance.fr")), pd("it", x.key("parlance.it")), pd("nb", x.key("parlance.no")), pd("nl", x.key("parlance.nl")), pd("pt", x.key("parlance.pt_br")), pd("pt_pt", x.key("parlance.pt_pt")), pd("sv", x.key("parlance.sv"))]
            }, isOn: function (a) {
                return "no.language" !== a
            }, offKey: h("no.language")
        }, N_ = function (a, b) {
            var c = vf.get();
            return {
                "spelling.dropdown": {
                    name: "spellcheck", textkey: x.key("spelling.menu"), menuTextkey: "", updateDropdown: function (b) {
                        b.populate([{label: g.none, items: h(c)}]);
                        var d = a.profile().spelling().get();
                        Da.on(d).fold(b.untick, t, b.tick)
                    }, action: function (c) {
                        a.profile().spelling().setAndCache(c);
                        Gb(c, "en") || a.profile().autocorrect().set(!1);
                        b.trigger.change(c)
                    }, values: c, render: g.none(), describe: function (a) {
                        return x.key("spelling.menu")
                    }, hasPopup: !0, toggle: !1
                }
            }
        }, O_ = function (a, b, c) {
            var d = a.profile().spelling().get() !== vf.offKey();
            return {
                "spelling.general": {
                    toggle: !0, value: "spellcheck", textkey: x.key("cog.spellcheck"), action: function () {
                        var e = (d = !d) ? b : vf.offKey();
                        a.profile().spelling().setAndCache(e);
                        c.trigger.change(e)
                    },
                    updateGeneral: function (a) {
                        d ? a.select() : a.deselect()
                    }, icon: !1
                }
            }
        }, Q_ = O("area", "f"), Ll = {
            stop: h("trampoline.stop"), run: function (a) {
                for (; "trampoline.stop" !== a;) a = a()
            }
        },
        fj = ta.generate([{inline: ["item", "mode", "lang"]}, {text: ["item", "mode"]}, {empty: ["item", "mode"]}, {boundary: ["item", "mode", "lang"]}, {concluded: ["item", "mode"]}]),
        nS = function (a, b, c, d) {
            var e = a.property().isElement(b) ? g.from(a.attrs().get(b, "lang")) : g.none();
            return a.property().isText(b) ? fj.text(b, c) : d(b, c) ? fj.concluded(b, c) : a.property().isBoundary(b) ?
                fj.boundary(b, c, e) : a.property().isEmptyTag(b) ? fj.empty(b, c) : fj.inline(b, c, e)
        }, $ma = function (a, b, c, d) {
            return Ca.walk(a, b, c, Ca.walkers().right(), void 0).fold(function () {
                return fj.concluded(b, c)
            }, function (b) {
                return nS(a, b.item(), b.mode(), d)
            })
        }, oS = function (a, b, c, d, e, f) {
            return function () {
                return b.fold(function (b, g, h) {
                    (g === Ca.advance ? d.openInline : d.closeInline)(h, b);
                    return Ml(a, b, g, c, d, e, f)
                }, function (b, g) {
                    var k = e(a, b);
                    d.addDetail(k);
                    return c(b, g) ? Ll.stop() : Ml(a, b, g, c, d, e, f)
                }, function (b, g) {
                    d.addEmpty(b);
                    return Ml(a, b, g, c, d, e, f)
                }, function (b, g, h) {
                    var k = f.assess(b);
                    return Rg.cata(k, function (k) {
                        return g !== Ca.backtrack ? Ml(a, b, Ca.sidestep, c, d, e, f) : Ll.stop()
                    }, function (k) {
                        (g === Ca.advance ? d.openBoundary : d.closeBoundary)(h, b);
                        return Ml(a, b, g, c, d, e, f)
                    }, function (a) {
                        return Ll.stop()
                    })
                }, function (a, b) {
                    return Ll.stop()
                })
            }
        }, Ml = function (a, b, c, d, e, f, g) {
            b = $ma(a, b, c, d);
            return oS(a, b, d, e, f, g)
        }, ana = {
            walk: function (a, b, c, d, e, f) {
                var g = function (b, d) {
                        return a.eq(b, c) && (d !== Ca.advance || a.property().isText(b) || 0 === a.property().children(b).length)
                    },
                    h = zi.nu(d), m = nS(a, b, Ca.advance, g);
                Ll.run(function () {
                    return oS(a, m, g, h, e, f)
                });
                return h.done()
            }
        }, bna = Aa(["elements", "lang", "words"], []), cna = {
            fromWalking: function (a, b) {
                a = E(b, function (a) {
                    var b = a.details();
                    a = a.lang();
                    var c = E(b, function (a) {
                        return a.text()
                    }).join("");
                    b = E(b, function (a) {
                        return a.item()
                    });
                    c = cM.words(c);
                    return bna({lang: a, words: c, elements: b})
                });
                return {zones: h(a)}
            }
        }, dna = function (a, b, c, d, e, f) {
            return (a.eq(b, c) ? g.some(b) : a.property().parent(b)).map(function (g) {
                g = zi.calculate(a, g).getOr(d);
                return ana.walk(a,
                    b, c, g, e, f)
            })
        }, tq = function (a, b, c, d, e, f) {
            b = zd.subset(a, b, c).bind(function (b) {
                return 0 === b.length ? g.none() : dna(a, b[0], b[b.length - 1], d, e, f)
            }).getOr([]);
            return cna.fromWalking(a, b)
        }, Mx = function (a, b) {
            return function (c, d) {
                return c.eq(d, a.item()) ? a : c.eq(d, b.item()) ? b : Ff.detail(c, d)
            }
        }, pS = function () {
            return {zones: h([])}
        }, Ch = {
            fromRange: function (a, b, c, d, e) {
                b = Sk.getEdges(a, b, c, h(!1));
                c = Mx(b.left(), b.right());
                return tq(a, b.left().item(), b.right().item(), d, c, e)
            }, transformEdges: Mx, fromBounded: function (a, b, c, d, e) {
                return tq(a,
                    b, c, d, Ff.detail, e)
            }, fromBoundedWith: tq, fromInline: function (a, b, c, d) {
                b = Sk.byBoundary(a, b);
                var e = Mx(b.left(), b.right());
                return b.isEmpty() ? pS() : tq(a, b.left().item(), b.right().item(), c, e, d)
            }, empty: pS
        }, rS = function (a, b, c, d) {
            return a.property().isBoundary(b) ? Ch.fromBounded(a, b, b, c, d) : a.property().isEmptyTag(b) ? qS() : Ch.fromInline(a, b, c, d)
        }, qS = function () {
            return Ch.empty()
        }, Nx = {
            single: rS, range: function (a, b, c, d, e, f, g) {
                b = bd.toLeaf(a, b, c);
                d = bd.toLeaf(a, d, e);
                return a.eq(b.element(), d.element()) ? rS(a, b.element(),
                    f, g) : Ch.fromRange(a, b.element(), d.element(), f, g)
            }, empty: qS
        }, sS = nb(), Tm = {
            single: function (a, b, c) {
                return Nx.single(sS, a, b, c)
            }, range: function (a, b, c, d, e, f) {
                return Nx.range(sS, a, b, c, d, e, f)
            }, empty: function () {
                return Nx.empty()
            }
        }, mB = {
            update: function (a, b, c) {
                var d = cb(c);
                z(d, function (d) {
                    a.add(b, d, c[d])
                });
                return d
            }, getInCache: function (a, b, c) {
                return ka(c, function (c) {
                    return a.get(b, c.word()).fold(h(!1), function (a) {
                        return a.suggestions().isSome()
                    })
                })
            }
        }, ena = {anything: h({assess: Rg.inView})}.anything(), Ox = function (a,
                                                                               b, c, d, e, f) {
            a = Ch.fromBoundedWith(a, b, c, d, f, ena).zones();
            1 === a.length ? (a = a[0], e = a.lang() === e ? g.some(a) : g.none()) : e = g.none();
            return e
        }, tS = function (a, b, c, d, e) {
            return Ox(a, b, c, d, e, Ff.detail)
        }, uq = {
            fromRange: function (a, b, c, d, e) {
                var f = zi.strictBounder(d, e);
                b = Sk.getEdges(a, b, c, f);
                c = Ch.transformEdges(b.left(), b.right());
                return Ox(a, b.left().item(), b.right().item(), d, e, c)
            }, fromBounded: tS, fromInline: function (a, b, c, d) {
                var e = zi.strictBounder(c, d);
                e = Sk.getEdges(a, b, b, e);
                var f = Ch.transformEdges(e.left(), e.right());
                e.isEmpty() ? (f = a.property().isText(b) ? a.property().getText(b) : a.property().children(b).length, e = bd.toLeaf(a, b, 0), b = bd.toLeaf(a, b, f), a = tS(a, e.element(), b.element(), c, d)) : a = Ox(a, e.left().item(), e.right().item(), c, d, f);
                return a
            }, empty: function () {
                return g.none()
            }
        }, uS = function (a, b, c, d) {
            return a.property().isBoundary(b) ? uq.fromBounded(a, b, b, c, d) : a.property().isEmptyTag(b) ? uq.empty() : uq.fromInline(a, b, c, d)
        }, vS = {
            single: uS, range: function (a, b, c, d, e, f, g) {
                b = bd.toLeaf(a, b, c);
                d = bd.toLeaf(a, d, e);
                return a.eq(b.element(),
                    d.element()) ? uS(a, b.element(), f, g) : uq.fromRange(a, b.element(), d.element(), f, g)
            }
        }, wS = nb(), fna = {
            single: function (a, b, c) {
                return vS.single(wS, a, b, c)
            }, range: function (a, b, c, d, e, f) {
                return vS.range(wS, a, b, c, d, e, f)
            }
        }, xS = function (a) {
            return ia(a, function (a) {
                return ed.descendants(a, D.isText)
            })
        }, vq = {
            textnodes: xS, text: function (a) {
                a = xS(a);
                return E(a, function (a) {
                    return D.isText(a) ? Ya.get(a) : ""
                }).join("")
            }, parsed: function (a, b, c) {
                return g.from(a[0]).bind(function (a) {
                    return fna.single(a, b, c).bind(function (a) {
                        a = a.words();
                        return 1 === a.length ? g.some(a[0]).map(function (a) {
                            return a.word()
                        }) : g.none()
                    })
                })
            }, children: function (a) {
                return ia(a, A.children)
            }
        }, gna = {
            clobber: function (a, b) {
                var c = vq.children(a), d = vq.textnodes(a);
                return g.from(a[0]).bind(function (e) {
                    P.before(e, c);
                    e = g.from(d[0]);
                    e.each(function (a) {
                        Ya.set(a, b)
                    });
                    z(d.slice(1), function (a) {
                        Ya.set(a, "")
                    });
                    z(a, F.remove);
                    return e
                })
            }
        }, yS = gw.resolve("annotation"), zS = gw.resolve("lingo"), AS = hw.resolve("annotation-wrap"), gj = {
            nu: function () {
                var a = r.fromTag("span");
                n.add(a, AS);
                m.set(a,
                    "aria-invalid", "spelling");
                return wi.nu(a)
            }, set: function (a, b, c) {
                m.set(a, yS, c);
                m.set(a, zS, b)
            }, label: h(AS), detail: function (a) {
                return zg.id(a).bind(function (b) {
                    return g.from(m.get(a, yS)).bind(function (c) {
                        return g.from(m.get(a, zS)).map(function (a) {
                            return {id: h(b), word: h(c), lang: h(a)}
                        })
                    })
                })
            }
        }, hna = hw.resolve("wrap-disabled"), ina = function (a) {
            a = zg.all(a);
            z(a, function (a) {
                n.remove(a, hna)
            })
        }, jna = O("id", "elements", "word", "lang"), BS = {
            success: function (a) {
                return {
                    fold: function (b, c) {
                        c(a)
                    }
                }
            }, fail: function (a) {
                return {
                    fold: function (b,
                                    c) {
                        b(a)
                    }
                }
            }
        }, kna = function (a, b) {
            var c = {};
            z(a, function (a) {
                zg.marker(a, b.label()).filter(ja.inBody).each(function (a) {
                    b.detail(a).each(function (b) {
                        var d = b.id(), e = b.word();
                        b = b.lang();
                        var f = zg.all(a);
                        0 < f.length && (c[d] = jna(d, f, e, b))
                    })
                })
            });
            return c
        }, CS = function (a, b, c, d) {
            var e = vq.text(a);
            a = vq.parsed(a, c, d);
            return e === b && a.is(b)
        }, lna = function (a, b, c) {
            a = Ze(a);
            return E(a, function (a) {
                return a.lang() === c && CS(a.elements(), a.word(), b, a.lang()) ? BS.success(a) : BS.fail(a)
            })
        }, mna = {
            validate: CS, verify: function (a, b, c, d, e) {
                b =
                    kna(a.elements(), b);
                a = lna(b, e, a.lang());
                z(a, function (a) {
                    var b = function (a) {
                        return function (b) {
                            z(b.elements(), a)
                        }
                    };
                    a.fold(b(d), b(c))
                })
            }
        }, DS = function (a) {
            return zg.marker(a, gj.label())
        }, Sr = {
            highlight: function (a, b, c, d) {
                mna.verify(b, gj, ina, F.unwrap, a.lang());
                c = ol.matchWords(b.elements(), c, d);
                c = ol.annotates(c, gj.label());
                return ia(c, function (c) {
                    return c.current().fold(function () {
                        var d = c.match(), e = d.word();
                        if (a.ignore(d)) return [];
                        d = wi.wrapper(d.elements(), gj.nu) || [];
                        z(d, function (a) {
                            zg.set(a, c.id());
                            gj.set(a,
                                b.lang(), e)
                        });
                        return [Jp.created(d)]
                    }, function (a) {
                        return [Jp.preserved(a)]
                    })
                })
            }, marker: DS, substitute: function (a, b) {
                a = DS(a).fold(h([]), zg.all);
                return gna.clobber(a, b)
            }, detail: function (a) {
                return gj.detail(a)
            }
        }, T_ = {
            highlight: function (a, b, c) {
                c = {ignore: h(!1), lang: h(c)};
                var d = E(b, function (a) {
                    return a.word()
                });
                b = ka(d, function (a, b) {
                    return Gc(d, a).filter(function (a) {
                        return a === b
                    }).isSome()
                });
                Sr.highlight(c, a, b, h(!1))
            }
        }, nna = function (a, b) {
            return Ga.nu(function (c) {
                var d = {
                    words: E(a.words(), function (a) {
                        return ej(a.word())
                    })
                };
                b.correction(d, a.lang(), function (b) {
                    b = I.value({spelling: h(b), zone: h(a)});
                    c(b)
                }, function (a) {
                    a = I.error(Error(a));
                    c(a)
                })
            })
        }, U_ = {
            scan: function (a, b, c) {
                var d = function (b) {
                    var c = b.zone(), d = mB.update(a, c.lang(), b.spelling());
                    b = ka(c.words(), function (a) {
                        a = ej(a.word());
                        return U(d, a)
                    });
                    return {zone: h(c), words: h(b)}
                };
                c = E(c, function (a) {
                    return nna(a, b)
                });
                return Rl(c, Ga.nu).map(function (a) {
                    a = ia(a, function (a) {
                        return a.fold(h([]), IB)
                    });
                    return E(a, d)
                })
            }
        }, oB = {
            active: function (a) {
                var b = {};
                a.autocorrect().get(function (a) {
                    a.fold(function (a) {
                            ld.log("Error loading autocorrect list")
                        },
                        function (a) {
                            b = D1(a.corrections, function (a, b) {
                                return 1 === a.length && 1 < b.length
                            }).f
                        })
                });
                return {
                    lookup: function (a) {
                        return b.hasOwnProperty(a) ? g.from(b[a]) : g.none()
                    }
                }
            }, inactive: function () {
                return {lookup: g.none}
            }
        }, ona = Cc([za("language"), za("words")]), W_ = {many: h(ona)}, pna = function (a, b) {
            return zc(a, b).getOrThunk(function () {
                return lm()
            })
        }, Px = Ha("good-spelling"), nB = {
            execute: function (a, b, c, d, e, f) {
                var g = pna(b, c);
                f = nm.multiple(function (b, d) {
                        return a.execute({language: c, words: b})
                    }, g, d, function (a) {
                        return a.spell
                    },
                    ca, e, void 0 !== f ? f : !1);
                b[c] = g;
                return hf.mapSync(f, function (a) {
                    z(d, function (b) {
                        ye(a, b) || g.set(b, Px, e)
                    });
                    var b = {};
                    Ma(a, function (a, c) {
                        g.get(e, c).is(Px) || (b[c] = a)
                    });
                    return b
                })
            }, initCaches: function (a) {
                var b = {};
                Ma(void 0 !== a ? a : {}, function (a, d) {
                    b[d] = lm(a)
                });
                return b
            }, correct: h(Px)
        }, qna = {image: h("1"), spelling: h("1")}, ES = function (a, b) {
            return (je(a, "/") ? a : a + "/") + b
        }, Y_ = {
            corsQuery: function (a) {
                return ES(a, "version")
            }, spelling: function (a) {
                return ES(a, qna.spelling()) + "/"
            }
        }, Nl = function (a) {
            a = "data-" + B.resolve(a);
            return h(a)
        },
        Ee = {
            value: Nl("spelling-value"),
            type: Nl("spelling-type"),
            overflow: Nl("spelling-overflow"),
            overflowMenu: Nl("spelling-overflow-menu"),
            spelling: Nl("spelling-suggestion")
        }, FS = O("primary", "secondary", "submenus"), rna = O("value", "text", "attrs"),
        sna = O("textkey", "value", "items"), c0 = {
            generate: function (a, b) {
                if (a.length > b) {
                    var c = a.slice(0, b);
                    var d = rna(Ee.overflow(), x.translate("spelling.context.more"), {});
                    b = a.slice(b);
                    a = {};
                    a[Ee.overflow()] = Ee.overflowMenu();
                    b = sna(x.key("spelling.context.morelabel"), Ee.overflowMenu(),
                        b);
                    c = FS(c.concat([d]), [b], a)
                } else c = FS(a, [], {});
                return c
            }
        }, b0 = O("value", "text", "attrs"), qB = aa.detect().browser,
        h0 = Aa("communication profile content undo viewable cache url autocorrectOn language fromServiceState multilingual".split(" "), []),
        GS = function (a) {
            a = r.fromTag(a);
            var b = r.fromText(mb());
            y.append(a, b);
            n.add(a, Rb.styleSpan());
            return a
        }, HS = function (a, b, c, d) {
            var e = GS(d);
            A.firstChild(e).each(function (d) {
                a(c, e);
                b.setSelection(d, 0, d, 0)
            })
        }, IS = {nu: GS, insertAfter: u(HS, y.after), insertBefore: u(HS, y.before)},
        JS = aa.detect().browser, KS = function (a, b) {
            return kb.toLeaf(a, b)
        }, tna = function (a) {
            return D.isText(a) && 0 !== Ya.get(a).trim().length
        }, una = function (a) {
            return D.isElement(a) && "br" === D.name(a)
        }, vna = function (a) {
            return Xa([tna, una], function (b) {
                return b(a)
            })
        }, wna = function (a) {
            return D.isText(a.element()) && 0 === a.offset() || D.isElement(a.element())
        }, xna = function (a, b, c) {
            var d = h(a);
            return (!1 === b && wna(a) ? g.some(!0) : g.none()).fold(d, function (b) {
                return wc.seekLeft(a.element(), vna, c).fold(d, function (a) {
                    return W.point(a,
                        D.isText(a) ? Ya.get(a).length : 0)
                })
            })
        }, yna = function (a, b) {
            return N.eq(a.element(), b.element())
        }, wf = {
            context: function (a) {
                return a.getSelection().bind(function (b) {
                    if (b.collapsed()) {
                        var c = b.startContainer();
                        return sb.cell(c, a.isRoot).bind(function (d) {
                            return sb.table(c, a.isRoot).map(function (a) {
                                return {cell: h(d), table: h(a), start: h(c), selection: h(b)}
                            })
                        })
                    }
                    return g.none()
                })
            }, selectedCells: function (a, b) {
                return Zb.cata(a.get(), h([]), ca, function (a) {
                    var c = JS.isFirefox() ? KS(a.startContainer(), a.startOffset()) : W.point(a.startContainer(),
                        a.startOffset()),
                        e = JS.isFirefox() ? KS(a.endContainer(), a.endOffset()) : W.point(a.endContainer(), a.endOffset());
                    a = xna(e, a.collapsed() || yna(c, e), b);
                    return nf.sharedOne(function (a) {
                        return sb.cell(a, b)
                    }, [c.element(), a.element()]).toArray()
                })
            }
        }, hj = {
            none: function (a) {
                return {
                    fold: function (b, c, d, e) {
                        return b(a)
                    }
                }
            }, first: function (a) {
                return {
                    fold: function (b, c, d, e) {
                        return c(a)
                    }
                }
            }, middle: function (a, b) {
                return {
                    fold: function (c, d, e, f) {
                        return e(a, b)
                    }
                }
            }, last: function (a) {
                return {
                    fold: function (b, c, d, e) {
                        return e(a)
                    }
                }
            }
        }, LS =
            function (a, b) {
                return sb.table(a, b).bind(function (b) {
                    var c = sb.cells(b);
                    return Va(c, function (b) {
                        return N.eq(a, b)
                    }).map(function (a) {
                        return {index: h(a), all: h(c)}
                    })
                })
            }, wq = {
            next: function (a, b) {
                return LS(a, b).fold(function () {
                    return hj.none(a)
                }, function (b) {
                    return b.index() + 1 < b.all().length ? hj.middle(a, b.all()[b.index() + 1]) : hj.last(a)
                })
            }, prev: function (a, b) {
                return LS(a, b).fold(function () {
                    return hj.none()
                }, function (b) {
                    return 0 <= b.index() - 1 ? hj.middle(a, b.all()[b.index() - 1]) : hj.first(a)
                })
            }
        }, wB = {
            upOrLeft: function (a) {
                wf.context(a).each(function (b) {
                    wq.prev(b.cell()).fold(t,
                        function () {
                            Cj.isFirstInContent(a, b.table()) && Qg.isLeft(b.cell(), b.selection()) && IS.insertBefore(a, b.table(), "p")
                        }, t, t)
                })
            }, right: function (a) {
                wf.context(a).each(function (b) {
                    wq.next(b.cell()).fold(t, t, t, function () {
                        Cj.isLastInContent(a, b.table()) && Qg.isRight(b.cell(), b.selection()) && IS.insertAfter(a, b.table(), "p")
                    })
                })
            }
        }, z0 = {
            widget: function (a) {
                var b = a.content(), c = O("value", "icon", "textkey"),
                    d = c("aligntop", g.some(va.resolve("aligntop")), x.key("table.cell.alignment.top")),
                    e = c("alignmiddle", g.some(va.resolve("alignmiddle")),
                        x.key("table.cell.alignment.middle"));
                c = c("alignbottom", g.some(va.resolve("alignbottom")), x.key("table.cell.alignment.bottom"));
                var f = [d, e, c];
                d = function (a) {
                    return function (b) {
                        v.set(b, "vertical-align", a)
                    }
                };
                var k = {aligntop: d("top"), alignmiddle: d("middle"), alignbottom: d("bottom")}, l = g.none(),
                    m = function (a, b) {
                        a.enable();
                        return v.getRaw(b, "vertical-align").fold(function () {
                            return Da.on("aligntop")
                        }, function (a) {
                            return "middle" === a ? Da.on("alignmiddle") : "bottom" === a ? Da.on("alignbottom") : Da.on("aligntop")
                        })
                    };
                return {
                    name: "cell-alignment",
                    textkey: x.key("table.cell.alignment.toolbar"),
                    menuTextkey: x.key("table.cell.alignment.toolbar"),
                    action: function (c) {
                        b.focus();
                        var d = wf.selectedCells(a.selections(), b.isRoot);
                        z(d, k[c]);
                        b.uiChanged()
                    },
                    updateDropdown: function (c) {
                        var d = wf.selectedCells(a.selections(), b.isRoot);
                        0 < d.length ? d = m(c, d[0]) : (c.disable(), d = Da.off());
                        c.populate([{label: g.none, items: h(f)}]);
                        cm.updateMenu(c, d, Da.on(), f, l)
                    },
                    values: f,
                    render: l,
                    tooltip: qb.get,
                    toggle: !1,
                    describe: function (a) {
                        return x.translate("alignment.describe",
                            x.get(a.textkey()))
                    }
                }
            }
        }, zna = {
            cssNamespace: "table-cell-border",
            i18nNamespace: "table.cell.border",
            property: "border-width",
            tag: "table",
            specials: [["thin", "medium", "thick"]]
        }, y0 = {
            widget: function (a) {
                var b = a.content(), c = Gm(zna);
                c.initLayout();
                S.dialog(c.element(), x.translate("aria.table.cell.border.size"));
                var d = H.create({done: p([]), abort: Q([], c.events.abort)});
                c.events.close.bind(function (a) {
                    d.trigger.done();
                    b.focus()
                });
                c.events.action.bind(function (c) {
                    var d = Z.active();
                    b.focus();
                    var e = wf.selectedCells(a.selections(),
                        b.isRoot);
                    z(e, function (a) {
                        v.set(a, "border-width", c.value());
                        v.getRaw(a, "border-style").fold(function () {
                            v.set(a, "border-style", "solid")
                        }, t)
                    });
                    b.domChanged();
                    d.each(Z.focus)
                });
                var e = function () {
                    c.enter();
                    c.open()
                };
                return {
                    element: c.element,
                    destroy: c.destroy,
                    name: h("cellborderwidth"),
                    textkey: h(x.key("table.cell.border.width")),
                    tooltip: qb.get,
                    label: h(!1),
                    updateWidget: function (d) {
                        var f = wf.selectedCells(a.selections(), b.isRoot);
                        0 < f.length ? (d.enable(), d = v.getRaw(f[0], "border-width").fold(Da.off, Da.on), c.updateInlineWidget({size: h(d)},
                            "1px")) : d.disable();
                        e()
                    },
                    events: d.registry,
                    open: e,
                    close: c.close
                }
            }
        }, Ana = Aa(["name", "textkey", "menuTextkey", "action", "shortname"], []), uB = {
            widget: function (a, b, c) {
                var d = Ana(c), e = a.content();
                c = T.div();
                S.label(c, x.translate(d.textkey()));
                ma.add(c, [B.resolve("palette-cell-colors"), B.resolve(d.shortname() + "-cell-colors")]);
                var f = Ij.create(b.colors.buttons);
                y.append(c, f.element());
                var g = function (b) {
                    var c = wf.selectedCells(a.selections(), e.isRoot);
                    d.action()(c, b);
                    n.trigger.done()
                }, l = Dm(f.element()), m = (b.colors.custom ?
                    Fm.create : Fm.stub)(e, a.smartview().uiContainer());
                P.append(c, m.elements);
                m.events.selected.bind(function (a) {
                    g(a.color())
                });
                var n = H.create({done: p([]), abort: p([])});
                f.events.selected.bind(function (a) {
                    a = a.value();
                    g(a)
                });
                var r = function () {
                    m.refresh();
                    t.enter();
                    l.refresh()
                }, t = ha.multiple(c, [l.grid].concat(m.layouts));
                t.events.exit.bind(function () {
                    n.trigger.abort()
                });
                return {
                    element: h(c), destroy: function () {
                        t.destroy();
                        f.destroy();
                        m.destroy()
                    }, name: h(d.name()), textkey: h(x.key(d.textkey())), tooltip: qb.get,
                    label: h(!1), updateWidget: function (b) {
                        lj.isHighContrast(a.smartview()) ? b.disable() : (0 === wf.selectedCells(a.selections(), e.isRoot).length ? b.disable() : b.enable(), r())
                    }, events: n.registry, open: r, close: function () {
                        n.trigger.done()
                    }
                }
            }
        }, Bna = {styles: {"border-collapse": "collapse", width: "100%"}, attributes: {border: "1"}, percentages: !0},
        Cna = function (a, b, c, d, e) {
            void 0 === e && (e = Bna);
            var f = r.fromTag("table");
            v.setAll(f, e.styles);
            m.setAll(f, e.attributes);
            var g = r.fromTag("tbody");
            y.append(f, g);
            for (var h = [], n = 0; n < a; n++) {
                for (var p =
                    r.fromTag("tr"), t = 0; t < b; t++) {
                    var u = n < c || t < d ? r.fromTag("th") : r.fromTag("td");
                    t < d && m.set(u, "scope", "row");
                    n < c && m.set(u, "scope", "col");
                    y.append(u, r.fromTag("br"));
                    e.percentages && v.set(u, "width", 100 / b + "%");
                    y.append(p, u)
                }
                h.push(p)
            }
            P.append(g, h);
            return f
        }, Dna = {
            insert: function (a, b, c, d, e) {
                return a.getSelection().bind(function (f) {
                    var k = Cna(b, c, d, e);
                    sd.insertAtCursor(a, [k]).each(function (b) {
                        sb.firstCell(k).each(function (b) {
                            a.setSelection(b, 0, b, 0)
                        })
                    });
                    return g.some(k)
                })
            }
        }, Ena = vd.resolve("table-picker"), Fna =
            vd.resolve("table-picker-row"), Gna = vd.resolve("table-picker-cell"), Hna = vd.resolve("table-picker-button"),
        $g = {table: h(Ena), row: h(Fna), cell: h(Gna), button: h(Hna)}, Ina = "." + $g.cell(), Jna = "." + $g.row(),
        cg = {
            cells: function (a) {
                return Y.descendants(a, Ina)
            }, rows: function (a) {
                return Y.descendants(a, Jna)
            }, grid: function (a, b, c) {
                b = parseInt(m.get(a, b), 10);
                a = parseInt(m.get(a, c), 10);
                return Oa.grid(b, a)
            }, button: function (a) {
                return L.child(a, "." + $g.button()).getOr(a)
            }
        }, MS = function (a, b, c, d, e) {
            d = Math.max(d, Math.min(e, a.row()));
            a = Math.max(b, Math.min(c, a.column()));
            return Oa.address(d, a)
        }, NS = function (a, b) {
            a = MS(a, 1, b.maxCols, 1, b.maxRows);
            var c = Oa.address(a.row() + 1, a.column() + 1);
            b = MS(c, b.minCols, b.maxCols, b.minRows, b.maxRows);
            return {selection: h(a), full: h(b)}
        }, sB = {
            resize: function (a, b) {
                a = Oa.address(a.row() + 1, a.column() + 1);
                return NS(a, b)
            }, grow: function (a, b, c, d) {
                a = Oa.address(a.rows() + c, a.columns() + b);
                return NS(a, d)
            }
        }, OS = function (a, b, c, d) {
            var e = a.width() / b.columns();
            a = a.height() / b.rows();
            return Oa.address(Math.floor(d / a), Math.floor(c /
                e))
        }, Kna = {
            pickerCell: function (a, b, c, d) {
                var e = d.x() - a.x();
                a = d.y() - a.y();
                return OS(b, c, e, a)
            }, isRtl: h(!1)
        }, Lna = {
            pickerCell: function (a, b, c, d) {
                var e = a.x() + b.width() - d.x();
                a = d.y() - a.y();
                return OS(b, c, e, a)
            }, isRtl: h(!0)
        }, x0 = {
            widget: function (a, b) {
                var c = a.content(), d = m0(a.region().uiDirection().isRtl() ? Lna : Kna, b), e = a.undo();
                a = H.create({done: Q([], d.events.done), abort: Q([], d.events.abort)});
                d.events.select.bind(function (a) {
                    e.save();
                    Dna.insert(c, a.rows(), a.cols(), a.rowHeaders(), a.columnHeaders()).each(function (a) {
                        e.save();
                        c.domChanged()
                    });
                    c.toEditing()
                });
                return {
                    element: d.element,
                    name: h("table"),
                    textkey: h(x.key("insert.table")),
                    menuTextkey: h(x.key("table.menu")),
                    tooltip: qb.get,
                    label: h(!1),
                    updateWidget: function (a) {
                        c.getSelection().each(function (b) {
                            a.enable()
                        });
                        d.open()
                    },
                    destroy: d.destroy,
                    events: a.registry,
                    open: d.open,
                    close: d.close
                }
            }
        }, Vj = {
            set: function (a, b) {
                a.dom().checked = b
            }, find: function (a) {
                return L.descendant(a, "input:checked")
            }
        }, PS = Aa(["floatval", "caption", "summary", "border", "dimensions"], []), Mna = function (a) {
            a = m.get(a,
                "border");
            return "0" === a || "1" === a ? g.some(a) : g.none()
        }, Nna = function (a) {
            var b = v.getRaw(a, "width");
            a = v.getRaw(a, "height");
            return {width: h(b), height: h(a)}
        }, Ur = {
            divine: function (a, b) {
                var c = uu.divine(b), d = m.get(b, "summary"), e = L.child(b, "caption").map(function (b) {
                    b = Ea.get(b);
                    return a.filterHtml(a.output(), b)
                }).getOr(""), f = Mna(b);
                b = Nna(b);
                return PS({floatval: c, caption: e, summary: d, border: f, dimensions: b})
            }, properties: PS, apply: function (a, b) {
                b.floatval().each(function (b) {
                    oh.runFloat(a, b)
                });
                b.border().each(function (b) {
                    m.set(a,
                        "border", b)
                });
                "" === b.summary() ? m.remove(a, "summary") : Qf.setSummary(a, b.summary());
                "" === b.caption() ? L.child(a, "caption").each(F.remove) : Qf.setCaption(a, b.caption());
                Qf.setDimensions(a, b.dimensions())
            }
        }, Vr = {
            halve: function (a, b) {
                pc.getGenericWidth(a).each(function (c) {
                    var d = c.width() / 2;
                    pc.setGenericWidth(a, d, c.unit());
                    pc.setGenericWidth(b, d, c.unit())
                })
            }
        }, QS = function (a, b, c, d) {
            return c.fold(g.none, g.none, function (a, b) {
                return kc.first(b).bind(function (a) {
                    return g.some(Sc(a, 0, a, 0))
                })
            }, function (c) {
                return sb.table(c,
                    b.isRoot).bind(function (e) {
                    Ac.execute(a, nc.insertRowAfter, t, d)(b, e, Um.noMenu(c));
                    e = Y.descendants(e, "tr");
                    if (0 < e.length) return L.descendant(e[e.length - 1], "td,th").map(function (a) {
                        return Sc(a, 0, a, 0)
                    })
                })
            })
        }, vB = {
            forward: function (a, b, c, d) {
                return QS(a, b, wq.next(c), d)
            }, backward: function (a, b, c, d) {
                return QS(a, b, wq.prev(c), d)
            }
        }, tB = {
            setBorderColor: function (a, b) {
                v.set(a, "border-color", b);
                v.getRaw(a, "border-style").fold(function () {
                    v.set(a, "border-style", "solid")
                }, t)
            }, setBackgroundColor: function (a, b) {
                v.set(a, "background-color",
                    b)
            }, setHeight: function (a, b) {
                v.set(a, "height", b)
            }, setWidth: function (a, b) {
                v.set(a, "width", b)
            }, setType: function (a, b) {
                b = Pc.copy(a, b);
                y.after(a, b);
                F.remove(a)
            }, setScope: function (a, b) {
                m.set(a, "scope", b)
            }, setStyle: function (a, b) {
                m.set(a, "style", b)
            }, setClass: function (a, b) {
                m.set(a, "class", b)
            }
        }, u0 = vd.resolve("resizer-bar-dragging"), Ona = O("withSpaces", "withoutSpaces"), Pna = function (a) {
            return ka(a.split(/[\.,-\/#!$%\^&\*;:{}=\-_`~()\s\u00A0]/gim), function (a) {
                return 0 < a.length
            }).length
        }, xB = {
            count: function (a) {
                return {
                    words: h(Pna(a)),
                    characters: h(Ona(a.length, a.replace(/[\s\u00A0]/gim, "").length))
                }
            }
        },
        F0 = Aa("accessibility formatting alignindent bookmark directionality table font parlance media imageEdit blocktag specialchar wordcount link linkvalidator horizontalrule help fileupload findreplace plaincodeview macros spelling".split(" "), []),
        xq = 0, Qx = g.none(), Yr = {
            add: function () {
                if (0 === xq) {
                    var a = r.fromTag("style");
                    Vb.set(a, '/*\n * Keep this file as small as possible.\n * It is injected into the JavaScript, so it needs to be tiny.\n */\n\n/*\n * Animate from 0 to 359, not 0 to 360, as they are the same and FireFox does nothing\n *\n * Until we have token replacement, manual shorthand for "ephox-polish-spin"\n */\n\n@keyframes e-p-spin {\n  0% {\n    transform: rotate(0deg);\n  }\n  100% {\n    transform: rotate(359deg);\n  }\n}\n\n/* Until we have token replacement, manual shorthand for "ephox-polish-spinner-img" */\n\n.e-p-s-img {\n  animation: e-p-spin 2s infinite linear;\n  width: 30px;\n  height: 30px;\n  margin: 2px 2em 0 auto;\n  background: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQBAMAAADt3eJSAAAAIVBMVEUAAABAQEBDQ0NERERERERCQkJDQ0NERERDQ0NEREREREQTPu3mAAAACnRSTlMAENDPwGBwsKB/qy4kVgAAAFpJREFUCNdjAAImAwYI4FoApooFuBYwWgAZXoZMCsJLgAyhpQwMUYpABmMiA4OYAAMCaC2GklqLwIxFMAmoYkmQYmGQdkOQgYpMBkIgA4tAVmggLAU7QwFIAADjyQ3FWhtneAAAAABJRU5ErkJggg==") 0/cover;\n}');
                    y.append(ja.body(), a);
                    Qx = g.some(a)
                }
                xq++
            }, remove: function () {
                0 !== xq && 0 === --xq && (Qx.each(F.remove), Qx = g.none())
            }
        }, Qna = hc.pencil(), yq = hc.code(), RS = function (a) {
            var b = a.old().toTransfer();
            a.nu().fromTransfer(b)
        }, Rna = {transition: RS, factory: gy, style: hc.pencil}, Sna = {transition: RS, factory: Vm, style: hc.code},
        Wm = {
            goingToDesign: function (a) {
                return a === yq
            }, alternate: function (a) {
                return a === yq ? Qna : yq
            }, detect: function (a) {
                return a === yq ? Rna : Sna
            }
        }, J0 = function (a, b) {
            return {
                destroy: t, init: t, setMode: yb("Code view is not enabled, cannot switch modes"),
                events: H.create({change: p([]), ready: p([])}).registry
            }
        }, I0 = function (a, b) {
            var c = b.css + "/codemirror.css", d = H.create({change: p([]), ready: p(["type"])}), e = g.none(),
                f = function () {
                    var a = Tl.load.codeview(b.js).map(function (a) {
                        return a.map(h(!0))
                    });
                    e = g.some(a)
                }, k = function (a) {
                    a(I.value(!0))
                };
            return {
                init: function (a) {
                    e.fold(function () {
                            gn.addStylesheet(c, k).get(function (b) {
                                b.fold(function (a) {
                                    console.error(a);
                                    console.error("Code View disabled due to error loading stylesheet")
                                }, function () {
                                    f();
                                    d.trigger.ready(a)
                                })
                            })
                        },
                        function (b) {
                            d.trigger.ready(a)
                        })
                }, setMode: function (b) {
                    return e.fold(function () {
                        throw"Cannot set mode before Code View has loaded";
                    }, function (c) {
                        c.get(function (c) {
                            c.fold(function (a) {
                                d.trigger.ready(b);
                                console.error(a);
                                console.error("Code View non-functional due to error downloading script file")
                            }, function () {
                                var c = Wm.detect(b), e = a.swap(c.factory, {}, {});
                                d.trigger.change();
                                c.transition(e);
                                e.destroy()
                            })
                        })
                    })
                }, events: d.registry, destroy: t
            }
        }, zB = aa.detect().browser, N0 = {
            build: function (a, b, c, d, e, f, g, l) {
                var k =
                    L0(a, b, c, f, g, l), m = d.full(k);
                m.init();
                return {
                    element: k.element,
                    socket: k.socket,
                    viewport: k.viewport,
                    uiContainerParent: k.uiContainerParent,
                    init: function (b, d, g) {
                        d = m.config(a.isInline(), d, e, g);
                        BE.setup(k, f, a, b, c, d);
                        m.loaded()
                    },
                    connect: k.connect,
                    destroy: function () {
                        k.destroy();
                        m.destroy()
                    },
                    displayBanner: k.displayBanner,
                    hideBanner: k.hideBanner,
                    position: t,
                    refresh: k.refresh,
                    tabstrip: k.toolbar,
                    state: h(l),
                    dialogContainer: k.dialogContainer
                }
            }, bounds: function () {
                return Bf.view
            }
        }, SS = {
            blobTob64: function (a, b) {
                var c =
                    m.get(b, uc.blobId());
                m.remove(b, uc.blobId());
                a.get(c).each(function (a) {
                    m.remove(b, uc.blobId());
                    m.set(b, "src", Yc.imageResultToDataURL(a.imageresult()))
                })
            }, b64ToBlob: function (a, b) {
                var c = m.get(b, "src"), d = function () {
                    return Nj.dataUriToBlobSync(c).map(function (b) {
                        var d = Yc.fromBlobAndUrlSync(b, c);
                        b = dg.createObjectURL(b);
                        var e = Ha("image");
                        return a.add(e, d, b)
                    })
                };
                try {
                    a.lookupByData(c).fold(d, g.some).each(function (a) {
                        m.set(b, uc.blobId(), a.id());
                        m.set(b, "src", a.objurl())
                    })
                } catch (e) {
                    console.warn("Unable to read Base64 image data: ",
                        e, c)
                }
            }
        }, a1 = {
            configure: function (a, b) {
                var c = uc.blobId(), d = "img[" + c + "]";
                a.addSelector(a.internal(), d, Na.removeAttr(c));
                a.addSelector(a.output(), d, function (a) {
                    z(a, function (a) {
                        SS.blobTob64(b, a)
                    })
                });
                a.addSelector(a.input(), "img:not([" + c + "])[src]", function (a) {
                    z(a, function (a) {
                        SS.b64ToBlob(b, a)
                    })
                });
                c = Na.removeClass(uc.uploadInProgress());
                a.add(a.output(), uc.uploadInProgress(), c);
                a.add(a.history(), uc.uploadInProgress(), c);
                a.add(a.internal(), uc.uploadInProgress(), c);
                d = uc.trackedImage();
                c = "img[" + d + "]";
                d = Na.removeAttr(d);
                a.addSelector(a.output(), c, d);
                a.addSelector(a.internal(), c, d)
            }, blobId: uc.blobId
        }, TS = O("image", "blobInfo"), Rx = ta.generate([{failure: ["error"]}, {success: ["result", "images", "blob"]}]),
        Una = function (a, b, c, d) {
            z(b, function (a) {
                m.set(a, "src", d.location);
                m.remove(a, uc.blobId())
            });
            return Tna(a, c)
        }, US = function (a, b, c, d, e) {
            var f = Yc.imageResultToDataURL(c);
            f = a.lookupByData(f).getOrThunk(function () {
                return a.add(b, c, d)
            });
            m.set(e, uc.blobId(), f.id());
            return TS(e, f)
        }, Vna = function (a, b) {
            var c = m.get(b, uc.blobId());
            return a.get(c).fold(function () {
                    return I.error(c)
                },
                function (a) {
                    return I.value(TS(b, a))
                })
        }, Tna = function (a, b) {
            return a.get(b).fold(function () {
                return I.error("Internal error with blob cache")
            }, function (c) {
                a.remove(b);
                return I.value(c)
            })
        }, Zj = {
            prepareForUpload: function (a, b, c) {
                var d = a.isActive(b);
                a.register(c, b);
                n.add(c, uc.uploadInProgress());
                return d ? g.none() : g.some(b)
            }, handleUpload: function (a, b, c, d, e, f, g) {
                var k = function () {
                    console.error("Internal error with blob cache", e);
                    g(Rx.failure({status: h(666)}))
                };
                a.upload(f, e, function (a) {
                    var f = b.findById(d, e);
                    z(f,
                        yf.removeClass(uc.uploadInProgress()));
                    a.fold(function (a) {
                        g(Rx.failure(a))
                    }, function (a) {
                        Una(c, f, e, a).fold(k, function (b) {
                            g(Rx.success(a, f, b))
                        })
                    });
                    b.report(e, f, a.isValue())
                })
            }, registerAssets: function (a, b, c) {
                return ia(c, function (c) {
                    return Qc.cata(c, function (c, d, g) {
                        return L.descendant(b, 'img[src="' + g + '"]').fold(function () {
                            return [I.error("Image that was just inserted could not be found: " + g)]
                        }, function (b) {
                            return [I.value(US(a, c, d, g, b))]
                        })
                    }, h([]))
                })
            }, registerBlob: US, findBlobs: function (a, b, c) {
                c = a.findAll(c);
                return a.inProgress() ? [] : E(c, function (a) {
                    return Vna(b, a)
                })
            }
        }, Wna = function (a) {
            var b = function (b) {
                var c = b.image(), e = b.blobInfo(), f = vr.changedBounds(c);
                e = Ua.fromPromise(Yc.imageResultToOriginalBlob(e.imageresult()));
                return Ua.bind(e, function (d) {
                    return Fj.resampleAction(f, d, function (e) {
                        if (e === d) return Ua.pure(b);
                        var f = sf.updater(sf.keepResample, c), g = xr.applyEdit(c);
                        e = Re.single(e).bind(g).map(f);
                        return Ua.map(e, function (d) {
                            return Qc.cata(d, function (b, d, e) {
                                return Zj.registerBlob(a, b, d, e, c)
                            }, function (a, c,
                                         d) {
                                return b
                            })
                        })
                    })
                })
            };
            return function (a) {
                return Ce(a, b)
            }
        }, Xna = function (a) {
            a = E(a, I.value);
            return Ga.pure(a)
        }, $0 = {
            instance: function (a, b) {
                return !0 === a.immediate ? Xna : Wna(b)
            }
        }, Yna = {
            400: "errors.http.400",
            401: "errors.http.401",
            403: "errors.http.403",
            404: "errors.http.404",
            407: "errors.http.407",
            409: "errors.http.409",
            413: "errors.http.413",
            415: "errors.http.415",
            500: "errors.http.500",
            501: "errors.http.501"
        }, Zna = {
            get: function (a, b) {
                return g.from(Yna[a]).map(function (a) {
                    return x.translate(a, b)
                })
            }
        }, $na = function (a) {
            return xa(a) &&
            "" !== a.trim() ? {description: h(a), link: h(null)} : mf.get("error.imageupload.generic")
        }, aoa = function (a, b) {
            var c = b.status();
            return Zna.get(c, a).fold(function () {
                var b = 0 === c ? "error.imageupload.cors" : 400 <= c && 500 > c ? "error.code.images.not.found" : "error.imageupload";
                return mf.get(b, [a])
            }, function (a) {
                return {description: h(a), link: h(null)}
            })
        }, VS = function (a, b) {
            return {
                instance: function () {
                    return gc(function (c) {
                        c = b(c);
                        a.show(c)
                    })
                }
            }
        }, WS = {
            simple: function (a) {
                return VS(a, $na)
            }, url: function (a, b) {
                return VS(a, u(aoa, b))
            }
        },
        boa = ["jpg", "png", "gif", "jpeg"], Yj = {
            failureObject: O("message", "status", "contents"), getFilename: function (a, b) {
                xa(a.name) && !je(a.name, ".tmp") ? b = a.name : xa(a.type) && Gb(a.type, "image/") && (a = a.type.substr(6), b = U(boa, a) ? b + "." + a : b);
                return b
            }, buildData: function (a, b, c) {
                var d = new (Kc.getOrDie("FormData"));
                d.append(a, b, c);
                return d
            }
        }, R0 = O("id", "filename", "blob", "base64"), XS = {
            direct: function (a) {
                return P0(a)
            }, custom: function (a) {
                return Q0(a)
            }
        }, Sx = O("uploader", "errors"), Z0 = {
            choose: function (a, b, c) {
                return !0 !== a.bundled ?
                    Sx({upload: yb}, {instance: h(yb("Image Upload is disabled"))}) : vb(a.handler) ? Sx(XS.custom(a.handler), WS.simple(b)) : Sx(XS.direct(a.direct), WS.url(b, a.direct.url))
            }
        }, T0 = O("id", "imageresult", "objurl"), Xm = uc.trackedImage(), W0 = function (a, b) {
            return Y.descendants(a, "img[" + Xm + '="' + b + '"]')
        }, X0 = function (a) {
            return Y.descendants(a, "img:not([" + Xm + "])[" + uc.blobId() + "]")
        }, coa = {
            settings: function (a) {
                var b = {
                    ui: {toolbar: {display: !1}},
                    spelling: {bundled: !1},
                    highlighter: {bundled: !1},
                    table: {bundled: !1},
                    resize: {bundled: !1},
                    codeview: {bundled: !1},
                    imageEdit: {bundled: !1},
                    imageupload: {immediate: !0},
                    linkvalidator: {bundled: !1}
                };
                b = aa.detect().deviceType.isTouch() ? b : {};
                return oa(b, void 0 === a.content || void 0 === a.content.inline ? {} : {
                    fullscreen: {bundled: !1},
                    codeview: {bundled: !1},
                    plaincodeview: {bundled: !1}
                })
            }
        }, CB = {isRtl: h(!1)}, BB = {isRtl: h(!0)}, d1 = function (a) {
            return Xa(["ar", "fa", "he"], function (b) {
                return Gb(a, b)
            })
        }, f1 = function (a) {
            return oa(DB.settings(a.resources), a, coa.settings(a))
        }, YS = function (a, b, c) {
            var d = RC.withOptions(a, c);
            d.content &&
            d.content.tabindex && (0, m.remove)(a, "tabindex", d.content.tabindex);
            c = as(d, {});
            var e = Ea.get(a), f = m.get(a, "style");
            b(a);
            Ea.set(a, "");
            c.connect(a);
            Fd.set(c, e);
            return {
                polish: c, restore: function (b) {
                    Ea.set(a, b);
                    null !== f && void 0 !== f && 0 < f.length ? m.set(a, "style", f) : m.remove(a, "style");
                    d.content && d.content.tabindex && (0, m.set)(a, "tabindex", d.content.tabindex);
                    return a
                }
            }
        }, ZS = {
            replace: function (a, b) {
                return YS(a, b.content && !0 === b.content.autoresize ? N2 : M2, b)
            }, takeover: function (a, b) {
                return YS(a, t, b)
            }
        }, Ob = function (a,
                          b) {
            var c = {};
            if (void 0 === a) return c;
            z(b, function (b) {
                var d = b.name();
                d = a[d];
                void 0 !== d && (b.validate(d), c[b.output()] = Mb(b.contents) ? Ob(d, b.contents) : d)
            });
            return c
        }, doa = function (a) {
            return E(void 0 === a ? [] : a, function (a) {
                var b = Ob, d = ba.string("prefix"), e = ba.string("suffix");
                var f = [ba.string("color"), ba.string("background-color")];
                f = ua(ba.object("style"), {contents: f});
                return b(a, [d, e, f])
            })
        }, eoa = function (a) {
            if (void 0 === a || void 0 === a.url) return {service: !1};
            var b = $S(a, "autocorrect", !0);
            if (xa(a.url)) return {
                url: a.url,
                service: !0, autocorrect: b
            };
            throw Error("Spelling URL was not a string");
        }, foa = function (a) {
            if (void 0 === a || void 0 === a.validation || void 0 === a.validation.url) return {};
            if (xa(a.validation.url)) return {url: a.validation.url, bundled: !0};
            throw Error("Link Validation URL was not a string");
        }, goa = function (a) {
            if (void 0 === a || void 0 === a.embed || void 0 === a.embed.url) return {};
            if (xa(a.embed.url)) return {url: a.embed.url, bundled: !0};
            throw Error("Link Embed URL was not a string");
        }, hoa = function (a, b) {
            b = !1 === b ? !0 : !1;
            a = (void 0 ===
            a ? {} : a).upload;
            if (void 0 !== a) {
                if (void 0 !== a.handler) {
                    if (!vb(a.handler)) throw Error("Image Upload Handler was not a function");
                    return {handler: a.handler, immediate: b, bundled: !0}
                }
                if (!xa(a.url)) throw Error("Image Upload URL was not a string");
                return {
                    direct: Ob(a, [ba.string("url"), ba.string("basePath"), ba.bool("credentials")]),
                    immediate: b,
                    bundled: !0
                }
            }
            return {}
        }, ioa = function (a) {
            a = Ob((void 0 === a ? {} : a).editing, [ba.bool("enabled"), ba.string("proxy"), ba.number("preferredWidth"), ba.number("preferredHeight")]);
            void 0 !== a.enabled && (a.bundled = a.enabled);
            return a
        }, $S = function (a, b, c) {
            if (void 0 === a[b]) return c;
            ba.bool(b).validate(a[b]);
            return a[b]
        }, joa = function (a) {
            return Ob((void 0 === a ? {} : a).toolbar, [ba.arrayOfToolbarGroups("items"), ba.arrayOfStrings("contextual")])
        }, koa = function (a) {
            if (void 0 === a) return {};
            if (void 0 === a.toolbar) var b = {}; else {
                var c = a.toolbar;
                if (void 0 !== c.offset) {
                    c = c.offset;
                    if (!ic(c) || void 0 === c.top || void 0 === c.left) throw Error("toolbar offset must be an object with left and top");
                    if (!$e(c.top) &&
                        !$e(c.left)) throw Error("toolbar offset values must be numbers");
                    b = {draggable: !0, offset: {left: c.left, top: c.top}}
                } else b = {}
            }
            c = Ob(a.toolbar, [ba.bool("visible"), ba.bool("draggable"), ba.bool("sticky")]);
            b = oa(b, c);
            return void 0 === c.sticky && !0 === a.autoresize ? oa(b, {sticky: !0}) : b
        }, loa = function (a) {
            if (void 0 !== a) {
                if (!xa(a)) throw Error("The basePath configuration value was not a string");
                return ik(a, "/")
            }
        }, moa = function (a) {
            if (void 0 === a || void 0 === a.fonts) return [];
            a = a.fonts;
            if (!Mb(a)) throw Error("The fonts configuration was not an array");
            var b = function (a, b) {
                console.error(a + " :", b);
                throw Error(a);
            };
            return E(a, function (a) {
                if (xa(a)) return {value: a, text: a};
                ic(a) || b("The fonts array value was not a string or object", a);
                void 0 !== a.value && xa(a.value) || b("The font value configuration was not a string or is undefined", a);
                void 0 === a.text || xa(a.text) || b("The font text configuration was not a string", a);
                return {value: a.value, text: a.text && 0 < a.text.length ? a.text : a.value}
            })
        }, ooa = function (a) {
            if (void 0 === a || void 0 === a.colors) return {};
            var b = Ob(a.colors,
                [ba.bool("custom")]);
            void 0 !== a.colors.buttons && (b.buttons = noa(a.colors.buttons));
            return b
        }, noa = function (a) {
            if (!Mb(a)) throw Error("The colors button configuration was not an array");
            var b = function (a, b) {
                console.error(a + " :", b);
                throw Error(a);
            };
            return E(a, function (a) {
                if (xa(a)) return {value: a, text: a};
                ic(a) || b("A buttons array value was not a string or object", a);
                void 0 !== a.value && xa(a.value) || b("The color button value configuration was not a string or is undefined", a);
                void 0 === a.text || xa(a.text) || b("The color button text configuration was not a string",
                    a);
                return {value: a.value, text: a.text && 0 < a.text.length ? a.text : a.value}
            })
        }, poa = function (a) {
            a = Ob(void 0 === a ? {} : a, [ba.bool("enabled"), ba.bool("showButton")]);
            return {
                bundled: void 0 === a.enabled || !0 === a.enabled,
                showButton: void 0 === a.showButton || !0 === a.showButton
            }
        }, qoa = function (a) {
            a = ua({allowLocal: !0}, void 0 === a ? {} : a);
            ba.bool("allowLocal").validate(a.allowLocal);
            return a.allowLocal
        }, roa = function (a) {
            a = Ob(void 0 === a ? {} : a, [ba.arrayOfStrings("languages")]);
            return void 0 === a.languages ? {} : {
                languages: E(a.languages,
                    function (a) {
                        return a.toLowerCase()
                    })
            }
        }, soa = function (a) {
            void 0 !== a.styles && (a.styles = ka(a.styles, function (a) {
                a = a.rule;
                return !(void 0 === a || "." === a || 0 <= a.indexOf("..") || 0 <= a.indexOf("#"))
            }))
        }, toa = function (a, b, c) {
            return "plain" === a ? {forceText: !0} : {
                officeStyles: "retain" === a ? "merge" : void 0 !== a ? a : "prompt",
                htmlStyles: "retain" === a ? "merge" : void 0 !== a ? a : "merge",
                allowLocalImages: c,
                enableFlashImport: !1 === b ? !1 : !0
            }
        }, uoa = function (a) {
            a = Ob(a.macros, [ba.arrayOfStrings("allowed")]);
            void 0 !== a.allowed && (a.allowed = g.some(a.allowed));
            return a
        }, j1 = function (a) {
            var b = Ob(a, [ba.arrayOfStrings("plugins")]);
            b = void 0 === b.plugins ? [] : b.plugins;
            var c = Ob(a.ui, [ba.string("locale", "code")]), d = $S(a, "autosubmit", !0),
                e = Ob(a.content, [ba.arrayOfObjects("highlighters")]),
                f = Ob(a.paste, [ba.string("style"), ba.bool("enableFlashImport")]), g = function () {
                    var b = Ob(a.css, [ba.arrayOfStrings("stylesheets"), ba.string("documentStyles"), ba.bool("showDocumentStyles")]),
                        c = Ob(a.ui, [ba.bool("autoresize")]);
                    return ua(b, c)
                }(), h = Ob(a.css, [ba.arrayOfObjects("styles"),
                    ba.bool("showDocumentStyles")]);
            soa(h);
            var m = Ob(a.ui, [ba.bool("shortcuts", "features")]), n = roa(a.ui), p = poa(a.codeview), r = eoa(a.spelling),
                t = foa(a.links), u = goa(a.links), v = qoa(a.images), x = ioa(a.images),
                y = v ? hoa(a.images, x.bundled) : {}, z = joa(a.ui), A = koa(a.ui), B = loa(a.basePath), D = moa(a.ui),
                E = ooa(a.ui), F = function () {
                    var b = Ob(a.ui, [ba.string("aria-label", "editorName"), ba.bool("autoresize")]);
                    return ua(b, {locale: c, toolbar: A})
                }(), H = uoa(a);
            return {
                resources: B,
                plugins: b,
                spelling: r,
                linkvalidator: t,
                embed: u,
                font: {
                    faces: D,
                    colors: E
                },
                table: {colors: E},
                macros: H,
                ui: F,
                shortcuts: m,
                autosubmit: d,
                highlighter: {external: doa(e.highlighters)},
                smartclipboard: {paste: toa(f.style, f.enableFlashImport, v)},
                parlance: n,
                content: g,
                imageEdit: x,
                imageupload: y,
                blocktag: h,
                fileupload: {allowLocalImages: v},
                platform: {toolbar: z, allowLocalImages: v},
                plaincodeview: {bundled: p.bundled},
                codeview: p
            }
        }, voa = {
            getPath: function (a) {
                var b = document.getElementsByTagName("script");
                return qa(ds(b), function (b) {
                    return b.src.indexOf(a) === b.src.length - a.length
                }).map(function (b) {
                    return b.src.substring(0,
                        b.src.indexOf(a))
                }).getOr(void 0)
            }
        }, aT = gc(function () {
            return g.from(voa.getPath("textboxio.js")).map(function (a) {
                return ik(a, "/")
            })
        }), bT = function (a) {
            return a + "/resources"
        }, FB = {
            setupResources: function (a) {
                return g.from(a.resources).orThunk(aT).map(bT).fold(yb("basePath auto detection failed, please provide one in the editor configuration"), function (b) {
                    b = ak.load(b);
                    return oa(a, {resources: b})
                })
            }, speculate: function (a) {
                g.from(a).orThunk(aT).map(bT).each(ak.load)
            }
        }, woa = function (a, b, c) {
            var d = function () {
                var a =
                    r.fromDom(Hb.activeElement);
                b(a) && c()
            };
            return K.bind(a, "blur", function () {
                setTimeout(d, 200)
            })
        }, xoa = function (a, b, c) {
            return K.bind(a, "focusout", function (a) {
                cT(a, b) && c()
            })
        }, yoa = function (a, b, c) {
            return K.bind(a, "blur", function (a) {
                cT(a, b) && c()
            })
        }, zoa = function () {
            var a = aa.detect();
            return a.browser.isFirefox() ? woa : a.browser.isIE() ? xoa : yoa
        }(), cT = function (a, b) {
            a = g.from(a.raw().relatedTarget).getOr(Hb.activeElement);
            return b(r.fromDom(a))
        }, Aoa = {
            register: function (a, b, c, d) {
                var e = K.bind(a, "focus", function (a) {
                    Z.hasFocus(a.target()) &&
                    c()
                }), f = zoa(a, function (c) {
                    return !wd.closest(c, function (c) {
                        return N.eq(a, c) || N.eq(b(), c) || n.has(c, FA.magicBox())
                    })
                }, d);
                return {
                    destroy: function () {
                        e.unbind();
                        f.unbind()
                    }
                }
            }
        }, Ye = {
            replace: function (a, b) {
                b = oa(b, {content: {inline: a}});
                var c = m.clone(a), d = as(b), e = g1(d.element, a, c), f = Cq(e.toolbarHide, e.toolbarShow, !1),
                    g = function () {
                        var a = e.isVisible();
                        f.on();
                        !1 === a && d.activateInline()
                    }, h = function () {
                        d.deactivateInline();
                        f.off()
                    }, n = Aoa.register(a, d.element, g, h);
                b = function () {
                    Z.active().each(function (b) {
                        N.eq(b, a) ||
                        h()
                    })
                };
                b();
                d.events.connected.bind(b);
                d.events.loaded.bind(function () {
                    d.content().getSelection().bind(g)
                });
                var p = d.focus;
                b = {
                    polish: ua(d, {
                        focus: function () {
                            g();
                            p()
                        }
                    }), restore: function (b) {
                        n.destroy();
                        e.restore();
                        Ea.set(a, b);
                        return a
                    }
                };
                d.connect(ja.body());
                Fd.set(d, Ea.get(a));
                return b
            }
        }, Boa = {
            attach: function (a, b, c, d) {
                if (4 !== arguments.length) throw"requires 4 parameters";
                var e = function (b) {
                        return function () {
                            var c = r.fromTag("input");
                            m.setAll(c, {type: "hidden", name: b});
                            a.append(c.dom());
                            return function (a) {
                                c.val(a)
                            }
                        }
                    },
                    f = c.getOrThunk(e(b)), g = d.getOrThunk(e(b + "_styles"));
                return function (a) {
                    f(a.content);
                    g(a.styles)
                }
            }
        }, dT = function (a, b) {
            var c = a.onsubmit, d = h1(a);
            a.onsubmit = function (e) {
                if (d.inprogress()) return !0;
                b(function () {
                    c && !1 === c.apply(a) || setTimeout(d.submit, 0)
                });
                return !1
            };
            return {
                unbind: function () {
                    a.onsubmit = c
                }
            }
        }, Coa = {
            attachToFormSubmit: dT, attachToParentFormSubmit: function (a, b, c, d, e) {
                if (5 !== arguments.length) throw"requires 5 parameters";
                var f = a.parents("form:first");
                if (0 !== f.size()) {
                    var g = f.get(0), h = Boa.attach(f,
                        b, d, e);
                    dT(g, function (a) {
                        h(c());
                        a()
                    })
                }
            }
        }, Eoa = function (a, b, c, d) {
            v.set(b, "display", "none");
            var e = as(RC.withOptions(b, d)), f = fa.get(b);
            e.connect(a);
            Fd.set(e, f);
            var h = !0 === d.autosubmit ? Doa(b, e) : g.none();
            return {
                polish: e, restore: function (d) {
                    h.each(function (a) {
                        a.unbind()
                    });
                    fa.set(b, d);
                    c.fold(function () {
                        v.remove(b, "display")
                    }, function (a) {
                        v.set(b, "display", a)
                    });
                    F.remove(a);
                    return b
                }
            }
        }, Doa = function (a, b) {
            return L.closest(a, "form").map(function (c) {
                return Coa.attachToFormSubmit(c.dom(), function (c) {
                    b.uploadImages(function () {
                        fa.set(a,
                            Fd.get(b));
                        c()
                    })
                })
            })
        }, k1 = {
            textarea: {
                replace: function (a, b) {
                    var c = v.getRaw(a, "display");
                    return A.parent(a).fold(function () {
                        return null
                    }, function () {
                        var d = m.get(a, "id");
                        d = d ? "ephox_" + d : Ha("ephox");
                        var e = r.fromTag("div");
                        m.set(e, "id", d);
                        v.copy(a, e);
                        (b.content && !0 === b.content.autoresize ? L2 : K2)(a, e);
                        y.before(a, e);
                        return Eoa(e, a, c, b)
                    })
                }
            }, div: ZS, body: {
                replace: function (a, b) {
                    b = oa(b, {platform: {fillscreen: !0}});
                    a = ZS.takeover(a, b);
                    return {polish: a.polish, restore: a.restore}
                }
            }
        }, l1 = {
            div: Ye, blockquote: Ye, article: Ye,
            aside: Ye, figure: Ye, figcaption: Ye, footer: Ye, header: Ye, nav: Ye, section: Ye
        }, Ol = function (a) {
            return {name: a.name, required: fd, validate: a.validate}
        }, Ym = {
            bool: Pb(Ol, ba.bool),
            func: Pb(Ol, ba.func),
            number: Pb(Ol, ba.number),
            object: Pb(Ol, ba.object),
            string: Pb(Ol, ba.string)
        }, Tx = function (a) {
            return I.error("ERROR: Textbox.io requires " + a + " or above")
        }, Ux = aa.detect().os, Pl = aa.detect().browser,
        eT = "CSS1Compat" === Hb.compatMode || Hb.doctype && "html" === Hb.doctype.name, Foa = {
            supported: function () {
                if (Pl.isIE() && 11 > Pl.version.major) return Tx("Internet Explorer 11");
                if (Ux.isOSX() && Pl.isSafari() && 9 > Pl.version.major) return Tx("Safari 9");
                if (Ux.isiOS() && 9 > Ux.version.major) return Tx("iOS 9");
                if (!eT && Pl.isIE()) return I.error("ERROR: Document is not in standards mode. Textbox.io requires standards mode on Internet Explorer.");
                eT || void 0 === console.warn || console.warn("WARNING: Document is not in standards mode. Textbox.io may experience user interface issues.");
                return I.value(void 0)
            }
        }, fT = function (a) {
            Xf.textboxio = a
        }, Goa = Pb(fT, function (a) {
            a = yb(a);
            return {
                replace: a, replaceAll: a,
                inline: a, inlineAll: a, get: a, getActiveEditor: a, definePlugin: a, version: Vx, isSupported: fd
            }
        });
    (function () {
        var a = Xf.install;
        Xf.install = function (b, c) {
            Xf.install = a;
            Foa.supported().fold(Goa, function () {
                var a = null === c || void 0 === c ? {onprem: !0} : c;
                a = null === b || void 0 === b ? a : oa(a, {resources: b});
                fT(m1(a));
                FB.speculate(a.resources)
            })
        }
    })()
})();
install();
